{"version":3,"file":"static/js/757.4812b9f1.chunk.js","mappings":"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","sources":["pages/games/ChessGame.js"],"sourcesContent":["// src/ChessGame.js\nimport React, {\n  useState,\n  useEffect,\n  useCallback,\n  useRef,\n  Suspense,\n  lazy,\n} from \"react\";\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { usePolling } from \"../../hooks/usePolling\";\nimport {\n  db,\n  doc,\n  setDoc,\n  getDoc,\n  runTransaction,\n  increment,\n  serverTimestamp,\n  collection,\n  query,\n  where,\n  getDocs,\n  deleteDoc,\n} from \"../../firebase\";\nimport { logActivity, ACTIVITY_TYPES } from \"../../utils/firestoreHelpers\";\nimport \"./ChessGame.css\";\nimport { AlchanLoading } from \"../../components/AlchanLayout\";\nimport { logger } from \"../../utils/logger\";\n\n// 3D ë³´ë“œ ì§€ì—° ë¡œë”© (ChunkLoadError ë°©ì§€)\nfunction lazyWithRetry(importFn) {\n  return lazy(() =>\n    importFn().catch(() => {\n      const reloaded = sessionStorage.getItem(\"chunk_reload\");\n      if (reloaded) {\n        sessionStorage.removeItem(\"chunk_reload\");\n        return importFn();\n      }\n      sessionStorage.setItem(\"chunk_reload\", \"1\");\n      window.location.reload();\n      return new Promise(() => {});\n    }),\n  );\n}\nconst Chess3DCanvas = lazyWithRetry(() => import(\"./Chess3DBoard\"));\n\nconst PIECES = {\n  wK: \"â™”\",\n  wQ: \"â™•\",\n  wR: \"â™–\",\n  wB: \"â™—\",\n  wN: \"â™˜\",\n  wP: \"â™™\",\n  bK: \"â™š\",\n  bQ: \"â™›\",\n  bR: \"â™œ\",\n  bB: \"â™\",\n  bN: \"â™ž\",\n  bP: \"â™Ÿ\",\n};\n\nconst RANKS = [\n  { name: \"Unranked\", minPoints: 0 },\n  { name: \"C\", minPoints: 800 },\n  { name: \"B\", minPoints: 1000 },\n  { name: \"A\", minPoints: 1200 },\n  { name: \"S\", minPoints: 1400 },\n  { name: \"SS\", minPoints: 1600 },\n];\n\nconst RATING_CHANGE = { WIN: 15, LOSS: -10, MIN_RATING: 800 };\n\nconst getRankInfo = (points = 0) => {\n  let currentRank = RANKS[0];\n  for (let i = RANKS.length - 1; i >= 0; i--) {\n    if (points >= RANKS[i].minPoints) {\n      currentRank = RANKS[i];\n      break;\n    }\n  }\n  const nextRankIndex = RANKS.findIndex((r) => r.name === currentRank.name) + 1;\n  const nextRank = nextRankIndex < RANKS.length ? RANKS[nextRankIndex] : null;\n  const pointsForNextRank = nextRank ? nextRank.minPoints - points : 0;\n\n  return {\n    rank: currentRank.name,\n    nextRank: nextRank?.name,\n    pointsForNextRank: pointsForNextRank,\n  };\n};\n\nconst getInitialBoard = () => {\n  return [\n    [\"bR\", \"bN\", \"bB\", \"bQ\", \"bK\", \"bB\", \"bN\", \"bR\"],\n    [\"bP\", \"bP\", \"bP\", \"bP\", \"bP\", \"bP\", \"bP\", \"bP\"],\n    [null, null, null, null, null, null, null, null],\n    [null, null, null, null, null, null, null, null],\n    [null, null, null, null, null, null, null, null],\n    [null, null, null, null, null, null, null, null],\n    [\"wP\", \"wP\", \"wP\", \"wP\", \"wP\", \"wP\", \"wP\", \"wP\"],\n    [\"wR\", \"wN\", \"wB\", \"wQ\", \"wK\", \"wB\", \"wN\", \"wR\"],\n  ];\n};\n\nconst serializeBoard = (board) => {\n  const serialized = {};\n  board.forEach((row, rIndex) => {\n    row.forEach((cell, cIndex) => {\n      if (cell) {\n        serialized[`${rIndex}-${cIndex}`] = cell;\n      }\n    });\n  });\n  return serialized;\n};\n\nconst deserializeBoard = (serializedBoard) => {\n  const board = Array(8)\n    .fill(null)\n    .map(() => Array(8).fill(null));\n  for (const key in serializedBoard) {\n    const [r, c] = key.split(\"-\").map(Number);\n    board[r][c] = serializedBoard[key];\n  }\n  return board;\n};\n\n// ===== AI ì—”ì§„ =====\nconst PIECE_VALUES = {\n  P: 100,\n  N: 320,\n  B: 330,\n  R: 500,\n  Q: 900,\n  K: 20000,\n};\n\n// ìœ„ì¹˜ ê°€ì¤‘ì¹˜ í…Œì´ë¸” (í°ì˜ ì¤‘ì•™ ì§„ì¶œ ì„ í˜¸)\nconst PAWN_POSITION_BONUS = [\n  [0, 0, 0, 0, 0, 0, 0, 0],\n  [50, 50, 50, 50, 50, 50, 50, 50],\n  [10, 10, 20, 30, 30, 20, 10, 10],\n  [5, 5, 10, 25, 25, 10, 5, 5],\n  [0, 0, 0, 20, 20, 0, 0, 0],\n  [5, -5, -10, 0, 0, -10, -5, 5],\n  [5, 10, 10, -20, -20, 10, 10, 5],\n  [0, 0, 0, 0, 0, 0, 0, 0],\n];\n\nconst KNIGHT_POSITION_BONUS = [\n  [-50, -40, -30, -30, -30, -30, -40, -50],\n  [-40, -20, 0, 0, 0, 0, -20, -40],\n  [-30, 0, 10, 15, 15, 10, 0, -30],\n  [-30, 5, 15, 20, 20, 15, 5, -30],\n  [-30, 0, 15, 20, 20, 15, 0, -30],\n  [-30, 5, 10, 15, 15, 10, 5, -30],\n  [-40, -20, 0, 5, 5, 0, -20, -40],\n  [-50, -40, -30, -30, -30, -30, -40, -50],\n];\n\n// ë³´ë“œ í‰ê°€ í•¨ìˆ˜\nconst evaluateBoard = (board, color) => {\n  let score = 0;\n\n  for (let r = 0; r < 8; r++) {\n    for (let c = 0; c < 8; c++) {\n      const piece = board[r][c];\n      if (!piece) continue;\n\n      const pieceColor = piece[0];\n      const pieceType = piece[1];\n      const pieceValue = PIECE_VALUES[pieceType] || 0;\n\n      let positionBonus = 0;\n      if (pieceType === \"P\") {\n        const row = pieceColor === \"w\" ? r : 7 - r;\n        positionBonus = PAWN_POSITION_BONUS[row][c];\n      } else if (pieceType === \"N\") {\n        positionBonus = KNIGHT_POSITION_BONUS[r][c];\n      }\n\n      const totalValue = pieceValue + positionBonus;\n\n      if (pieceColor === color) {\n        score += totalValue;\n      } else {\n        score -= totalValue;\n      }\n    }\n  }\n\n  return score;\n};\n\n// Minimax ì•Œê³ ë¦¬ì¦˜\nconst minimax = (\n  board,\n  depth,\n  isMaximizing,\n  alpha,\n  beta,\n  color,\n  getValidMovesFunc,\n) => {\n  if (depth === 0) {\n    return evaluateBoard(board, color);\n  }\n\n  const currentColor = isMaximizing ? color : color === \"w\" ? \"b\" : \"w\";\n\n  // ëª¨ë“  ê°€ëŠ¥í•œ ìˆ˜ ì°¾ê¸°\n  const allMoves = [];\n  for (let r = 0; r < 8; r++) {\n    for (let c = 0; c < 8; c++) {\n      const piece = board[r][c];\n      if (piece && piece[0] === currentColor) {\n        const moves = getValidMovesFunc(board, r, c, piece, true);\n        moves.forEach(([toR, toC]) => {\n          allMoves.push({ from: [r, c], to: [toR, toC], piece });\n        });\n      }\n    }\n  }\n\n  if (allMoves.length === 0) {\n    return isMaximizing ? -999999 : 999999;\n  }\n\n  if (isMaximizing) {\n    let maxEval = -Infinity;\n    for (const move of allMoves) {\n      const newBoard = board.map((row) => [...row]);\n      newBoard[move.to[0]][move.to[1]] = move.piece;\n      newBoard[move.from[0]][move.from[1]] = null;\n\n      const evaluation = minimax(\n        newBoard,\n        depth - 1,\n        false,\n        alpha,\n        beta,\n        color,\n        getValidMovesFunc,\n      );\n      maxEval = Math.max(maxEval, evaluation);\n      alpha = Math.max(alpha, evaluation);\n      if (beta <= alpha) break;\n    }\n    return maxEval;\n  } else {\n    let minEval = Infinity;\n    for (const move of allMoves) {\n      const newBoard = board.map((row) => [...row]);\n      newBoard[move.to[0]][move.to[1]] = move.piece;\n      newBoard[move.from[0]][move.from[1]] = null;\n\n      const evaluation = minimax(\n        newBoard,\n        depth - 1,\n        true,\n        alpha,\n        beta,\n        color,\n        getValidMovesFunc,\n      );\n      minEval = Math.min(minEval, evaluation);\n      beta = Math.min(beta, evaluation);\n      if (beta <= alpha) break;\n    }\n    return minEval;\n  }\n};\n\n// AIê°€ ìµœì ì˜ ìˆ˜ ì°¾ê¸°\nconst findBestMove = (board, color, difficulty, getValidMovesFunc) => {\n  const allMoves = [];\n\n  for (let r = 0; r < 8; r++) {\n    for (let c = 0; c < 8; c++) {\n      const piece = board[r][c];\n      if (piece && piece[0] === color) {\n        const moves = getValidMovesFunc(board, r, c, piece, true);\n        moves.forEach(([toR, toC]) => {\n          allMoves.push({ from: [r, c], to: [toR, toC], piece });\n        });\n      }\n    }\n  }\n\n  if (allMoves.length === 0) return null;\n\n  // ì´ˆê¸‰: ëžœë¤ ì„ íƒ\n  if (difficulty === \"beginner\") {\n    return allMoves[Math.floor(Math.random() * allMoves.length)];\n  }\n\n  // ì¤‘ê¸‰: Depth 2\n  // ê³ ê¸‰: Depth 3\n  const depth = difficulty === \"intermediate\" ? 2 : 3;\n\n  let bestMove = null;\n  let bestValue = -Infinity;\n\n  for (const move of allMoves) {\n    const newBoard = board.map((row) => [...row]);\n    newBoard[move.to[0]][move.to[1]] = move.piece;\n    newBoard[move.from[0]][move.from[1]] = null;\n\n    const moveValue = minimax(\n      newBoard,\n      depth - 1,\n      false,\n      -Infinity,\n      Infinity,\n      color,\n      getValidMovesFunc,\n    );\n\n    if (moveValue > bestValue) {\n      bestValue = moveValue;\n      bestMove = move;\n    }\n  }\n\n  return bestMove;\n};\n\nconst ChessGame = () => {\n  const { user, userDoc, isAdmin } = useAuth();\n  // ... (state definitions)\n\n  // Force strict dark mode background via inline style\n  const containerStyle = {\n    backgroundColor: \"#0a0a12\",\n    minHeight: \"100%\",\n    width: \"100%\",\n  };\n  const [gameId, setGameId] = useState(null);\n  const [gameData, setGameData] = useState(null);\n  const [showCreateRoom, setShowCreateRoom] = useState(true);\n  const [newRoomId, setNewRoomId] = useState(\"\");\n  const [feedback, setFeedback] = useState({ message: \"\", type: \"\" });\n  const [selectedPiece, setSelectedPiece] = useState(null);\n  const [possibleMoves, setPossibleMoves] = useState([]);\n  const [availableRooms, setAvailableRooms] = useState([]);\n  const [timeControl, setTimeControl] = useState(600);\n  const [whiteTime, setWhiteTime] = useState(600);\n  const [blackTime, setBlackTime] = useState(600);\n  const [showPromotion, setShowPromotion] = useState(null);\n  const [moveHistory, setMoveHistory] = useState([]);\n  const intervalRef = useRef(null);\n  const refetchRef = useRef(null);\n  const aiTimeoutRef = useRef(null);\n  const lastAiMoveCountRef = useRef(0);\n\n  // AI ëª¨ë“œ ê´€ë ¨ state\n  const [gameMode, setGameMode] = useState(\"player\"); // 'player' or 'ai'\n  const [aiDifficulty, setAiDifficulty] = useState(\"intermediate\"); // 'beginner', 'intermediate', 'advanced'\n  const [isAiThinking, setIsAiThinking] = useState(false);\n  const [isMoving, setIsMoving] = useState(false);\n\n  // 3D ëª¨ë“œ ê´€ë ¨ state\n  const [is3DMode, setIs3DMode] = useState(true); // ê¸°ë³¸ê°’ 3D ëª¨ë“œ\n\n  // ë³´ìƒ ê´€ë ¨ state\n  const [showRewardSelection, setShowRewardSelection] = useState(false);\n  const [rewardCards, setRewardCards] = useState([]);\n\n  // ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜\n  const [dailyPlayCount, setDailyPlayCount] = useState(0);\n\n  const myColor =\n    gameData &&\n    user &&\n    (gameData.aiMode\n      ? gameData.playerColor\n      : gameData.players.white === user.uid\n        ? \"w\"\n        : \"b\");\n  const isMyTurn = gameData && gameData.turn === myColor;\n\n  const {\n    rank: userRank,\n    nextRank,\n    pointsForNextRank,\n  } = getRankInfo(userDoc?.chessRating);\n\n  const gameIdRef = useRef(gameId);\n  useEffect(() => {\n    gameIdRef.current = gameId;\n  }, [gameId]);\n  const gameDataRef = useRef(gameData);\n  useEffect(() => {\n    gameDataRef.current = gameData;\n  }, [gameData]);\n  const userRef = useRef(user);\n  useEffect(() => {\n    userRef.current = user;\n  }, [user]);\n\n  useEffect(() => {\n    const cleanup = () => {\n      const currentGameId = gameIdRef.current;\n      const currentGameData = gameDataRef.current;\n      const currentUser = userRef.current;\n      // í˜¸ìŠ¤íŠ¸(ë°± í”Œë ˆì´ì–´)ê°€ ë‚˜ê°€ë©´ í•­ìƒ ë°© ì‚­ì œ (ìƒíƒœ ë¬´ê´€)\n      if (\n        currentGameId &&\n        currentGameData &&\n        currentUser &&\n        currentGameData.players?.white === currentUser.uid\n      ) {\n        deleteDoc(doc(db, \"chessGames\", currentGameId));\n      }\n    };\n\n    window.addEventListener(\"beforeunload\", cleanup);\n\n    return () => {\n      window.removeEventListener(\"beforeunload\", cleanup);\n    };\n  }, []);\n\n  const handleTimeout = useCallback(\n    async (loserColor) => {\n      if (!gameId) return;\n      const gameRef = doc(db, \"chessGames\", gameId);\n      const winnerColor = loserColor === \"w\" ? \"b\" : \"w\";\n\n      await runTransaction(db, async (transaction) => {\n        const gameDoc = await transaction.get(gameRef);\n        if (!gameDoc.exists() || gameDoc.data().status !== \"active\") {\n          return;\n        }\n\n        const winnerId =\n          gameDoc.data().players[winnerColor === \"w\" ? \"white\" : \"black\"];\n        const loserId =\n          gameDoc.data().players[loserColor === \"w\" ? \"white\" : \"black\"];\n\n        transaction.update(gameRef, {\n          status: \"finished\",\n          winner: winnerColor,\n          endReason: \"timeout\",\n          ratingChange: {\n            [winnerColor === \"w\" ? \"white\" : \"black\"]: RATING_CHANGE.WIN,\n            [loserColor === \"w\" ? \"white\" : \"black\"]: RATING_CHANGE.LOSS,\n          },\n        });\n\n        // âœ¨ updateUserChessResult í•¨ìˆ˜ í˜¸ì¶œì„ ì—¬ê¸°ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤.\n      });\n      if (refetchRef.current) await refetchRef.current();\n    },\n    [gameId],\n  );\n\n  useEffect(() => {\n    if (gameData && gameData.status === \"active\" && isMyTurn) {\n      intervalRef.current = setInterval(async () => {\n        const gameDocRef = doc(db, \"chessGames\", gameId);\n        const currentTurn = gameData.turn;\n        if (currentTurn === \"w\") {\n          const newTime = Math.max(0, whiteTime - 1);\n          setWhiteTime(newTime);\n          if (newTime <= 0) {\n            await handleTimeout(\"w\");\n          }\n        } else {\n          const newTime = Math.max(0, blackTime - 1);\n          setBlackTime(newTime);\n          if (newTime <= 0) {\n            await handleTimeout(\"b\");\n          }\n        }\n      }, 1000);\n    }\n    return () => clearInterval(intervalRef.current);\n  }, [gameData, isMyTurn, whiteTime, blackTime, gameId, handleTimeout]);\n\n  const fetchAvailableRooms = useCallback(async () => {\n    if (!user) return;\n\n    try {\n      const q = query(\n        collection(db, \"chessGames\"),\n        where(\"status\", \"==\", \"waiting\"),\n      );\n      const querySnapshot = await getDocs(q);\n      const rooms = [];\n      querySnapshot.forEach((doc) => {\n        const data = doc.data();\n        if (data.players.white !== user.uid) {\n          rooms.push({\n            id: doc.id,\n            ...data,\n          });\n        }\n      });\n      setAvailableRooms(rooms);\n    } catch (error) {\n      logger.error(\"Error fetching rooms:\", error);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (showCreateRoom && user) {\n      fetchAvailableRooms();\n      // ðŸ”¥ [ìµœì í™”] 5ì´ˆ â†’ 60ì´ˆë¡œ ë³€ê²½ (ì½ê¸° ë¹„ìš© ì ˆê°)\n      const interval = setInterval(fetchAvailableRooms, 60000);\n      return () => clearInterval(interval);\n    }\n  }, [showCreateRoom, user, fetchAvailableRooms]);\n\n  const fetchGameData = useCallback(async () => {\n    if (!gameId) return;\n\n    const gameRef = doc(db, \"chessGames\", gameId);\n    const docSnap = await getDoc(gameRef);\n\n    if (docSnap.exists()) {\n      const rawData = docSnap.data();\n      const deserializedData = {\n        ...rawData,\n        board: deserializeBoard(rawData.board),\n      };\n      setGameData(deserializedData);\n      setShowCreateRoom(false);\n\n      if (rawData.whiteTime !== undefined) setWhiteTime(rawData.whiteTime);\n      if (rawData.blackTime !== undefined) setBlackTime(rawData.blackTime);\n      if (rawData.moveHistory) setMoveHistory(rawData.moveHistory);\n    } else {\n      setFeedback({ message: \"ê²Œìž„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\", type: \"error\" });\n      setGameId(null);\n      setGameData(null);\n      setShowCreateRoom(true);\n    }\n  }, [gameId]);\n\n  // ðŸ”¥ [ìµœì í™”] 60ì´ˆ â†’ 3ë¶„ìœ¼ë¡œ ë³€ê²½ (ì½ê¸° ë¹„ìš© ì ˆê°)\n  const { refetch } = usePolling(fetchGameData, {\n    interval: 180000,\n    enabled: !!gameId,\n  });\n\n  useEffect(() => {\n    refetchRef.current = refetch;\n  }, [refetch]);\n\n  // ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜ ë¡œë“œ\n  useEffect(() => {\n    const loadDailyPlayCount = () => {\n      if (!user) return;\n\n      const today = new Date().toDateString();\n      const storageKey = `chessPlayCount_${user.uid}_${today}`;\n      const count = parseInt(localStorage.getItem(storageKey) || \"0\", 10);\n      setDailyPlayCount(count);\n    };\n\n    loadDailyPlayCount();\n  }, [user]);\n\n  useEffect(() => {\n    if (feedback.message) {\n      const timer = setTimeout(\n        () => setFeedback({ message: \"\", type: \"\" }),\n        3000,\n      );\n      return () => clearTimeout(timer);\n    }\n  }, [feedback.message]);\n\n  const getValidMoves = useCallback(\n    (board, row, col, piece, checkForCheck = true) => {\n      const moves = [];\n      const color = piece[0];\n      const type = piece[1];\n\n      const addMove = (r, c) => {\n        if (r >= 0 && r < 8 && c >= 0 && c < 8) {\n          const target = board[r][c];\n          if (!target || target[0] !== color) {\n            if (checkForCheck) {\n              const testBoard = board.map((row) => [...row]);\n              testBoard[r][c] = piece;\n              testBoard[row][col] = null;\n              if (!isInCheck(testBoard, color)) {\n                moves.push([r, c]);\n              }\n            } else {\n              moves.push([r, c]);\n            }\n          }\n        }\n      };\n\n      switch (type) {\n        case \"P\":\n          const direction = color === \"w\" ? -1 : 1;\n          const startRow = color === \"w\" ? 6 : 1;\n\n          if (\n            row + direction >= 0 &&\n            row + direction < 8 &&\n            !board[row + direction][col]\n          ) {\n            addMove(row + direction, col);\n            if (row === startRow && !board[row + 2 * direction][col]) {\n              addMove(row + 2 * direction, col);\n            }\n          }\n\n          [-1, 1].forEach((dc) => {\n            if (\n              row + direction >= 0 &&\n              row + direction < 8 &&\n              col + dc >= 0 &&\n              col + dc < 8\n            ) {\n              const target = board[row + direction][col + dc];\n              if (target && target[0] !== color) {\n                addMove(row + direction, col + dc);\n              }\n            }\n          });\n\n          if (gameData?.enPassant) {\n            const [epRow, epCol] = gameData.enPassant;\n            if (row + direction === epRow && Math.abs(col - epCol) === 1) {\n              addMove(epRow, epCol);\n            }\n          }\n          break;\n\n        case \"N\":\n          [\n            [-2, -1],\n            [-2, 1],\n            [-1, -2],\n            [-1, 2],\n            [1, -2],\n            [1, 2],\n            [2, -1],\n            [2, 1],\n          ].forEach(([dr, dc]) => {\n            addMove(row + dr, col + dc);\n          });\n          break;\n\n        case \"B\":\n        case \"R\":\n        case \"Q\":\n          const directions = {\n            B: [\n              [1, 1],\n              [1, -1],\n              [-1, 1],\n              [-1, -1],\n            ],\n            R: [\n              [0, 1],\n              [0, -1],\n              [1, 0],\n              [-1, 0],\n            ],\n            Q: [\n              [0, 1],\n              [0, -1],\n              [1, 0],\n              [-1, 0],\n              [1, 1],\n              [1, -1],\n              [-1, 1],\n              [-1, -1],\n            ],\n          }[type];\n\n          directions.forEach(([dr, dc]) => {\n            for (let i = 1; i < 8; i++) {\n              const r = row + dr * i;\n              const c = col + dc * i;\n              if (r >= 0 && r < 8 && c >= 0 && c < 8) {\n                if (!board[r][c]) {\n                  addMove(r, c);\n                } else {\n                  if (board[r][c][0] !== color) addMove(r, c);\n                  break;\n                }\n              } else break;\n            }\n          });\n          break;\n\n        case \"K\":\n          [\n            [-1, -1],\n            [-1, 0],\n            [-1, 1],\n            [0, -1],\n            [0, 1],\n            [1, -1],\n            [1, 0],\n            [1, 1],\n          ].forEach(([dr, dc]) => {\n            addMove(row + dr, col + dc);\n          });\n\n          if (checkForCheck && gameData?.castling) {\n            const kingRow = color === \"w\" ? 7 : 0;\n            if (row === kingRow && col === 4) {\n              if (\n                gameData.castling[color + \"K\"] &&\n                !board[kingRow][5] &&\n                !board[kingRow][6] &&\n                board[kingRow][7] === color + \"R\"\n              ) {\n                if (\n                  !isSquareUnderAttack(board, kingRow, 4, color) &&\n                  !isSquareUnderAttack(board, kingRow, 5, color) &&\n                  !isSquareUnderAttack(board, kingRow, 6, color)\n                ) {\n                  addMove(kingRow, 6);\n                }\n              }\n              if (\n                gameData.castling[color + \"Q\"] &&\n                !board[kingRow][3] &&\n                !board[kingRow][2] &&\n                !board[kingRow][1] &&\n                board[kingRow][0] === color + \"R\"\n              ) {\n                if (\n                  !isSquareUnderAttack(board, kingRow, 4, color) &&\n                  !isSquareUnderAttack(board, kingRow, 3, color) &&\n                  !isSquareUnderAttack(board, kingRow, 2, color)\n                ) {\n                  addMove(kingRow, 2);\n                }\n              }\n            }\n          }\n          break;\n        default:\n          break;\n      }\n\n      return moves;\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    },\n    [gameData],\n  );\n\n  const isSquareUnderAttack = useCallback(\n    (board, row, col, color) => {\n      const opponentColor = color === \"w\" ? \"b\" : \"w\";\n\n      for (let r = 0; r < 8; r++) {\n        for (let c = 0; c < 8; c++) {\n          const piece = board[r][c];\n          if (piece && piece[0] === opponentColor) {\n            const moves = getValidMoves(board, r, c, piece, false);\n            if (moves.some(([mr, mc]) => mr === row && mc === col)) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    },\n    [getValidMoves],\n  );\n\n  const isInCheck = useCallback(\n    (board, color) => {\n      let kingPos = null;\n      for (let r = 0; r < 8; r++) {\n        for (let c = 0; c < 8; c++) {\n          if (board[r][c] === color + \"K\") {\n            kingPos = [r, c];\n            break;\n          }\n        }\n        if (kingPos) break;\n      }\n\n      if (!kingPos) return false;\n\n      return isSquareUnderAttack(board, kingPos[0], kingPos[1], color);\n    },\n    [isSquareUnderAttack],\n  );\n\n  const checkGameEnd = useCallback(\n    (board, color) => {\n      for (let r = 0; r < 8; r++) {\n        for (let c = 0; c < 8; c++) {\n          const piece = board[r][c];\n          if (piece && piece[0] === color) {\n            const moves = getValidMoves(board, r, c, piece, true);\n            if (moves.length > 0) return null;\n          }\n        }\n      }\n      if (isInCheck(board, color)) {\n        return \"checkmate\";\n      } else {\n        return \"stalemate\";\n      }\n    },\n    [getValidMoves, isInCheck],\n  );\n\n  // ë³´ìƒ ì¹´ë“œ ìƒì„±\n  const generateRewardCards = () => {\n    const cashRewards = [\n      { amount: 50000, weight: 5 },\n      { amount: 30000, weight: 10 },\n      { amount: 20000, weight: 15 },\n      { amount: 10000, weight: 20 },\n      { amount: 5000, weight: 18 },\n      { amount: 3000, weight: 12 },\n      { amount: 1000, weight: 10 },\n      { amount: 500, weight: 7 },\n      { amount: 100, weight: 3 },\n    ];\n\n    const couponRewards = [\n      { amount: 20, weight: 10 },\n      { amount: 10, weight: 20 },\n      { amount: 5, weight: 20 },\n      { amount: 3, weight: 20 },\n      { amount: 1, weight: 30 },\n    ];\n\n    const weightedRandom = (items) => {\n      const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);\n      let random = Math.random() * totalWeight;\n\n      for (const item of items) {\n        random -= item.weight;\n        if (random <= 0) {\n          return item.amount;\n        }\n      }\n\n      return items[items.length - 1].amount;\n    };\n\n    return [\n      { type: \"cash\", amount: weightedRandom(cashRewards) },\n      { type: \"coupon\", amount: weightedRandom(couponRewards) },\n    ];\n  };\n\n  // ë³´ìƒ ì„ íƒ ì²˜ë¦¬\n  const handleRewardSelection = async (selectedCard) => {\n    if (!user || !gameId) return;\n\n    try {\n      const userRef = doc(db, \"users\", user.uid);\n      const today = new Date().toDateString();\n      const storageKey = `chessPlayCount_${user.uid}_${today}`;\n\n      await runTransaction(db, async (transaction) => {\n        const userDocSnap = await transaction.get(userRef);\n        if (!userDocSnap.exists()) return;\n\n        const updateData = {};\n\n        if (selectedCard.type === \"cash\") {\n          updateData.balance = increment(selectedCard.amount);\n        } else if (selectedCard.type === \"coupon\") {\n          updateData.couponBalance = increment(selectedCard.amount);\n        }\n\n        transaction.update(userRef, updateData);\n      });\n\n      // ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜ ì¦ê°€\n      const newCount = dailyPlayCount + 1;\n      localStorage.setItem(storageKey, newCount.toString());\n      setDailyPlayCount(newCount);\n\n      setShowRewardSelection(false);\n      setFeedback({\n        message:\n          selectedCard.type === \"cash\"\n            ? `í˜„ê¸ˆ ${selectedCard.amount.toLocaleString()}ì›ì„ íšë“í–ˆìŠµë‹ˆë‹¤!`\n            : `ì¿ í° ${selectedCard.amount}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`,\n        type: \"success\",\n      });\n\n      // ðŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (AI ì²´ìŠ¤ ìŠ¹ë¦¬ ë³´ìƒ)\n      logActivity(db, {\n        classCode: userDoc?.classCode,\n        userId: user.uid,\n        userName: userDoc?.name || \"ì‚¬ìš©ìž\",\n        type: ACTIVITY_TYPES.GAME_WIN,\n        description: `ì²´ìŠ¤ AI(${aiDifficulty}) ìŠ¹ë¦¬ - ${selectedCard.type === \"cash\" ? `í˜„ê¸ˆ ${selectedCard.amount.toLocaleString()}ì›` : `ì¿ í° ${selectedCard.amount}ê°œ`} íšë“`,\n        amount: selectedCard.type === \"cash\" ? selectedCard.amount : 0,\n        couponAmount: selectedCard.type === \"coupon\" ? selectedCard.amount : 0,\n        metadata: {\n          gameType: \"chess\",\n          opponent: \"AI\",\n          difficulty: aiDifficulty,\n          rewardType: selectedCard.type,\n          rewardAmount: selectedCard.amount,\n        },\n      });\n\n      // ê²Œìž„ ë‚˜ê°€ê¸°\n      setTimeout(() => {\n        handleLeaveGame();\n      }, 2000);\n    } catch (error) {\n      logger.error(\"Error applying reward:\", error);\n      setFeedback({ message: \"ë³´ìƒ ì§€ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\", type: \"error\" });\n    }\n  };\n\n  const handleCreateRoom = async () => {\n    if (!user) {\n      setFeedback({ message: \"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\", type: \"error\" });\n      return;\n    }\n\n    // AI ëª¨ë“œì¼ ë•Œ ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜ ì²´í¬ (localStorageì—ì„œ ì§ì ‘ í™•ì¸)\n    if (gameMode === \"ai\") {\n      const today = new Date().toDateString();\n      const storageKey = `chessPlayCount_${user.uid}_${today}`;\n      const currentCount = parseInt(\n        localStorage.getItem(storageKey) || \"0\",\n        10,\n      );\n\n      if (currentCount >= 3) {\n        setFeedback({\n          message: \"ì˜¤ëŠ˜ì˜ AI ëŒ€ì „ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. (3/3)\",\n          type: \"error\",\n        });\n        return;\n      }\n    }\n\n    const newGameId = Math.random().toString(36).substring(2, 8);\n    const gameRef = doc(db, \"chessGames\", newGameId);\n\n    const isAiMode = gameMode === \"ai\";\n    const playerColor = Math.random() > 0.5 ? \"w\" : \"b\"; // AI ëª¨ë“œì—ì„œ ëžœë¤ ìƒ‰ìƒ\n    const aiColor = playerColor === \"w\" ? \"b\" : \"w\";\n\n    const initialGameData = {\n      board: serializeBoard(getInitialBoard()),\n      players: isAiMode\n        ? playerColor === \"w\"\n          ? { white: user.uid, black: \"AI\" }\n          : { white: \"AI\", black: user.uid }\n        : { white: user.uid, black: null },\n      playerNames: isAiMode\n        ? playerColor === \"w\"\n          ? {\n              white: userDoc.name,\n              black: `AI (${aiDifficulty === \"beginner\" ? \"ì´ˆê¸‰\" : aiDifficulty === \"intermediate\" ? \"ì¤‘ê¸‰\" : \"ê³ ê¸‰\"})`,\n            }\n          : {\n              white: `AI (${aiDifficulty === \"beginner\" ? \"ì´ˆê¸‰\" : aiDifficulty === \"intermediate\" ? \"ì¤‘ê¸‰\" : \"ê³ ê¸‰\"})`,\n              black: userDoc.name,\n            }\n        : { white: userDoc.name, black: null },\n      playerRanks: isAiMode\n        ? playerColor === \"w\"\n          ? { white: userRank, black: \"AI\" }\n          : { white: \"AI\", black: userRank }\n        : { white: userRank, black: \"Unranked\" },\n      playerRatings: isAiMode\n        ? playerColor === \"w\"\n          ? { white: userDoc.chessRating || 0, black: 0 }\n          : { white: 0, black: userDoc.chessRating || 0 }\n        : { white: userDoc.chessRating || 0, black: null },\n      turn: \"w\",\n      status: isAiMode ? \"active\" : \"waiting\",\n      winner: null,\n      timeControl: timeControl,\n      whiteTime: timeControl,\n      blackTime: timeControl,\n      castling: { wK: true, wQ: true, bK: true, bQ: true },\n      enPassant: null,\n      moveHistory: [],\n      createdAt: serverTimestamp(),\n      ratingChange: null,\n      aiMode: isAiMode,\n      aiDifficulty: isAiMode ? aiDifficulty : null,\n      aiColor: isAiMode ? aiColor : null,\n      playerColor: isAiMode ? playerColor : null,\n    };\n\n    try {\n      await setDoc(gameRef, initialGameData);\n      setGameId(newGameId);\n      setFeedback({\n        message: isAiMode\n          ? `AI ëŒ€ì „ ì‹œìž‘!`\n          : `ì²´ìŠ¤ ë°© ìƒì„± ì™„ë£Œ! ì½”ë“œ: ${newGameId}`,\n        type: \"success\",\n      });\n      if (refetchRef.current) await refetchRef.current();\n    } catch (error) {\n      logger.error(\"Error creating room:\", error);\n      setFeedback({ message: \"ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\", type: \"error\" });\n    }\n  };\n\n  const handleJoinRoom = async (roomId = null) => {\n    const targetRoomId = roomId || newRoomId.trim();\n\n    if (!targetRoomId) {\n      setFeedback({ message: \"ì°¸ê°€í•  ë°© ì½”ë“œë¥¼ ìž…ë ¥í•˜ì„¸ìš”.\", type: \"error\" });\n      return;\n    }\n    if (!user) {\n      setFeedback({ message: \"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\", type: \"error\" });\n      return;\n    }\n\n    const gameRef = doc(db, \"chessGames\", targetRoomId);\n\n    try {\n      await runTransaction(db, async (transaction) => {\n        const gameDoc = await transaction.get(gameRef);\n        if (!gameDoc.exists()) throw new Error(\"ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n\n        const data = gameDoc.data();\n        if (data.players.black) throw new Error(\"ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.\");\n        if (data.players.white === user.uid)\n          throw new Error(\"ìžì‹ ì´ ë§Œë“  ë°©ì—ëŠ” ì°¸ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n\n        transaction.update(gameRef, {\n          \"players.black\": user.uid,\n          \"playerNames.black\": userDoc.name,\n          \"playerRanks.black\": userRank,\n          \"playerRatings.black\": userDoc.chessRating || 0,\n          status: \"active\",\n        });\n      });\n      setGameId(targetRoomId);\n      if (refetchRef.current) await refetchRef.current();\n    } catch (error) {\n      logger.error(\"Error joining room: \", error);\n      setFeedback({ message: `ì°¸ê°€ ì‹¤íŒ¨: ${error.message}`, type: \"error\" });\n    }\n  };\n\n  const handleAdminDeleteRoom = async (roomId) => {\n    if (!isAdmin?.()) {\n      setFeedback({ message: \"ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\", type: \"error\" });\n      return;\n    }\n    try {\n      await deleteDoc(doc(db, \"chessGames\", roomId));\n      setFeedback({\n        message: `ë°© ${roomId}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`,\n        type: \"success\",\n      });\n      fetchAvailableRooms();\n    } catch (error) {\n      logger.error(\"Error deleting room by admin:\", error);\n      setFeedback({ message: \"ë°© ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\", type: \"error\" });\n    }\n  };\n\n  const handlePieceClick = (row, col) => {\n    if (!isMyTurn || gameData.status !== \"active\" || isMoving) return;\n\n    const piece = gameData.board[row][col];\n\n    if (\n      selectedPiece &&\n      possibleMoves.some(([r, c]) => r === row && c === col)\n    ) {\n      handleMove(row, col);\n    } else if (piece && piece[0] === myColor) {\n      setSelectedPiece({ row, col, piece });\n      const moves = getValidMoves(gameData.board, row, col, piece);\n      setPossibleMoves(moves);\n    } else {\n      setSelectedPiece(null);\n      setPossibleMoves([]);\n    }\n  };\n\n  const handleMove = async (toRow, toCol) => {\n    if (!selectedPiece || !gameData) return;\n\n    const { row: fromRow, col: fromCol, piece } = selectedPiece;\n\n    if (piece[1] === \"P\" && (toRow === 0 || toRow === 7)) {\n      setShowPromotion({ toRow, toCol, fromRow, fromCol });\n      return;\n    }\n\n    await executeMove(fromRow, fromCol, toRow, toCol, piece);\n  };\n\n  const handlePromotion = async (promoteTo) => {\n    if (!showPromotion) return;\n    const { fromRow, fromCol, toRow, toCol } = showPromotion;\n    const piece = gameData.board[fromRow][fromCol];\n\n    await executeMove(fromRow, fromCol, toRow, toCol, piece, promoteTo);\n    setShowPromotion(null);\n  };\n\n  const handleLeaveGame = useCallback(async () => {\n    // í˜¸ìŠ¤íŠ¸(ë°± í”Œë ˆì´ì–´)ê°€ ë‚˜ê°€ë©´ í•­ìƒ ë°© ì‚­ì œ (ìƒíƒœ ë¬´ê´€)\n    if (gameData && gameId && gameData.players?.white === user?.uid) {\n      try {\n        await deleteDoc(doc(db, \"chessGames\", gameId));\n      } catch (error) {\n        logger.error(\"Error deleting room:\", error);\n      }\n    }\n\n    setGameId(null);\n    setGameData(null);\n    setShowCreateRoom(true);\n    setSelectedPiece(null);\n    setPossibleMoves([]);\n  }, [gameData, gameId, user]);\n\n  const executeMove = useCallback(\n    async (fromRow, fromCol, toRow, toCol, piece, promotionPiece = null) => {\n      if (!gameId || isMoving) return;\n      setIsMoving(true);\n      const gameRef = doc(db, \"chessGames\", gameId);\n\n      try {\n        const result = await runTransaction(db, async (transaction) => {\n          const gameDoc = await transaction.get(gameRef);\n          if (!gameDoc.exists()) {\n            throw new Error(\"ê²Œìž„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n          }\n\n          const currentData = gameDoc.data();\n          if (currentData.status !== \"active\") {\n            return {\n              status: currentData.status,\n              winner: currentData.winner,\n              aiMode: currentData.aiMode,\n              moveMade: false,\n            };\n          }\n\n          const color = piece[0];\n          if (currentData.turn !== color) {\n            throw new Error(\"ìƒëŒ€ë°©ì˜ í„´ìž…ë‹ˆë‹¤.\");\n          }\n\n          const board = deserializeBoard(currentData.board);\n\n          let newBoard = board.map((r) => [...r]);\n          newBoard[fromRow][fromCol] = null;\n          newBoard[toRow][toCol] = promotionPiece\n            ? color + promotionPiece\n            : piece;\n\n          const newCastling = { ...currentData.castling };\n          let newEnPassant = null;\n\n          if (piece === \"wK\") {\n            newCastling.wK = false;\n            newCastling.wQ = false;\n          }\n          if (piece === \"bK\") {\n            newCastling.bK = false;\n            newCastling.bQ = false;\n          }\n          if (piece === \"wR\" && fromRow === 7 && fromCol === 0)\n            newCastling.wQ = false;\n          if (piece === \"wR\" && fromRow === 7 && fromCol === 7)\n            newCastling.wK = false;\n          if (piece === \"bR\" && fromRow === 0 && fromCol === 0)\n            newCastling.bQ = false;\n          if (piece === \"bR\" && fromRow === 0 && fromCol === 7)\n            newCastling.bK = false;\n\n          if (piece[1] === \"K\" && Math.abs(fromCol - toCol) === 2) {\n            if (toCol === 6) {\n              newBoard[fromRow][5] = newBoard[fromRow][7];\n              newBoard[fromRow][7] = null;\n            } else {\n              newBoard[fromRow][3] = newBoard[fromRow][0];\n              newBoard[fromRow][0] = null;\n            }\n          }\n\n          if (piece[1] === \"P\" && currentData.enPassant) {\n            const [epRow, epCol] = currentData.enPassant;\n            if (toRow === epRow && toCol === epCol) {\n              newBoard[fromRow][toCol] = null;\n            }\n          }\n\n          if (piece[1] === \"P\" && Math.abs(fromRow - toRow) === 2) {\n            newEnPassant = [(fromRow + toRow) / 2, fromCol];\n          }\n\n          const files = \"abcdefgh\";\n          const moveNotation = `${piece[1] !== \"P\" ? piece[1] : \"\"}${files[fromCol]}${8 - fromRow} -> ${files[toCol]}${8 - toRow}`;\n          const newMoveHistory = [...currentData.moveHistory, moveNotation];\n\n          const nextTurn = color === \"w\" ? \"b\" : \"w\";\n          let newStatus = currentData.status;\n          let newWinner = null;\n          let endReason = null;\n          let newRatingChange = null;\n\n          const gameEndState = checkGameEnd(newBoard, nextTurn);\n          if (gameEndState) {\n            newStatus = \"finished\";\n            endReason = gameEndState;\n            if (gameEndState === \"checkmate\") {\n              newWinner = color;\n            } else {\n              newWinner = \"draw\";\n            }\n          }\n\n          if (newStatus === \"finished\" && newWinner !== \"draw\") {\n            newRatingChange = {\n              [newWinner === \"w\" ? \"white\" : \"black\"]: RATING_CHANGE.WIN,\n              [newWinner === \"w\" ? \"black\" : \"white\"]: RATING_CHANGE.LOSS,\n            };\n          }\n\n          const updateData = {\n            board: serializeBoard(newBoard),\n            turn: nextTurn,\n            castling: newCastling,\n            enPassant: newEnPassant,\n            moveHistory: newMoveHistory,\n            status: newStatus,\n            winner: newWinner,\n            endReason: endReason,\n            ratingChange: newRatingChange,\n          };\n\n          transaction.update(gameRef, updateData);\n\n          return {\n            status: newStatus,\n            winner: newWinner,\n            aiMode: currentData.aiMode,\n            moveMade: true,\n          };\n        });\n\n        if (result.moveMade && result.status === \"finished\" && result.aiMode) {\n          const playerIsWinner = result.winner === myColor;\n          const isDraw = result.winner === \"draw\";\n\n          if (playerIsWinner || (isDraw && Math.random() < 0.5)) {\n            const cards = generateRewardCards();\n            setRewardCards(cards);\n            setShowRewardSelection(true);\n          } else {\n            const today = new Date().toDateString();\n            const storageKey = `chessPlayCount_${user.uid}_${today}`;\n            const newCount = dailyPlayCount + 1;\n            localStorage.setItem(storageKey, newCount.toString());\n            setDailyPlayCount(newCount);\n\n            if (isDraw) {\n              setFeedback({\n                message: \"ë¬´ìŠ¹ë¶€! ì•„ì‰½ì§€ë§Œ ë³´ìƒì€ ë‹¤ìŒ ê¸°íšŒì—!\",\n                type: \"info\",\n              });\n            }\n            setTimeout(() => handleLeaveGame(), 2000);\n          }\n        }\n\n        setSelectedPiece(null);\n        setPossibleMoves([]);\n\n        if (refetchRef.current) {\n          await refetchRef.current();\n        }\n      } catch (error) {\n        logger.error(\"Error making move: \", error);\n        setFeedback({\n          message: `ì´ë™ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`,\n          type: \"error\",\n        });\n        if (refetchRef.current) {\n          await refetchRef.current();\n        }\n      } finally {\n        setIsMoving(false);\n      }\n    },\n    [\n      gameId,\n      isMoving,\n      myColor,\n      dailyPlayCount,\n      user,\n      checkGameEnd,\n      setRewardCards,\n      setShowRewardSelection,\n      setDailyPlayCount,\n      setFeedback,\n      handleLeaveGame,\n      setSelectedPiece,\n      setPossibleMoves,\n    ],\n  );\n\n  // AI í„´ ì²˜ë¦¬ (ëª¨ë“  í•¨ìˆ˜ê°€ ì •ì˜ëœ í›„ ì‹¤í–‰)\n  useEffect(() => {\n    // Cleanup ì´ì „ timeout\n    return () => {\n      if (aiTimeoutRef.current) {\n        clearTimeout(aiTimeoutRef.current);\n        aiTimeoutRef.current = null;\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    const makeAiMove = async () => {\n      if (!gameData || !gameId || gameData.status !== \"active\") return;\n      if (!gameData.aiMode) return;\n      if (isAiThinking || isMoving) return;\n\n      const aiColor = gameData.aiColor;\n      if (gameData.turn !== aiColor) return;\n\n      // ê°™ì€ í„´ì— ì´ë¯¸ ì²˜ë¦¬í–ˆëŠ”ì§€ í™•ì¸ (moveHistory ê¸¸ì´ë¡œ ì²´í¬)\n      const currentMoveCount = gameData.moveHistory?.length || 0;\n      if (\n        currentMoveCount === lastAiMoveCountRef.current &&\n        currentMoveCount > 0\n      ) {\n        return;\n      }\n\n      setIsAiThinking(true);\n      lastAiMoveCountRef.current = currentMoveCount + 1; // ë‹¤ìŒ ìˆ˜ë¥¼ ì˜ˆìƒ\n\n      // AI ì‚¬ê³  ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ (500ms ~ 1500ms)\n      const thinkingTime = 500 + Math.random() * 1000;\n\n      aiTimeoutRef.current = setTimeout(async () => {\n        try {\n          // ìµœì‹  ê²Œìž„ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜´\n          const gameRef = doc(db, \"chessGames\", gameId);\n          const gameSnap = await getDoc(gameRef);\n\n          if (!gameSnap.exists()) {\n            setIsAiThinking(false);\n            return;\n          }\n\n          const currentGameData = gameSnap.data();\n\n          // ì—¬ì „ížˆ AI í„´ì¸ì§€ í™•ì¸\n          if (\n            currentGameData.status !== \"active\" ||\n            currentGameData.turn !== aiColor\n          ) {\n            setIsAiThinking(false);\n            return;\n          }\n\n          const currentBoard = deserializeBoard(currentGameData.board);\n          const bestMove = findBestMove(\n            currentBoard,\n            aiColor,\n            aiDifficulty,\n            getValidMoves,\n          );\n\n          if (bestMove) {\n            const { from, to, piece } = bestMove;\n            await executeMove(from[0], from[1], to[0], to[1], piece);\n          }\n        } catch (error) {\n          logger.error(\"AI move error:\", error);\n          setIsAiThinking(false);\n        }\n\n        setIsAiThinking(false);\n        aiTimeoutRef.current = null;\n      }, thinkingTime);\n    };\n\n    makeAiMove();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    gameData?.turn,\n    gameData?.status,\n    gameData?.moveHistory?.length,\n    gameId,\n    aiDifficulty,\n    executeMove,\n    getValidMoves,\n    isMoving,\n  ]);\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  if (showCreateRoom) {\n    const canPlayAi = dailyPlayCount < 3;\n\n    return (\n      <div className=\"chess-container\">\n        <div className=\"room-creation\">\n          <h2>â™š ì²´ìŠ¤ ê²Œìž„ â™”</h2>\n          <p>ì „ëžµì  ì‚¬ê³ ë ¥ì„ ê¸°ë¥´ëŠ” ìµœê³ ì˜ ë‘ë‡Œ ê²Œìž„!</p>\n\n          <div className=\"user-rank-info\">\n            <p>\n              ë‚´ ë“±ê¸‰: <strong>{userRank}</strong> ({userDoc?.chessRating || 0}\n              ì )\n            </p>\n            {nextRank && (\n              <p className=\"next-rank-guide\">\n                ë‹¤ìŒ ë“±ê¸‰ ({nextRank})ê¹Œì§€{\" \"}\n                <strong>{pointsForNextRank}ì </strong> ë‚¨ì•˜ìŠµë‹ˆë‹¤.\n              </p>\n            )}\n          </div>\n\n          {/* ê²Œìž„ ëª¨ë“œ ì„ íƒ */}\n          <div className=\"game-mode-selector\">\n            <h3>ê²Œìž„ ëª¨ë“œ ì„ íƒ</h3>\n            <div className=\"mode-options\">\n              <button\n                className={gameMode === \"player\" ? \"selected\" : \"\"}\n                onClick={() => setGameMode(\"player\")}\n              >\n                ðŸ‘¥ í”Œë ˆì´ì–´ ëŒ€ì „\n              </button>\n              <button\n                className={gameMode === \"ai\" ? \"selected\" : \"\"}\n                onClick={() => setGameMode(\"ai\")}\n              >\n                ðŸ¤– AI ëŒ€ì „ ({dailyPlayCount}/3)\n              </button>\n            </div>\n          </div>\n\n          {/* AI ë‚œì´ë„ ì„ íƒ (AI ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ) */}\n          {gameMode === \"ai\" && (\n            <div className=\"ai-difficulty-selector\">\n              <h3>AI ë‚œì´ë„</h3>\n              <div className=\"difficulty-options\">\n                <button\n                  className={aiDifficulty === \"beginner\" ? \"selected\" : \"\"}\n                  onClick={() => setAiDifficulty(\"beginner\")}\n                >\n                  ðŸ˜Š ì´ˆê¸‰\n                </button>\n                <button\n                  className={aiDifficulty === \"intermediate\" ? \"selected\" : \"\"}\n                  onClick={() => setAiDifficulty(\"intermediate\")}\n                >\n                  ðŸ¤” ì¤‘ê¸‰\n                </button>\n                <button\n                  className={aiDifficulty === \"advanced\" ? \"selected\" : \"\"}\n                  onClick={() => setAiDifficulty(\"advanced\")}\n                >\n                  ðŸ”¥ ê³ ê¸‰\n                </button>\n              </div>\n            </div>\n          )}\n\n          {feedback.message && (\n            <div className={`feedback ${feedback.type}`}>\n              {feedback.message}\n            </div>\n          )}\n\n          <div className=\"time-control-selector\">\n            <h3>ì‹œê°„ ì œí•œ ì„ íƒ</h3>\n            <div className=\"time-options\">\n              {[180, 300, 600, 900].map((time) => (\n                <button\n                  key={time}\n                  className={timeControl === time ? \"selected\" : \"\"}\n                  onClick={() => setTimeControl(time)}\n                >\n                  {time / 60}ë¶„\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"room-actions\">\n            <button onClick={handleCreateRoom} className=\"create-room-btn\">\n              {gameMode === \"ai\" ? \"ðŸ¤– AI ëŒ€ì „ ì‹œìž‘\" : \"ìƒˆë¡œìš´ ë°© ë§Œë“¤ê¸°\"}\n            </button>\n\n            {/* í”Œë ˆì´ì–´ ëŒ€ì „ ëª¨ë“œì¼ ë•Œë§Œ ë°© ì°¸ê°€ ê¸°ëŠ¥ í‘œì‹œ */}\n            {gameMode === \"player\" && (\n              <div className=\"join-room\">\n                <input\n                  type=\"text\"\n                  value={newRoomId}\n                  onChange={(e) => setNewRoomId(e.target.value)}\n                  placeholder=\"ë°© ì½”ë“œ ìž…ë ¥\"\n                  maxLength=\"6\"\n                />\n                <button onClick={() => handleJoinRoom()}>ì½”ë“œë¡œ ì°¸ê°€</button>\n              </div>\n            )}\n          </div>\n\n          {availableRooms.length > 0 && (\n            <div className=\"available-rooms\">\n              <h3>ðŸ“‹ ëŒ€ê¸° ì¤‘ì¸ ë°© ëª©ë¡</h3>\n              <div className=\"rooms-list\">\n                {availableRooms.map((room) => (\n                  <div key={room.id} className=\"room-item\">\n                    <div className=\"room-info\">\n                      <span className=\"room-host\">\n                        í˜¸ìŠ¤íŠ¸: {room.playerNames.white} (\n                        {room.playerRanks?.white || \"Unranked\"},{\" \"}\n                        {room.playerRatings?.white || 0}ì )\n                      </span>\n                      <span className=\"room-time\">\n                        â± {formatTime(room.timeControl)}\n                      </span>\n                      <span className=\"room-code\">ì½”ë“œ: {room.id}</span>\n                    </div>\n                    <div className=\"room-item-buttons\">\n                      <button\n                        onClick={() => handleJoinRoom(room.id)}\n                        className=\"join-btn\"\n                      >\n                        ì°¸ê°€\n                      </button>\n                      {isAdmin?.() && (\n                        <button\n                          onClick={() => handleAdminDeleteRoom(room.id)}\n                          className=\"delete-btn\"\n                        >\n                          ì‚­ì œ\n                        </button>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          <div className=\"chess-rules\">\n            <h3>ì²´ìŠ¤ ê¸°ë³¸ ê·œì¹™</h3>\n            <ul>\n              <li>ë°±(White)ì´ ë¨¼ì € ì‹œìž‘í•©ë‹ˆë‹¤.</li>\n              <li>ìƒëŒ€ë°©ì˜ í‚¹ì„ ì²´í¬ë©”ì´íŠ¸í•˜ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤.</li>\n              <li>\n                í”Œë ˆì´ì–´ ëŒ€ì „: ìŠ¹ë¦¬ ì‹œ <strong>ì ìˆ˜(+15)</strong>ì™€ ì¿ í° 3ê°œ,\n                íŒ¨ë°° ì‹œ <strong>ì ìˆ˜(-10)</strong>\n              </li>\n              <li>\n                AI ëŒ€ì „: ìŠ¹ë¦¬ ì‹œ <strong>ì¹´ë“œ ë³´ìƒ</strong> ì„ íƒ (í˜„ê¸ˆ ë˜ëŠ”\n                ì¿ í°), í•˜ë£¨ 3íšŒ ì œí•œ\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!gameData) {\n    return <AlchanLoading />;\n  }\n\n  const whitePlayerId = gameData.players.white;\n  const blackPlayerId = gameData.players.black;\n\n  return (\n    <div className=\"chess-container\" style={containerStyle}>\n      <div className=\"game-info\">\n        <div\n          className={`player black ${gameData.turn === \"b\" ? \"active\" : \"\"} ${user?.uid === blackPlayerId ? \"my-player\" : \"opponent-player\"}`}\n        >\n          <span className=\"player-name\">\n            â™› {gameData.playerNames.black || \"ëŒ€ê¸°ì¤‘...\"}\n            <span className=\"player-rank\">\n              [{gameData.playerRanks?.black || \"Unranked\"}] (\n              {gameData.playerRatings?.black || 0}ì )\n            </span>\n          </span>\n          <span className=\"player-time\">{formatTime(blackTime)}</span>\n        </div>\n\n        <div className=\"game-status\">\n          {gameData.status === \"finished\" ? (\n            gameData.winner === \"draw\" ? (\n              <span>ë¬´ìŠ¹ë¶€!</span>\n            ) : gameData.winner === myColor ? (\n              <span className=\"winner\">\n                ðŸŽ‰ ìŠ¹ë¦¬! (\n                {gameData.ratingChange[myColor === \"w\" ? \"white\" : \"black\"] > 0\n                  ? \"+\"\n                  : \"\"}\n                {gameData.ratingChange[myColor === \"w\" ? \"white\" : \"black\"]}ì )\n                ì¿ í° 3ê°œ íšë“!\n              </span>\n            ) : (\n              <span className=\"loser\">\n                íŒ¨ë°°! (\n                {gameData.ratingChange[myColor === \"w\" ? \"white\" : \"black\"]}ì )\n              </span>\n            )\n          ) : gameData.status === \"waiting\" ? (\n            <span>ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘... (ì½”ë“œ: {gameId})</span>\n          ) : (\n            <span>{isMyTurn ? \"ë‹¹ì‹ ì˜ ì°¨ë¡€\" : \"ìƒëŒ€ë°© ì°¨ë¡€\"}</span>\n          )}\n        </div>\n\n        <div\n          className={`player white ${gameData.turn === \"w\" ? \"active\" : \"\"} ${user?.uid === whitePlayerId ? \"my-player\" : \"opponent-player\"}`}\n        >\n          <span className=\"player-name\">\n            â™• {gameData.playerNames.white}\n            <span className=\"player-rank\">\n              [{gameData.playerRanks?.white || \"Unranked\"}] (\n              {gameData.playerRatings?.white || 0}ì )\n            </span>\n          </span>\n          <span className=\"player-time\">{formatTime(whiteTime)}</span>\n        </div>\n      </div>\n\n      <div className=\"board-container\">\n        {/* 3D/2D í† ê¸€ ë²„íŠ¼ */}\n        <div className=\"view-toggle\">\n          <button\n            className={`toggle-btn ${!is3DMode ? \"active\" : \"\"}`}\n            onClick={() => setIs3DMode(false)}\n          >\n            2D\n          </button>\n          <button\n            className={`toggle-btn ${is3DMode ? \"active\" : \"\"}`}\n            onClick={() => setIs3DMode(true)}\n          >\n            3D\n          </button>\n        </div>\n\n        {is3DMode ? (\n          // 3D ì²´ìŠ¤ ë³´ë“œ\n          <div className=\"chess-board-3d\">\n            <Suspense\n              fallback={<div className=\"loading-3d\">3D ë³´ë“œ ë¡œë”© ì¤‘...</div>}\n            >\n              <Chess3DCanvas\n                board={gameData.board}\n                selectedPiece={selectedPiece}\n                possibleMoves={possibleMoves}\n                onSquareClick={handlePieceClick}\n                myColor={myColor}\n                isInCheck={isInCheck}\n              />\n            </Suspense>\n          </div>\n        ) : (\n          // 2D ì²´ìŠ¤ ë³´ë“œ\n          <div className={`chess-board ${myColor === \"b\" ? \"flipped\" : \"\"}`}>\n            {gameData.board.map((row, rIndex) =>\n              row.map((piece, cIndex) => {\n                const isSelected =\n                  selectedPiece?.row === rIndex &&\n                  selectedPiece?.col === cIndex;\n                const isPossibleMove = possibleMoves.some(\n                  ([r, c]) => r === rIndex && c === cIndex,\n                );\n                const isLight = (rIndex + cIndex) % 2 === 0;\n                const isCheck =\n                  piece &&\n                  piece[1] === \"K\" &&\n                  isInCheck(gameData.board, piece[0]);\n\n                return (\n                  <div\n                    key={`${rIndex}-${cIndex}`}\n                    className={`square ${isLight ? \"light\" : \"dark\"}\n                                                   ${isSelected ? \"selected\" : \"\"}\n                                                   ${isPossibleMove ? \"possible\" : \"\"}\n                                                   ${isCheck ? \"check\" : \"\"}`}\n                    onClick={() => handlePieceClick(rIndex, cIndex)}\n                  >\n                    {piece && (\n                      <div\n                        className={`piece ${piece[0] === \"w\" ? \"white-piece\" : \"black-piece\"}`}\n                      >\n                        {PIECES[piece]}\n                      </div>\n                    )}\n                    {isPossibleMove && !piece && <div className=\"move-dot\" />}\n                    {isPossibleMove && piece && (\n                      <div className=\"capture-hint\" />\n                    )}\n                  </div>\n                );\n              }),\n            )}\n          </div>\n        )}\n\n        {showPromotion && (\n          <div className=\"promotion-modal\">\n            <div className=\"promotion-content\">\n              <h3>í”„ë¡œëª¨ì…˜ ì„ íƒ</h3>\n              <div className=\"promotion-pieces\">\n                {[\"Q\", \"R\", \"B\", \"N\"].map((type) => (\n                  <button\n                    key={type}\n                    onClick={() => handlePromotion(type)}\n                    className=\"promotion-piece\"\n                  >\n                    {PIECES[myColor + type]}\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* AI ì‚¬ê³  ì¤‘ í‘œì‹œ */}\n        {isAiThinking && (\n          <div className=\"ai-thinking\">\n            <div className=\"thinking-content\">\n              <div className=\"spinner\"></div>\n              <p>AIê°€ ìˆ˜ë¥¼ ê³ ë¯¼í•˜ëŠ” ì¤‘...</p>\n            </div>\n          </div>\n        )}\n\n        {/* ë³´ìƒ ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ */}\n        {showRewardSelection && rewardCards.length === 2 && (\n          <div className=\"reward-modal\">\n            <div className=\"reward-content\">\n              <h3>ðŸŽ‰ ìŠ¹ë¦¬ ë³´ìƒ!</h3>\n              <p>í•˜ë‚˜ì˜ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>\n              <div className=\"reward-cards\">\n                {rewardCards.map((card, index) => (\n                  <div\n                    key={index}\n                    className=\"reward-card\"\n                    onClick={() => handleRewardSelection(card)}\n                  >\n                    <div className=\"card-icon\">\n                      {card.type === \"cash\" ? \"ðŸ’µ\" : \"ðŸŽ«\"}\n                    </div>\n                    <div className=\"card-title\">\n                      {card.type === \"cash\" ? \"í˜„ê¸ˆ\" : \"ì¿ í°\"}\n                    </div>\n                    <div className=\"card-amount\">\n                      {card.type === \"cash\"\n                        ? `${card.amount.toLocaleString()}ì›`\n                        : `${card.amount}ê°œ`}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {feedback.message && (\n        <div className={`feedback ${feedback.type}`}>{feedback.message}</div>\n      )}\n\n      <div className=\"game-controls\">\n        <button onClick={handleLeaveGame} className=\"leave-button\">\n          ê²Œìž„ ë‚˜ê°€ê¸°\n        </button>\n      </div>\n\n      {moveHistory.length > 0 && (\n        <div className=\"move-history\">\n          <h4>ì´ë™ ê¸°ë¡</h4>\n          <div className=\"moves-list\">\n            {moveHistory.map((move, idx) => (\n              <span key={idx} className=\"move\">\n                {idx % 2 === 0 ? `${Math.floor(idx / 2) + 1}. ` : \"\"}\n                {move}\n              </span>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ChessGame;\n"],"names":["Chess3DCanvas","importFn","lazy","catch","sessionStorage","getItem","removeItem","setItem","window","location","reload","Promise","PIECES","wK","wQ","wR","wB","wN","wP","bK","bQ","bR","bB","bN","bP","RANKS","name","minPoints","RATING_CHANGE","serializeBoard","board","serialized","forEach","row","rIndex","cell","cIndex","concat","deserializeBoard","serializedBoard","Array","fill","map","key","r","c","split","Number","PIECE_VALUES","P","N","B","R","Q","K","PAWN_POSITION_BONUS","KNIGHT_POSITION_BONUS","minimax","depth","isMaximizing","alpha","beta","color","getValidMovesFunc","evaluateBoard","score","piece","pieceColor","pieceType","pieceValue","positionBonus","totalValue","currentColor","allMoves","_ref","toR","toC","push","from","to","length","maxEval","Infinity","move","newBoard","evaluation","Math","max","minEval","min","ChessGame","_gameData$moveHistory2","_gameData$playerRanks","_gameData$playerRatin","_gameData$playerRanks2","_gameData$playerRatin2","user","userDoc","isAdmin","useAuth","gameId","setGameId","useState","gameData","setGameData","showCreateRoom","setShowCreateRoom","newRoomId","setNewRoomId","feedback","setFeedback","message","type","selectedPiece","setSelectedPiece","possibleMoves","setPossibleMoves","availableRooms","setAvailableRooms","timeControl","setTimeControl","whiteTime","setWhiteTime","blackTime","setBlackTime","showPromotion","setShowPromotion","moveHistory","setMoveHistory","intervalRef","useRef","refetchRef","aiTimeoutRef","lastAiMoveCountRef","gameMode","setGameMode","aiDifficulty","setAiDifficulty","isAiThinking","setIsAiThinking","isMoving","setIsMoving","is3DMode","setIs3DMode","showRewardSelection","setShowRewardSelection","rewardCards","setRewardCards","dailyPlayCount","setDailyPlayCount","myColor","aiMode","playerColor","players","white","uid","isMyTurn","turn","rank","userRank","nextRank","pointsForNextRank","points","arguments","undefined","currentRank","i","nextRankIndex","findIndex","getRankInfo","chessRating","gameIdRef","useEffect","current","gameDataRef","userRef","cleanup","_currentGameData$play","currentGameId","currentGameData","currentUser","deleteDoc","doc","db","addEventListener","removeEventListener","handleTimeout","useCallback","async","gameRef","winnerColor","loserColor","runTransaction","gameDoc","transaction","get","exists","data","status","update","winner","endReason","ratingChange","setInterval","newTime","clearInterval","fetchAvailableRooms","q","query","collection","where","querySnapshot","getDocs","rooms","_objectSpread","id","error","logger","interval","fetchGameData","docSnap","getDoc","rawData","deserializedData","refetch","usePolling","enabled","loadDailyPlayCount","today","Date","toDateString","storageKey","count","parseInt","localStorage","timer","setTimeout","clearTimeout","getValidMoves","col","checkForCheck","moves","addMove","target","testBoard","isInCheck","direction","startRow","dc","enPassant","epRow","epCol","abs","_ref3","dr","_ref4","_ref5","castling","kingRow","isSquareUnderAttack","opponentColor","some","_ref6","mr","mc","kingPos","checkGameEnd","handleCreateRoom","newGameId","random","toString","substring","isAiMode","aiColor","initialGameData","black","playerNames","playerRanks","playerRatings","createdAt","serverTimestamp","setDoc","handleJoinRoom","targetRoomId","trim","Error","handlePieceClick","_ref7","handleMove","toRow","toCol","fromRow","fromCol","executeMove","handleLeaveGame","_gameData$players","promotionPiece","result","currentData","moveMade","newCastling","newEnPassant","files","moveNotation","newMoveHistory","nextTurn","newStatus","newWinner","newRatingChange","gameEndState","updateData","playerIsWinner","isDraw","cards","generateRewardCards","weightedRandom","items","totalWeight","reduce","sum","item","weight","amount","newCount","_gameData$moveHistory","currentMoveCount","thinkingTime","gameSnap","bestMove","findBestMove","difficulty","_ref2","floor","bestValue","moveValue","makeAiMove","formatTime","seconds","mins","secs","padStart","_jsx","className","children","_jsxs","onClick","time","value","onChange","e","placeholder","maxLength","room","_room$playerRanks","_room$playerRatings","roomId","handleAdminDeleteRoom","AlchanLoading","whitePlayerId","blackPlayerId","style","backgroundColor","minHeight","width","Suspense","fallback","onSquareClick","isSelected","isPossibleMove","_ref8","isLight","isCheck","promoteTo","handlePromotion","card","index","selectedCard","balance","increment","couponBalance","toLocaleString","logActivity","classCode","userId","userName","ACTIVITY_TYPES","GAME_WIN","description","couponAmount","metadata","gameType","opponent","rewardType","rewardAmount","handleRewardSelection","idx"],"ignoreList":[],"sourceRoot":""}