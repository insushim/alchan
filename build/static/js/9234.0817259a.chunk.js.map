{"version":3,"file":"static/js/9234.0817259a.chunk.js","mappings":"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","sources":["utils/validation.js","pages/banking/MoneyTransfer.js","services/database.js"],"sourcesContent":["// src/utils/validation.js - ì…ë ¥ ê²€ì¦ ìœ í‹¸ë¦¬í‹°\nimport { getCurrencyUnit } from \"./numberFormatter\";\n\n/**\n * ê¸ˆì•¡ ê²€ì¦ ë° ì •ê·œí™”\n * @param {number|string} amount - ê²€ì¦í•  ê¸ˆì•¡\n * @param {object} options - ê²€ì¦ ì˜µì…˜\n * @returns {number} - ê²€ì¦ëœ ê¸ˆì•¡\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\n */\nexport const validateAmount = (amount, options = {}) => {\n  const {\n    min = 0,\n    max = Number.MAX_SAFE_INTEGER,\n    allowZero = false,\n    fieldName = \"ê¸ˆì•¡\",\n  } = options;\n\n  // ìˆ«ìë¡œ ë³€í™˜\n  const numAmount = Number(amount);\n\n  // NaN ì²´í¬\n  if (isNaN(numAmount)) {\n    throw new Error(`${fieldName}ëŠ” ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  // ë¬´í•œëŒ€ ì²´í¬\n  if (!isFinite(numAmount)) {\n    throw new Error(`${fieldName}ëŠ” ìœ í•œí•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  // ìŒìˆ˜ ì²´í¬\n  if (numAmount < 0) {\n    throw new Error(`${fieldName}ëŠ” ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\n  }\n\n  // 0 ì²´í¬\n  if (!allowZero && numAmount === 0) {\n    throw new Error(`${fieldName}ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  // ë²”ìœ„ ì²´í¬\n  if (numAmount < min) {\n    throw new Error(\n      `${fieldName}ëŠ” ìµœì†Œ ${min.toLocaleString()}${getCurrencyUnit()} ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`,\n    );\n  }\n\n  if (numAmount > max) {\n    throw new Error(\n      `${fieldName}ëŠ” ìµœëŒ€ ${max.toLocaleString()}${getCurrencyUnit()}ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,\n    );\n  }\n\n  // ì •ìˆ˜ë¡œ ë³€í™˜ (ì†Œìˆ˜ì  ì œê±°)\n  return Math.floor(numAmount);\n};\n\n/**\n * ìˆ˜ëŸ‰ ê²€ì¦\n * @param {number|string} quantity - ê²€ì¦í•  ìˆ˜ëŸ‰\n * @param {object} options - ê²€ì¦ ì˜µì…˜\n * @returns {number} - ê²€ì¦ëœ ìˆ˜ëŸ‰\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\n */\nexport const validateQuantity = (quantity, options = {}) => {\n  const {\n    min = 1,\n    max = Number.MAX_SAFE_INTEGER,\n    fieldName = \"ìˆ˜ëŸ‰\",\n  } = options;\n\n  const numQuantity = Number(quantity);\n\n  if (isNaN(numQuantity) || !isFinite(numQuantity)) {\n    throw new Error(`${fieldName}ëŠ” ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  if (numQuantity < min) {\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${min}ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  if (numQuantity > max) {\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${max}ê°œë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\n  }\n\n  // ì •ìˆ˜ë¡œ ë³€í™˜\n  const intQuantity = Math.floor(numQuantity);\n\n  if (intQuantity !== numQuantity) {\n    throw new Error(`${fieldName}ëŠ” ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  return intQuantity;\n};\n\n/**\n * í¼ì„¼íŠ¸ ê²€ì¦\n * @param {number|string} percent - ê²€ì¦í•  í¼ì„¼íŠ¸\n * @param {object} options - ê²€ì¦ ì˜µì…˜\n * @returns {number} - ê²€ì¦ëœ í¼ì„¼íŠ¸\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\n */\nexport const validatePercent = (percent, options = {}) => {\n  const { min = 0, max = 100, fieldName = \"í¼ì„¼íŠ¸\" } = options;\n\n  const numPercent = Number(percent);\n\n  if (isNaN(numPercent) || !isFinite(numPercent)) {\n    throw new Error(`${fieldName}ëŠ” ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  if (numPercent < min || numPercent > max) {\n    throw new Error(`${fieldName}ëŠ” ${min}%ì—ì„œ ${max}% ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  return numPercent;\n};\n\n/**\n * ì”ì•¡ ì¶©ë¶„ ì—¬ë¶€ í™•ì¸\n * @param {number} currentBalance - í˜„ì¬ ì”ì•¡\n * @param {number} requiredAmount - í•„ìš”í•œ ê¸ˆì•¡\n * @param {string} fieldName - í•„ë“œ ì´ë¦„\n * @throws {Error} - ì”ì•¡ ë¶€ì¡± ì‹œ\n */\nexport const validateSufficientBalance = (\n  currentBalance,\n  requiredAmount,\n  fieldName = \"ì”ì•¡\",\n) => {\n  const balance = Number(currentBalance);\n  const required = Number(requiredAmount);\n\n  if (isNaN(balance) || isNaN(required)) {\n    throw new Error(\"ì”ì•¡ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\n  }\n\n  if (balance < required) {\n    throw new Error(\n      `${fieldName}ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${balance.toLocaleString()}${getCurrencyUnit()}, í•„ìš”: ${required.toLocaleString()}${getCurrencyUnit()})`,\n    );\n  }\n};\n\n/**\n * ë¬¸ìì—´ ê²€ì¦\n * @param {string} value - ê²€ì¦í•  ë¬¸ìì—´\n * @param {object} options - ê²€ì¦ ì˜µì…˜\n * @returns {string} - ê²€ì¦ëœ ë¬¸ìì—´\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\n */\nexport const validateString = (value, options = {}) => {\n  const {\n    minLength = 0,\n    maxLength = 1000,\n    allowEmpty = false,\n    fieldName = \"ì…ë ¥ê°’\",\n  } = options;\n\n  if (typeof value !== \"string\") {\n    throw new Error(`${fieldName}ëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  const trimmed = value.trim();\n\n  if (!allowEmpty && trimmed.length === 0) {\n    throw new Error(`${fieldName}ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);\n  }\n\n  if (trimmed.length < minLength) {\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${minLength}ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  if (trimmed.length > maxLength) {\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${maxLength}ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\n  }\n\n  return trimmed;\n};\n\n/**\n * ë°°ì—´ ê²€ì¦\n * @param {Array} value - ê²€ì¦í•  ë°°ì—´\n * @param {object} options - ê²€ì¦ ì˜µì…˜\n * @returns {Array} - ê²€ì¦ëœ ë°°ì—´\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\n */\nexport const validateArray = (value, options = {}) => {\n  const {\n    minLength = 0,\n    maxLength = Number.MAX_SAFE_INTEGER,\n    allowEmpty = false,\n    fieldName = \"ë°°ì—´\",\n  } = options;\n\n  if (!Array.isArray(value)) {\n    throw new Error(`${fieldName}ëŠ” ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  if (!allowEmpty && value.length === 0) {\n    throw new Error(`${fieldName}ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.`);\n  }\n\n  if (value.length < minLength) {\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${minLength}ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\n  }\n\n  if (value.length > maxLength) {\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${maxLength}ê°œë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\n  }\n\n  return value;\n};\n","// src/MoneyTransfer.js - ì„œë²„ ì‘ë‹µ ê¸°ë°˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì • ë²„ì „\n\nimport React, { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { useCurrency } from \"../../contexts/CurrencyContext\";\nimport { adminCashAction } from \"../../services/database\";\nimport \"./MoneyTransfer.css\";\nimport { formatKoreanCurrency } from \"../../utils/numberFormatter\";\nimport { logger } from \"../../utils/logger\";\n\nfunction MoneyTransfer() {\n  // AuthContextì—ì„œ í•„ìš”í•œ ë°ì´í„°ì™€ í•¨ìˆ˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.\n  const {\n    userDoc,\n    allClassMembers,\n    loading: authLoading,\n    setUserDoc,\n    setAllClassMembers,\n  } = useAuth();\n  const { currencyUnit } = useCurrency();\n\n  // ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ ìƒíƒœ ê´€ë¦¬\n  const [selectedUsers, setSelectedUsers] = useState([]);\n  const [amount, setAmount] = useState(\"\");\n  const [amountType, setAmountType] = useState(\"fixed\");\n  const [action, setAction] = useState(\"send\");\n  const [takeMode, setTakeMode] = useState(\"toMe\"); // \"toMe\" ë˜ëŠ” \"remove\"\n  const [taxRate, setTaxRate] = useState(10);\n  const [message, setMessage] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [selectAll, setSelectAll] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // ê´€ë¦¬ì ì •ë³´ ì¶”ì¶œ\n  const adminName = userDoc?.name;\n  const adminClassCode = userDoc?.classCode;\n\n  // ì „ì²´ ì‚¬ìš©ì ëª©ë¡ì„ ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬\n  const users = useMemo(() => {\n    if (!allClassMembers || allClassMembers.length === 0) return [];\n    return [...allClassMembers].sort((a, b) => {\n      const nameA = a.name || a.nickname || \"\";\n      const nameB = b.name || b.nickname || \"\";\n      return nameA.localeCompare(nameB, \"ko\");\n    });\n  }, [allClassMembers]);\n\n  // ì•¡ì…˜ íƒ€ì…ì´ ë³€ê²½ë˜ë©´ ì„ íƒ ì´ˆê¸°í™”\n  useEffect(() => {\n    setSelectedUsers([]);\n    setSelectAll(false);\n  }, [action, amountType]);\n\n  // ì‚¬ìš©ì ì„ íƒ í•¸ë“¤ëŸ¬\n  const handleUserSelection = (userId) => {\n    setSelectedUsers((prevSelected) =>\n      prevSelected.includes(userId)\n        ? prevSelected.filter((id) => id !== userId)\n        : [...prevSelected, userId],\n    );\n  };\n\n  // ì „ì²´ ì„ íƒ í•¸ë“¤ëŸ¬\n  const handleSelectAll = () => {\n    setSelectAll((prev) => {\n      const newSelectAll = !prev;\n      setSelectedUsers(newSelectAll ? users.map((user) => user.id) : []);\n      return newSelectAll;\n    });\n  };\n\n  // ë¯¸ë¦¬ë³´ê¸° ê¸ˆì•¡ ê³„ì‚° í•¨ìˆ˜\n  const calculatePreviewAmount = useCallback(\n    (userCash, inputValue, applyTax = false) => {\n      let baseAmount;\n      if (amountType === \"percentage\") {\n        baseAmount = Math.floor((userCash * Number(inputValue)) / 100);\n      } else {\n        baseAmount = Number(inputValue);\n      }\n\n      if (applyTax && action === \"send\") {\n        const taxAmount = Math.floor((baseAmount * taxRate) / 100);\n        return baseAmount - taxAmount;\n      }\n\n      return baseAmount;\n    },\n    [amountType, action, taxRate],\n  );\n\n  // í¼ ì œì¶œ (ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ì‹¤í–‰) í•¸ë“¤ëŸ¬\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (selectedUsers.length === 0 || !amount || isNaN(Number(amount))) {\n      setError(\"ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ê³  ìœ íš¨í•œ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.\");\n      return;\n    }\n\n    const inputValue = Number(amount);\n    if (inputValue <= 0) {\n      setError(\n        `${amountType === \"percentage\" ? \"í¼ì„¼íŠ¸\" : \"ê¸ˆì•¡\"}ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.`,\n      );\n      return;\n    }\n    if (amountType === \"percentage\" && (inputValue > 100 || inputValue < 0)) {\n      setError(\"í¼ì„¼íŠ¸ëŠ” 0ê³¼ 100 ì‚¬ì´ì˜ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.\");\n      return;\n    }\n\n    setIsProcessing(true);\n    setMessage(\"\");\n    setError(\"\");\n\n    try {\n      const targetUsersData = users.filter((user) =>\n        selectedUsers.includes(user.id),\n      );\n\n      // âœ¨ DB ì‘ì—… ì‹¤í–‰í•˜ê³  ì„œë²„ë¡œë¶€í„° ì‹¤ì œ ê²°ê³¼ ë°›ê¸°\n      const { count, totalProcessed, updatedUsers } = await adminCashAction({\n        adminName,\n        adminClassCode,\n        targetUsers: targetUsersData,\n        action,\n        takeMode: action === \"take\" ? takeMode : undefined, // ê°€ì ¸ì˜¤ê¸° ëª¨ë“œ ì „ë‹¬\n        amountType,\n        amount: inputValue,\n        taxRate,\n      });\n\n      // âœ¨ ì„œë²„ì—ì„œ ë°›ì€ 'ì§„ì§œ' ë°ì´í„°ë¡œ ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸\n      if (updatedUsers && updatedUsers.length > 0) {\n        // 1. ëŒ€ìƒ ì‚¬ìš©ìë“¤ì˜ ì”ì•¡ ì—…ë°ì´íŠ¸\n        setAllClassMembers((currentMembers) =>\n          currentMembers.map((member) => {\n            const updatedInfo = updatedUsers.find((u) => u.id === member.id);\n            return updatedInfo\n              ? { ...member, cash: updatedInfo.newCash }\n              : member;\n          }),\n        );\n\n        // 2. ê´€ë¦¬ì ë³¸ì¸ì˜ ì”ì•¡ ì—…ë°ì´íŠ¸\n        setUserDoc((currentAdminDoc) => {\n          const currentAdminCash = Number(currentAdminDoc.cash || 0);\n          let newAdminCash;\n          if (action === \"send\") {\n            // ë³´ëƒˆì„ ë•ŒëŠ” ì²˜ë¦¬ëœ ì´ì•¡ë§Œí¼ ì°¨ê° (ì„¸ê¸ˆ í¬í•¨ëœ ê¸ˆì•¡ì´ totalProcessed)\n            newAdminCash = currentAdminCash - totalProcessed;\n          } else if (action === \"take\" && takeMode === \"toMe\") {\n            // ë‚˜ì—ê²Œ ê°€ì ¸ì˜¬ ë•ŒëŠ” ì²˜ë¦¬ëœ ì´ì•¡ë§Œí¼ ì¦ê°€\n            newAdminCash = currentAdminCash + totalProcessed;\n          } else {\n            // ëˆ ì—†ì• ê¸° ëª¨ë“œëŠ” ê´€ë¦¬ì ì”ì•¡ ë³€í™” ì—†ìŒ\n            newAdminCash = currentAdminCash;\n          }\n          return { ...currentAdminDoc, cash: newAdminCash };\n        });\n      }\n\n      // ì„±ê³µ ë©”ì‹œì§€ ì„¤ì •\n      const actionText =\n        action === \"send\"\n          ? \"ë³´ë‚´ê¸°\"\n          : takeMode === \"toMe\"\n            ? \"ê°€ì ¸ì˜¤ê¸°\"\n            : \"ì—†ì• ê¸°\";\n      setMessage(\n        `${count}ëª…ì—ê²Œ ${amountType === \"percentage\" ? `${inputValue}%` : `${inputValue.toLocaleString()}${currencyUnit}`} ${actionText} ì™„ë£Œ! (ì´ ${totalProcessed.toLocaleString()}${currencyUnit} ì²˜ë¦¬${action === \"send\" && taxRate > 0 ? `, ì„¸ê¸ˆ ${taxRate}% ì ìš©` : \"\"})`,\n      );\n\n      setAmount(\"\");\n      setSelectedUsers([]);\n      setSelectAll(false);\n\n      setTimeout(() => setMessage(\"\"), 3000);\n    } catch (err) {\n      logger.error(\"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\", err);\n      setError(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message}`);\n      // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ëŠ” ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ ê°€ì¥ ì •í™•í•˜ì§€ë§Œ,\n      // Firestore ì‚¬ìš© ìµœì†Œí™”ë¥¼ ìœ„í•´ ì—¬ê¸°ì„œëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.\n      setTimeout(() => setError(\"\"), 5000);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const previewAmounts = useMemo(() => {\n    if (!amount || selectedUsers.length === 0) return {};\n    const preview = {};\n    selectedUsers.forEach((userId) => {\n      const user = users.find((u) => u.id === userId);\n      if (user) {\n        const userCash = Number(user.cash || 0);\n        const applyTax = action === \"send\";\n        preview[userId] = calculatePreviewAmount(userCash, amount, applyTax);\n      }\n    });\n    return preview;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedUsers, amount, action, users, calculatePreviewAmount]); // amountTypeê³¼ taxRateëŠ” calculatePreviewAmount ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë¨\n\n  return (\n    <div className=\"money-transfer-container\">\n      <div className=\"header\">\n        <div className=\"admin-info\">\n          <span className=\"admin-label\">ê´€ë¦¬ì</span>\n          <span className=\"admin-name\">{adminName || \"ë¡œë”© ì¤‘...\"}</span>\n          <span className=\"admin-cash\">\n            í˜„ê¸ˆ: {(userDoc?.cash || 0).toLocaleString()}\n            {currencyUnit}\n          </span>\n        </div>\n      </div>\n\n      {error && <div className=\"alert alert-error\">{error}</div>}\n      {message && <div className=\"alert alert-success\">{message}</div>}\n\n      <form onSubmit={handleSubmit} className=\"transfer-form\">\n        <div className=\"action-selector\">\n          <button\n            type=\"button\"\n            className={`action-btn ${action === \"send\" ? \"active send\" : \"\"}`}\n            onClick={() => setAction(\"send\")}\n          >\n            <span className=\"icon\">ğŸ“¤</span> ë³´ë‚´ê¸°\n          </button>\n          <button\n            type=\"button\"\n            className={`action-btn ${action === \"take\" ? \"active take\" : \"\"}`}\n            onClick={() => setAction(\"take\")}\n          >\n            <span className=\"icon\">ğŸ“¥</span> ê°€ì ¸ì˜¤ê¸°\n          </button>\n        </div>\n\n        {action === \"take\" && (\n          <div className=\"take-mode-section\">\n            <h4>ê°€ì ¸ì˜¤ê¸° ì˜µì…˜</h4>\n            <div className=\"take-mode-selector\">\n              <label\n                className={`mode-option ${takeMode === \"toMe\" ? \"active\" : \"\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"takeMode\"\n                  value=\"toMe\"\n                  checked={takeMode === \"toMe\"}\n                  onChange={(e) => setTakeMode(e.target.value)}\n                />\n                <span className=\"radio-custom\"></span>\n                <span className=\"mode-text\">\n                  <strong>ğŸ’° ë‚˜ì—ê²Œ ê°€ì ¸ì˜¤ê¸°</strong>\n                  <small>ì„ íƒí•œ í•™ìƒë“¤ì˜ ëˆì„ ë‚´ ê³„ì¢Œë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤</small>\n                </span>\n              </label>\n              <label\n                className={`mode-option ${takeMode === \"remove\" ? \"active\" : \"\"}`}\n              >\n                <input\n                  type=\"radio\"\n                  name=\"takeMode\"\n                  value=\"remove\"\n                  checked={takeMode === \"remove\"}\n                  onChange={(e) => setTakeMode(e.target.value)}\n                />\n                <span className=\"radio-custom\"></span>\n                <span className=\"mode-text\">\n                  <strong>ğŸ—‘ï¸ ëˆ ì—†ì• ê¸°</strong>\n                  <small>ì„ íƒí•œ í•™ìƒë“¤ì˜ ëˆì„ ì˜êµ¬ì ìœ¼ë¡œ ì œê±°í•©ë‹ˆë‹¤</small>\n                </span>\n              </label>\n            </div>\n          </div>\n        )}\n\n        <div className=\"amount-section\">\n          <div className=\"amount-type-selector\">\n            <label\n              className={`type-option ${amountType === \"fixed\" ? \"active\" : \"\"}`}\n            >\n              <input\n                type=\"radio\"\n                name=\"amountType\"\n                value=\"fixed\"\n                checked={amountType === \"fixed\"}\n                onChange={(e) => setAmountType(e.target.value)}\n              />\n              <span className=\"radio-custom\"></span> ê³ ì • ê¸ˆì•¡\n            </label>\n            <label\n              className={`type-option ${amountType === \"percentage\" ? \"active\" : \"\"}`}\n            >\n              <input\n                type=\"radio\"\n                name=\"amountType\"\n                value=\"percentage\"\n                checked={amountType === \"percentage\"}\n                onChange={(e) => setAmountType(e.target.value)}\n              />\n              <span className=\"radio-custom\"></span> í¼ì„¼íŠ¸ (%)\n            </label>\n          </div>\n          <div className=\"amount-input-group\">\n            <input\n              type=\"number\"\n              value={amount}\n              onChange={(e) => setAmount(e.target.value)}\n              placeholder={amountType === \"fixed\" ? \"ê¸ˆì•¡ ì…ë ¥\" : \"í¼ì„¼íŠ¸ ì…ë ¥\"}\n              min=\"1\"\n              max={amountType === \"percentage\" ? \"100\" : undefined}\n              required\n              className=\"amount-input\"\n            />\n            <span className=\"amount-unit\">\n              {amountType === \"fixed\" ? currencyUnit : \"%\"}\n            </span>\n          </div>\n        </div>\n\n        {action === \"send\" && (\n          <div className=\"tax-section\">\n            <div className=\"tax-header\">\n              <h4>ğŸ’¸ ì„¸ê¸ˆ ì„¤ì •</h4>\n              <span className=\"tax-description\">\n                ë³´ë‚´ëŠ” ê¸ˆì•¡ì—ì„œ ì„¸ê¸ˆì„ ì œì™¸í•˜ê³  ì§€ê¸‰ë©ë‹ˆë‹¤.\n              </span>\n            </div>\n            <div className=\"tax-input-group\">\n              <label htmlFor=\"taxRate\">ì„¸ê¸ˆìœ¨:</label>\n              <input\n                type=\"number\"\n                id=\"taxRate\"\n                value={taxRate}\n                onChange={(e) =>\n                  setTaxRate(Math.max(0, Math.min(100, Number(e.target.value))))\n                }\n                min=\"0\"\n                max=\"100\"\n                className=\"tax-input\"\n              />\n              <span className=\"tax-unit\">%</span>\n            </div>\n            {amount && (\n              <div className=\"tax-preview\">\n                {amountType === \"fixed\" ? (\n                  <>\n                    ì‹¤ì œ ì§€ê¸‰ì•¡:{\" \"}\n                    {calculatePreviewAmount(0, amount, true).toLocaleString()}\n                    {currencyUnit}\n                    (ì„¸ê¸ˆ{\" \"}\n                    {Math.floor(\n                      (Number(amount) * taxRate) / 100,\n                    ).toLocaleString()}\n                    {currencyUnit} ì œì™¸)\n                  </>\n                ) : (\n                  `ê° í•™ìƒ ì”ì•¡ì˜ ${amount}%ì—ì„œ ì„¸ê¸ˆ ${taxRate}%ê°€ ì¶”ê°€ë¡œ ì°¨ê°ë©ë‹ˆë‹¤.`\n                )}\n              </div>\n            )}\n          </div>\n        )}\n\n        <div className=\"user-selection-section\">\n          <div className=\"section-header\">\n            <h3>ëŒ€ìƒ ì„ íƒ</h3>\n            <label className=\"select-all-label\">\n              <input\n                type=\"checkbox\"\n                checked={selectAll}\n                onChange={handleSelectAll}\n                className=\"checkbox-custom\"\n              />\n              <span className=\"checkmark\"></span> ì „ì²´ ì„ íƒ\n            </label>\n          </div>\n\n          {authLoading && users.length === 0 ? (\n            <div className=\"loading\">ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>\n          ) : (\n            <div className=\"user-list\">\n              {users.map((user) => {\n                const previewAmount = previewAmounts[user.id];\n                return (\n                  <div key={user.id} className=\"user-item\">\n                    <label className=\"user-label\">\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedUsers.includes(user.id)}\n                        onChange={() => handleUserSelection(user.id)}\n                        className=\"checkbox-custom\"\n                      />\n                      <span className=\"checkmark\"></span>\n                      <div className=\"user-info\">\n                        <span className=\"user-name\">{user.name}</span>\n                        <span className=\"user-balance\">\n                          ì”ì•¡: {user.cash?.toLocaleString() || 0}\n                          {currencyUnit}\n                        </span>\n                        {previewAmount !== undefined && (\n                          <span className={`preview-amount ${action}`}>\n                            {action === \"send\" ? \"+\" : \"âˆ’\"}\n                            {previewAmount.toLocaleString()}\n                            {currencyUnit}\n                          </span>\n                        )}\n                      </div>\n                    </label>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        <button\n          type=\"submit\"\n          className={`submit-btn ${action}`}\n          disabled={authLoading || isProcessing}\n        >\n          {isProcessing ? (\n            <>\n              <span className=\"spinner\"></span> ì²˜ë¦¬ ì¤‘...\n            </>\n          ) : (\n            <>\n              <span className=\"icon\">{action === \"send\" ? \"ğŸ“¤\" : \"ğŸ“¥\"}</span>{\" \"}\n              {action === \"send\" ? \"ë³´ë‚´ê¸°\" : \"ê°€ì ¸ì˜¤ê¸°\"} ì‹¤í–‰\n            </>\n          )}\n        </button>\n      </form>\n    </div>\n  );\n}\n\nexport default MoneyTransfer;\n","// src/database.js\r\nimport {\r\n  addActivityLog,\r\n  getUserDocument,\r\n  updateUserCashInFirestore,\r\n  updateUserCouponsInFirestore,\r\n  addTransaction as firebaseAddTransaction,\r\n  db,\r\n  writeBatch,\r\n  doc,\r\n  collection,\r\n  serverTimestamp,\r\n  updateUserDocument, // ì¶”ê°€ëœ import\r\n  runTransaction,\r\n  getDoc,\r\n  increment\r\n} from '../firebase';\r\nimport { applyTransactionTax, applyIncomeTax } from '../utils/taxUtils';\r\nimport { validateAmount } from '../utils/validation';\r\n\r\nimport { logger } from \"../utils/logger\";\r\n/**\r\n * í™œë™ ë¡œê·¸ íƒ€ì… ì •ì˜\r\n */\r\nconst LOG_TYPES = {\r\n  // í˜„ê¸ˆ ê´€ë ¨\r\n  CASH_INCOME: 'í˜„ê¸ˆ ì…ê¸ˆ',\r\n  CASH_EXPENSE: 'í˜„ê¸ˆ ì¶œê¸ˆ',\r\n  CASH_TRANSFER_SEND: 'ì†¡ê¸ˆ',\r\n  CASH_TRANSFER_RECEIVE: 'ì†¡ê¸ˆ ìˆ˜ì‹ ',\r\n  ADMIN_CASH_SEND: 'ê´€ë¦¬ì ì§€ê¸‰',\r\n  ADMIN_CASH_TAKE: 'ê´€ë¦¬ì íšŒìˆ˜',\r\n\r\n  // ì¿ í° ê´€ë ¨\r\n  COUPON_EARN: 'ì¿ í° íšë“',\r\n  COUPON_USE: 'ì¿ í° ì‚¬ìš©',\r\n  COUPON_GIVE: 'ì¿ í° ì§€ê¸‰',\r\n  COUPON_TAKE: 'ì¿ í° íšŒìˆ˜',\r\n  COUPON_TRANSFER_SEND: 'ì¿ í° ì†¡ê¸ˆ',\r\n  COUPON_TRANSFER_RECEIVE: 'ì¿ í° ìˆ˜ì‹ ',\r\n\r\n  // ì•„ì´í…œ ê´€ë ¨\r\n  ITEM_PURCHASE: 'ì•„ì´í…œ êµ¬ë§¤',\r\n  ITEM_USE: 'ì•„ì´í…œ ì‚¬ìš©', // ì•„ì´í…œ ì‚¬ìš© ë¡œê·¸ íƒ€ì…\r\n  ITEM_SELL: 'ì•„ì´í…œ íŒë§¤',\r\n  ITEM_MARKET_LIST: 'ì•„ì´í…œ ì‹œì¥ ë“±ë¡',\r\n  ITEM_MARKET_BUY: 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤',\r\n  ITEM_OBTAIN: 'ì•„ì´í…œ íšë“',\r\n  ITEM_MOVE: 'ì•„ì´í…œ ì´ë™',\r\n\r\n  // ê³¼ì œ ê´€ë ¨\r\n  TASK_COMPLETE: 'ê³¼ì œ ì™„ë£Œ',\r\n  TASK_REWARD: 'ê³¼ì œ ë³´ìƒ',\r\n\r\n  // ê²Œì„ ê´€ë ¨\r\n  GAME_WIN: 'ê²Œì„ ìŠ¹ë¦¬',\r\n  GAME_LOSE: 'ê²Œì„ íŒ¨ë°°',\r\n  GAME_REWARD: 'ê²Œì„ ë³´ìƒ',\r\n  OMOK_GAME: 'ì˜¤ëª© ê²Œì„',\r\n  CHESS_GAME: 'ì²´ìŠ¤ ê²Œì„',\r\n\r\n  // ì£¼ì‹ ê´€ë ¨\r\n  STOCK_BUY: 'ì£¼ì‹ ë§¤ìˆ˜',\r\n  STOCK_SELL: 'ì£¼ì‹ ë§¤ë„',\r\n\r\n  // ì„¸ê¸ˆ ê´€ë ¨\r\n  TAX_PAYMENT: 'ì„¸ê¸ˆ ë‚©ë¶€',\r\n  TAX_REFUND: 'ì„¸ê¸ˆ í™˜ê¸‰',\r\n  FINE_PAYMENT: 'ë²Œê¸ˆ ë‚©ë¶€',\r\n\r\n  // ê¸‰ì—¬ ê´€ë ¨\r\n  SALARY_PAYMENT: 'ì›”ê¸‰ ì§€ê¸‰',\r\n  BONUS_PAYMENT: 'ë³´ë„ˆìŠ¤ ì§€ê¸‰',\r\n\r\n  // ì‹œìŠ¤í…œ ê´€ë ¨\r\n  SYSTEM: 'ì‹œìŠ¤í…œ',\r\n  ADMIN_ACTION: 'ê´€ë¦¬ì ì¡°ì¹˜',\r\n  TREASURY_DEPOSIT: 'ê¸ˆê³  ì…ê¸ˆ',\r\n  TREASURY_WITHDRAW: 'ê¸ˆê³  ì¶œê¸ˆ',\r\n};\r\n\r\n/**\r\n * ì²´ê³„ì ì¸ í™œë™ ë¡œê±°\r\n * @param {string} userId - ì‚¬ìš©ì ID\r\n * @param {string} type - í™œë™ ìœ í˜• (LOG_TYPES ì°¸ì¡°)\r\n * @param {string} description - í™œë™ ì„¤ëª…\r\n * @param {object} metadata - ì¶”ê°€ ë©”íƒ€ë°ì´í„°\r\n */\r\nconst logActivity = async (userId, type, description, metadata = {}) => {\r\n  if (!userId || userId === 'system') {\r\n    logger.log(`[System Log] ${type}: ${description}`);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Firebaseì— í™œë™ ë¡œê·¸ ê¸°ë¡ (ë©”íƒ€ë°ì´í„° í¬í•¨)\r\n    await addActivityLog(userId, type, description, metadata);\r\n\r\n    // ë©”íƒ€ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì½˜ì†”ì—ë„ ê¸°ë¡\r\n    if (Object.keys(metadata).length > 0) {\r\n      logger.log(`[Activity Log] User: ${userId}, Type: ${type}`, metadata);\r\n    }\r\n  } catch (error) {\r\n    logger.error('[Activity Log Error]', error);\r\n  }\r\n};\r\n\r\n/**\r\n * ê´€ë¦¬ì í˜„ê¸ˆ ì§€ê¸‰/íšŒìˆ˜ (MoneyTransfer.jsìš©) - Firestore íŠ¸ëœì­ì…˜ ì ìš©\r\n * @param {object} params - í•¨ìˆ˜ íŒŒë¼ë¯¸í„°\r\n * @param {string} params.adminName - ê´€ë¦¬ì ì´ë¦„\r\n * @param {string} params.adminClassCode - ê´€ë¦¬ì í•™ê¸‰ ì½”ë“œ\r\n * @param {Array<object>} params.targetUsers - ëŒ€ìƒ ì‚¬ìš©ì ì •ë³´ ë°°ì—´\r\n * @param {string} params.action - 'send' ë˜ëŠ” 'take'\r\n * @param {string} params.amountType - 'fixed' ë˜ëŠ” 'percentage'\r\n * @param {number} params.amount - ê¸ˆì•¡ ë˜ëŠ” í¼ì„¼íŠ¸\r\n * @param {number} params.taxRate - ì„¸ìœ¨\r\n */\r\nexport const adminCashAction = async ({\r\n  adminName,\r\n  adminClassCode,\r\n  targetUsers,\r\n  action,\r\n  takeMode, // \"toMe\" ë˜ëŠ” \"remove\"\r\n  amountType,\r\n  amount,\r\n  taxRate,\r\n}) => {\r\n  logger.log('[database.js] adminCashAction ì‹œì‘:', {\r\n    adminName,\r\n    action,\r\n    takeMode,\r\n    amountType,\r\n    amount,\r\n    taxRate,\r\n    targetUsersCount: targetUsers.length\r\n  });\r\n\r\n  // ì…ë ¥ ê²€ì¦\r\n  try {\r\n    if (amountType === 'percentage') {\r\n      if (amount < 0 || amount > 100) {\r\n        throw new Error('í¼ì„¼íŠ¸ëŠ” 0ê³¼ 100 ì‚¬ì´ì˜ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\r\n      }\r\n    } else {\r\n      validateAmount(amount, { min: 1, fieldName: 'ê¸ˆì•¡' });\r\n    }\r\n  } catch (error) {\r\n    throw new Error(`ì…ë ¥ ê²€ì¦ ì‹¤íŒ¨: ${error.message}`);\r\n  }\r\n\r\n  const updatedUsers = [];\r\n  let totalProcessed = 0;\r\n  let successCount = 0;\r\n\r\n  // ê° ì‚¬ìš©ìì— ëŒ€í•´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬\r\n  for (const user of targetUsers) {\r\n    try {\r\n      await runTransaction(db, async (transaction) => {\r\n        const userRef = doc(db, \"users\", user.id);\r\n        const userDoc = await transaction.get(userRef);\r\n\r\n        if (!userDoc.exists()) {\r\n          throw new Error(`ì‚¬ìš©ì ${user.name}ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n        }\r\n\r\n        const userData = userDoc.data();\r\n        const currentCash = Number(userData.cash || 0);\r\n        let baseAmount;\r\n\r\n        if (amountType === \"percentage\") {\r\n          baseAmount = Math.floor((currentCash * amount) / 100);\r\n        } else {\r\n          baseAmount = validateAmount(amount, { min: 1, fieldName: 'ê¸ˆì•¡' });\r\n        }\r\n\r\n        if (baseAmount <= 0) {\r\n          logger.log(`[database.js] ${user.name}: ì²˜ë¦¬í•  ê¸ˆì•¡ì´ 0ì›ì´ë¯€ë¡œ ìŠ¤í‚µ`);\r\n          return;\r\n        }\r\n\r\n        let finalAmount = baseAmount;\r\n        let taxAmount = 0;\r\n\r\n        if (action === \"send\" && taxRate > 0) {\r\n          taxAmount = Math.floor((baseAmount * taxRate) / 100);\r\n          finalAmount = baseAmount - taxAmount;\r\n        }\r\n\r\n        let newCash;\r\n        if (action === \"send\") {\r\n          newCash = currentCash + finalAmount;\r\n        } else { // take\r\n          // ì”ì•¡ í™•ì¸\r\n          if (currentCash < baseAmount) {\r\n            throw new Error(`${user.name}ë‹˜ì˜ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${currentCash.toLocaleString()}ì›, í•„ìš”: ${baseAmount.toLocaleString()}ì›)`);\r\n          }\r\n          newCash = currentCash - baseAmount;\r\n        }\r\n\r\n        // ì‚¬ìš©ì ì”ì•¡ ì—…ë°ì´íŠ¸\r\n        transaction.update(userRef, {\r\n          cash: newCash,\r\n          updatedAt: serverTimestamp()\r\n        });\r\n\r\n        // ë¡œê·¸ ê¸°ë¡\r\n        const logRef = doc(collection(db, \"activity_logs\"));\r\n        let logType, logDescription;\r\n\r\n        if (action === \"send\") {\r\n          logType = \"ADMIN_CASH_SEND\";\r\n          if (amountType === \"percentage\") {\r\n            logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì—ê²Œ ${amount}% (${finalAmount.toLocaleString()}ì›)ì„ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤.`;\r\n            if (taxAmount > 0) {\r\n              logDescription += ` (ì›ê¸ˆ ${baseAmount.toLocaleString()}ì›, ì„¸ê¸ˆ ${taxAmount.toLocaleString()}ì› ì œì™¸)`;\r\n            }\r\n          } else {\r\n            logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì—ê²Œ ${finalAmount.toLocaleString()}ì›ì„ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤.`;\r\n            if (taxAmount > 0) {\r\n              logDescription += ` (ì›ê¸ˆ ${baseAmount.toLocaleString()}ì›, ì„¸ê¸ˆ ${taxAmount.toLocaleString()}ì› ì œì™¸)`;\r\n            }\r\n          }\r\n        } else if (action === \"take\") {\r\n          if (takeMode === \"remove\") {\r\n            logType = \"ADMIN_CASH_REMOVE\";\r\n            if (amountType === \"percentage\") {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì˜ ${amount}% (${baseAmount.toLocaleString()}ì›)ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.`;\r\n            } else {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì˜ ${baseAmount.toLocaleString()}ì›ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.`;\r\n            }\r\n          } else {\r\n            logType = \"ADMIN_CASH_TAKE\";\r\n            if (amountType === \"percentage\") {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ìœ¼ë¡œë¶€í„° ${amount}% (${baseAmount.toLocaleString()}ì›)ì„ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`;\r\n            } else {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ìœ¼ë¡œë¶€í„° ${baseAmount.toLocaleString()}ì›ì„ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`;\r\n            }\r\n          }\r\n        }\r\n\r\n        const logData = {\r\n          userId: user.id,\r\n          userName: user.name,\r\n          timestamp: serverTimestamp(),\r\n          type: logType,\r\n          description: logDescription,\r\n          classCode: adminClassCode,\r\n          metadata: {\r\n            adminName,\r\n            action,\r\n            amountType,\r\n            inputValue: amount,\r\n            taxRate: action === 'send' ? taxRate : 0,\r\n            baseAmount,\r\n            taxAmount,\r\n            finalAmount,\r\n            previousCash: currentCash,\r\n            newCash\r\n          }\r\n        };\r\n        transaction.set(logRef, logData);\r\n\r\n        // ê±°ë˜ ê¸°ë¡\r\n        const transactionRef = doc(collection(db, \"transactions\"));\r\n        const transactionData = {\r\n          userId: user.id,\r\n          amount: action === 'send' ? finalAmount : -baseAmount,\r\n          type: action === 'send' ? 'income' : 'expense',\r\n          category: 'admin',\r\n          description: action === 'send' ? 'ê´€ë¦¬ì ì§€ê¸‰' : 'ê´€ë¦¬ì íšŒìˆ˜',\r\n          timestamp: serverTimestamp(),\r\n          metadata: {\r\n            adminName,\r\n            amountType,\r\n            taxRate: action === 'send' ? taxRate : 0\r\n          }\r\n        };\r\n        transaction.set(transactionRef, transactionData);\r\n\r\n        // ì„±ê³µ ì •ë³´ ì €ì¥\r\n        updatedUsers.push({ id: user.id, newCash });\r\n        totalProcessed += baseAmount;\r\n        successCount++;\r\n\r\n        logger.log(`[database.js] ${user.name} íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ì™„ë£Œ:`, {\r\n          í˜„ì¬ì”ì•¡: currentCash,\r\n          ê¸°ë³¸ê¸ˆì•¡: baseAmount,\r\n          ì„¸ê¸ˆ: taxAmount,\r\n          ìµœì¢…ê¸ˆì•¡: finalAmount,\r\n          ìƒˆì”ì•¡: newCash\r\n        });\r\n      });\r\n    } catch (userError) {\r\n      logger.error(`[database.js] ì‚¬ìš©ì ${user.name} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, userError);\r\n      throw new Error(`${user.name}ë‹˜ ì²˜ë¦¬ ì‹¤íŒ¨: ${userError.message}`);\r\n    }\r\n  }\r\n\r\n  logger.log(`[database.js] adminCashAction ì™„ë£Œ: ${successCount}ëª… ì²˜ë¦¬, ì´ ${totalProcessed.toLocaleString()}ì›`);\r\n\r\n  return {\r\n    count: successCount,\r\n    totalProcessed,\r\n    updatedUsers,\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Initialize the database with default values\r\n */\r\nexport const initializeDatabase = async () => {\r\n  logger.log(\"Initializing database...\");\r\n\r\n  if (!localStorage.getItem(\"dbInitialized\")) {\r\n    logger.log(\"First time initialization...\");\r\n\r\n    // Initialize items\r\n    const defaultItems = [\r\n      {\r\n        id: 1,\r\n        name: \"ì—°í•„\",\r\n        description: \"ê³¼ì œ ì œì¶œ ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ ì•„ì´í…œ\",\r\n        icon: \"âœï¸\",\r\n        price: 100,\r\n        effect: \"ê³¼ì œ ì œì¶œ ì‹œ ì‚¬ìš©\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 2,\r\n        name: \"ì§€ìš°ê°œ\",\r\n        description: \"ì‹¤ìˆ˜ë¥¼ ì§€ìš¸ ìˆ˜ ìˆëŠ” í•„ìˆ˜ ì•„ì´í…œ\",\r\n        icon: \"ğŸ§½\",\r\n        price: 50,\r\n        effect: \"ì‹¤ìˆ˜ í•˜ë‚˜ ì§€ìš°ê¸°\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 3,\r\n        name: \"ë…¸íŠ¸\",\r\n        description: \"í•™ìŠµ ë‚´ìš©ì„ ê¸°ë¡í•  ìˆ˜ ìˆëŠ” ì•„ì´í…œ\",\r\n        icon: \"ğŸ““\",\r\n        price: 200,\r\n        effect: \"í•™ìŠµ ê¸°ë¡\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 4,\r\n        name: \"ê³„ì‚°ê¸°\",\r\n        description: \"ë³µì¡í•œ ê³„ì‚°ì„ ë„ì™€ì£¼ëŠ” ì•„ì´í…œ\",\r\n        icon: \"ğŸ§®\",\r\n        price: 500,\r\n        effect: \"ê³„ì‚° ë„ì›€\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 5,\r\n        name: \"ê³ ê¸‰ íœ\",\r\n        description: \"ê³¼ì œ ì œì¶œ ì‹œ ì¶”ê°€ ì ìˆ˜ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ì•„ì´í…œ\",\r\n        icon: \"ğŸ–‹ï¸\",\r\n        price: 1000,\r\n        effect: \"ê³¼ì œ ì œì¶œ ì‹œ ì¶”ê°€ ì ìˆ˜\",\r\n        available: true,\r\n      },\r\n    ];\r\n\r\n    localStorage.setItem(\"items\", JSON.stringify(defaultItems));\r\n\r\n    // Initialize tasks\r\n    const defaultTasks = [\r\n      {\r\n        id: 1,\r\n        title: \"ê¸°ë³¸ ê²½ì œ ê°œë… í•™ìŠµ\",\r\n        description: \"ê¸°ë³¸ì ì¸ ê²½ì œ ìš©ì–´ì™€ ê°œë…ì„ í•™ìŠµí•˜ì„¸ìš”.\",\r\n        reward: 100,\r\n        couponReward: 1,\r\n        completed: false,\r\n        deadline: addDays(new Date(), 3),\r\n      },\r\n      {\r\n        id: 2,\r\n        title: \"ì˜ˆì‚° ê³„íš ì„¸ìš°ê¸°\",\r\n        description: \"í•œ ë‹¬ ì˜ˆì‚° ê³„íšì„ ì„¸ì›Œë³´ì„¸ìš”.\",\r\n        reward: 200,\r\n        couponReward: 2,\r\n        completed: false,\r\n        deadline: addDays(new Date(), 5),\r\n      },\r\n      {\r\n        id: 3,\r\n        title: \"ì €ì¶• ëª©í‘œ ì„¤ì •\",\r\n        description: \"ì €ì¶• ëª©í‘œì™€ ì „ëµì„ ìˆ˜ë¦½í•˜ì„¸ìš”.\",\r\n        reward: 150,\r\n        couponReward: 1,\r\n        completed: false,\r\n        deadline: addDays(new Date(), 7),\r\n      },\r\n    ];\r\n\r\n    localStorage.setItem(\"tasks\", JSON.stringify(defaultTasks));\r\n\r\n    // Initialize transactions\r\n    const defaultTransactions = [\r\n      {\r\n        id: 1,\r\n        date: new Date().toISOString(),\r\n        type: \"income\",\r\n        amount: 1000,\r\n        description: \"ì´ˆê¸° ì§€ê¸‰ê¸ˆ\",\r\n        category: \"system\",\r\n      },\r\n    ];\r\n\r\n    localStorage.setItem(\"transactions\", JSON.stringify(defaultTransactions));\r\n    localStorage.setItem(\"activity_logs\", JSON.stringify([]));\r\n    localStorage.setItem(\"dbInitialized\", \"true\");\r\n\r\n    logger.log(\"Database initialization complete.\");\r\n  } else {\r\n    logger.log(\"Database already initialized.\");\r\n  }\r\n};\r\n\r\n/**\r\n * Helper function to add days to a date\r\n */\r\nfunction addDays(date, days) {\r\n  const result = new Date(date);\r\n  result.setDate(result.getDate() + days);\r\n  return result.toISOString();\r\n}\r\n\r\n/**\r\n * í˜„ê¸ˆ ì „ì†¡ (ì†¡ê¸ˆ) - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n * @param {string} senderId - ì†¡ê¸ˆì ID\r\n * @param {string} receiverId - ìˆ˜ì‹ ì ID\r\n * @param {number} amount - ì†¡ê¸ˆì•¡\r\n * @param {string} message - ì†¡ê¸ˆ ë©”ì‹œì§€\r\n */\r\nexport const transferCash = async (senderId, receiverId, amount, message = '') => {\r\n  if (!senderId || !receiverId || amount <= 0) {\r\n    throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì†¡ê¸ˆ ì •ë³´ì…ë‹ˆë‹¤.');\r\n  }\r\n\r\n  try {\r\n    // ì†¡ê¸ˆì ì”ì•¡ í™•ì¸\r\n    const senderDoc = await getUserDocument(senderId);\r\n    if (!senderDoc || (senderDoc.cash || 0) < amount) {\r\n      throw new Error('ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');\r\n    }\r\n\r\n    const receiverDoc = await getUserDocument(receiverId);\r\n    if (!receiverDoc) {\r\n      throw new Error('ìˆ˜ì‹ ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\r\n    }\r\n\r\n    // ê±°ë˜ì„¸ ê³„ì‚° ë° ì ìš©\r\n    const classCode = senderDoc.classCode || receiverDoc.classCode;\r\n    const taxResult = await applyTransactionTax(classCode, senderId, amount, 'ì†¡ê¸ˆ');\r\n    const { taxAmount, netAmount } = taxResult;\r\n\r\n    // ì†¡ê¸ˆìëŠ” ì›ë˜ ê¸ˆì•¡ + ì„¸ê¸ˆì„ ì§€ë¶ˆí•´ì•¼ í•¨\r\n    const totalDeduction = amount + taxAmount;\r\n    if ((senderDoc.cash || 0) < totalDeduction) {\r\n      throw new Error(`ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì†¡ê¸ˆì•¡: ${amount}ì› + ê±°ë˜ì„¸: ${taxAmount}ì› = ì´ ${totalDeduction}ì› í•„ìš”)`);\r\n    }\r\n\r\n    // ì†¡ê¸ˆ ì²˜ë¦¬\r\n    const transferMessage = message || `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì†¡ê¸ˆ`;\r\n\r\n    // ì†¡ê¸ˆì ì°¨ê° (ì›ë˜ ê¸ˆì•¡ + ê±°ë˜ì„¸)\r\n    await updateUserCashInFirestore(senderId, -totalDeduction,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ${amount}ì› ì†¡ê¸ˆ (ê±°ë˜ì„¸ ${taxAmount}ì› í¬í•¨) ${message ? `(${message})` : ''}`);\r\n\r\n    await logActivity(senderId, LOG_TYPES.CASH_TRANSFER_SEND,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ${amount}ì›ì„ ì†¡ê¸ˆí–ˆìŠµë‹ˆë‹¤.${taxAmount > 0 ? ` (ê±°ë˜ì„¸ ${taxAmount}ì› ë‚©ë¶€)` : ''}${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        receiverId,\r\n        receiverName: receiverDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        totalDeduction,\r\n        message,\r\n        transactionType: 'transfer_send'\r\n      }\r\n    );\r\n\r\n    // ìˆ˜ì‹ ì ì¦ê°€ (ì„¸ê¸ˆ ì œì™¸í•œ ì›ë˜ ê¸ˆì•¡)\r\n    await updateUserCashInFirestore(receiverId, amount,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ${amount}ì› ì†¡ê¸ˆ ë°›ìŒ ${message ? `(${message})` : ''}`);\r\n\r\n    await logActivity(receiverId, LOG_TYPES.CASH_TRANSFER_RECEIVE,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ${amount}ì›ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        senderId,\r\n        senderName: senderDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        message,\r\n        transactionType: 'transfer_receive'\r\n      }\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n      amount,\r\n      taxAmount,\r\n      totalDeduction,\r\n      message: taxAmount > 0 ? `ì†¡ê¸ˆ ì™„ë£Œ. ê±°ë˜ì„¸ ${taxAmount}ì›ì´ ë¶€ê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.` : 'ì†¡ê¸ˆ ì™„ë£Œ.'\r\n    };\r\n  } catch (error) {\r\n    logger.error('í˜„ê¸ˆ ì „ì†¡ ì‹¤íŒ¨:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * ì¿ í° ì „ì†¡ - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n * @param {string} senderId - ì†¡ê¸ˆì ID\r\n * @param {string} receiverId - ìˆ˜ì‹ ì ID\r\n * @param {number} amount - ì¿ í° ìˆ˜ëŸ‰\r\n * @param {string} message - ì „ì†¡ ë©”ì‹œì§€\r\n */\r\nexport const transferCoupons = async (senderId, receiverId, amount, message = '') => {\r\n  if (!senderId || !receiverId || amount <= 0) {\r\n    throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì¿ í° ì „ì†¡ ì •ë³´ì…ë‹ˆë‹¤.');\r\n  }\r\n\r\n  try {\r\n    // ì†¡ê¸ˆì ì¿ í° í™•ì¸\r\n    const senderDoc = await getUserDocument(senderId);\r\n    if (!senderDoc || (senderDoc.coupons || 0) < amount) {\r\n      throw new Error('ì¿ í°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');\r\n    }\r\n\r\n    const receiverDoc = await getUserDocument(receiverId);\r\n    if (!receiverDoc) {\r\n      throw new Error('ìˆ˜ì‹ ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\r\n    }\r\n\r\n    // ì¿ í° ì „ì†¡ì˜ ê²½ìš° í˜„ê¸ˆ ê¸°ì¤€ ê°€ê²©ìœ¼ë¡œ ê±°ë˜ì„¸ ê³„ì‚° (ì¿ í° 1ê°œ = 100ì›ìœ¼ë¡œ ê°€ì •)\r\n    const classCode = senderDoc.classCode || receiverDoc.classCode;\r\n    const couponValue = amount * 100; // ì¿ í° 1ê°œë‹¹ 100ì›ìœ¼ë¡œ ê³„ì‚°\r\n    const taxResult = await applyTransactionTax(classCode, senderId, couponValue, 'ì¿ í° ì „ì†¡');\r\n    const { taxAmount } = taxResult;\r\n\r\n    // ì†¡ê¸ˆìëŠ” ê±°ë˜ì„¸ë¥¼ í˜„ê¸ˆìœ¼ë¡œ ì§€ë¶ˆí•´ì•¼ í•¨\r\n    if (taxAmount > 0 && (senderDoc.cash || 0) < taxAmount) {\r\n      throw new Error(`ê±°ë˜ì„¸ ë‚©ë¶€ë¥¼ ìœ„í•œ í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ê±°ë˜ì„¸: ${taxAmount}ì› í•„ìš”)`);\r\n    }\r\n\r\n    // ì¿ í° ì „ì†¡ ì²˜ë¦¬\r\n    const transferMessage = message || `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ìˆ˜ì‹ `;\r\n\r\n    // ì†¡ê¸ˆì ì¿ í° ì°¨ê°\r\n    await updateUserCouponsInFirestore(senderId, -amount,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œ ì „ì†¡ ${message ? `(${message})` : ''}`\r\n    );\r\n\r\n    // ê±°ë˜ì„¸ ì°¨ê° (í˜„ê¸ˆìœ¼ë¡œ)\r\n    if (taxAmount > 0) {\r\n      await updateUserCashInFirestore(senderId, -taxAmount, `ì¿ í° ì „ì†¡ ê±°ë˜ì„¸ ${taxAmount}ì›`);\r\n    }\r\n\r\n    await logActivity(senderId, LOG_TYPES.COUPON_TRANSFER_SEND,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.${taxAmount > 0 ? ` (ê±°ë˜ì„¸ ${taxAmount}ì› ë‚©ë¶€)` : ''}${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        receiverId,\r\n        receiverName: receiverDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        couponValue,\r\n        message,\r\n        transactionType: 'coupon_transfer_send'\r\n      }\r\n    );\r\n\r\n    // ìˆ˜ì‹ ì ì¦ê°€\r\n    await updateUserCouponsInFirestore(receiverId, amount,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ${amount}ê°œ ë°›ìŒ ${message ? `(${message})` : ''}`);\r\n\r\n    await logActivity(receiverId, LOG_TYPES.COUPON_TRANSFER_RECEIVE,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ${amount}ê°œë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        senderId,\r\n        senderName: senderDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        message,\r\n        transactionType: 'coupon_transfer_receive'\r\n      }\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n      amount,\r\n      taxAmount,\r\n      message: taxAmount > 0 ? `ì¿ í° ì „ì†¡ ì™„ë£Œ. ê±°ë˜ì„¸ ${taxAmount}ì›ì´ ë¶€ê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.` : 'ì¿ í° ì „ì†¡ ì™„ë£Œ.'\r\n    };\r\n  } catch (error) {\r\n    logger.error('ì¿ í° ì „ì†¡ ì‹¤íŒ¨:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * ê±°ë˜ ì¶”ê°€ (ê°œì„ ëœ ë²„ì „) - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const addTransaction = async (transaction, updateFirebase = true) => {\r\n  try {\r\n    // localStorageì— ê±°ë˜ ê¸°ë¡\r\n    const transactionsJson = localStorage.getItem(\"transactions\");\r\n    const transactions = transactionsJson ? JSON.parse(transactionsJson) : [];\r\n\r\n    const newTransaction = {\r\n      ...transaction,\r\n      id: transactions.length > 0\r\n        ? Math.max(...transactions.map((t) => t.id)) + 1\r\n        : 1,\r\n      date: new Date().toISOString(),\r\n    };\r\n\r\n    transactions.push(newTransaction);\r\n    localStorage.setItem(\"transactions\", JSON.stringify(transactions));\r\n\r\n    // Firebase ì—…ë°ì´íŠ¸\r\n    if (updateFirebase && transaction.userId && typeof transaction.amount === 'number') {\r\n      try {\r\n        const logType = transaction.type === 'income' ? LOG_TYPES.CASH_INCOME : LOG_TYPES.CASH_EXPENSE;\r\n        const logMessage = `${transaction.description} (${Math.abs(transaction.amount)}ì›)`;\r\n\r\n        if (transaction.type === 'income') {\r\n          await updateUserCashInFirestore(transaction.userId, transaction.amount, logMessage);\r\n        } else if (transaction.type === 'expense') {\r\n          await updateUserCashInFirestore(transaction.userId, -Math.abs(transaction.amount), logMessage);\r\n        }\r\n\r\n        await logActivity(transaction.userId, logType, logMessage, {\r\n          amount: transaction.amount,\r\n          category: transaction.category,\r\n          transactionId: newTransaction.id,\r\n          transactionType: transaction.type\r\n        });\r\n\r\n        // Firebaseì—ë„ ê±°ë˜ ê¸°ë¡ ì €ì¥\r\n        if (firebaseAddTransaction) {\r\n          await firebaseAddTransaction(transaction.userId, transaction.amount, transaction.description);\r\n        }\r\n\r\n        logger.log('[DB] Firebase ë™ê¸°í™” ì™„ë£Œ:', newTransaction);\r\n      } catch (firebaseError) {\r\n        logger.error('[DB] Firebase ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜:', firebaseError);\r\n      }\r\n    }\r\n\r\n    return newTransaction;\r\n  } catch (error) {\r\n    logger.error(\"Error adding transaction:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * ì‚¬ìš©ì ê±°ë˜ ë‚´ì—­ ì¡°íšŒ\r\n */\r\nexport const getUserTransactions = (userId, limit = null) => {\r\n  try {\r\n    const transactionsJson = localStorage.getItem(\"transactions\");\r\n    const transactions = transactionsJson ? JSON.parse(transactionsJson) : [];\r\n\r\n    let filteredTransactions = transactions;\r\n    if (userId) {\r\n      filteredTransactions = transactions.filter(t => t.userId === userId);\r\n    }\r\n\r\n    const sortedTransactions = filteredTransactions.sort(\r\n      (a, b) => new Date(b.date) - new Date(a.date)\r\n    );\r\n\r\n    if (limit && limit > 0) {\r\n      return sortedTransactions.slice(0, limit);\r\n    }\r\n\r\n    return sortedTransactions;\r\n  } catch (error) {\r\n    logger.error(\"Error getting transactions:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * ì‚¬ìš©ì ê³¼ì œ ì¡°íšŒ\r\n */\r\nexport const getUserTasks = (userId, completed = null) => {\r\n  try {\r\n    const tasksJson = localStorage.getItem(\"tasks\");\r\n    const tasks = tasksJson ? JSON.parse(tasksJson) : [];\r\n\r\n    if (completed !== null) {\r\n      return tasks.filter((task) => task.completed === completed);\r\n    }\r\n\r\n    return tasks;\r\n  } catch (error) {\r\n    logger.error(\"Error getting tasks:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * ê³¼ì œ ì™„ë£Œ (ê°œì„ ëœ ë²„ì „) - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const completeTask = async (taskId, userId, updateFirebase = true) => {\r\n  try {\r\n    const tasksJson = localStorage.getItem(\"tasks\");\r\n    const tasks = tasksJson ? JSON.parse(tasksJson) : [];\r\n\r\n    const taskIndex = tasks.findIndex((task) => task.id === taskId);\r\n    if (taskIndex === -1) {\r\n      logger.warn(`Task with ID ${taskId} not found`);\r\n      return false;\r\n    }\r\n\r\n    const completedTask = tasks[taskIndex];\r\n    tasks[taskIndex].completed = true;\r\n    localStorage.setItem(\"tasks\", JSON.stringify(tasks));\r\n\r\n    const cashReward = completedTask.reward || 0;\r\n    const couponReward = completedTask.couponReward || 0;\r\n\r\n    if (updateFirebase && userId) {\r\n      try {\r\n        // í˜„ê¸ˆ ë³´ìƒ (ì†Œë“ì„¸ ì ìš©)\r\n        if (cashReward > 0) {\r\n          const userDoc = await getUserDocument(userId);\r\n          const classCode = userDoc?.classCode;\r\n\r\n          if (classCode) {\r\n            const taxResult = await applyIncomeTax(classCode, userId, cashReward, 'reward');\r\n            const { netIncome, taxAmount } = taxResult;\r\n\r\n            await updateUserCashInFirestore(userId, netIncome,\r\n              `'${completedTask.title}' ê³¼ì œ ì™„ë£Œ ë³´ìƒ (ì„¸í›„ ${netIncome}ì›, ì†Œë“ì„¸ ${taxAmount}ì› ë‚©ë¶€)`\r\n            );\r\n          } else {\r\n            await updateUserCashInFirestore(userId, cashReward,\r\n              `'${completedTask.title}' ê³¼ì œ ì™„ë£Œ ë³´ìƒ`\r\n            );\r\n          }\r\n        }\r\n\r\n        // ì¿ í° ë³´ìƒ\r\n        if (couponReward > 0) {\r\n          await updateUserCouponsInFirestore(userId, couponReward,\r\n            `'${completedTask.title}' ê³¼ì œ ì™„ë£Œ ì¿ í° ë³´ìƒ`\r\n          );\r\n\r\n          // ì¿ í° íšë“ì— ëŒ€í•œ ë³„ë„ ë¡œê·¸ (ìˆ˜ì •ëœ ë¶€ë¶„)\r\n          await logActivity(userId, LOG_TYPES.COUPON_EARN,\r\n            `'ê³¼ì œ ì™„ë£Œ: ${completedTask.title}' í™œë™ìœ¼ë¡œ ì¿ í° ${couponReward}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.`,\r\n            {\r\n              taskId,\r\n              taskTitle: completedTask.title,\r\n              couponAmount: couponReward,\r\n              reason: 'task_completion',\r\n              activity: `ê³¼ì œ ì™„ë£Œ: ${completedTask.title}`, // ì–´ë–¤ í™œë™ì¸ì§€ ëª…ì‹œ\r\n              taskDescription: completedTask.description\r\n            }\r\n          );\r\n        }\r\n\r\n        // ê³¼ì œ ì™„ë£Œ í™œë™ ë¡œê·¸\r\n        const rewardText = [];\r\n        if (cashReward > 0) rewardText.push(`í˜„ê¸ˆ ${cashReward}ì›`);\r\n        if (couponReward > 0) rewardText.push(`ì¿ í° ${couponReward}ê°œ`);\r\n\r\n        await logActivity(userId, LOG_TYPES.TASK_COMPLETE,\r\n          `'${completedTask.title}' ê³¼ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.${rewardText.length > 0 ? ` ë³´ìƒ: ${rewardText.join(', ')}` : ''}`,\r\n          {\r\n            taskId,\r\n            taskTitle: completedTask.title,\r\n            taskDescription: completedTask.description,\r\n            cashReward,\r\n            couponReward,\r\n            deadline: completedTask.deadline\r\n          }\r\n        );\r\n\r\n        logger.log(`[DB] ê³¼ì œ ì™„ë£Œ Firebase ë™ê¸°í™” ì™„ë£Œ: ${completedTask.title}`);\r\n      } catch (firebaseError) {\r\n        logger.error('[DB] Firebase ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜:', firebaseError);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    logger.error(\"Error completing task:\", error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ì•„ì´í…œ ì‚¬ìš© ê¸°ë¡ - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const useItem = async (userId, itemName, effect, quantity = 1, context = '') => {\r\n  if (!userId || !itemName) {\r\n    logger.warn('[DB] useItem: userIdì™€ itemNameì´ í•„ìš”í•©ë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const contextText = context ? ` (${context})` : '';\r\n    await logActivity(userId, LOG_TYPES.ITEM_USE,\r\n      `${itemName} ${quantity}ê°œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.${contextText} íš¨ê³¼: ${effect}`,\r\n      {\r\n        itemName,\r\n        effect,\r\n        quantity,\r\n        context,\r\n        usageTime: new Date().toISOString()\r\n      }\r\n    );\r\n    logger.log(`[DB] ì•„ì´í…œ ì‚¬ìš© ê¸°ë¡ ì™„ë£Œ: ${itemName}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ì•„ì´í…œ ì‚¬ìš© ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ì•„ì´í…œ íšë“ ê¸°ë¡ - ìƒˆë¡œìš´ í•¨ìˆ˜ ì¶”ê°€\r\n */\r\nexport const obtainItem = async (userId, itemName, quantity = 1, source = 'unknown') => {\r\n  if (!userId || !itemName) {\r\n    logger.warn('[DB] obtainItem: userIdì™€ itemNameì´ í•„ìš”í•©ë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const sourceText = source !== 'unknown' ? ` (${source})` : '';\r\n    await logActivity(userId, LOG_TYPES.ITEM_OBTAIN,\r\n      `${itemName} ${quantity}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.${sourceText}`,\r\n      {\r\n        itemName,\r\n        quantity,\r\n        source,\r\n        obtainTime: new Date().toISOString()\r\n      }\r\n    );\r\n    logger.log(`[DB] ì•„ì´í…œ íšë“ ê¸°ë¡ ì™„ë£Œ: ${itemName}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ì•„ì´í…œ íšë“ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ê²Œì„ ê²°ê³¼ ê¸°ë¡ - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const recordGameResult = async (userId, gameName, result, reward = null, gameDetails = {}) => {\r\n  if (!userId || !gameName || !result) {\r\n    logger.warn('[DB] recordGameResult: ëª¨ë“  ë§¤ê°œë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const logType = result === 'win' ? LOG_TYPES.GAME_WIN :\r\n                   result === 'lose' ? LOG_TYPES.GAME_LOSE :\r\n                   LOG_TYPES.GAME_REWARD;\r\n\r\n    let description = `${gameName}ì—ì„œ ${result === 'win' ? 'ìŠ¹ë¦¬' : result === 'lose' ? 'íŒ¨ë°°' : 'ê²Œì„ ì™„ë£Œ'}í–ˆìŠµë‹ˆë‹¤.`;\r\n    const rewardDetails = [];\r\n\r\n    if (reward) {\r\n      if (reward.cash > 0) {\r\n        await updateUserCashInFirestore(userId, reward.cash, `${gameName} ë³´ìƒ`);\r\n        rewardDetails.push(`í˜„ê¸ˆ ${reward.cash}ì›`);\r\n      }\r\n      if (reward.coupons > 0) {\r\n        await updateUserCouponsInFirestore(userId, reward.coupons, `${gameName} ë³´ìƒ`);\r\n        rewardDetails.push(`ì¿ í° ${reward.coupons}ê°œ`);\r\n\r\n        // ì¿ í° íšë“ì— ëŒ€í•œ ë³„ë„ ë¡œê·¸ (ìˆ˜ì •ëœ ë¶€ë¶„)\r\n        await logActivity(userId, LOG_TYPES.COUPON_EARN,\r\n          `'ê²Œì„ ë³´ìƒ: ${gameName}' í™œë™ìœ¼ë¡œ ì¿ í° ${reward.coupons}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.`,\r\n          {\r\n            gameName,\r\n            result,\r\n            couponAmount: reward.coupons,\r\n            reason: 'game_reward',\r\n            activity: `ê²Œì„ ë³´ìƒ: ${gameName}`, // ì–´ë–¤ í™œë™ì¸ì§€ ëª…ì‹œ\r\n            gameDetails\r\n          }\r\n        );\r\n      }\r\n\r\n      if (rewardDetails.length > 0) {\r\n        description += ` ë³´ìƒ: ${rewardDetails.join(', ')}`;\r\n      }\r\n    }\r\n\r\n    await logActivity(userId, logType, description, {\r\n      gameName,\r\n      result,\r\n      reward,\r\n      gameDetails,\r\n      duration: gameDetails.duration || null,\r\n      score: gameDetails.score || null\r\n    });\r\n\r\n    logger.log(`[DB] ê²Œì„ ê²°ê³¼ ê¸°ë¡ ì™„ë£Œ: ${gameName} - ${result}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê²Œì„ ê²°ê³¼ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * ê´€ë¦¬ì ì•¡ì…˜ ê¸°ë¡\r\n */\r\nexport const recordAdminAction = async (adminId, action, targetUserId, details) => {\r\n  if (!adminId || !action || !targetUserId) {\r\n    logger.warn('[DB] recordAdminAction: í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    await logActivity(adminId, LOG_TYPES.ADMIN_ACTION,\r\n      `ê´€ë¦¬ìê°€ ${action} ì‘ì—…ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ëŒ€ìƒ: ${targetUserId}`,\r\n      { action, targetUserId, details }\r\n    );\r\n    logger.log(`[DB] ê´€ë¦¬ì ì•¡ì…˜ ê¸°ë¡ ì™„ë£Œ: ${action}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê´€ë¦¬ì ì•¡ì…˜ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡\r\n */\r\nexport const recordSalaryPayment = async (userId, amount, period, details = {}) => {\r\n  if (!userId || !amount || amount <= 0) {\r\n    logger.warn('[DB] recordSalaryPayment: í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const userDoc = await getUserDocument(userId);\r\n    const classCode = userDoc?.classCode;\r\n\r\n    if (classCode) {\r\n      // ê¸‰ì—¬ì— ì†Œë“ì„¸ ì ìš©\r\n      const taxResult = await applyIncomeTax(classCode, userId, amount, 'salary');\r\n      const { netIncome, taxAmount } = taxResult;\r\n\r\n      await updateUserCashInFirestore(userId, netIncome,\r\n        `${period} ê¸‰ì—¬ ì§€ê¸‰ (ì„¸í›„ ${netIncome}ì›, ì†Œë“ì„¸ ${taxAmount}ì› ë‚©ë¶€)`\r\n      );\r\n\r\n      await logActivity(userId, LOG_TYPES.SALARY_PAYMENT,\r\n        `${period} ê¸‰ì—¬ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ${amount}ì›, ì„¸í›„ ${netIncome}ì›, ì†Œë“ì„¸ ${taxAmount}ì›)`,\r\n        {\r\n          grossAmount: amount,\r\n          netAmount: netIncome,\r\n          taxAmount,\r\n          period,\r\n          details,\r\n          paymentDate: new Date().toISOString()\r\n        }\r\n      );\r\n\r\n      logger.log(`[DB] ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡ ì™„ë£Œ: ${userId} - ì´ ${amount}ì› (ì„¸í›„ ${netIncome}ì›)`);\r\n    } else {\r\n      // í´ë˜ìŠ¤ ì½”ë“œê°€ ì—†ëŠ” ê²½ìš° ê¸°ì¡´ ë°©ì‹\r\n      await updateUserCashInFirestore(userId, amount, `${period} ê¸‰ì—¬ ì§€ê¸‰`);\r\n      await logActivity(userId, LOG_TYPES.SALARY_PAYMENT,\r\n        `${period} ê¸‰ì—¬ ${amount}ì›ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`,\r\n        {\r\n          amount,\r\n          period,\r\n          details,\r\n          paymentDate: new Date().toISOString()\r\n        }\r\n      );\r\n      logger.log(`[DB] ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡ ì™„ë£Œ: ${userId} - ${amount}ì›`);\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ì¿ í° ê´€ë ¨ ê´€ë¦¬ì ì•¡ì…˜\r\n */\r\nexport const adminCouponAction = async (adminId, targetUserId, action, amount, reason) => {\r\n  if (!adminId || !targetUserId || !action || !amount) {\r\n    logger.warn('[DB] adminCouponAction: í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const isGive = action === 'give';\r\n    const logType = isGive ? LOG_TYPES.COUPON_GIVE : LOG_TYPES.COUPON_TAKE;\r\n    const actionAmount = isGive ? amount : -Math.abs(amount);\r\n\r\n    await updateUserCouponsInFirestore(targetUserId, actionAmount,\r\n      `ê´€ë¦¬ì ${isGive ? 'ì§€ê¸‰' : 'íšŒìˆ˜'}: ${reason || 'ê´€ë¦¬ì ì¡°ì¹˜'}`\r\n    );\r\n\r\n    const targetDoc = await getUserDocument(targetUserId);\r\n    const targetName = targetDoc?.name || 'ì‚¬ìš©ì';\r\n\r\n    await logActivity(targetUserId, logType,\r\n      `ê´€ë¦¬ìê°€ ì¿ í° ${Math.abs(amount)}ê°œë¥¼ ${isGive ? 'ì§€ê¸‰' : 'íšŒìˆ˜'}í–ˆìŠµë‹ˆë‹¤.${reason ? ` ì‚¬ìœ : ${reason}` : ''}`,\r\n      {\r\n        adminId,\r\n        action,\r\n        amount: Math.abs(amount),\r\n        reason,\r\n        targetUserId,\r\n        targetName\r\n      }\r\n    );\r\n\r\n    // ê´€ë¦¬ì ì•¡ì…˜ë„ ë³„ë„ ê¸°ë¡\r\n    await recordAdminAction(adminId, `ì¿ í° ${isGive ? 'ì§€ê¸‰' : 'íšŒìˆ˜'}`, targetUserId, {\r\n      amount: Math.abs(amount),\r\n      reason\r\n    });\r\n\r\n    logger.log(`[DB] ê´€ë¦¬ì ì¿ í° ì•¡ì…˜ ì™„ë£Œ: ${action} - ${amount}ê°œ`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê´€ë¦¬ì ì¿ í° ì•¡ì…˜ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Export log types for external use\r\nexport { LOG_TYPES, logActivity };"],"names":["validateAmount","amount","options","arguments","length","undefined","min","max","Number","MAX_SAFE_INTEGER","allowZero","fieldName","numAmount","isNaN","Error","concat","isFinite","toLocaleString","getCurrencyUnit","Math","floor","userDoc","allClassMembers","loading","authLoading","setUserDoc","setAllClassMembers","useAuth","currencyUnit","useCurrency","selectedUsers","setSelectedUsers","useState","setAmount","amountType","setAmountType","action","setAction","takeMode","setTakeMode","taxRate","setTaxRate","message","setMessage","error","setError","selectAll","setSelectAll","isProcessing","setIsProcessing","adminName","name","adminClassCode","classCode","users","useMemo","sort","a","b","nameA","nickname","nameB","localeCompare","useEffect","calculatePreviewAmount","useCallback","userCash","inputValue","baseAmount","applyTax","previewAmounts","preview","forEach","userId","user","find","u","id","cash","_jsxs","className","children","_jsx","onSubmit","async","e","preventDefault","targetUsersData","filter","includes","count","totalProcessed","updatedUsers","targetUsers","_ref","logger","log","targetUsersCount","successCount","runTransaction","db","userRef","doc","transaction","get","exists","userData","data","currentCash","newCash","finalAmount","taxAmount","update","updatedAt","serverTimestamp","logRef","collection","logType","logDescription","logData","userName","timestamp","type","description","metadata","previousCash","set","transactionRef","transactionData","category","push","í˜„ì¬ì”ì•¡","ê¸°ë³¸ê¸ˆì•¡","ì„¸ê¸ˆ","ìµœì¢…ê¸ˆì•¡","ìƒˆì”ì•¡","userError","adminCashAction","currentMembers","map","member","updatedInfo","_objectSpread","currentAdminDoc","currentAdminCash","newAdminCash","actionText","setTimeout","err","onClick","value","checked","onChange","target","placeholder","required","htmlFor","_Fragment","handleSelectAll","prev","newSelectAll","_user$cash","previewAmount","handleUserSelection","prevSelected","disabled"],"ignoreList":[],"sourceRoot":""}