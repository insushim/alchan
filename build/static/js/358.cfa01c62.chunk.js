"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[358],{4358(e,s,a){a.r(s),a.d(s,{default:()=>d});var n=a(2555),c=a(5043),t=a(4689),i=a(5472),l=a(5016),o=a(5452),r=a(579);const d=function(){const{userDoc:e,allClassMembers:s,loading:a,addCouponsToUserById:d,deductCouponsFromUserById:u,updateLocalUserState:m}=(0,l.As)(),[h,p]=(0,c.useState)(""),[v,x]=(0,c.useState)(""),[N,j]=(0,c.useState)(!1),[f,g]=(0,c.useState)([]),[b,y]=(0,c.useState)(""),[k,S]=(0,c.useState)("fixed"),[C,L]=(0,c.useState)("send"),[w,I]=(0,c.useState)("delete"),[A,E]=(0,c.useState)(!1),[M,F]=(0,c.useState)([]),[T,U]=(0,c.useState)(null),_=(null===e||void 0===e?void 0:e.isAdmin)||!1,B=null===e||void 0===e?void 0:e.name,D=null===e||void 0===e?void 0:e.uid,K=null===e||void 0===e?void 0:e.classCode;(0,c.useEffect)(()=>{if(s){const e=[...s].sort((e,s)=>{const a=e.name||"",n=s.name||"";return a.localeCompare(n,"ko-KR")});F(e)}},[s]),(0,c.useEffect)(()=>{e&&U(e)},[e]);const R=M.length>0?M:(s||[]).sort((e,s)=>{const a=e.name||"",n=s.name||"";return a.localeCompare(n,"ko-KR")}),q=T||e;(0,c.useEffect)(()=>{g([]),y(""),p(""),x(""),E(!1)},[]);const H=(e,s)=>"percentage"===k?Math.floor(e*Number(s)/100):Number(s);if(!_)return(0,r.jsx)("div",{className:"coupon-transfer-container",children:(0,r.jsx)("div",{className:"alert alert-error",children:"\uad00\ub9ac\uc790\ub9cc \uc774 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."})});if(a&&0===R.length)return(0,r.jsx)("div",{className:"coupon-transfer-container",children:(0,r.jsx)("div",{className:"loading",children:"\ub370\uc774\ud130\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."})});const J=(()=>{if(!b||0===f.length)return{};const e={};return f.forEach(s=>{const a=R.find(e=>e.id===s);if(a){const n=H(Number(a.coupons||0),b);e[s]=n}}),e})();return(0,r.jsxs)("div",{className:"coupon-transfer-container",children:[(0,r.jsxs)("div",{className:"header",children:[(0,r.jsx)("h3",{children:"\ucfe0\ud3f0 \ub300\ub7c9 \uad00\ub9ac"}),(0,r.jsxs)("div",{className:"admin-info",children:[(0,r.jsx)("span",{className:"admin-label",children:(null===q||void 0===q?void 0:q.name)||"\uc0ac\uc6a9\uc790"}),(0,r.jsxs)("span",{className:"admin-coupons",children:["\ubcf4\uc720 \ucfe0\ud3f0: ",((null===q||void 0===q?void 0:q.coupons)||0).toLocaleString(),"\uac1c"]}),(0,r.jsxs)("span",{className:"admin-cash",style:{marginLeft:"10px"},children:["\ud604\uae08: ",((null===q||void 0===q?void 0:q.cash)||0).toLocaleString(),"\uc6d0"]})]})]}),v&&(0,r.jsx)("div",{className:"alert alert-error",children:v}),h&&(0,r.jsx)("div",{className:"alert alert-success",children:h}),(0,r.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f.length&&b&&!isNaN(Number(b))){j(!0),p(""),x("");try{const e=(0,i.wP)(t.db);let a=0,c=0;const l=[];for(const n of f){const r=R.find(e=>e.id===n);if(!r)continue;const m=Number(r.coupons||0),h=H(m,b);c+=h;try{"send"===C?(await d(n,h),l.push({userId:n,change:h})):"transfer"===w?(await u(n,h),await d(D,h),l.push({userId:n,change:-h}),l.push({userId:D,change:h})):(await u(n,h),l.push({userId:n,change:-h}));const s=(0,i.H9)((0,i.rJ)(t.db,"activity_logs")),c="send"===C?"\ub300\ub7c9 \uc9c0\uae09":"transfer"===w?"\ub300\ub7c9 \ud68c\uc218(\uad00\ub9ac\uc790 \uc774\uc804)":"\ub300\ub7c9 \uc0ad\uc81c",o="\uad00\ub9ac\uc790(".concat(B,")\uac00 ").concat(r.name,"\ub2d8\uc5d0\uac8c \ucfe0\ud3f0 ").concat(h.toLocaleString(),"\uac1c\ub97c ").concat(c,"\ud588\uc2b5\ub2c8\ub2e4. (").concat("percentage"===k?"".concat(b,"% \uc801\uc6a9"):"\uace0\uc815 \uac1c\uc218",")");e.set(s,{userId:n,userName:r.name,timestamp:(0,i.O5)(),type:"couponAdminAction",description:o,classCode:K,adminId:D,adminName:B}),a++}catch(s){o.vF.error("\uc0ac\uc6a9\uc790 ".concat(n," \ucc98\ub9ac \uc911 \uc624\ub958:"),s)}}await e.commit(),l.forEach(e=>{let{userId:s,change:a}=e;((e,s)=>{F(a=>a.map(a=>a.id===e?(0,n.A)((0,n.A)({},a),{},{coupons:Math.max(0,(a.coupons||0)+s)}):a)),e===D&&U(e=>(0,n.A)((0,n.A)({},e),{},{coupons:Math.max(0,((null===e||void 0===e?void 0:e.coupons)||0)+s)}))})(s,a)}),p("".concat(a,"\uba85\uc5d0\uac8c \ucfe0\ud3f0 \ucc98\ub9ac\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4. (\ucd1d ").concat(c.toLocaleString(),"\uac1c)")),y(""),g([]),E(!1),setTimeout(()=>p(""),3e3)}catch(a){o.vF.error("\ub300\ub7c9 \ucc98\ub9ac \uc911 \uc624\ub958:",a),x("\uc624\ub958 \ubc1c\uc0dd: ".concat(a.message)),setTimeout(()=>x(""),5e3)}finally{j(!1)}}else x("\uc0ac\uc6a9\uc790\ub97c \uc120\ud0dd\ud558\uace0 \uc720\ud6a8\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694.")},className:"transfer-form",children:[(0,r.jsxs)("div",{className:"action-selector",children:[(0,r.jsx)("button",{type:"button",className:"action-btn ".concat("send"===C?"active send":""),onClick:()=>L("send"),children:"\ud83d\udce4 \ubcf4\ub0b4\uae30"}),(0,r.jsx)("button",{type:"button",className:"action-btn ".concat("take"===C?"active take":""),onClick:()=>L("take"),children:"\ud83d\udce5 \uac00\uc838\uc624\uae30"})]}),"take"===C&&(0,r.jsxs)("div",{className:"amount-type-selector",style:{margin:"10px 0"},children:[(0,r.jsxs)("label",{className:"type-option ".concat("delete"===w?"active":""),children:[(0,r.jsx)("input",{type:"radio",value:"delete",checked:"delete"===w,onChange:e=>I(e.target.value)}),"\uc0ad\uc81c\ud558\uae30"]}),(0,r.jsxs)("label",{className:"type-option ".concat("transfer"===w?"active":""),children:[(0,r.jsx)("input",{type:"radio",value:"transfer",checked:"transfer"===w,onChange:e=>I(e.target.value)}),"\ub098\uc5d0\uac8c \uac00\uc838\uc624\uae30"]})]}),(0,r.jsxs)("div",{className:"amount-section",children:[(0,r.jsxs)("div",{className:"amount-type-selector",children:[(0,r.jsxs)("label",{className:"type-option ".concat("fixed"===k?"active":""),children:[(0,r.jsx)("input",{type:"radio",value:"fixed",checked:"fixed"===k,onChange:e=>S(e.target.value)}),"\uace0\uc815 \uac1c\uc218"]}),(0,r.jsxs)("label",{className:"type-option ".concat("percentage"===k?"active":""),children:[(0,r.jsx)("input",{type:"radio",value:"percentage",checked:"percentage"===k,onChange:e=>S(e.target.value)}),"\ud37c\uc13c\ud2b8 (%)"]})]}),(0,r.jsxs)("div",{className:"amount-input-group",children:[(0,r.jsx)("input",{type:"number",value:b,onChange:e=>y(e.target.value),placeholder:"fixed"===k?"\ucfe0\ud3f0 \uac1c\uc218":"\ud37c\uc13c\ud2b8",min:"1",required:!0,className:"amount-input"}),(0,r.jsx)("span",{className:"amount-unit",children:"fixed"===k?"\uac1c":"%"})]})]}),(0,r.jsxs)("div",{className:"user-selection-section",children:[(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsx)("h3",{children:"\ub300\uc0c1 \uc120\ud0dd"}),(0,r.jsxs)("label",{className:"select-all-label",children:[(0,r.jsx)("input",{type:"checkbox",checked:A,onChange:()=>{E(!A),g(A?[]:R.map(e=>e.id))},className:"checkbox-custom"}),(0,r.jsx)("span",{className:"checkmark"}),"\uc804\uccb4 \uc120\ud0dd"]})]}),(0,r.jsx)("div",{className:"user-list",children:R.map(e=>{var s;return(0,r.jsx)("div",{className:"user-item",children:(0,r.jsxs)("label",{className:"user-label",children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox-custom",checked:f.includes(e.id),onChange:()=>{return s=e.id,void g(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s}}),(0,r.jsx)("span",{className:"checkmark"}),(0,r.jsxs)("div",{className:"user-info",children:[(0,r.jsx)("span",{className:"user-name",children:e.name}),(0,r.jsxs)("span",{className:"user-balance",children:["\ucfe0\ud3f0: ",(null===(s=e.coupons)||void 0===s?void 0:s.toLocaleString())||0,"\uac1c"]}),void 0!==J[e.id]&&(0,r.jsxs)("span",{className:"preview-amount ".concat(C),children:["send"===C?"+":"-",J[e.id].toLocaleString(),"\uac1c"]})]})]})},e.id)})})]}),(0,r.jsx)("button",{type:"submit",className:"submit-btn ".concat(C),disabled:N,children:N?"\ucc98\ub9ac \uc911...":"\uc2e4\ud589"})]}),(0,r.jsxs)("div",{className:"recent-users",children:[(0,r.jsx)("h4",{children:"\ud559\uae09 \uc0ac\uc6a9\uc790 \ubaa9\ub85d"}),(0,r.jsx)("div",{className:"users-grid",children:R.map(e=>{var s,a;return(0,r.jsxs)("div",{className:"user-card",children:[(0,r.jsx)("div",{className:"user-name",children:e.name}),(0,r.jsxs)("div",{className:"user-coupons",children:["\ucfe0\ud3f0: ",(null===(s=e.coupons)||void 0===s?void 0:s.toLocaleString())||0,"\uac1c"]}),(0,r.jsxs)("div",{className:"user-cash",children:["\ud604\uae08: ",(null===(a=e.cash)||void 0===a?void 0:a.toLocaleString())||0,"\uc6d0"]})]},e.id)})})]})]})}}}]);
//# sourceMappingURL=358.cfa01c62.chunk.js.map