{"version":3,"file":"static/js/510.982047c7.chunk.js","mappings":"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","sources":["components/CouponGoal.js","pages/coupon/CouponGoalPage.js"],"sourcesContent":["// src/CouponGoal.js\r\nimport React from \"react\";\r\n\r\n// ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ ì»´í¬ë„ŒíŠ¸\r\nconst CircularProgress = ({ percentage, size = 140, strokeWidth = 12, color, children }) => {\r\n  const radius = (size - strokeWidth) / 2;\r\n  const circumference = radius * 2 * Math.PI;\r\n  const offset = circumference - (percentage / 100) * circumference;\r\n\r\n  return (\r\n    <div className=\"relative\" style={{ width: size, height: size }}>\r\n      <svg width={size} height={size} style={{ transform: \"rotate(-90deg)\" }}>\r\n        {/* ë°°ê²½ ì› */}\r\n        <circle\r\n          cx={size / 2}\r\n          cy={size / 2}\r\n          r={radius}\r\n          fill=\"none\"\r\n          stroke=\"rgba(255, 255, 255, 0.1)\"\r\n          strokeWidth={strokeWidth}\r\n        />\r\n        {/* í”„ë¡œê·¸ë ˆìŠ¤ ì› */}\r\n        <circle\r\n          cx={size / 2}\r\n          cy={size / 2}\r\n          r={radius}\r\n          fill=\"none\"\r\n          stroke={color}\r\n          strokeWidth={strokeWidth}\r\n          strokeDasharray={circumference}\r\n          strokeDashoffset={offset}\r\n          strokeLinecap=\"round\"\r\n          style={{ transition: \"stroke-dashoffset 0.5s ease\" }}\r\n        />\r\n      </svg>\r\n      {/* ì¤‘ì•™ ì½˜í…ì¸  */}\r\n      <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function CouponGoal({\r\n  classCouponGoal,\r\n  goalProgress,\r\n  myContribution,\r\n  currentCoupons,\r\n  couponValue,\r\n  setShowDonateModal,\r\n  setShowSellCouponModal,\r\n  setShowDonationHistoryModal,\r\n  setShowGiftCouponModal,\r\n  goalAchieved,\r\n  resetGoalButton,\r\n  isResettingGoal,\r\n}) {\r\n  const validClassCouponGoal =\r\n    typeof classCouponGoal === \"number\" && classCouponGoal > 0\r\n      ? classCouponGoal\r\n      : 1;\r\n\r\n  const goalPercentage = Math.min(\r\n    Math.round((goalProgress / validClassCouponGoal) * 100),\r\n    100\r\n  );\r\n\r\n  const myContributionPercentage =\r\n    validClassCouponGoal > 0\r\n      ? Math.min(Math.round((myContribution / validClassCouponGoal) * 100), 100)\r\n      : 0;\r\n\r\n  const mainColor = goalAchieved ? \"#10b981\" : \"#6366f1\";\r\n\r\n  return (\r\n    <div\r\n      className=\"class-coupon-goal p-6 rounded-2xl relative overflow-hidden\"\r\n      style={{\r\n        backgroundColor: \"rgba(20, 20, 35, 0.6)\",\r\n        boxShadow: goalAchieved\r\n          ? \"0 4px 20px rgba(16, 185, 129, 0.25)\"\r\n          : \"0 4px 20px rgba(0, 255, 242, 0.15)\",\r\n        border: goalAchieved ? \"2px solid #10b981\" : \"1px solid rgba(0, 255, 242, 0.2)\",\r\n        backdropFilter: \"blur(10px)\",\r\n      }}\r\n    >\r\n      {/* ë°°ê²½ ì¥ì‹ */}\r\n      <div\r\n        className=\"absolute -top-12 -right-12 w-36 h-36 rounded-full\"\r\n        style={{\r\n          background: goalAchieved\r\n            ? \"radial-gradient(circle, rgba(16,185,129,0.1) 0%, transparent 70%)\"\r\n            : \"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)\",\r\n        }}\r\n      />\r\n\r\n      {/* í—¤ë” */}\r\n      <div className=\"flex justify-between items-center mb-5\">\r\n        <div className=\"flex items-center gap-2.5\">\r\n          <span className=\"text-3xl\">ğŸ¯</span>\r\n          <h3\r\n            className=\"text-xl font-bold m-0\"\r\n            style={{\r\n              color: \"#e8e8ff\",\r\n              textShadow: \"0 0 5px rgba(0, 255, 242, 0.5)\",\r\n            }}\r\n          >\r\n            í•™ê¸‰ ì¿ í° ëª©í‘œ\r\n          </h3>\r\n        </div>\r\n\r\n        <div className=\"flex gap-2 items-center\">\r\n          {goalAchieved && (\r\n            <span\r\n              className=\"text-white px-3.5 py-1.5 rounded-2xl text-sm font-bold\"\r\n              style={{\r\n                background: \"linear-gradient(135deg, #10b981, #059669)\",\r\n                boxShadow: \"0 2px 8px rgba(16, 185, 129, 0.4)\",\r\n                animation: \"pulse 2s infinite\",\r\n              }}\r\n            >\r\n              ğŸ‰ ëª©í‘œ ë‹¬ì„±!\r\n            </span>\r\n          )}\r\n          {resetGoalButton && (\r\n            <button\r\n              onClick={resetGoalButton}\r\n              disabled={isResettingGoal}\r\n              className=\"text-white border-none rounded-xl px-3 py-1.5 text-xs font-semibold\"\r\n              style={{\r\n                backgroundColor: isResettingGoal ? \"#9ca3af\" : \"#ef4444\",\r\n                cursor: isResettingGoal ? \"not-allowed\" : \"pointer\",\r\n                opacity: isResettingGoal ? 0.7 : 1,\r\n              }}\r\n            >\r\n              {isResettingGoal ? \"ì´ˆê¸°í™” ì¤‘...\" : \"ì´ˆê¸°í™”\"}\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* ë©”ì¸ í”„ë¡œê·¸ë ˆìŠ¤ ì˜ì—­ */}\r\n      <div className=\"flex items-center justify-center gap-7 py-5 flex-wrap\">\r\n        {/* í•™ê¸‰ ëª©í‘œ ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ */}\r\n        <div className=\"text-center\">\r\n          <CircularProgress\r\n            percentage={goalPercentage}\r\n            size={150}\r\n            strokeWidth={14}\r\n            color={mainColor}\r\n          >\r\n            <div className=\"text-3xl font-extrabold\" style={{ color: mainColor }}>\r\n              {goalPercentage}%\r\n            </div>\r\n            <div className=\"text-xs font-medium\" style={{ color: \"#a0a0c0\" }}>\r\n              ë‹¬ì„±ë¥ \r\n            </div>\r\n          </CircularProgress>\r\n          <div className=\"mt-3\">\r\n            <div className=\"text-2xl font-extrabold\" style={{ color: \"#e8e8ff\" }}>\r\n              {(goalProgress || 0).toLocaleString()}\r\n              <span className=\"text-sm font-medium\" style={{ color: \"#a0a0c0\" }}> / {validClassCouponGoal.toLocaleString()}</span>\r\n            </div>\r\n            <div className=\"text-xs mt-0.5\" style={{ color: \"#6b7280\" }}>í•™ê¸‰ ì „ì²´ ê¸°ë¶€ëŸ‰</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ë‚´ ê¸°ì—¬ë„ ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ */}\r\n        <div className=\"text-center\">\r\n          <CircularProgress\r\n            percentage={myContributionPercentage}\r\n            size={120}\r\n            strokeWidth={10}\r\n            color=\"#f59e0b\"\r\n          >\r\n            <div className=\"text-2xl font-extrabold\" style={{ color: \"#f59e0b\" }}>\r\n              {myContributionPercentage}%\r\n            </div>\r\n            <div className=\"text-xs font-medium\" style={{ color: \"#a0a0c0\" }}>\r\n              ë‚´ ê¸°ì—¬\r\n            </div>\r\n          </CircularProgress>\r\n          <div className=\"mt-3\">\r\n            <div className=\"text-lg font-bold\" style={{ color: \"#e8e8ff\" }}>\r\n              {(myContribution || 0).toLocaleString()}\r\n              <span className=\"text-xs font-medium\" style={{ color: \"#a0a0c0\" }}> ì¿ í°</span>\r\n            </div>\r\n            <div className=\"text-xs mt-0.5\" style={{ color: \"#6b7280\" }}>ë‚´ê°€ ê¸°ë¶€í•œ ì¿ í°</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ë‚´ ë³´ìœ ëŸ‰ ì¹´ë“œ */}\r\n        <div\r\n          className=\"rounded-2xl p-5 text-center min-w-[130px]\"\r\n          style={{\r\n            background: \"linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%)\",\r\n            boxShadow: \"0 4px 12px rgba(245, 158, 11, 0.1)\",\r\n            border: \"1px solid rgba(251, 191, 36, 0.3)\",\r\n          }}\r\n        >\r\n          <div className=\"text-3xl mb-2\">ğŸ«</div>\r\n          <div className=\"text-3xl font-extrabold\" style={{ color: \"#fbbf24\", textShadow: \"0 0 10px rgba(251, 191, 36, 0.3)\" }}>\r\n            {(currentCoupons || 0).toLocaleString()}\r\n          </div>\r\n          <div className=\"text-xs font-semibold mt-1\" style={{ color: \"#fcd34d\" }}>\r\n            ë³´ìœ  ì¿ í°\r\n          </div>\r\n          <div className=\"text-xs mt-2 px-2 py-1 rounded-lg\" style={{ color: \"#fcd34d\", background: \"rgba(0,0,0,0.3)\" }}>\r\n            1ì¿ í° = {typeof couponValue === \"number\" ? couponValue.toLocaleString() : \"0\"}ì›\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}\r\n      <div className=\"grid grid-cols-4 gap-2 mt-5\">\r\n        <button\r\n          onClick={() => setShowDonateModal(true)}\r\n          className=\"border-none rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all\"\r\n          style={{\r\n            background: \"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)\",\r\n            boxShadow: \"0 4px 12px rgba(99, 102, 241, 0.35)\",\r\n          }}\r\n        >\r\n          <span className=\"text-2xl\">ğŸ’°</span>\r\n          <span className=\"text-white text-sm font-bold\">ì¿ í° ì‘ëª¨</span>\r\n        </button>\r\n\r\n        <button\r\n          onClick={() => setShowSellCouponModal(true)}\r\n          className=\"border-none rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all\"\r\n          style={{\r\n            background: \"linear-gradient(135deg, #f87171 0%, #ef4444 100%)\",\r\n            boxShadow: \"0 4px 12px rgba(239, 68, 68, 0.35)\",\r\n          }}\r\n        >\r\n          <span className=\"text-2xl\">ğŸ’µ</span>\r\n          <span className=\"text-white text-sm font-bold\">ì¿ í° íŒë§¤</span>\r\n        </button>\r\n\r\n        <button\r\n          onClick={() => setShowGiftCouponModal(true)}\r\n          className=\"border-none rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all\"\r\n          style={{\r\n            background: \"linear-gradient(135deg, #34d399 0%, #10b981 100%)\",\r\n            boxShadow: \"0 4px 12px rgba(16, 185, 129, 0.35)\",\r\n          }}\r\n        >\r\n          <span className=\"text-2xl\">ğŸ</span>\r\n          <span className=\"text-white text-sm font-bold\">ì¿ í° ì„ ë¬¼</span>\r\n        </button>\r\n\r\n        <button\r\n          onClick={() => setShowDonationHistoryModal(true)}\r\n          className=\"rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all\"\r\n          style={{\r\n            background: \"linear-gradient(135deg, #374151 0%, #1f2937 100%)\",\r\n            border: \"1px solid #4b5563\",\r\n          }}\r\n        >\r\n          <span className=\"text-2xl\">ğŸ“‹</span>\r\n          <span className=\"text-sm font-bold\" style={{ color: \"#4b5563\" }}>ê¸°ë¶€ ë‚´ì—­</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* ì¿ í° ëª©í‘œ ê¸€ì”¨ í¬ê¸° ì „ì²´ í™•ëŒ€ */}\r\n      <style>{`\r\n        .class-coupon-goal { font-size: 1.05rem; }\r\n        .class-coupon-goal h3 { font-size: 1.3rem !important; }\r\n        .class-coupon-goal .text-xs { font-size: 0.85rem !important; }\r\n        .class-coupon-goal .text-sm { font-size: 0.95rem !important; }\r\n        .class-coupon-goal .text-2xl { font-size: 1.6rem !important; }\r\n        .class-coupon-goal .text-3xl { font-size: 2rem !important; }\r\n      `}</style>\r\n\r\n      {/* ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ */}\r\n      <style>{`\r\n        @keyframes pulse {\r\n          0%, 100% { transform: scale(1); }\r\n          50% { transform: scale(1.05); }\r\n        }\r\n        .class-coupon-goal button:hover {\r\n          transform: translateY(-2px);\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","// src/pages/coupon/CouponGoalPage.js - ì¿ í° ëª©í‘œ ì „ìš© í˜ì´ì§€\r\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport {\r\n  db,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  collection,\r\n  query,\r\n  where,\r\n  functions,\r\n  httpsCallable,\r\n  writeBatch,\r\n  serverTimestamp,\r\n  runTransaction,\r\n} from \"../../firebase\";\r\nimport CouponGoal from \"../../components/CouponGoal\";\r\nimport LoginWarning from \"../../components/LoginWarning\";\r\nimport DonateCouponModal from \"../../components/modals/DonateCouponModal\";\r\nimport SellCouponModal from \"../../components/modals/SellCouponModal\";\r\nimport GiftCouponModal from \"../../components/modals/GiftCouponModal\";\r\nimport DonationHistoryModal from \"../../components/modals/DonationHistoryModal\";\r\nimport { AlchanLoading } from \"../../components/AlchanLayout\";\r\n\r\nimport { logger } from \"../../utils/logger\";\r\nexport default function CouponGoalPage() {\r\n  const {\r\n    user,\r\n    userDoc,\r\n    users,\r\n    classmates,\r\n    allClassMembers,\r\n    loading: authLoading,\r\n    optimisticUpdate,\r\n  } = useAuth();\r\n\r\n  const userId = user?.uid;\r\n  const currentUserClassCode = userDoc?.classCode;\r\n\r\n  const [assetsLoading, setAssetsLoading] = useState(true);\r\n  const loadingRef = useRef(false);\r\n  const loadGoalDataRef = useRef(null); // ğŸ”¥ loadGoalData í•¨ìˆ˜ë¥¼ ì €ì¥í•  ref\r\n  const [goalDonations, setGoalDonations] = useState([]);\r\n\r\n  const donateCouponFunction = httpsCallable(functions, 'donateCoupon');\r\n  const sellCouponFunction = httpsCallable(functions, 'sellCoupon');\r\n  const giftCouponFunction = httpsCallable(functions, 'giftCoupon');\r\n\r\n  const CACHE_DURATION = 5 * 60 * 1000;\r\n\r\n  const currentGoalId = currentUserClassCode\r\n    ? `${currentUserClassCode}_goal`\r\n    : null;\r\n\r\n  const [classCouponGoal, setClassCouponGoal] = useState(1000);\r\n  const [couponValue, setCouponValue] = useState(1000);\r\n\r\n  // ğŸ”¥ [ë²„ê·¸ ìˆ˜ì •] Firestoreì—ì„œ ì¿ í° ê°€ì¹˜ ì„¤ì • ë¡œë“œ\r\n  useEffect(() => {\r\n    const loadCouponValueFromSettings = async () => {\r\n      try {\r\n        const settingsRef = doc(db, \"settings\", \"mainSettings\");\r\n        const settingsSnap = await getDoc(settingsRef);\r\n        if (settingsSnap.exists()) {\r\n          const settingsData = settingsSnap.data();\r\n          if (settingsData.couponValue) {\r\n            setCouponValue(Number(settingsData.couponValue));\r\n          }\r\n        }\r\n      } catch (error) {\r\n        logger.error(\"[CouponGoalPage] ì¿ í° ê°€ì¹˜ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:\", error);\r\n      }\r\n    };\r\n\r\n    if (userId) {\r\n      loadCouponValueFromSettings();\r\n    }\r\n  }, [userId]);\r\n  const [goalProgress, setGoalProgress] = useState(0);\r\n  const [myContribution, setMyContribution] = useState(0);\r\n  const [goalAchieved, setGoalAchieved] = useState(false);\r\n  const [isResettingGoal, setIsResettingGoal] = useState(false);\r\n\r\n  const [showDonateModal, setShowDonateModal] = useState(false);\r\n  const [showSellCouponModal, setShowSellCouponModal] = useState(false);\r\n  const [sellAmount, setSellAmount] = useState(\"\");\r\n  const [showGiftCouponModal, setShowGiftCouponModal] = useState(false);\r\n  const [giftRecipient, setGiftRecipient] = useState(\"\");\r\n  const [giftAmount, setGiftAmount] = useState(\"\");\r\n  const [showDonationHistoryModal, setShowDonationHistoryModal] = useState(false);\r\n\r\n  const safeTimestampToDate = (timestamp) => {\r\n    try {\r\n      if (!timestamp) return new Date();\r\n      if (timestamp instanceof Date) {\r\n        return isNaN(timestamp.getTime()) ? new Date() : timestamp;\r\n      }\r\n      if (timestamp && typeof timestamp.toDate === 'function') {\r\n        const date = timestamp.toDate();\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n      if (timestamp && timestamp.seconds) {\r\n        const date = new Date(timestamp.seconds * 1000);\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n      if (typeof timestamp === 'string') {\r\n        const date = new Date(timestamp);\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n      if (typeof timestamp === 'number') {\r\n        const date = new Date(timestamp);\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n      return new Date();\r\n    } catch (error) {\r\n      return new Date();\r\n    }\r\n  };\r\n\r\n  const getCachedFirestoreData = useCallback((key) => {\r\n    try {\r\n      const cached = localStorage.getItem(`firestore_cache_${key}_${userId}`);\r\n      if (cached) {\r\n        const { data, timestamp } = JSON.parse(cached);\r\n        if (Date.now() - timestamp < CACHE_DURATION) {\r\n          return data;\r\n        }\r\n      }\r\n    } catch (error) {\r\n    }\r\n    return null;\r\n  }, [userId, CACHE_DURATION]);\r\n\r\n  const setCachedFirestoreData = useCallback((key, data) => {\r\n    try {\r\n      const cacheItem = {\r\n        data,\r\n        timestamp: Date.now(),\r\n      };\r\n      localStorage.setItem(`firestore_cache_${key}_${userId}`, JSON.stringify(cacheItem));\r\n    } catch (error) {\r\n    }\r\n  }, [userId]);\r\n\r\n  // ğŸ”¥ [ìµœì í™”] ë°ì´í„° ì²˜ë¦¬ í—¬í¼ í•¨ìˆ˜ (ìºì‹œ/Firestore ê³µìš©)\r\n  const processGoalData = useCallback((goalData) => {\r\n    setClassCouponGoal(Number(goalData.targetAmount) || 1000);\r\n    setGoalProgress(Number(goalData.progress) || 0);\r\n\r\n    // ê¸°ë¶€ ë‚´ì—­ ì²˜ë¦¬ - timestamp ì¼ê´€ì„± ìœ ì§€\r\n    const donations = Array.isArray(goalData.donations)\r\n      ? goalData.donations.map((donation) => {\r\n        let processedTimestamp;\r\n        if (donation.timestamp && donation.timestamp.toDate) {\r\n          processedTimestamp = donation.timestamp.toDate().toISOString();\r\n        } else if (donation.timestamp && donation.timestamp.seconds) {\r\n          processedTimestamp = new Date(donation.timestamp.seconds * 1000).toISOString();\r\n        } else if (donation.timestampISO) {\r\n          processedTimestamp = donation.timestampISO;\r\n        } else if (typeof donation.timestamp === 'string') {\r\n          processedTimestamp = donation.timestamp;\r\n        } else {\r\n          processedTimestamp = new Date().toISOString();\r\n        }\r\n\r\n        return {\r\n          ...donation,\r\n          amount: Number(donation.amount) || 0,\r\n          timestamp: processedTimestamp,\r\n          userId: donation.userId || '',\r\n          userName: donation.userName || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì',\r\n          message: donation.message || '',\r\n          classCode: donation.classCode || currentUserClassCode,\r\n        };\r\n      })\r\n      : [];\r\n\r\n    setGoalDonations(donations);\r\n\r\n    // ë‚´ ê¸°ì—¬ë„ ê³„ì‚°\r\n    const myDonations = donations.filter(d => d.userId === userId);\r\n    const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n    setMyContribution(myTotal);\r\n  }, [currentUserClassCode, userId]);\r\n\r\n  // ğŸ”¥ loadGoalData í•¨ìˆ˜ - useCallback ì œê±°í•˜ê³  ì¼ë°˜ í•¨ìˆ˜ë¡œ ë³€ê²½\r\n  const loadGoalData = async (forceRefresh = false) => {\r\n    if (!userId || !currentUserClassCode || !currentGoalId) {\r\n      setAssetsLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (loadingRef.current) {\r\n      return;\r\n    }\r\n\r\n    loadingRef.current = true;\r\n    setAssetsLoading(true);\r\n\r\n    try {\r\n      // ğŸ”¥ [ìµœì í™”] ìºì‹œ ìš°ì„  ë¡œë“œ - Firestore ì½ê¸° ì ˆê°\r\n      const cacheKey = `goal_${currentGoalId}`;\r\n      if (!forceRefresh) {\r\n        const cachedData = getCachedFirestoreData(cacheKey);\r\n        if (cachedData) {\r\n          processGoalData(cachedData);\r\n          setAssetsLoading(false);\r\n          loadingRef.current = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // ğŸ”¥ Firestoreì—ì„œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n      const goalDocSnap = await getDoc(goalDocRef);\r\n\r\n      if (goalDocSnap.exists()) {\r\n        const goalData = goalDocSnap.data();\r\n\r\n        // ğŸ”¥ [ìµœì í™”] ê³µìš© í—¬í¼ í•¨ìˆ˜ë¡œ ì²˜ë¦¬\r\n        processGoalData(goalData);\r\n\r\n        // ğŸ”¥ ìºì‹œì— ì €ì¥\r\n        const cacheKey = `goal_${currentGoalId}`;\r\n        setCachedFirestoreData(cacheKey, goalData);\r\n      } else {\r\n        logger.warn('[CouponGoalPage] ëª©í‘œ ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');\r\n      }\r\n    } catch (error) {\r\n      logger.error('[CouponGoalPage] ëª©í‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n      loadingRef.current = false;\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ refì— loadGoalData í•¨ìˆ˜ ì €ì¥\r\n  loadGoalDataRef.current = loadGoalData;\r\n\r\n  // ğŸ”¥ ì´ˆê¸° ë¡œë“œ useEffect - loadGoalDataRef ì‚¬ìš©\r\n  useEffect(() => {\r\n    if (!authLoading && user && currentUserClassCode && currentGoalId) {\r\n      if (loadGoalDataRef.current) {\r\n        loadGoalDataRef.current();\r\n      }\r\n    } else if (!authLoading && !user) {\r\n      setAssetsLoading(false);\r\n    } else if (authLoading) {\r\n      setAssetsLoading(true);\r\n    }\r\n  }, [authLoading, user, currentUserClassCode, currentGoalId]);\r\n\r\n  // ğŸ”¥ [ì œê±°] userDoc.myContribution ì‚¬ìš© ì¤‘ë‹¨ - donations ë°°ì—´ì—ì„œ ì§ì ‘ ê³„ì‚°\r\n  // useEffect(() => {\r\n  //   if (userDoc) {\r\n  //     setMyContribution(userDoc.myContribution || 0);\r\n  //   }\r\n  // }, [userDoc]);\r\n\r\n  useEffect(() => {\r\n    setGoalAchieved(goalProgress >= classCouponGoal && classCouponGoal > 0);\r\n  }, [goalProgress, classCouponGoal]);\r\n\r\n  const handleDonateCoupon = async (amount, memo) => {\r\n    if (!userId || !currentUserClassCode || !userDoc) {\r\n      alert(\"ì‚¬ìš©ì ë˜ëŠ” í•™ê¸‰ ì •ë³´ê°€ ì—†ì–´ ê¸°ë¶€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return false;\r\n    }\r\n\r\n    const donationAmount = parseInt(amount, 10);\r\n    if (isNaN(donationAmount) || donationAmount <= 0) {\r\n      alert(\"ìœ íš¨í•œ ì¿ í° ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return false;\r\n    }\r\n\r\n    // ğŸ”¥ ì¿ í° ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({ coupons: -donationAmount });\r\n    }\r\n    setMyContribution(prev => prev + donationAmount);\r\n    setGoalProgress(prev => prev + donationAmount);\r\n\r\n    // ğŸ”¥ ë¡œë”© ìƒíƒœ í‘œì‹œ\r\n    setAssetsLoading(true);\r\n\r\n    try {\r\n      // Call the server function in the background\r\n      const result = await donateCouponFunction({ amount: donationAmount, message: memo });\r\n\r\n      // ğŸ”¥ ìºì‹œ ë¬´íš¨í™”\r\n      const cacheKey = `goal_${currentGoalId}`;\r\n      localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n\r\n      // ğŸ”¥ ì¦‰ì‹œ ìµœì‹  ë°ì´í„° ë¡œë“œ\r\n      loadingRef.current = false;\r\n      if (loadGoalDataRef.current) {\r\n        await loadGoalDataRef.current();\r\n      }\r\n\r\n      alert(`${donationAmount} ì¿ í° ê¸°ë¶€ ì™„ë£Œ!`);\r\n      setShowDonateModal(false);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('[CouponGoalPage] ê¸°ë¶€ ì˜¤ë¥˜ (ìƒì„¸):', {\r\n        error,\r\n        message: error.message,\r\n        code: error.code,\r\n        details: error.details,\r\n        stack: error.stack\r\n      });\r\n      alert(`ê¸°ë¶€ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: donationAmount });\r\n      }\r\n\r\n      return false;\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const forceRefreshGoalData = async () => {\r\n    if (!currentGoalId || !currentUserClassCode) {\r\n      alert(\"í•™ê¸‰ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n\r\n    try {\r\n      localStorage.removeItem(`firestore_cache_goal_${currentGoalId}_${userId}`);\r\n\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n      const goalDocSnap = await getDoc(goalDocRef);\r\n\r\n      if (goalDocSnap.exists()) {\r\n        const latestGoalData = goalDocSnap.data();\r\n\r\n        setClassCouponGoal(Number(latestGoalData.targetAmount) || 1000);\r\n        setGoalProgress(Number(latestGoalData.progress) || 0);\r\n\r\n        const freshDonations = Array.isArray(latestGoalData.donations)\r\n          ? latestGoalData.donations.map((donation) => {\r\n            let processedTimestamp;\r\n            if (donation.timestamp && donation.timestamp.toDate) {\r\n              processedTimestamp = donation.timestamp.toDate().toISOString();\r\n            } else if (donation.timestamp && donation.timestamp.seconds) {\r\n              processedTimestamp = new Date(donation.timestamp.seconds * 1000).toISOString();\r\n            } else if (donation.timestampISO) {\r\n              processedTimestamp = donation.timestampISO;\r\n            } else if (typeof donation.timestamp === 'string') {\r\n              processedTimestamp = donation.timestamp;\r\n            } else {\r\n              processedTimestamp = new Date().toISOString();\r\n            }\r\n\r\n            return {\r\n              ...donation,\r\n              amount: Number(donation.amount) || 0,\r\n              timestamp: processedTimestamp,\r\n              userId: donation.userId || '',\r\n              userName: donation.userName || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì',\r\n              message: donation.message || '',\r\n              classCode: donation.classCode || currentUserClassCode,\r\n            };\r\n          })\r\n          : [];\r\n\r\n        setGoalDonations(freshDonations);\r\n        setCachedFirestoreData(`goal_${currentGoalId}`, latestGoalData);\r\n\r\n        alert(`ëª©í‘œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ!\\nëª©í‘œ ì§„í–‰ë¥ : ${latestGoalData.progress || 0}/${latestGoalData.targetAmount || 1000}\\nê¸°ë¶€ ë‚´ì—­: ${freshDonations.length}ê°œ`);\r\n      } else {\r\n        alert(\"ëª©í‘œ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.\");\r\n      }\r\n    } catch (error) {\r\n      alert(`ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const showDebugInfo = () => {\r\n    const debugInfo = {\r\n      userId,\r\n      currentUserClassCode,\r\n      currentGoalId,\r\n      goalProgress,\r\n      classCouponGoal,\r\n      myContribution,\r\n      donationsCount: goalDonations.length,\r\n      donations: goalDonations,\r\n      userCoupons: userDoc?.coupons,\r\n      userCash: userDoc?.cash,\r\n    };\r\n\r\n    logger.log('[CouponGoalPage Debug]', debugInfo);\r\n    alert(`ë””ë²„ê·¸ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.\\nê¸°ë¶€ ë‚´ì—­: ${goalDonations.length}ê°œ\\nëª©í‘œ ì§„í–‰ë¥ : ${goalProgress}/${classCouponGoal}`);\r\n  };\r\n\r\n  const resetCouponGoal = async () => {\r\n    if (!userDoc?.isAdmin && !userDoc?.isSuperAdmin) {\r\n      alert(\"ê´€ë¦¬ìë§Œ ì´ˆê¸°í™” ê°€ëŠ¥í•©ë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n    if (!currentUserClassCode || !currentGoalId) {\r\n      alert(\"í•™ê¸‰ ì½”ë“œë‚˜ ëª©í‘œ ì •ë³´ê°€ ì—†ì–´ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n    if (!window.confirm(`ì •ë§ë¡œ ${currentUserClassCode} í•™ê¸‰ì˜ ì¿ í° ëª©í‘œì™€ ê¸°ì—¬ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\r\n      return;\r\n    }\r\n\r\n    setIsResettingGoal(true);\r\n    try {\r\n      const batch = writeBatch(db);\r\n      const goalRef = doc(db, \"goals\", currentGoalId);\r\n\r\n      const usersQuery = query(\r\n        collection(db, \"users\"),\r\n        where(\"classCode\", \"==\", currentUserClassCode)\r\n      );\r\n      const usersSnapshot = await getDocs(usersQuery);\r\n\r\n      usersSnapshot.forEach((userDocument) => {\r\n        const userRef = doc(db, \"users\", userDocument.id);\r\n        batch.update(userRef, {\r\n          myContribution: 0,\r\n          updatedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      batch.update(goalRef, {\r\n        progress: 0,\r\n        donations: [],\r\n        donationCount: 0,\r\n        updatedAt: serverTimestamp(),\r\n        resetAt: serverTimestamp(),\r\n        resetBy: userId,\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n      localStorage.removeItem(`firestore_cache_goal_${currentGoalId}_${userId}`);\r\n\r\n      setMyContribution(0);\r\n      setGoalProgress(0);\r\n      setGoalDonations([]);\r\n\r\n      alert(`í•™ê¸‰(${currentUserClassCode})ì˜ ì¿ í° ëª©í‘œì™€ ê¸°ì—¬ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);\r\n    } catch (error) {\r\n      alert(`ëª©í‘œ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`);\r\n    } finally {\r\n      setIsResettingGoal(false);\r\n    }\r\n  };\r\n\r\n  const handleSellCoupon = async () => {\r\n    const amount = parseInt(sellAmount, 10);\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert(\"ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    // ğŸ”¥ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({\r\n        coupons: -amount,\r\n        cash: amount * couponValue\r\n      });\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n    try {\r\n      await sellCouponFunction({ amount });\r\n      alert(`${amount}ê°œ ì¿ í°ì„ íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);\r\n      setShowSellCouponModal(false);\r\n      setSellAmount(\"\");\r\n\r\n      // ğŸ”¥ refë¥¼ í†µí•´ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ\r\n      setTimeout(() => {\r\n        loadingRef.current = false;\r\n        if (loadGoalDataRef.current) {\r\n          loadGoalDataRef.current();\r\n        }\r\n      }, 500);\r\n    } catch (error) {\r\n      alert(`íŒë§¤ ì˜¤ë¥˜: ${error.message}`);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGiftCoupon = async () => {\r\n    logger.log(\"handleGiftCoupon called\"); // í•¨ìˆ˜ í˜¸ì¶œ í™•ì¸ ë¡œê·¸\r\n    const recipientUser = users.find((u) => u.id === giftRecipient);\r\n    const amount = parseInt(giftAmount, 10);\r\n\r\n    if (!recipientUser) {\r\n      alert(\"ë°›ëŠ” ì‚¬ëŒì„ ì„ íƒí•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert(\"ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({ coupons: -amount });\r\n    }\r\n\r\n    if (window.confirm(`${recipientUser.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œë¥¼ ì„ ë¬¼í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\r\n      setAssetsLoading(true);\r\n      try {\r\n        await giftCouponFunction({ recipientId: recipientUser.id, amount, message: \"\" });\r\n        alert(\"ì¿ í° ì„ ë¬¼ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\");\r\n        setShowGiftCouponModal(false);\r\n        setGiftRecipient(\"\");\r\n        setGiftAmount(\"\");\r\n\r\n        // ğŸ”¥ refë¥¼ í†µí•´ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ\r\n        setTimeout(() => {\r\n          loadingRef.current = false;\r\n          if (loadGoalDataRef.current) {\r\n            loadGoalDataRef.current();\r\n          }\r\n        }, 500);\r\n      } catch (error) {\r\n        alert(`ì„ ë¬¼ ì˜¤ë¥˜: ${error.message}`);\r\n        // ë¡¤ë°±\r\n        if (optimisticUpdate) {\r\n          optimisticUpdate({ coupons: amount });\r\n        }\r\n      } finally {\r\n        setAssetsLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (authLoading || assetsLoading) {\r\n    return <AlchanLoading />;\r\n  }\r\n\r\n  if (!user) {\r\n    return <LoginWarning />;\r\n  }\r\n\r\n  if (!currentUserClassCode && !authLoading) {\r\n    return (\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"center\",\r\n          alignItems: \"center\",\r\n          height: \"80vh\",\r\n          fontSize: \"1.2em\",\r\n          color: \"#ef4444\",\r\n        }}\r\n      >\r\n        í•™ê¸‰ ì½”ë“œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì—¬ í•™ê¸‰ ì½”ë“œë¥¼ í• ë‹¹ë°›ìœ¼ì„¸ìš”.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full min-h-full\" style={{ backgroundColor: \"#0a0a12\" }}>\r\n      <div className=\"w-full px-4 md:px-6 lg:px-8 py-6\">\r\n        <h2 className=\"text-2xl font-bold text-emerald-400 border-b-2 border-emerald-900 pb-3 mb-6\" style={{ textShadow: \"0 0 10px rgba(52, 211, 153, 0.3)\" }}>\r\n          ğŸ¯ ì¿ í° ëª©í‘œ (í•™ê¸‰: {currentUserClassCode})\r\n        </h2>\r\n\r\n        {currentUserClassCode && currentGoalId && (\r\n          <>\r\n            <CouponGoal\r\n              classCouponGoal={classCouponGoal}\r\n              goalProgress={goalProgress}\r\n              myContribution={myContribution}\r\n              currentCoupons={Number(userDoc?.coupons) || 0}\r\n              couponValue={couponValue}\r\n              setShowDonateModal={setShowDonateModal}\r\n              setShowSellCouponModal={setShowSellCouponModal}\r\n              setShowDonationHistoryModal={setShowDonationHistoryModal}\r\n              setShowGiftCouponModal={setShowGiftCouponModal}\r\n              goalAchieved={goalAchieved}\r\n              resetGoalButton={\r\n                userDoc?.isAdmin || userDoc?.isSuperAdmin ? resetCouponGoal : null\r\n              }\r\n              isResettingGoal={isResettingGoal}\r\n            />\r\n\r\n            <div\r\n              style={{\r\n                marginTop: \"20px\",\r\n                padding: \"15px\",\r\n                backgroundColor: \"rgba(20, 20, 35, 0.85)\",\r\n                borderRadius: \"8px\",\r\n                border: \"1px solid rgba(0, 255, 242, 0.15)\",\r\n              }}\r\n            >\r\n              <h4\r\n                style={{\r\n                  fontSize: \"14px\",\r\n                  color: \"#00fff2\",\r\n                  marginBottom: \"10px\",\r\n                  fontWeight: \"600\",\r\n                }}\r\n              >\r\n                ğŸ”§ ë°ì´í„° ê´€ë¦¬ ë„êµ¬\r\n              </h4>\r\n              <div style={{ display: \"flex\", gap: \"10px\", flexWrap: \"wrap\" }}>\r\n                <button\r\n                  onClick={forceRefreshGoalData}\r\n                  disabled={assetsLoading}\r\n                  style={{\r\n                    padding: \"8px 12px\",\r\n                    backgroundColor: \"#17a2b8\",\r\n                    color: \"white\",\r\n                    border: \"none\",\r\n                    borderRadius: \"4px\",\r\n                    fontSize: \"12px\",\r\n                    cursor: \"pointer\",\r\n                    fontWeight: \"500\",\r\n                  }}\r\n                >\r\n                  ğŸ“Š ëª©í‘œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨\r\n                </button>\r\n                <button\r\n                  onClick={showDebugInfo}\r\n                  style={{\r\n                    padding: \"8px 12px\",\r\n                    backgroundColor: \"#6c757d\",\r\n                    color: \"white\",\r\n                    border: \"none\",\r\n                    borderRadius: \"4px\",\r\n                    fontSize: \"12px\",\r\n                    cursor: \"pointer\",\r\n                    fontWeight: \"500\",\r\n                  }}\r\n                >\r\n                  ğŸ” ë””ë²„ê·¸ ì •ë³´ í™•ì¸\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    localStorage.clear();\r\n                    alert(\"ë¡œì»¬ ìºì‹œê°€ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.\");\r\n                    window.location.reload();\r\n                  }}\r\n                  style={{\r\n                    padding: \"8px 12px\",\r\n                    backgroundColor: \"#dc3545\",\r\n                    color: \"white\",\r\n                    border: \"none\",\r\n                    borderRadius: \"4px\",\r\n                    fontSize: \"12px\",\r\n                    cursor: \"pointer\",\r\n                    fontWeight: \"500\",\r\n                  }}\r\n                >\r\n                  ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ í›„ ìƒˆë¡œê³ ì¹¨\r\n                </button>\r\n              </div>\r\n              <p\r\n                style={{\r\n                  fontSize: \"11px\",\r\n                  color: \"#868e96\",\r\n                  marginTop: \"8px\",\r\n                  marginBottom: \"0\",\r\n                  lineHeight: \"1.4\",\r\n                }}\r\n              >\r\n                â€¢ ê¸°ë¶€ ë‚´ì—­ì´ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ \"ëª©í‘œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨\" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”\r\n                <br />\r\n                â€¢ ë¬¸ì œê°€ ì§€ì†ë˜ë©´ \"ìºì‹œ ì‚­ì œ í›„ ìƒˆë¡œê³ ì¹¨\"ì„ ì‹œë„í•´ë³´ì„¸ìš”\r\n                <br />â€¢ í˜„ì¬ ìƒíƒœ: ê¸°ë¶€ ë‚´ì—­ {goalDonations.length}ê°œ, ëª©í‘œ ì§„í–‰ë¥ {\" \"}\r\n                {goalProgress}/{classCouponGoal}\r\n              </p>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {showDonateModal && currentUserClassCode && currentGoalId && (\r\n          <DonateCouponModal\r\n            showDonateModal={showDonateModal}\r\n            setShowDonateModal={setShowDonateModal}\r\n            currentCoupons={Number(userDoc?.coupons) || 0}\r\n            onDonate={handleDonateCoupon}\r\n            classCode={currentUserClassCode}\r\n          />\r\n        )}\r\n        {showSellCouponModal && (\r\n          <SellCouponModal\r\n            showSellCouponModal={showSellCouponModal}\r\n            setShowSellCouponModal={setShowSellCouponModal}\r\n            currentCoupons={Number(userDoc?.coupons) || 0}\r\n            couponValue={couponValue}\r\n            sellAmount={sellAmount}\r\n            setSellAmount={setSellAmount}\r\n            SellCoupon={handleSellCoupon}\r\n          />\r\n        )}\r\n        {showGiftCouponModal && (\r\n          <GiftCouponModal\r\n            showGiftCouponModal={showGiftCouponModal}\r\n            setShowGiftCouponModal={setShowGiftCouponModal}\r\n            recipients={classmates}\r\n            giftRecipient={giftRecipient}\r\n            setGiftRecipient={setGiftRecipient}\r\n            giftAmount={giftAmount}\r\n            setGiftAmount={setGiftAmount}\r\n            handleGiftCoupon={handleGiftCoupon}\r\n            currentCoupons={Number(userDoc?.coupons) || 0}\r\n            userId={userId}\r\n          />\r\n        )}\r\n        {showDonationHistoryModal && currentUserClassCode && currentGoalId && (\r\n          <DonationHistoryModal\r\n            showDonationHistoryModal={showDonationHistoryModal}\r\n            setShowDonationHistoryModal={setShowDonationHistoryModal}\r\n            students={allClassMembers || []}\r\n            classCode={currentUserClassCode}\r\n            donations={goalDonations}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["CircularProgress","_ref","percentage","size","strokeWidth","color","children","radius","circumference","Math","PI","offset","_jsxs","className","style","width","height","transform","_jsx","cx","cy","r","fill","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","transition","CouponGoal","_ref2","classCouponGoal","goalProgress","myContribution","currentCoupons","couponValue","setShowDonateModal","setShowSellCouponModal","setShowDonationHistoryModal","setShowGiftCouponModal","goalAchieved","resetGoalButton","isResettingGoal","validClassCouponGoal","goalPercentage","min","round","myContributionPercentage","mainColor","backgroundColor","boxShadow","border","backdropFilter","background","textShadow","animation","onClick","disabled","cursor","opacity","toLocaleString","CouponGoalPage","user","userDoc","users","classmates","allClassMembers","loading","authLoading","optimisticUpdate","useAuth","userId","uid","currentUserClassCode","classCode","assetsLoading","setAssetsLoading","useState","loadingRef","useRef","loadGoalDataRef","goalDonations","setGoalDonations","donateCouponFunction","httpsCallable","functions","sellCouponFunction","giftCouponFunction","CACHE_DURATION","currentGoalId","concat","setClassCouponGoal","setCouponValue","useEffect","async","settingsRef","doc","db","settingsSnap","getDoc","exists","settingsData","data","Number","error","logger","loadCouponValueFromSettings","setGoalProgress","setMyContribution","setGoalAchieved","setIsResettingGoal","showDonateModal","showSellCouponModal","sellAmount","setSellAmount","showGiftCouponModal","giftRecipient","setGiftRecipient","giftAmount","setGiftAmount","showDonationHistoryModal","getCachedFirestoreData","useCallback","key","cached","localStorage","getItem","timestamp","JSON","parse","Date","now","setCachedFirestoreData","cacheItem","setItem","stringify","processGoalData","goalData","targetAmount","progress","donations","Array","isArray","map","donation","processedTimestamp","toDate","toISOString","seconds","timestampISO","_objectSpread","amount","userName","message","myTotal","filter","d","reduce","sum","current","forceRefresh","arguments","length","undefined","cacheKey","cachedData","goalDocRef","goalDocSnap","warn","AlchanLoading","_Fragment","coupons","isAdmin","isSuperAdmin","window","confirm","batch","writeBatch","goalRef","usersQuery","query","collection","where","getDocs","forEach","userDocument","userRef","id","update","updatedAt","serverTimestamp","donationCount","resetAt","resetBy","commit","removeItem","alert","marginTop","padding","borderRadius","fontSize","marginBottom","fontWeight","display","gap","flexWrap","latestGoalData","freshDonations","showDebugInfo","debugInfo","donationsCount","userCoupons","userCash","cash","log","clear","location","reload","lineHeight","DonateCouponModal","onDonate","memo","donationAmount","parseInt","isNaN","prev","code","details","stack","SellCouponModal","SellCoupon","setTimeout","GiftCouponModal","recipients","handleGiftCoupon","recipientUser","find","u","name","recipientId","DonationHistoryModal","students","justifyContent","alignItems","LoginWarning"],"ignoreList":[],"sourceRoot":""}