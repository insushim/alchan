{"version":3,"file":"static/js/771.7fa61b6a.chunk.js","mappings":"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","sources":["pages/games/GonuGame.js"],"sourcesContent":["// src/GonuGame.js - 실제 고누 규칙 적용 + AI 모드\r\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { db } from '../../firebase';\r\nimport {\r\n    doc,\r\n    setDoc,\r\n    getDoc,\r\n    runTransaction,\r\n    increment,\r\n    serverTimestamp,\r\n    collection,\r\n    query,\r\n    where,\r\n    getDocs,\r\n    deleteDoc\r\n} from 'firebase/firestore';\r\nimport { usePolling } from '../../hooks/usePolling';\r\nimport { logActivity, ACTIVITY_TYPES } from '../../utils/firestoreHelpers';\r\nimport './GonuGame.css';\r\nimport { AlchanLoading } from '../../components/AlchanLayout';\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 우물고누 정의 (가장 기본적인 고누)\r\n// 동그라미 안에 X 표시 형태, 각자 2개의 말\r\n// 원 둘레 4개 위치 + 빈 시작 위치 1개 = 총 5개 위치\r\n// 중앙(우물)은 선이 교차하는 곳이지만 이동 불가\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\n// 우물고누 노드 배치 (나무위키 기준 5개 위치)\r\n// 말판 (원 + X):\r\n//       1 (상) - 흑1 시작\r\n//      /|\\\r\n//     / | \\\r\n//    4-(우물)-2 (우) - 흑2 시작\r\n//     \\ | /\r\n//      \\|/\r\n//       3 (하) - 백3 시작\r\n//       |\r\n//       5 (하단 추가 위치) - 백4 시작?\r\n//\r\n// 나무위키 표기: [1 2 ; 3 4 ;흑] = 1,2에 흑, 3,4에 백\r\n// \"2 위치의 흑돌을 5로 옮길 수 없다\" = 2→5 이동 제한\r\n//\r\n// 재해석: 원 둘레(1,2,3,4)와 빈 위치(5)\r\n// 실제로는 원 둘레를 따라 시계/반시계 방향으로 한 칸씩 이동\r\nconst UMUL_NODES = [\r\n    { id: 1, x: 150, y: 40 },   // 1번 (상)\r\n    { id: 2, x: 260, y: 150 },  // 2번 (우)\r\n    { id: 3, x: 150, y: 260 },  // 3번 (하)\r\n    { id: 4, x: 40, y: 150 },   // 4번 (좌)\r\n    { id: 5, x: 150, y: 150 },  // 5번 (중앙) - 우물 위치, 이동 가능하지만 첫수 제한\r\n];\r\n\r\n// 우물고누 연결 (선) - 원 + X\r\nconst UMUL_EDGES = [\r\n    // 원 둘레\r\n    [1, 2], [2, 3], [3, 4], [4, 1],\r\n    // X 대각선 (중앙 통과)\r\n    [1, 5], [5, 3],  // 상-중앙-하\r\n    [2, 5], [5, 4],  // 우-중앙-좌\r\n];\r\n\r\n// 우물고누에서 이동 가능한 연결\r\n// 원 둘레를 따라 한 칸씩 + 중앙(5)으로/에서 이동\r\n// \"각 수마다 각각의 돌이 움직일 수 있는 곳은 하나밖에 없습니다\"\r\n// → 이건 특정 상황에서의 설명, 실제로는 여러 방향 가능\r\nconst UMUL_VALID_MOVES = {\r\n    1: [2, 4, 5],    // 상: 우(2), 좌(4), 중앙(5)\r\n    2: [1, 3, 5],    // 우: 상(1), 하(3), 중앙(5)\r\n    3: [2, 4, 5],    // 하: 우(2), 좌(4), 중앙(5)\r\n    4: [1, 3, 5],    // 좌: 상(1), 하(3), 중앙(5)\r\n    5: [1, 2, 3, 4], // 중앙: 모든 방향\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 호박고누 정의\r\n// 출발선 2개 + 가운데 원(우물고누 형태), 각자 3개의 말\r\n// 전진만 가능, 후퇴 불가, 출발선 재진입 불가\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\n// 호박고누 노드 배치 (7개의 점)\r\n// 단순화된 말판:\r\n//\r\n//     0 (파랑 출발선) - 파랑 3개 시작\r\n//     |\r\n//     1\r\n//    /|\\\r\n//   4-5-2  (5는 중앙)\r\n//    \\|/\r\n//     3\r\n//     |\r\n//     6 (빨강 출발선) - 빨강 3개 시작\r\n//\r\nconst HOBAK_NODES = [\r\n    { id: 0, x: 150, y: 30, isHome: 'B' },   // 파랑 출발선\r\n    { id: 1, x: 150, y: 90 },                 // 상단\r\n    { id: 2, x: 230, y: 150 },                // 우측\r\n    { id: 3, x: 150, y: 210 },                // 하단\r\n    { id: 4, x: 70, y: 150 },                 // 좌측\r\n    { id: 5, x: 150, y: 150 },                // 중앙\r\n    { id: 6, x: 150, y: 270, isHome: 'R' },  // 빨강 출발선\r\n];\r\n\r\n// 호박고누 연결 (선)\r\nconst HOBAK_EDGES = [\r\n    [0, 1],                      // 파랑 출발선 → 상단\r\n    [1, 2], [2, 3], [3, 4], [4, 1],  // 원 둘레\r\n    [1, 5], [2, 5], [3, 5], [4, 5],  // 원 둘레 → 중앙\r\n    [3, 6],                      // 하단 → 빨강 출발선\r\n];\r\n\r\n// 호박고누에서 이동 가능한 연결 (인접 리스트)\r\n// 출발선에서 나온 말은 출발선으로 못 돌아감 (게임 로직에서 처리)\r\nconst HOBAK_ADJACENCY = {\r\n    0: [1],              // 파랑 출발선: 상단으로만\r\n    1: [2, 4, 5],        // 상단: 우, 좌, 중앙 (0으로 못 돌아감 - 게임 로직)\r\n    2: [1, 3, 5],        // 우: 상, 하, 중앙\r\n    3: [2, 4, 5],        // 하: 우, 좌, 중앙 (6으로 못 감 - 상대 출발선)\r\n    4: [1, 3, 5],        // 좌: 상, 하, 중앙\r\n    5: [1, 2, 3, 4],     // 중앙: 상하좌우\r\n    6: [3],              // 빨강 출발선: 하단으로만\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 밭고누 (네줄고누) 정의\r\n// 4x4 격자, 각자 4개의 말, 3연속 만들면 상대 말 제거\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\n// 밭고누 노드 배치 (16개의 점, 4x4 격자)\r\nconst BAT_NODES = [];\r\nfor (let row = 0; row < 4; row++) {\r\n    for (let col = 0; col < 4; col++) {\r\n        BAT_NODES.push({\r\n            id: row * 4 + col,\r\n            x: 60 + col * 80,\r\n            y: 60 + row * 80,\r\n            row: row,\r\n            col: col\r\n        });\r\n    }\r\n}\r\n\r\n// 밭고누 연결 (가로, 세로, 대각선)\r\nconst BAT_EDGES = [];\r\n// 가로 연결\r\nfor (let row = 0; row < 4; row++) {\r\n    for (let col = 0; col < 3; col++) {\r\n        BAT_EDGES.push([row * 4 + col, row * 4 + col + 1]);\r\n    }\r\n}\r\n// 세로 연결\r\nfor (let row = 0; row < 3; row++) {\r\n    for (let col = 0; col < 4; col++) {\r\n        BAT_EDGES.push([row * 4 + col, (row + 1) * 4 + col]);\r\n    }\r\n}\r\n// 대각선 연결 (오른쪽 아래)\r\nfor (let row = 0; row < 3; row++) {\r\n    for (let col = 0; col < 3; col++) {\r\n        BAT_EDGES.push([row * 4 + col, (row + 1) * 4 + col + 1]);\r\n    }\r\n}\r\n// 대각선 연결 (왼쪽 아래)\r\nfor (let row = 0; row < 3; row++) {\r\n    for (let col = 1; col < 4; col++) {\r\n        BAT_EDGES.push([row * 4 + col, (row + 1) * 4 + col - 1]);\r\n    }\r\n}\r\n\r\n// 밭고누 인접 리스트 생성\r\nconst BAT_ADJACENCY = {};\r\nfor (let i = 0; i < 16; i++) {\r\n    BAT_ADJACENCY[i] = [];\r\n}\r\nBAT_EDGES.forEach(([a, b]) => {\r\n    BAT_ADJACENCY[a].push(b);\r\n    BAT_ADJACENCY[b].push(a);\r\n});\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 게임 타입 설정\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\nconst GONU_TYPES = {\r\n    umul: {\r\n        name: '우물고누',\r\n        description: '가장 기본적인 고누. 각자 2개의 말로 상대를 봉쇄하면 승리!',\r\n        rules: [\r\n            '각자 2개의 말을 가지고 시작합니다',\r\n            '말은 원 둘레를 따라 한 칸씩만 이동합니다',\r\n            '중앙(우물)으로는 이동할 수 없습니다',\r\n            '상대의 말이 더 이상 움직일 수 없게 만들면 승리!',\r\n            '실수하지 않으면 무승부가 될 수 있습니다',\r\n        ],\r\n        nodes: UMUL_NODES,\r\n        edges: UMUL_EDGES,\r\n        adjacency: UMUL_VALID_MOVES,\r\n        initialPieces: () => ({\r\n            // 나무위키: [1 2 ; 3 4 ;흑] = 1,2에 흑(파랑), 3,4에 백(빨강)\r\n            // 5번(중앙)은 처음에 비어있음\r\n            1: 'B',  // 상 - 파랑1\r\n            2: 'B',  // 우 - 파랑2\r\n            3: 'R',  // 하 - 빨강3\r\n            4: 'R',  // 좌 - 빨강4\r\n            // 5(중앙)는 비어있음 - 첫 수로 여기에 이동 가능 (단, 2→5는 금지)\r\n        }),\r\n        piecesPerPlayer: 2,\r\n        boardWidth: 300,\r\n        boardHeight: 300,\r\n        // 첫 수 제한: 2번 위치에서 5번으로 바로 이동 금지\r\n        firstMoveRestriction: { from: 2, to: 5 },\r\n        checkWin: (pieces, currentPlayer) => {\r\n            // 상대방이 움직일 수 없으면 승리\r\n            const opponent = currentPlayer === 'B' ? 'R' : 'B';\r\n            const opponentPieces = Object.entries(pieces)\r\n                .filter(([, color]) => color === opponent)\r\n                .map(([nodeId]) => parseInt(nodeId));\r\n\r\n            for (const nodeId of opponentPieces) {\r\n                const moves = UMUL_VALID_MOVES[nodeId] || [];\r\n                for (const target of moves) {\r\n                    if (!pieces[target]) {\r\n                        return null; // 움직일 수 있는 곳이 있음\r\n                    }\r\n                }\r\n            }\r\n            return currentPlayer; // 상대방이 움직일 수 없음 = 현재 플레이어 승리\r\n        },\r\n        isWell: (nodeId) => nodeId === 5, // 5번이 우물(중앙)\r\n    },\r\n    hobak: {\r\n        name: '호박고누',\r\n        description: '출발선이 있는 고누. 각자 3개의 말로 상대를 봉쇄하면 승리!',\r\n        rules: [\r\n            '각자 3개의 말을 가지고 시작합니다',\r\n            '말은 선을 따라 한 칸씩만 이동합니다',\r\n            '출발선에서 나온 말은 출발선으로 돌아갈 수 없습니다',\r\n            '상대 출발선으로도 들어갈 수 없습니다',\r\n            '상대의 말이 더 이상 움직일 수 없게 만들면 승리!',\r\n        ],\r\n        nodes: HOBAK_NODES,\r\n        edges: HOBAK_EDGES,\r\n        adjacency: HOBAK_ADJACENCY,\r\n        initialPieces: () => ({\r\n            // 파랑: 출발선(0)에 1개, 나머지는 가운데 영역에서 시작\r\n            // 단순화: 파랑 출발선(0), 상단(1), 좌측(4)\r\n            // 빨강: 출발선(6), 하단(3), 우측(2)\r\n            0: 'B',  // 파랑 출발선\r\n            1: 'B',  // 상단\r\n            4: 'B',  // 좌측\r\n            6: 'R',  // 빨강 출발선\r\n            3: 'R',  // 하단\r\n            2: 'R',  // 우측\r\n        }),\r\n        piecesPerPlayer: 3,\r\n        boardWidth: 300,\r\n        boardHeight: 300,\r\n        checkWin: (pieces, currentPlayer) => {\r\n            const opponent = currentPlayer === 'B' ? 'R' : 'B';\r\n            const opponentPieces = Object.entries(pieces)\r\n                .filter(([, color]) => color === opponent)\r\n                .map(([nodeId]) => parseInt(nodeId));\r\n\r\n            for (const nodeId of opponentPieces) {\r\n                const moves = HOBAK_ADJACENCY[nodeId] || [];\r\n                for (const target of moves) {\r\n                    if (!pieces[target]) {\r\n                        // 출발선 제한 체크\r\n                        const targetNode = HOBAK_NODES.find(n => n.id === target);\r\n                        if (targetNode?.isHome) {\r\n                            continue;\r\n                        }\r\n                        return null;\r\n                    }\r\n                }\r\n            }\r\n            return currentPlayer;\r\n        },\r\n        getHomeNode: (color) => color === 'B' ? 0 : 6,\r\n    },\r\n    bat: {\r\n        name: '밭고누 (네줄고누)',\r\n        description: '4x4 격자에서 자기 말 3개를 일렬로 만들면 상대 말을 제거!',\r\n        rules: [\r\n            '각자 4개의 말을 가지고 시작합니다',\r\n            '말은 선을 따라 한 칸씩만 이동합니다',\r\n            '자기 말 3개가 가로/세로/대각선 일렬이 되면 상대 말 1개 제거',\r\n            '상대 말을 1개만 남기면 승리!',\r\n        ],\r\n        nodes: BAT_NODES,\r\n        edges: BAT_EDGES,\r\n        adjacency: BAT_ADJACENCY,\r\n        initialPieces: () => ({\r\n            0: 'B', 1: 'B', 2: 'B', 3: 'B',   // 흑 (상단 행)\r\n            12: 'R', 13: 'R', 14: 'R', 15: 'R', // 적 (하단 행)\r\n        }),\r\n        piecesPerPlayer: 4,\r\n        boardWidth: 320,\r\n        boardHeight: 320,\r\n        checkWin: (pieces) => {\r\n            // 상대 말이 1개만 남으면 승리\r\n            const blackCount = Object.values(pieces).filter(c => c === 'B').length;\r\n            const redCount = Object.values(pieces).filter(c => c === 'R').length;\r\n            if (blackCount <= 1) return 'R';\r\n            if (redCount <= 1) return 'B';\r\n            return null;\r\n        },\r\n        checkThreeInRow: (pieces, nodeId, color) => {\r\n            // 해당 노드를 포함해서 3개 일렬인지 확인\r\n            const node = BAT_NODES.find(n => n.id === nodeId);\r\n            if (!node) return false;\r\n\r\n            const { row, col } = node;\r\n\r\n            // 가로 체크\r\n            for (let startCol = Math.max(0, col - 2); startCol <= Math.min(1, col); startCol++) {\r\n                let count = 0;\r\n                for (let c = startCol; c < startCol + 3 && c < 4; c++) {\r\n                    const id = row * 4 + c;\r\n                    if (pieces[id] === color) count++;\r\n                }\r\n                if (count === 3) return true;\r\n            }\r\n\r\n            // 세로 체크\r\n            for (let startRow = Math.max(0, row - 2); startRow <= Math.min(1, row); startRow++) {\r\n                let count = 0;\r\n                for (let r = startRow; r < startRow + 3 && r < 4; r++) {\r\n                    const id = r * 4 + col;\r\n                    if (pieces[id] === color) count++;\r\n                }\r\n                if (count === 3) return true;\r\n            }\r\n\r\n            // 대각선 체크 (오른쪽 아래 방향)\r\n            for (let offset = -2; offset <= 0; offset++) {\r\n                let count = 0;\r\n                for (let d = 0; d < 3; d++) {\r\n                    const r = row + offset + d;\r\n                    const c = col + offset + d;\r\n                    if (r >= 0 && r < 4 && c >= 0 && c < 4) {\r\n                        const id = r * 4 + c;\r\n                        if (pieces[id] === color) count++;\r\n                    }\r\n                }\r\n                if (count === 3) return true;\r\n            }\r\n\r\n            // 대각선 체크 (왼쪽 아래 방향)\r\n            for (let offset = -2; offset <= 0; offset++) {\r\n                let count = 0;\r\n                for (let d = 0; d < 3; d++) {\r\n                    const r = row + offset + d;\r\n                    const c = col - offset - d;\r\n                    if (r >= 0 && r < 4 && c >= 0 && c < 4) {\r\n                        const id = r * 4 + c;\r\n                        if (pieces[id] === color) count++;\r\n                    }\r\n                }\r\n                if (count === 3) return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n    },\r\n};\r\n\r\n// Firestore 직렬화/역직렬화\r\nconst serializePieces = (pieces) => pieces;\r\nconst deserializePieces = (data) => {\r\n    const result = {};\r\n    for (const key in data) {\r\n        result[parseInt(key)] = data[key];\r\n    }\r\n    return result;\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// AI 로직\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\nconst getAIMove = (gameType, pieces, aiColor) => {\r\n    const config = GONU_TYPES[gameType];\r\n    const adjacency = config.adjacency;\r\n    const opponentColor = aiColor === 'B' ? 'R' : 'B';\r\n\r\n    // AI의 모든 말 찾기\r\n    const aiPieces = Object.entries(pieces)\r\n        .filter(([, color]) => color === aiColor)\r\n        .map(([nodeId]) => parseInt(nodeId));\r\n\r\n    // 가능한 모든 이동 찾기\r\n    const possibleMoves = [];\r\n\r\n    for (const fromNode of aiPieces) {\r\n        const targets = adjacency[fromNode] || [];\r\n        for (const toNode of targets) {\r\n            if (pieces[toNode]) continue; // 이미 말이 있음\r\n\r\n            // 호박고누 출발선 제한 체크\r\n            if (gameType === 'hobak') {\r\n                const targetNodeInfo = HOBAK_NODES.find(n => n.id === toNode);\r\n                if (targetNodeInfo?.isHome) continue;\r\n            }\r\n\r\n            // 우물고누 우물 제한 체크\r\n            if (gameType === 'umul' && config.isWell && config.isWell(toNode)) continue;\r\n\r\n            possibleMoves.push({ from: fromNode, to: toNode });\r\n        }\r\n    }\r\n\r\n    if (possibleMoves.length === 0) return null;\r\n\r\n    // 각 이동에 대한 점수 계산\r\n    const scoredMoves = possibleMoves.map(move => {\r\n        let score = 0;\r\n\r\n        // 시뮬레이션: 이 이동을 했을 때\r\n        const simulatedPieces = { ...pieces };\r\n        delete simulatedPieces[move.from];\r\n        simulatedPieces[move.to] = aiColor;\r\n\r\n        // 1. 승리 가능한 이동은 최우선\r\n        const winner = config.checkWin(simulatedPieces, aiColor);\r\n        if (winner === aiColor) {\r\n            score += 1000;\r\n        }\r\n\r\n        // 2. 상대방의 이동 가능 수 줄이기\r\n        const opponentPieces = Object.entries(simulatedPieces)\r\n            .filter(([, color]) => color === opponentColor)\r\n            .map(([nodeId]) => parseInt(nodeId));\r\n\r\n        let opponentMoves = 0;\r\n        for (const nodeId of opponentPieces) {\r\n            const moves = adjacency[nodeId] || [];\r\n            for (const target of moves) {\r\n                if (!simulatedPieces[target]) {\r\n                    if (gameType === 'hobak') {\r\n                        const targetNode = HOBAK_NODES.find(n => n.id === target);\r\n                        if (!targetNode?.isHome) opponentMoves++;\r\n                    } else if (gameType === 'umul') {\r\n                        if (!config.isWell || !config.isWell(target)) opponentMoves++;\r\n                    } else {\r\n                        opponentMoves++;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        score -= opponentMoves * 5; // 상대방 이동 가능 수가 적을수록 좋음\r\n\r\n        // 3. 중앙에 가까울수록 좋음 (밭고누)\r\n        if (gameType === 'bat') {\r\n            const toNode = BAT_NODES.find(n => n.id === move.to);\r\n            if (toNode) {\r\n                const centerDist = Math.abs(toNode.row - 1.5) + Math.abs(toNode.col - 1.5);\r\n                score -= centerDist * 2;\r\n            }\r\n\r\n            // 3연속 만들 수 있으면 보너스\r\n            if (config.checkThreeInRow(simulatedPieces, move.to, aiColor)) {\r\n                score += 100;\r\n            }\r\n        }\r\n\r\n        // 4. 약간의 랜덤성 추가\r\n        score += Math.random() * 3;\r\n\r\n        return { ...move, score };\r\n    });\r\n\r\n    // 가장 높은 점수의 이동 선택\r\n    scoredMoves.sort((a, b) => b.score - a.score);\r\n    return scoredMoves[0];\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 메인 컴포넌트\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\nconst GonuGame = () => {\r\n    const { user, userDoc } = useAuth();\r\n    const [gameId, setGameId] = useState(null);\r\n    const [gameData, setGameData] = useState(null);\r\n    const [showCreateRoom, setShowCreateRoom] = useState(true);\r\n    const [newRoomId, setNewRoomId] = useState('');\r\n    const [feedback, setFeedback] = useState({ message: '', type: '' });\r\n    const [selectedPiece, setSelectedPiece] = useState(null);\r\n    const [selectedGameType, setSelectedGameType] = useState('umul');\r\n    const [availableRooms, setAvailableRooms] = useState([]);\r\n    const [showRules, setShowRules] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [gameMode, setGameMode] = useState('pvp'); // 'pvp' or 'ai'\r\n    const [aiThinking, setAiThinking] = useState(false);\r\n    const [validMoves, setValidMoves] = useState([]);\r\n    const [pendingCapture, setPendingCapture] = useState(null); // 밭고누에서 상대 말 제거 대기\r\n\r\n    // 로컬 AI 게임 상태\r\n    const [localGame, setLocalGame] = useState(null);\r\n\r\n    const isMyTurn = gameData && user && gameData.turn === (gameData.players.B === user.uid ? 'B' : 'R');\r\n    const myColor = gameData && user && (gameData.players.B === user.uid ? 'B' : 'R');\r\n\r\n    const gameIdRef = useRef(gameId);\r\n    useEffect(() => { gameIdRef.current = gameId; }, [gameId]);\r\n    const gameDataRef = useRef(gameData);\r\n    useEffect(() => { gameDataRef.current = gameData; }, [gameData]);\r\n    const userRef = useRef(user);\r\n    useEffect(() => { userRef.current = user; }, [user]);\r\n\r\n    useEffect(() => {\r\n        const cleanup = () => {\r\n            const currentGameId = gameIdRef.current;\r\n            const currentGameData = gameDataRef.current;\r\n            const currentUser = userRef.current;\r\n            if (\r\n                currentGameId &&\r\n                currentGameData &&\r\n                currentUser &&\r\n                currentGameData.status === 'waiting' &&\r\n                currentGameData.players.B === currentUser.uid\r\n            ) {\r\n                deleteDoc(doc(db, 'gonuGames', currentGameId));\r\n            }\r\n        };\r\n\r\n        window.addEventListener('beforeunload', cleanup);\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeunload', cleanup);\r\n        };\r\n    }, []);\r\n\r\n    // 유효한 이동 위치 계산\r\n    useEffect(() => {\r\n        if (selectedPiece === null || selectedPiece === undefined) {\r\n            setValidMoves([]);\r\n            return;\r\n        }\r\n\r\n        const currentPieces = localGame?.pieces || (gameData ? deserializePieces(gameData.pieces) : {});\r\n        const gameType = localGame?.gameType || gameData?.gameType || 'umul';\r\n        const config = GONU_TYPES[gameType];\r\n        const adjacency = config.adjacency;\r\n        const currentColor = localGame ? 'B' : myColor;\r\n        const pieceId = parseInt(selectedPiece);\r\n\r\n        if (currentPieces[pieceId] !== currentColor) {\r\n            setValidMoves([]);\r\n            return;\r\n        }\r\n\r\n        const moves = [];\r\n        const targets = adjacency[pieceId] || [];\r\n        const moveCount = localGame?.moveCount || 0;\r\n\r\n        for (const target of targets) {\r\n            if (currentPieces[target]) continue;\r\n\r\n            // 우물고누 첫 수 제한: 2→5 금지 (우물고누 첫수 규칙)\r\n            if (gameType === 'umul' && moveCount === 0 && config.firstMoveRestriction) {\r\n                const { from, to } = config.firstMoveRestriction;\r\n                if (pieceId === from && target === to) continue;\r\n            }\r\n\r\n            // 호박고누 출발선 제한\r\n            if (gameType === 'hobak') {\r\n                const targetNode = HOBAK_NODES.find(n => n.id === target);\r\n                if (targetNode?.isHome) continue;\r\n            }\r\n\r\n            moves.push(target);\r\n        }\r\n\r\n        setValidMoves(moves);\r\n    }, [selectedPiece, localGame, gameData, myColor]);\r\n\r\n    const fetchAvailableRooms = useCallback(async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const q = query(\r\n                collection(db, 'gonuGames'),\r\n                where('status', '==', 'waiting')\r\n            );\r\n            const querySnapshot = await getDocs(q);\r\n            const rooms = [];\r\n            querySnapshot.forEach((doc) => {\r\n                const data = doc.data();\r\n                if (data.players.B !== user.uid) {\r\n                    rooms.push({ id: doc.id, ...data });\r\n                }\r\n            });\r\n            setAvailableRooms(rooms);\r\n        } catch (error) {\r\n            console.error(\"Error fetching rooms:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (showCreateRoom && user && gameMode === 'pvp') {\r\n            fetchAvailableRooms();\r\n            const interval = setInterval(fetchAvailableRooms, 60000);\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [showCreateRoom, user, fetchAvailableRooms, gameMode]);\r\n\r\n    const fetchGameData = useCallback(async () => {\r\n        if (!gameId) return;\r\n\r\n        const gameDocRef = doc(db, 'gonuGames', gameId);\r\n        try {\r\n            const docSnap = await getDoc(gameDocRef);\r\n            if (docSnap.exists()) {\r\n                const rawData = docSnap.data();\r\n                setGameData(rawData);\r\n                setShowCreateRoom(false);\r\n\r\n                if (rawData.status === 'finished') {\r\n                    setTimeout(async () => {\r\n                        try { await deleteDoc(gameDocRef); } catch (error) { console.error(\"Error deleting finished game:\", error); }\r\n                    }, 10000);\r\n                }\r\n            } else {\r\n                setFeedback({ message: '게임을 찾을 수 없습니다.', type: 'error' });\r\n                setGameId(null);\r\n                setGameData(null);\r\n                setShowCreateRoom(true);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error fetching game data:\", error);\r\n        }\r\n    }, [gameId]);\r\n\r\n    usePolling(fetchGameData, { interval: 3000, enabled: !!gameId });\r\n\r\n    useEffect(() => {\r\n        if (feedback.message) {\r\n            const timer = setTimeout(() => setFeedback({ message: '', type: '' }), 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [feedback.message]);\r\n\r\n    // AI 턴 처리 - ref 사용하여 cleanup 문제 방지\r\n    const aiTimerRef = useRef(null);\r\n    const localGameRef = useRef(localGame);\r\n\r\n    useEffect(() => {\r\n        localGameRef.current = localGame;\r\n    }, [localGame]);\r\n\r\n    useEffect(() => {\r\n        if (!localGame || localGame.status !== 'active' || localGame.turn !== 'R' || aiThinking || pendingCapture) {\r\n            return;\r\n        }\r\n\r\n        setAiThinking(true);\r\n\r\n        // 기존 타이머 정리\r\n        if (aiTimerRef.current) {\r\n            clearTimeout(aiTimerRef.current);\r\n        }\r\n\r\n        aiTimerRef.current = setTimeout(() => {\r\n            const currentGame = localGameRef.current;\r\n            if (!currentGame || currentGame.turn !== 'R') {\r\n                setAiThinking(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const move = getAIMove(currentGame.gameType, currentGame.pieces, 'R');\r\n\r\n                if (move) {\r\n                    const newPieces = { ...currentGame.pieces };\r\n                    delete newPieces[move.from];\r\n                    newPieces[move.to] = 'R';\r\n\r\n                    const config = GONU_TYPES[currentGame.gameType];\r\n\r\n                    // 밭고누에서 3연속 체크\r\n                    if (currentGame.gameType === 'bat' && config.checkThreeInRow(newPieces, move.to, 'R')) {\r\n                        const playerPieces = Object.entries(newPieces)\r\n                            .filter(([, color]) => color === 'B')\r\n                            .map(([nodeId]) => parseInt(nodeId));\r\n\r\n                        if (playerPieces.length > 0) {\r\n                            const targetIdx = Math.floor(Math.random() * playerPieces.length);\r\n                            delete newPieces[playerPieces[targetIdx]];\r\n                        }\r\n                    }\r\n\r\n                    const winner = config.checkWin(newPieces, 'R');\r\n\r\n                    setLocalGame({\r\n                        ...currentGame,\r\n                        pieces: newPieces,\r\n                        turn: 'B',\r\n                        status: winner ? 'finished' : 'active',\r\n                        winner: winner,\r\n                        moveCount: (currentGame.moveCount || 0) + 1,\r\n                    });\r\n                } else {\r\n                    // AI가 이동할 수 없으면 플레이어 승리\r\n                    setLocalGame({\r\n                        ...currentGame,\r\n                        status: 'finished',\r\n                        winner: 'B',\r\n                    });\r\n                }\r\n            } catch (error) {\r\n                console.error('AI move error:', error);\r\n            } finally {\r\n                setAiThinking(false);\r\n            }\r\n        }, 1200);\r\n\r\n        // cleanup에서 타이머 정리하지 않음 (aiThinking이 true인 동안)\r\n    }, [localGame?.turn, localGame?.status, aiThinking, pendingCapture]);\r\n\r\n    const handleStartAIGame = () => {\r\n        const config = GONU_TYPES[selectedGameType];\r\n        setLocalGame({\r\n            gameType: selectedGameType,\r\n            pieces: config.initialPieces(),\r\n            turn: 'B',\r\n            status: 'active',\r\n            winner: null,\r\n            moveCount: 0, // 첫 수 제한 체크용\r\n        });\r\n        setShowCreateRoom(false);\r\n    };\r\n\r\n    const handleCreateRoom = async () => {\r\n        if (!user) {\r\n            setFeedback({ message: '로그인이 필요합니다.', type: 'error' });\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        const newGameId = Math.random().toString(36).substring(2, 8);\r\n        const gameRef = doc(db, 'gonuGames', newGameId);\r\n        const gameType = GONU_TYPES[selectedGameType];\r\n\r\n        const initialGameData = {\r\n            pieces: serializePieces(gameType.initialPieces()),\r\n            players: { B: user.uid, R: null },\r\n            playerNames: { B: userDoc.name, R: null },\r\n            turn: 'B',\r\n            status: 'waiting',\r\n            winner: null,\r\n            gameType: selectedGameType,\r\n            gameName: gameType.name,\r\n            createdAt: serverTimestamp(),\r\n        };\r\n\r\n        try {\r\n            await setDoc(gameRef, initialGameData);\r\n            setGameId(newGameId);\r\n            setFeedback({ message: `${gameType.name} 방 생성 완료! 코드: ${newGameId}`, type: 'success' });\r\n            await fetchGameData();\r\n        } catch (error) {\r\n            console.error(\"Error creating room:\", error);\r\n            setFeedback({ message: '방 생성에 실패했습니다.', type: 'error' });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleJoinRoom = async (roomIdToJoin) => {\r\n        const targetRoomId = roomIdToJoin || newRoomId.trim();\r\n        if (!targetRoomId) {\r\n            setFeedback({ message: '참가할 방 코드를 입력하세요.', type: 'error' });\r\n            return;\r\n        }\r\n        if (!user) {\r\n            setFeedback({ message: '로그인이 필요합니다.', type: 'error' });\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        const gameRef = doc(db, 'gonuGames', targetRoomId);\r\n\r\n        try {\r\n            await runTransaction(db, async (transaction) => {\r\n                const gameDoc = await transaction.get(gameRef);\r\n                if (!gameDoc.exists()) throw new Error(\"방을 찾을 수 없습니다.\");\r\n                const data = gameDoc.data();\r\n                if (data.players.R) throw new Error(\"방이 가득 찼습니다.\");\r\n                if (data.players.B === user.uid) throw new Error(\"자신이 만든 방에는 참가할 수 없습니다.\");\r\n\r\n                transaction.update(gameRef, {\r\n                    'players.R': user.uid,\r\n                    'playerNames.R': userDoc.name,\r\n                    status: 'active',\r\n                });\r\n            });\r\n            setGameId(targetRoomId);\r\n            await fetchGameData();\r\n        } catch (error) {\r\n            console.error(\"Error joining room: \", error);\r\n            setFeedback({ message: `참가 실패: ${error.message}`, type: 'error' });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAdminDeleteRoom = async (roomId) => {\r\n        if (!userDoc?.isAdmin) {\r\n            setFeedback({ message: '삭제 권한이 없습니다.', type: 'error' });\r\n            return;\r\n        }\r\n        try {\r\n            await deleteDoc(doc(db, 'gonuGames', roomId));\r\n            setFeedback({ message: `방 ${roomId}가 삭제되었습니다.`, type: 'success' });\r\n            fetchAvailableRooms();\r\n        } catch (error) {\r\n            console.error(\"Error deleting room by admin:\", error);\r\n            setFeedback({ message: '방 삭제에 실패했습니다.', type: 'error' });\r\n        }\r\n    };\r\n\r\n    // 밭고누에서 상대 말 제거\r\n    const handleCaptureClick = (nodeId) => {\r\n        if (!pendingCapture) return;\r\n\r\n        const pieces = localGame?.pieces || deserializePieces(gameData.pieces);\r\n        const opponentColor = pendingCapture.capturer === 'B' ? 'R' : 'B';\r\n\r\n        if (pieces[nodeId] !== opponentColor) {\r\n            setFeedback({ message: '상대방의 말을 선택하세요.', type: 'error' });\r\n            return;\r\n        }\r\n\r\n        const newPieces = { ...pieces };\r\n        delete newPieces[nodeId];\r\n\r\n        const config = GONU_TYPES[localGame?.gameType || gameData.gameType];\r\n        const winner = config.checkWin(newPieces, pendingCapture.capturer);\r\n\r\n        if (localGame) {\r\n            setLocalGame(prev => ({\r\n                ...prev,\r\n                pieces: newPieces,\r\n                turn: pendingCapture.capturer === 'B' ? 'R' : 'B',\r\n                status: winner ? 'finished' : 'active',\r\n                winner: winner,\r\n            }));\r\n        }\r\n\r\n        setPendingCapture(null);\r\n    };\r\n\r\n    const handleMove = useCallback(async (targetNode) => {\r\n        if (pendingCapture) {\r\n            handleCaptureClick(targetNode);\r\n            return;\r\n        }\r\n\r\n        if (selectedPiece === null) return;\r\n\r\n        // 로컬 AI 게임\r\n        if (localGame) {\r\n            if (localGame.status !== 'active' || localGame.turn !== 'B') return;\r\n\r\n            const pieces = localGame.pieces;\r\n            if (pieces[selectedPiece] !== 'B') return;\r\n            if (!validMoves.includes(targetNode)) {\r\n                setFeedback({ message: '이동할 수 없는 위치입니다.', type: 'error' });\r\n                return;\r\n            }\r\n\r\n            const newPieces = { ...pieces };\r\n            delete newPieces[selectedPiece];\r\n            newPieces[targetNode] = 'B';\r\n\r\n            const config = GONU_TYPES[localGame.gameType];\r\n\r\n            // 밭고누에서 3연속 체크\r\n            if (localGame.gameType === 'bat' && config.checkThreeInRow(newPieces, targetNode, 'B')) {\r\n                // 상대 말 제거 대기 상태로\r\n                setLocalGame(prev => ({\r\n                    ...prev,\r\n                    pieces: newPieces,\r\n                }));\r\n                setPendingCapture({ capturer: 'B' });\r\n                setSelectedPiece(null);\r\n                setFeedback({ message: '3연속! 제거할 상대 말을 선택하세요.', type: 'success' });\r\n                return;\r\n            }\r\n\r\n            const winner = config.checkWin(newPieces, 'B');\r\n\r\n            setLocalGame(prev => ({\r\n                ...prev,\r\n                pieces: newPieces,\r\n                turn: 'R',\r\n                status: winner ? 'finished' : 'active',\r\n                winner: winner,\r\n                moveCount: (prev.moveCount || 0) + 1,\r\n            }));\r\n            setSelectedPiece(null);\r\n\r\n            if (winner === 'B') {\r\n                setFeedback({ message: '🎉 승리했습니다!', type: 'success' });\r\n            }\r\n            return;\r\n        }\r\n\r\n        // 온라인 게임\r\n        if (!isMyTurn || !gameData) return;\r\n\r\n        const pieces = deserializePieces(gameData.pieces);\r\n        if (pieces[selectedPiece] !== myColor) return;\r\n        if (!validMoves.includes(targetNode)) {\r\n            setFeedback({ message: '이동할 수 없는 위치입니다.', type: 'error' });\r\n            return;\r\n        }\r\n\r\n        const gameRef = doc(db, 'gonuGames', gameId);\r\n\r\n        try {\r\n            await runTransaction(db, async (transaction) => {\r\n                const gameDoc = await transaction.get(gameRef);\r\n                if (!gameDoc.exists()) throw new Error('게임이 존재하지 않습니다.');\r\n                const currentData = gameDoc.data();\r\n                if (currentData.turn !== myColor) throw new Error('상대방의 턴입니다.');\r\n\r\n                const newPieces = { ...deserializePieces(currentData.pieces) };\r\n                delete newPieces[selectedPiece];\r\n                newPieces[targetNode] = myColor;\r\n\r\n                const config = GONU_TYPES[gameData.gameType];\r\n                const winner = config.checkWin(newPieces, myColor);\r\n                const opponentColor = myColor === 'B' ? 'R' : 'B';\r\n\r\n                transaction.update(gameRef, {\r\n                    pieces: serializePieces(newPieces),\r\n                    turn: opponentColor,\r\n                    status: winner ? 'finished' : 'active',\r\n                    winner: winner,\r\n                });\r\n\r\n                if (winner) {\r\n                    const userDocRef = doc(db, 'users', user.uid);\r\n                    transaction.update(userDocRef, { coupons: increment(1) });\r\n\r\n                    logActivity(db, {\r\n                        classCode: userDoc?.classCode,\r\n                        userId: user.uid,\r\n                        userName: userDoc?.name || '사용자',\r\n                        type: ACTIVITY_TYPES.GAME_WIN,\r\n                        description: `${gameData.gameName || '고누'} 승리 - 쿠폰 1개 획득`,\r\n                        couponAmount: 1,\r\n                        metadata: {\r\n                            gameType: 'gonu',\r\n                            gameVariant: gameData.gameType,\r\n                            gameName: gameData.gameName\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            setSelectedPiece(null);\r\n        } catch (error) {\r\n            console.error('Move error:', error);\r\n            setFeedback({ message: `이동 실패: ${error.message}`, type: 'error' });\r\n        }\r\n    }, [gameId, gameData, isMyTurn, myColor, selectedPiece, user?.uid, localGame, validMoves, pendingCapture]);\r\n\r\n    const handleNodeClick = (nodeId) => {\r\n        if (pendingCapture) {\r\n            handleCaptureClick(nodeId);\r\n            return;\r\n        }\r\n\r\n        const pieces = localGame?.pieces || (gameData ? deserializePieces(gameData.pieces) : {});\r\n        const currentTurn = localGame?.turn || gameData?.turn;\r\n        const currentColor = localGame ? 'B' : myColor;\r\n        const status = localGame?.status || gameData?.status;\r\n\r\n        if (status !== 'active') return;\r\n        if (localGame && currentTurn !== 'B') return;\r\n        if (!localGame && !isMyTurn) return;\r\n\r\n        // 자기 말 선택\r\n        if (pieces[nodeId] === currentColor) {\r\n            setSelectedPiece(nodeId);\r\n            return;\r\n        }\r\n\r\n        // 빈 칸으로 이동\r\n        if (selectedPiece !== null && !pieces[nodeId]) {\r\n            handleMove(nodeId);\r\n        }\r\n    };\r\n\r\n    const handleLeaveGame = async () => {\r\n        if (localGame) {\r\n            setLocalGame(null);\r\n            setShowCreateRoom(true);\r\n            setSelectedPiece(null);\r\n            setPendingCapture(null);\r\n            return;\r\n        }\r\n\r\n        if (gameData && gameData.status === 'waiting' && gameId && gameData.players.B === user.uid) {\r\n            try { await deleteDoc(doc(db, 'gonuGames', gameId)); } catch (error) { console.error(\"Error deleting room:\", error); }\r\n        }\r\n\r\n        setGameId(null);\r\n        setGameData(null);\r\n        setShowCreateRoom(true);\r\n        setSelectedPiece(null);\r\n        setPendingCapture(null);\r\n    };\r\n\r\n    // 게임 보드 렌더링\r\n    const renderBoard = () => {\r\n        const gameType = localGame?.gameType || gameData?.gameType || 'umul';\r\n        const config = GONU_TYPES[gameType];\r\n        const pieces = localGame?.pieces || (gameData ? deserializePieces(gameData.pieces) : {});\r\n        const currentTurn = localGame?.turn || gameData?.turn;\r\n\r\n        return (\r\n            <svg\r\n                className=\"gonu-svg-board\"\r\n                width={config.boardWidth}\r\n                height={config.boardHeight}\r\n                viewBox={`0 0 ${config.boardWidth} ${config.boardHeight}`}\r\n                style={{ width: '100%', maxWidth: config.boardWidth, height: 'auto' }}\r\n            >\r\n                {/* 배경 */}\r\n                <rect x=\"0\" y=\"0\" width={config.boardWidth} height={config.boardHeight} fill=\"#2a2a3a\" rx=\"10\" />\r\n\r\n                {/* 우물고누: 원형 둘레 + X 대각선 */}\r\n                {gameType === 'umul' && (\r\n                    <>\r\n                        {/* 원 둘레 */}\r\n                        <circle\r\n                            cx={150}\r\n                            cy={150}\r\n                            r={110}\r\n                            fill=\"none\"\r\n                            stroke=\"#555\"\r\n                            strokeWidth=\"3\"\r\n                        />\r\n                        {/* X 대각선 (상-중앙-하, 좌-중앙-우) */}\r\n                        <line x1={150} y1={40} x2={150} y2={260} stroke=\"#555\" strokeWidth=\"3\" />\r\n                        <line x1={40} y1={150} x2={260} y2={150} stroke=\"#555\" strokeWidth=\"3\" />\r\n                    </>\r\n                )}\r\n\r\n                {/* 다른 게임 타입: 일반 연결선 */}\r\n                {gameType !== 'umul' && config.edges.map(([from, to], idx) => {\r\n                    const fromNode = config.nodes.find(n => n.id === from);\r\n                    const toNode = config.nodes.find(n => n.id === to);\r\n                    return (\r\n                        <line\r\n                            key={`edge-${idx}`}\r\n                            x1={fromNode.x}\r\n                            y1={fromNode.y}\r\n                            x2={toNode.x}\r\n                            y2={toNode.y}\r\n                            stroke=\"#555\"\r\n                            strokeWidth=\"3\"\r\n                        />\r\n                    );\r\n                })}\r\n\r\n                {/* 노드 및 말 */}\r\n                {config.nodes.map(node => {\r\n                    const piece = pieces[node.id];\r\n                    const isSelected = selectedPiece === node.id;\r\n                    const isValidMove = validMoves.includes(node.id);\r\n                    const isWell = gameType === 'umul' && config.isWell && config.isWell(node.id);\r\n                    const isHome = node.isHome;\r\n                    const isPendingCapture = pendingCapture && piece && piece !== pendingCapture.capturer;\r\n\r\n                    return (\r\n                        <g\r\n                            key={`node-${node.id}`}\r\n                            onClick={() => handleNodeClick(node.id)}\r\n                            style={{ cursor: 'pointer' }}\r\n                        >\r\n                            {/* 노드 배경 */}\r\n                            <circle\r\n                                cx={node.x}\r\n                                cy={node.y}\r\n                                r={isWell ? 20 : 22}\r\n                                fill={isWell ? '#333' : isValidMove ? '#4a7' : isHome ? (isHome === 'B' ? '#334' : '#433') : '#444'}\r\n                                stroke={isSelected ? '#0ff' : isValidMove ? '#4f7' : isPendingCapture ? '#f44' : '#666'}\r\n                                strokeWidth={isSelected || isValidMove || isPendingCapture ? 3 : 2}\r\n                            />\r\n\r\n                            {/* 우물 표시 */}\r\n                            {isWell && (\r\n                                <text\r\n                                    x={node.x}\r\n                                    y={node.y + 5}\r\n                                    textAnchor=\"middle\"\r\n                                    fill=\"#666\"\r\n                                    fontSize=\"12\"\r\n                                    fontWeight=\"bold\"\r\n                                >\r\n                                    우물\r\n                                </text>\r\n                            )}\r\n\r\n                            {/* 출발선 표시 */}\r\n                            {isHome && !piece && (\r\n                                <text\r\n                                    x={node.x}\r\n                                    y={node.y + 5}\r\n                                    textAnchor=\"middle\"\r\n                                    fill={isHome === 'B' ? '#88f' : '#f88'}\r\n                                    fontSize=\"10\"\r\n                                >\r\n                                    출발\r\n                                </text>\r\n                            )}\r\n\r\n                            {/* 말 */}\r\n                            {piece && (\r\n                                <>\r\n                                    <circle\r\n                                        cx={node.x}\r\n                                        cy={node.y}\r\n                                        r={18}\r\n                                        fill={piece === 'B' ? '#1a5fb4' : '#c00'}\r\n                                        stroke={piece === 'B' ? '#62a0ea' : '#f66'}\r\n                                        strokeWidth=\"3\"\r\n                                    />\r\n                                    <circle\r\n                                        cx={node.x - 5}\r\n                                        cy={node.y - 5}\r\n                                        r={6}\r\n                                        fill={piece === 'B' ? '#62a0ea' : '#f44'}\r\n                                        opacity=\"0.6\"\r\n                                    />\r\n                                </>\r\n                            )}\r\n\r\n                            {/* 이동 가능 표시 */}\r\n                            {isValidMove && !piece && (\r\n                                <circle\r\n                                    cx={node.x}\r\n                                    cy={node.y}\r\n                                    r={8}\r\n                                    fill=\"#4f7\"\r\n                                    opacity=\"0.6\"\r\n                                />\r\n                            )}\r\n                        </g>\r\n                    );\r\n                })}\r\n\r\n                {/* 턴 표시 */}\r\n                <text\r\n                    x={config.boardWidth / 2}\r\n                    y={config.boardHeight - 8}\r\n                    textAnchor=\"middle\"\r\n                    fill=\"#aaa\"\r\n                    fontSize=\"11\"\r\n                >\r\n                    {currentTurn === 'B' ? '🔵 파랑 차례' : '🔴 빨강 차례'}\r\n                </text>\r\n            </svg>\r\n        );\r\n    };\r\n\r\n    if (showCreateRoom) {\r\n        return (\r\n            <div className=\"gonu-container\">\r\n                <div className=\"room-creation\">\r\n                    <h2>🎯 고누 게임</h2>\r\n                    <p>한국 전통 보드게임을 즐겨보세요!</p>\r\n\r\n                    {feedback.message && <div className={`feedback ${feedback.type}`}>{feedback.message}</div>}\r\n\r\n                    {/* 게임 모드 선택 */}\r\n                    <div className=\"game-mode-selector\">\r\n                        <h3>🎮 게임 모드</h3>\r\n                        <div className=\"mode-buttons\">\r\n                            <button\r\n                                className={`mode-btn ${gameMode === 'ai' ? 'selected' : ''}`}\r\n                                onClick={() => setGameMode('ai')}\r\n                            >\r\n                                🤖 AI 대전\r\n                            </button>\r\n                            <button\r\n                                className={`mode-btn ${gameMode === 'pvp' ? 'selected' : ''}`}\r\n                                onClick={() => setGameMode('pvp')}\r\n                            >\r\n                                👥 친구 대전\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"game-type-selector\">\r\n                        <h3>게임 종류 선택</h3>\r\n                        <div className=\"game-types\">\r\n                            {Object.entries(GONU_TYPES).map(([key, type]) => (\r\n                                <label key={key} className={`game-type-option ${selectedGameType === key ? 'selected' : ''}`}>\r\n                                    <input type=\"radio\" value={key} checked={selectedGameType === key} onChange={(e) => setSelectedGameType(e.target.value)} />\r\n                                    <div className=\"game-type-info\">\r\n                                        <strong>{type.name}</strong>\r\n                                        <small>{type.description}</small>\r\n                                    </div>\r\n                                </label>\r\n                            ))}\r\n                        </div>\r\n                        <button onClick={() => setShowRules(!showRules)} className=\"rules-toggle-btn\">\r\n                            {showRules ? '규칙 숨기기' : '규칙 보기'}\r\n                        </button>\r\n\r\n                        {showRules && (\r\n                            <div className=\"rules-display\">\r\n                                <h4>{GONU_TYPES[selectedGameType].name} 규칙</h4>\r\n                                <ul>\r\n                                    {GONU_TYPES[selectedGameType].rules.map((rule, idx) => <li key={idx}>{rule}</li>)}\r\n                                </ul>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"room-actions\">\r\n                        {gameMode === 'ai' ? (\r\n                            <button onClick={handleStartAIGame} className=\"create-room-btn\" disabled={loading}>\r\n                                🤖 AI와 대전 시작\r\n                            </button>\r\n                        ) : (\r\n                            <>\r\n                                <button onClick={handleCreateRoom} className=\"create-room-btn\" disabled={loading}>\r\n                                    {loading ? <span className=\"loading\"></span> : '새로운 방 만들기'}\r\n                                </button>\r\n\r\n                                <div className=\"join-room\">\r\n                                    <input type=\"text\" value={newRoomId} onChange={(e) => setNewRoomId(e.target.value)} placeholder=\"방 코드 입력\" maxLength=\"6\" />\r\n                                    <button onClick={() => handleJoinRoom()} disabled={loading}>{loading ? <span className=\"loading\"></span> : '코드로 참가'}</button>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {gameMode === 'pvp' && availableRooms.length > 0 && (\r\n                        <div className=\"available-rooms\">\r\n                            <h3>📋 대기 중인 방 목록</h3>\r\n                            <div className=\"rooms-list\">\r\n                                {availableRooms.map((room) => (\r\n                                    <div key={room.id} className=\"room-item\">\r\n                                        <div className=\"room-info\">\r\n                                            <span className=\"room-type\">{room.gameName}</span>\r\n                                            <span className=\"room-host\">호스트: {room.playerNames.B}</span>\r\n                                            <span className=\"room-code\">코드: {room.id}</span>\r\n                                        </div>\r\n                                        <div className=\"room-item-buttons\">\r\n                                            <button onClick={() => handleJoinRoom(room.id)} className=\"join-btn\" disabled={loading}>참가</button>\r\n                                            {userDoc?.isAdmin && (\r\n                                                <button onClick={() => handleAdminDeleteRoom(room.id)} className=\"delete-btn\">삭제</button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 온라인 게임 로딩\r\n    if (!localGame && !gameData) {\r\n        return <AlchanLoading />;\r\n    }\r\n\r\n    const currentGameType = localGame?.gameType || gameData?.gameType || 'umul';\r\n    const currentStatus = localGame?.status || gameData?.status;\r\n    const currentWinner = localGame?.winner || gameData?.winner;\r\n    const currentTurn = localGame?.turn || gameData?.turn;\r\n\r\n    return (\r\n        <div className=\"gonu-container\">\r\n            <div className=\"game-info\">\r\n                <h2>\r\n                    {GONU_TYPES[currentGameType].name}\r\n                    {localGame && ' (AI 대전)'}\r\n                    {gameId && ` (방: ${gameId})`}\r\n                </h2>\r\n\r\n                {!localGame && (\r\n                    <div className=\"player-info\">\r\n                        <p className={`player-b ${currentTurn === 'B' ? 'active-turn' : ''}`}>\r\n                            🔵 {gameData?.playerNames?.B || '플레이어 1'} {gameData?.players?.B === user?.uid && '(나)'}\r\n                        </p>\r\n                        <p className={`player-r ${currentTurn === 'R' ? 'active-turn' : ''}`}>\r\n                            🔴 {gameData?.playerNames?.R || '대기중...'} {gameData?.players?.R === user?.uid && '(나)'}\r\n                        </p>\r\n                    </div>\r\n                )}\r\n\r\n                {localGame && (\r\n                    <div className=\"player-info\">\r\n                        <p className={`player-b ${currentTurn === 'B' ? 'active-turn' : ''}`}>\r\n                            🔵 나 (파랑)\r\n                        </p>\r\n                        <p className={`player-r ${currentTurn === 'R' ? 'active-turn' : ''}`}>\r\n                            🔴 AI (적) {aiThinking && '🤔 생각 중...'}\r\n                        </p>\r\n                    </div>\r\n                )}\r\n\r\n                {currentStatus === 'finished' ? (\r\n                    <div className=\"game-status winner\">\r\n                        {localGame ? (\r\n                            currentWinner === 'B' ? '🎉 승리했습니다!' : '😢 AI에게 패배했습니다.'\r\n                        ) : (\r\n                            currentWinner === myColor ? '🎉 승리! 쿠폰 1개를 획득했습니다!' : '😢 패배했습니다.'\r\n                        )}\r\n                    </div>\r\n                ) : currentStatus === 'waiting' ? (\r\n                    <div className=\"game-status\">상대방을 기다리는 중...</div>\r\n                ) : pendingCapture ? (\r\n                    <div className=\"game-status capture-mode\">🎯 제거할 상대 말을 선택하세요!</div>\r\n                ) : (\r\n                    <div className=\"game-status\">\r\n                        {localGame ? (\r\n                            currentTurn === 'B' ? \"🎯 당신의 턴입니다.\" : \"⏳ AI가 생각 중...\"\r\n                        ) : (\r\n                            isMyTurn ? \"🎯 당신의 턴입니다.\" : \"⏳ 상대방의 턴을 기다리는 중...\"\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"board-area\">\r\n                {renderBoard()}\r\n            </div>\r\n\r\n            {feedback.message && <div className={`feedback ${feedback.type}`}>{feedback.message}</div>}\r\n\r\n            <button onClick={handleLeaveGame} className=\"leave-button\">\r\n                {currentStatus === 'finished' ? '나가기' : '게임 나가기'}\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GonuGame;\r\n"],"names":["UMUL_VALID_MOVES","HOBAK_NODES","id","x","y","isHome","HOBAK_ADJACENCY","BAT_NODES","row","col","push","BAT_EDGES","BAT_ADJACENCY","i","forEach","_ref","a","b","GONU_TYPES","umul","name","description","rules","nodes","edges","adjacency","initialPieces","piecesPerPlayer","boardWidth","boardHeight","firstMoveRestriction","from","to","checkWin","pieces","currentPlayer","opponent","opponentPieces","Object","entries","filter","_ref2","color","map","_ref3","nodeId","parseInt","moves","target","isWell","hobak","_ref4","_ref5","targetNode","find","n","getHomeNode","bat","blackCount","values","c","length","redCount","checkThreeInRow","node","startCol","Math","max","min","count","startRow","r","offset","d","deserializePieces","data","result","key","GonuGame","_gameData$playerNames","_gameData$players","_gameData$playerNames2","_gameData$players2","user","userDoc","useAuth","gameId","setGameId","useState","gameData","setGameData","showCreateRoom","setShowCreateRoom","newRoomId","setNewRoomId","feedback","setFeedback","message","type","selectedPiece","setSelectedPiece","selectedGameType","setSelectedGameType","availableRooms","setAvailableRooms","showRules","setShowRules","loading","setLoading","gameMode","setGameMode","aiThinking","setAiThinking","validMoves","setValidMoves","pendingCapture","setPendingCapture","localGame","setLocalGame","isMyTurn","turn","players","B","uid","myColor","gameIdRef","useRef","useEffect","current","gameDataRef","userRef","cleanup","currentGameId","currentGameData","currentUser","status","deleteDoc","doc","db","window","addEventListener","removeEventListener","undefined","currentPieces","gameType","config","currentColor","pieceId","targets","moveCount","fetchAvailableRooms","useCallback","async","q","query","collection","where","querySnapshot","getDocs","rooms","_objectSpread","error","console","interval","setInterval","clearInterval","fetchGameData","gameDocRef","docSnap","getDoc","exists","rawData","setTimeout","usePolling","enabled","timer","clearTimeout","aiTimerRef","localGameRef","currentGame","move","getAIMove","aiColor","opponentColor","aiPieces","_ref6","_ref7","possibleMoves","fromNode","toNode","targetNodeInfo","scoredMoves","score","simulatedPieces","_ref8","_ref9","opponentMoves","abs","random","sort","newPieces","playerPieces","_ref0","_ref1","floor","winner","handleStartAIGame","handleCreateRoom","newGameId","toString","substring","gameRef","initialGameData","R","playerNames","gameName","createdAt","serverTimestamp","setDoc","concat","handleJoinRoom","targetRoomId","roomIdToJoin","trim","runTransaction","gameDoc","transaction","get","Error","update","handleCaptureClick","capturer","prev","handleMove","includes","currentData","userDocRef","coupons","increment","logActivity","classCode","userId","userName","ACTIVITY_TYPES","GAME_WIN","couponAmount","metadata","gameVariant","_jsx","className","children","_jsxs","onClick","_ref11","value","checked","onChange","e","rule","idx","disabled","_Fragment","placeholder","maxLength","room","isAdmin","roomId","handleAdminDeleteRoom","AlchanLoading","currentGameType","currentStatus","currentWinner","currentTurn","renderBoard","width","height","viewBox","style","maxWidth","fill","rx","cx","cy","stroke","strokeWidth","x1","y1","x2","y2","_ref10","piece","isSelected","isValidMove","isPendingCapture","handleNodeClick","cursor","textAnchor","fontSize","fontWeight","opacity"],"sourceRoot":""}