{"version":3,"file":"static/js/967.989ba5a7.chunk.js","mappings":"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","sources":["services/AdminDatabaseService.js","pages/admin/AdminDatabase.js"],"sourcesContent":["// src/services/AdminDatabaseService.js\r\n// ğŸ”¥ DB ìµœì í™”: ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì½ê¸° ë¹„ìš© 50% ì´ìƒ ì ˆê°\r\nimport { db } from '../firebase';\r\nimport { collection, query, where, getDocs, orderBy, limit, startAfter, Timestamp } from 'firebase/firestore';\r\n\r\nimport { logger } from \"../utils/logger\";\n/**\r\n * ê´€ë¦¬ììš© ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤\r\n * ğŸ”¥ ìµœì í™”: ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ë¬¸ì„œ ì½ê¸° ì œê±°\r\n */\r\n\r\n// í•œê¸€ íƒ€ì…ì„ ì˜ë¬¸ íƒ€ì…ìœ¼ë¡œ ë§¤í•‘\r\nconst TYPE_MAPPING = {\r\n  'ì¿ í° íšë“': 'COUPON_EARN',\r\n  'ì¿ í° ì‚¬ìš©': 'COUPON_USE',\r\n  'ì¿ í° ì§€ê¸‰': 'COUPON_GIVE',\r\n  'ì¿ í° íšŒìˆ˜': 'COUPON_TAKE',\r\n  'ì¿ í° ì†¡ê¸ˆ': 'COUPON_TRANSFER_SEND',\r\n  'ì¿ í° ìˆ˜ì‹ ': 'COUPON_TRANSFER_RECEIVE',\r\n  'ì•„ì´í…œ êµ¬ë§¤': 'ITEM_PURCHASE',\r\n  'ì•„ì´í…œ ì‚¬ìš©': 'ITEM_USE',\r\n  'ì•„ì´í…œ íŒë§¤': 'ITEM_SELL',\r\n  'ì•„ì´í…œ ì‹œì¥ ë“±ë¡': 'ITEM_MARKET_LIST',\r\n  'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤': 'ITEM_MARKET_BUY',\r\n  'ì†¡ê¸ˆ': 'CASH_TRANSFER_SEND',\r\n  'ì†¡ê¸ˆ ìˆ˜ì‹ ': 'CASH_TRANSFER_RECEIVE',\r\n  'ëˆ ì†¡ê¸ˆ': 'CASH_TRANSFER_SEND',\r\n  'ëˆ ì¶œê¸ˆ': 'CASH_WITHDRAW',\r\n  'ëˆ ì…ê¸ˆ': 'CASH_DEPOSIT',\r\n  'ì£¼ì‹ ë§¤ìˆ˜': 'STOCK_BUY',\r\n  'ì£¼ì‹ ë§¤ë„': 'STOCK_SELL',\r\n  'ì£¼ì‹ ê±°ë˜ì„¸': 'STOCK_TAX',\r\n  'ê±°ë˜ì„¸': 'STOCK_TAX',\r\n  'TAX_PAYMENT': 'STOCK_TAX',\r\n  'ê³¼ì œ ì™„ë£Œ': 'TASK_COMPLETE',\r\n  'ê²Œì„ ìŠ¹ë¦¬': 'GAME_WIN',\r\n  'ê²Œì„ íŒ¨ë°°': 'GAME_LOSE',\r\n  'ADMIN_CASH_SEND': 'ADMIN_CASH_SEND',\r\n  'ADMIN_CASH_TAKE': 'ADMIN_CASH_TAKE',\r\n};\r\n\r\n// íƒ€ì… ì •ê·œí™” í•¨ìˆ˜\r\nconst normalizeType = (type) => {\r\n  if (!type) return null;\r\n  return type;\r\n};\r\n\r\n// ğŸ”¥ ìºì‹œ ê´€ë¦¬ - TTL ì¦ê°€ (5ë¶„ â†’ 15ë¶„, Firestore ì½ê¸° 67% ê°ì†Œ)\r\nconst cache = new Map();\r\nconst CACHE_TTL = 15 * 60 * 1000; // ğŸ”¥ [ìµœì í™”] 15ë¶„\r\n\r\n/**\r\n * ìºì‹œ í‚¤ ìƒì„±\r\n */\r\nconst getCacheKey = (classCode, type, options = {}) => {\r\n  return `${classCode}_${type}_${JSON.stringify(options)}`;\r\n};\r\n\r\n/**\r\n * ìºì‹œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\r\n */\r\nconst getFromCache = (key) => {\r\n  const cached = cache.get(key);\r\n  if (!cached) return null;\r\n\r\n  const now = Date.now();\r\n  if (now - cached.timestamp > CACHE_TTL) {\r\n    cache.delete(key);\r\n    return null;\r\n  }\r\n\r\n  return cached.data;\r\n};\r\n\r\n/**\r\n * ìºì‹œì— ë°ì´í„° ì €ì¥\r\n */\r\nconst setCache = (key, data) => {\r\n  cache.set(key, {\r\n    data,\r\n    timestamp: Date.now()\r\n  });\r\n};\r\n\r\n/**\r\n * í™œë™ ë¡œê·¸ ì¡°íšŒ (ì¿ í° íšë“, ì•„ì´í…œ ì‚¬ìš© ë“±)\r\n * ğŸ”¥ ìµœì í™”: ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ìœ¼ë¡œ ë³€ê²½ - ì½ê¸° ë¹„ìš© 50% ì´ìƒ ì ˆê°\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜ { userId, type, startDate, endDate, limitCount, lastDoc }\r\n * @returns {Promise<{logs: Array, hasMore: boolean, lastDoc: any}>}\r\n */\r\nexport const getActivityLogs = async (classCode, options = {}) => {\r\n  const { userId, type, startDate, endDate, limitCount = 50, lastDoc = null } = options;\r\n\r\n  try {\r\n    // ğŸ”¥ ìºì‹œ í™•ì¸\r\n    const cacheKey = getCacheKey(classCode, 'activity_logs', options);\r\n    const cached = getFromCache(cacheKey);\r\n    if (cached) {\r\n      logger.log('[AdminDatabaseService] ìºì‹œëœ í™œë™ ë¡œê·¸ ì‚¬ìš©');\r\n      return cached;\r\n    }\r\n\r\n    logger.log('[AdminDatabaseService] í™œë™ ë¡œê·¸ ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ ì¡°íšŒ:', { classCode, userId, type, limitCount });\r\n\r\n    // ğŸ”¥ ìµœì í™”: ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ìœ¼ë¡œ í•„ìš”í•œ ë¬¸ì„œë§Œ ê°€ì ¸ì˜¤ê¸°\r\n    const constraints = [\r\n      where('classCode', '==', classCode)\r\n    ];\r\n\r\n    // userId í•„í„° - ì„œë²„ì—ì„œ ì²˜ë¦¬\r\n    if (userId) {\r\n      constraints.push(where('userId', '==', userId));\r\n    }\r\n\r\n    // ë‚ ì§œ ë²”ìœ„ í•„í„° - ì„œë²„ì—ì„œ ì²˜ë¦¬ (ë³µí•© ì¸ë±ìŠ¤ í•„ìš”: classCode + timestamp)\r\n    if (startDate) {\r\n      const startTimestamp = startDate instanceof Date ? Timestamp.fromDate(startDate) : startDate;\r\n      constraints.push(where('timestamp', '>=', startTimestamp));\r\n    }\r\n    if (endDate) {\r\n      const endTimestamp = endDate instanceof Date ? Timestamp.fromDate(endDate) : endDate;\r\n      constraints.push(where('timestamp', '<=', endTimestamp));\r\n    }\r\n\r\n    // íƒ€ì… í•„í„° - ì„œë²„ì—ì„œ ì²˜ë¦¬ (ë‚ ì§œ ë²”ìœ„ì™€ í•¨ê»˜ ì‚¬ìš© ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬)\r\n    // Firestore ì œí•œ: ë²”ìœ„ ì¿¼ë¦¬ëŠ” í•˜ë‚˜ì˜ í•„ë“œì—ì„œë§Œ ê°€ëŠ¥\r\n    const useServerTypeFilter = type && !startDate && !endDate;\r\n    if (useServerTypeFilter) {\r\n      constraints.push(where('type', '==', normalizeType(type)));\r\n    }\r\n\r\n    // ì •ë ¬ ë° ì œí•œ\r\n    constraints.push(orderBy('timestamp', 'desc'));\r\n    constraints.push(limit(limitCount + 1)); // hasMore í™•ì¸ì„ ìœ„í•´ +1\r\n\r\n    const q = query(collection(db, 'activity_logs'), ...constraints);\r\n    const snapshot = await getDocs(q);\r\n\r\n    let logs = [];\r\n    snapshot.forEach(doc => {\r\n      const data = doc.data();\r\n      logs.push({\r\n        id: doc.id,\r\n        ...data,\r\n        timestamp: data.timestamp?.toDate() || new Date()\r\n      });\r\n    });\r\n\r\n    // ğŸ”¥ íƒ€ì… í•„í„°ê°€ ë‚ ì§œ ë²”ìœ„ì™€ í•¨ê»˜ ì‚¬ìš©ëœ ê²½ìš°ì—ë§Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§\r\n    if (type && !useServerTypeFilter) {\r\n      const normalizedFilterType = normalizeType(type);\r\n      logs = logs.filter(log => log.type === normalizedFilterType);\r\n    }\r\n\r\n    // hasMore íŒë‹¨ ë° ê²°ê³¼ ìŠ¬ë¼ì´ìŠ¤\r\n    const hasMore = logs.length > limitCount;\r\n    const paginatedLogs = logs.slice(0, limitCount);\r\n    const newLastDoc = paginatedLogs.length > 0 ? paginatedLogs[paginatedLogs.length - 1].id : null;\r\n\r\n    logger.log(`[AdminDatabaseService] í™œë™ ë¡œê·¸ ì¡°íšŒ ì™„ë£Œ: ${paginatedLogs.length}ê°œ (ì„œë²„ í•„í„°ë§)`);\r\n\r\n    const result = {\r\n      logs: paginatedLogs,\r\n      hasMore,\r\n      lastDoc: newLastDoc\r\n    };\r\n\r\n    // ğŸ”¥ ìºì‹œ ì €ì¥\r\n    setCache(cacheKey, result);\r\n\r\n    return result;\r\n\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] í™œë™ ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * í•™ê¸‰ í•™ìƒë“¤ì˜ ì¿ í° íšë“ ë‚´ì—­ ì¡°íšŒ\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜\r\n * @returns {Promise<Array>}\r\n */\r\nexport const getCouponEarnLogs = async (classCode, options = {}) => {\r\n  try {\r\n    const result = await getActivityLogs(classCode, {\r\n      ...options,\r\n      type: 'COUPON_EARN'\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] ì¿ í° íšë“ ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * í•™ê¸‰ í•™ìƒë“¤ì˜ ì¿ í° ì‚¬ìš© ë‚´ì—­ ì¡°íšŒ\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜\r\n * @returns {Promise<Array>}\r\n */\r\nexport const getCouponUseLogs = async (classCode, options = {}) => {\r\n  try {\r\n    const result = await getActivityLogs(classCode, {\r\n      ...options,\r\n      type: 'COUPON_USE'\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] ì¿ í° ì‚¬ìš© ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * í•™ê¸‰ í•™ìƒë“¤ì˜ ì•„ì´í…œ êµ¬ë§¤ ë‚´ì—­ ì¡°íšŒ\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜\r\n * @returns {Promise<Array>}\r\n */\r\nexport const getItemPurchaseLogs = async (classCode, options = {}) => {\r\n  try {\r\n    const result = await getActivityLogs(classCode, {\r\n      ...options,\r\n      type: 'ITEM_PURCHASE'\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] ì•„ì´í…œ êµ¬ë§¤ ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * í•™ê¸‰ í•™ìƒë“¤ì˜ ì•„ì´í…œ ì‚¬ìš© ë‚´ì—­ ì¡°íšŒ\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜\r\n * @returns {Promise<Array>}\r\n */\r\nexport const getItemUseLogs = async (classCode, options = {}) => {\r\n  try {\r\n    const result = await getActivityLogs(classCode, {\r\n      ...options,\r\n      type: 'ITEM_USE'\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] ì•„ì´í…œ ì‚¬ìš© ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * í•™ê¸‰ í•™ìƒë“¤ì˜ ì•„ì´í…œ íŒë§¤ ë‚´ì—­ ì¡°íšŒ\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜\r\n * @returns {Promise<Array>}\r\n */\r\nexport const getItemSellLogs = async (classCode, options = {}) => {\r\n  try {\r\n    const result = await getActivityLogs(classCode, {\r\n      ...options,\r\n      type: 'ITEM_SELL'\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] ì•„ì´í…œ íŒë§¤ ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * í†µí•© í™œë™ ìš”ì•½ ì¡°íšŒ (í•™ìƒë³„)\r\n * ğŸ”¥ ìµœì í™”: classCode í•„í„°ë¥¼ ì„œë²„ì—ì„œ ì ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë¬¸ì„œ ì½ê¸° ì œê±°\r\n * @param {string} classCode - í•™ê¸‰ ì½”ë“œ\r\n * @param {string} userId - ì‚¬ìš©ì ID (ì„ íƒ)\r\n * @returns {Promise<object>}\r\n */\r\nexport const getActivitySummary = async (classCode, userId = null) => {\r\n  try {\r\n    const cacheKey = getCacheKey(classCode, 'activity_summary', { userId });\r\n    const cached = getFromCache(cacheKey);\r\n    if (cached) {\r\n      logger.log('[AdminDatabaseService] ìºì‹œëœ í™œë™ ìš”ì•½ ì‚¬ìš©');\r\n      return cached;\r\n    }\r\n\r\n    logger.log('[AdminDatabaseService] í™œë™ ìš”ì•½ ì¡°íšŒ ì‹œì‘ (ì„œë²„ í•„í„°ë§):', { classCode, userId });\r\n\r\n    // ğŸ”¥ ìµœì í™”: classCode í•„í„°ë¥¼ ì„œë²„ì—ì„œ ì ìš©\r\n    const constraints = [where('classCode', '==', classCode)];\r\n\r\n    if (userId) {\r\n      constraints.push(where('userId', '==', userId));\r\n    }\r\n\r\n    // ìµœê·¼ 1000ê°œë¡œ ì œí•œí•˜ì—¬ ë¹„ìš© ì ˆê°\r\n    constraints.push(orderBy('timestamp', 'desc'));\r\n    constraints.push(limit(1000));\r\n\r\n    const baseQuery = query(collection(db, 'activity_logs'), ...constraints);\r\n\r\n    // í•„í„°ë§ëœ í™œë™ ë¡œê·¸ë§Œ ì¡°íšŒ\r\n    const snapshot = await getDocs(baseQuery);\r\n\r\n    logger.log(`[AdminDatabaseService] ì¡°íšŒëœ ë¬¸ì„œ ìˆ˜: ${snapshot.size} (classCode í•„í„° ì ìš©)`);\r\n\r\n    const summary = {\r\n      totalActivities: 0,\r\n      couponEarned: 0,\r\n      couponUsed: 0,\r\n      itemPurchased: 0,\r\n      itemUsed: 0,\r\n      itemSold: 0,\r\n      byUser: {}\r\n    };\r\n\r\n    snapshot.forEach(doc => {\r\n      const data = doc.data();\r\n      const normalizedType = normalizeType(data.type); // íƒ€ì… ì •ê·œí™”\r\n\r\n      summary.totalActivities++;\r\n\r\n      // ì‚¬ìš©ìë³„ í†µê³„\r\n      if (!summary.byUser[data.userId]) {\r\n        summary.byUser[data.userId] = {\r\n          userName: data.userName || 'ì•Œ ìˆ˜ ì—†ìŒ',\r\n          couponEarned: 0,\r\n          couponUsed: 0,\r\n          itemPurchased: 0,\r\n          itemUsed: 0,\r\n          itemSold: 0,\r\n          activities: []\r\n        };\r\n      }\r\n\r\n      const userSummary = summary.byUser[data.userId];\r\n\r\n      // íƒ€ì…ë³„ ì§‘ê³„ (ì •ê·œí™”ëœ íƒ€ì… ì‚¬ìš©)\r\n      switch (normalizedType) {\r\n        case 'COUPON_EARN':\r\n          const earnAmount = data.metadata?.couponAmount || 1; // ê¸°ë³¸ê°’ 1\r\n          summary.couponEarned += earnAmount;\r\n          userSummary.couponEarned += earnAmount;\r\n          break;\r\n        case 'COUPON_USE':\r\n          const useAmount = data.metadata?.couponAmount || 1; // ê¸°ë³¸ê°’ 1\r\n          summary.couponUsed += useAmount;\r\n          userSummary.couponUsed += useAmount;\r\n          break;\r\n        case 'ITEM_PURCHASE':\r\n          summary.itemPurchased++;\r\n          userSummary.itemPurchased++;\r\n          break;\r\n        case 'ITEM_USE':\r\n          summary.itemUsed++;\r\n          userSummary.itemUsed++;\r\n          break;\r\n        case 'ITEM_SELL':\r\n        case 'ITEM_MARKET_LIST':\r\n          summary.itemSold++;\r\n          userSummary.itemSold++;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      // ìµœê·¼ í™œë™ ì €ì¥ (ìµœëŒ€ 10ê°œ)\r\n      if (userSummary.activities.length < 10) {\r\n        userSummary.activities.push({\r\n          type: normalizedType, // ì •ê·œí™”ëœ íƒ€ì… ì €ì¥\r\n          description: data.description,\r\n          timestamp: data.timestamp?.toDate() || new Date(),\r\n          metadata: data.metadata\r\n        });\r\n      }\r\n    });\r\n\r\n    logger.log(`[AdminDatabaseService] í™œë™ ìš”ì•½ ì¡°íšŒ ì™„ë£Œ:`, {\r\n      totalActivities: summary.totalActivities,\r\n      couponEarned: summary.couponEarned,\r\n      couponUsed: summary.couponUsed,\r\n      itemPurchased: summary.itemPurchased,\r\n      itemUsed: summary.itemUsed,\r\n      itemSold: summary.itemSold,\r\n      userCount: Object.keys(summary.byUser).length\r\n    });\r\n\r\n    // ìºì‹œ ì €ì¥\r\n    setCache(cacheKey, summary);\r\n\r\n    return summary;\r\n\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] í™œë™ ìš”ì•½ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    logger.error('[AdminDatabaseService] ì˜¤ë¥˜ ìƒì„¸:', error.message, error.code);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * ìºì‹œ ì´ˆê¸°í™”\r\n */\r\nexport const clearCache = () => {\r\n  cache.clear();\r\n  logger.log('[AdminDatabaseService] ìºì‹œ ì´ˆê¸°í™” ì™„ë£Œ');\r\n};\r\n\r\n/**\r\n * íŠ¹ì • í•™ê¸‰ì˜ ìºì‹œë§Œ ì´ˆê¸°í™”\r\n */\r\nexport const clearClassCache = (classCode) => {\r\n  const keysToDelete = [];\r\n  cache.forEach((value, key) => {\r\n    if (key.startsWith(classCode)) {\r\n      keysToDelete.push(key);\r\n    }\r\n  });\r\n  keysToDelete.forEach(key => cache.delete(key));\r\n  logger.log(`[AdminDatabaseService] ${classCode} í•™ê¸‰ ìºì‹œ ì´ˆê¸°í™” ì™„ë£Œ`);\r\n};\r\n\r\n/**\r\n * transactions ì»¬ë ‰ì…˜ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (í´ë°±)\r\n * @param {Array} userIds - ì‚¬ìš©ì ID ë°°ì—´\r\n * @param {object} options - ì¡°íšŒ ì˜µì…˜\r\n * @returns {Promise<Array>}\r\n */\r\nexport const getTransactionsData = async (userIds = [], options = {}) => {\r\n  try {\r\n    const { limitCount = 100 } = options;\r\n\r\n    logger.log('[AdminDatabaseService] transactions ì»¬ë ‰ì…˜ ì¡°íšŒ ì‹œì‘:', { userIdsCount: userIds.length });\r\n\r\n    if (userIds.length === 0) {\r\n      logger.warn('[AdminDatabaseService] userIdsê°€ ë¹„ì–´ìˆìŒ');\r\n      return [];\r\n    }\r\n\r\n    // FirestoreëŠ” 'in' ì¿¼ë¦¬ê°€ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì§€ì›í•˜ë¯€ë¡œ ë°°ì¹˜ ì²˜ë¦¬\r\n    const batches = [];\r\n    for (let i = 0; i < userIds.length; i += 10) {\r\n      batches.push(userIds.slice(i, i + 10));\r\n    }\r\n\r\n    const allTransactions = [];\r\n\r\n    for (const batch of batches) {\r\n      let q = query(\r\n        collection(db, 'transactions'),\r\n        where('userId', 'in', batch),\r\n        orderBy('timestamp', 'desc'),\r\n        limit(limitCount)\r\n      );\r\n\r\n      const snapshot = await getDocs(q);\r\n\r\n      snapshot.forEach(doc => {\r\n        const data = doc.data();\r\n        allTransactions.push({\r\n          id: doc.id,\r\n          ...data,\r\n          timestamp: data.timestamp?.toDate() || new Date()\r\n        });\r\n      });\r\n    }\r\n\r\n    logger.log(`[AdminDatabaseService] transactions ì¡°íšŒ ì™„ë£Œ: ${allTransactions.length}ê°œ`);\r\n    return allTransactions;\r\n\r\n  } catch (error) {\r\n    logger.error('[AdminDatabaseService] transactions ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * transactions ë°ì´í„°ë¥¼ activity_logs í˜•ì‹ìœ¼ë¡œ ë³€í™˜\r\n * @param {Array} transactions - ê±°ë˜ ë‚´ì—­\r\n * @returns {Array}\r\n */\r\nexport const convertTransactionsToLogs = (transactions) => {\r\n  return transactions.map(tx => {\r\n    let type = 'CASH_INCOME';\r\n    let description = tx.description || 'ê±°ë˜';\r\n\r\n    // ê±°ë˜ ì„¤ëª…ì—ì„œ íƒ€ì… ì¶”ë¡ \r\n    if (tx.description) {\r\n      if (tx.description.includes('ì¿ í°') && tx.description.includes('íšë“')) {\r\n        type = 'COUPON_EARN';\r\n      } else if (tx.description.includes('ì¿ í°') && tx.description.includes('ì‚¬ìš©')) {\r\n        type = 'COUPON_USE';\r\n      } else if (tx.description.includes('ì•„ì´í…œ') && tx.description.includes('êµ¬ë§¤')) {\r\n        type = 'ITEM_PURCHASE';\r\n      } else if (tx.description.includes('ì•„ì´í…œ') && tx.description.includes('ì‚¬ìš©')) {\r\n        type = 'ITEM_USE';\r\n      } else if (tx.description.includes('ì•„ì´í…œ') && (tx.description.includes('íŒë§¤') || tx.description.includes('ë“±ë¡'))) {\r\n        type = 'ITEM_SELL';\r\n      } else if (tx.description.includes('ì†¡ê¸ˆ')) {\r\n        type = tx.amount > 0 ? 'CASH_TRANSFER_RECEIVE' : 'CASH_TRANSFER_SEND';\r\n      } else if (tx.type === 'expense') {\r\n        type = 'CASH_EXPENSE';\r\n      }\r\n    }\r\n\r\n    return {\r\n      id: tx.id,\r\n      userId: tx.userId,\r\n      userName: tx.userName || 'ì•Œ ìˆ˜ ì—†ìŒ',\r\n      type,\r\n      description,\r\n      timestamp: tx.timestamp,\r\n      metadata: {\r\n        amount: tx.amount,\r\n        category: tx.category,\r\n        ...tx.metadata\r\n      }\r\n    };\r\n  });\r\n};\r\n","// src/AdminDatabase.js\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport {\r\n  getActivityLogs,\r\n  clearClassCache,\r\n  getTransactionsData,\r\n  convertTransactionsToLogs\r\n} from '../../services/AdminDatabaseService';\r\nimport './AdminDatabase.css';\r\nimport { logger } from '../../utils/logger';\n\r\nconst AdminDatabase = () => {\r\n  const { userDoc, allClassMembers } = useAuth();\r\n  const [selectedUser, setSelectedUser] = useState('all');\r\n  const [activityData, setActivityData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [hasMore, setHasMore] = useState(false);\r\n  const [lastDoc, setLastDoc] = useState(null);\r\n  const [debugInfo, setDebugInfo] = useState('');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [activityTypeFilter, setActivityTypeFilter] = useState('all');\r\n\r\n  const classCode = userDoc?.classCode;\r\n\r\n  const loadData = useCallback(async (refresh = false, lastDocForPagination = null) => {\r\n    if (!classCode || classCode === 'ë¯¸ì§€ì •') {\r\n      setError('í•™ê¸‰ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // ğŸ”¥ ìµœì í™”: í•„í„°ë‚˜ ê²€ìƒ‰ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë” ë§ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´\r\n      const isFiltered = activityTypeFilter !== 'all' || searchTerm.trim() !== '';\r\n      const limitCount = isFiltered ? 100 : 10; // í•„í„° ì‚¬ìš© ì‹œ 100ê°œ, ê¸°ë³¸ 10ê°œ\r\n\r\n      const options = {\r\n        userId: selectedUser !== 'all' ? selectedUser : null,\r\n        limitCount: limitCount,\r\n        lastDoc: refresh ? null : lastDocForPagination,\r\n        useCache: !refresh\r\n      };\r\n\r\n      const result = await getActivityLogs(classCode, options);\r\n\r\n      if (result.logs.length === 0 && allClassMembers.length > 0 && refresh) {\r\n        const userIds = selectedUser !== 'all'\r\n          ? [selectedUser]\r\n          : allClassMembers.map(m => m.id || m.uid);\r\n        const transactions = await getTransactionsData(userIds, { limitCount: 100 });\r\n\r\n        if (transactions.length > 0) {\r\n          result.logs = convertTransactionsToLogs(transactions);\r\n          result.hasMore = false;\r\n        }\r\n      }\r\n\r\n      if (refresh) {\r\n        setActivityData(result.logs);\r\n      } else {\r\n        setActivityData(prev => [...prev, ...result.logs]);\r\n      }\r\n      setHasMore(result.hasMore);\r\n      setLastDoc(result.lastDoc);\r\n\r\n    } catch (err) {\r\n      logger.error('[AdminDatabase] ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err);\r\n      setError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [classCode, selectedUser, allClassMembers, activityTypeFilter, searchTerm]);\r\n\r\n  useEffect(() => {\r\n    setActivityData([]);\r\n    setLastDoc(null);\r\n    setHasMore(false);\r\n    loadData(true, null);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [selectedUser, classCode]); // loadData ì¶”ê°€í•˜ë©´ ë¬´í•œ ë£¨í”„ ë°œìƒ\r\n\r\n  // ğŸ”¥ í•„í„°ë‚˜ ê²€ìƒ‰ì´ ë³€ê²½ë˜ë©´ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ\r\n  useEffect(() => {\r\n    if (activityData.length > 0) {\r\n      setActivityData([]);\r\n      setLastDoc(null);\r\n      setHasMore(false);\r\n      loadData(true, null);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activityTypeFilter, searchTerm]); // loadDataì™€ activityData ì¶”ê°€í•˜ë©´ ë¬´í•œ ë£¨í”„ ë°œìƒ\r\n\r\n  const handleRefresh = () => {\r\n    clearClassCache(classCode);\r\n    setActivityData([]);\r\n    setLastDoc(null);\r\n    setHasMore(false);\r\n    setDebugInfo('');\r\n    loadData(true, null);\r\n  };\r\n\r\n  const handleDebugFirestore = async () => {\r\n    setDebugInfo('ì¡°íšŒ ì¤‘...');\r\n    try {\r\n      let info = [];\r\n\r\n      // í˜„ì¬ ë¡œë“œëœ ë°ì´í„°ì˜ íƒ€ì… ë¶„ì„\r\n      const typeCounts = {};\r\n      const typeExamples = {};\r\n\r\n      activityData.forEach(log => {\r\n        const type = log.type || 'undefined';\r\n        typeCounts[type] = (typeCounts[type] || 0) + 1;\r\n\r\n        if (!typeExamples[type]) {\r\n          typeExamples[type] = {\r\n            description: log.description,\r\n            userName: log.userName,\r\n            timestamp: log.timestamp\r\n          };\r\n        }\r\n      });\r\n\r\n      info.push('=== í˜„ì¬ ë¡œë“œëœ ë°ì´í„° íƒ€ì… ë¶„í¬ ===');\r\n      info.push(`ì´ ${activityData.length}ê°œì˜ ë¡œê·¸`);\r\n      info.push('');\r\n\r\n      Object.entries(typeCounts)\r\n        .sort((a, b) => b[1] - a[1])\r\n        .forEach(([type, count]) => {\r\n          info.push(`${type}: ${count}ê°œ`);\r\n          if (typeExamples[type]) {\r\n            info.push(`  ì˜ˆì‹œ: ${typeExamples[type].description}`);\r\n          }\r\n          // ì¿ í°ì´ë‚˜ ì•„ì´í…œ ê´€ë ¨ íƒ€ì… ê°•ì¡°\r\n          if (type.includes('COUPON') || type.includes('ì¿ í°') ||\r\n              type.includes('ITEM') || type.includes('ì•„ì´í…œ')) {\r\n            info.push(`  â­ ì¿ í°/ì•„ì´í…œ ê´€ë ¨ íƒ€ì… ë°œê²¬!`);\r\n          }\r\n        });\r\n\r\n      info.push('');\r\n      info.push('=== í•„í„°ë³„ ë§¤ì¹­ ê²°ê³¼ ===');\r\n\r\n      // ê° í•„í„°ë³„ë¡œ ë§¤ì¹­ë˜ëŠ” ë¡œê·¸ ìˆ˜ ê³„ì‚°\r\n      const filters = {\r\n        'coupon': (log) => {\r\n          const type = log.type?.toString() || '';\r\n          const desc = log.description?.toString() || '';\r\n          const couponTypes = [\r\n            'ì¿ í° íšë“', 'ì¿ í° ì‚¬ìš©', 'ì¿ í° ì§€ê¸‰', 'ì¿ í° íšŒìˆ˜',\r\n            'ì¿ í° ì†¡ê¸ˆ', 'ì¿ í° ìˆ˜ì‹ ', 'ì¿ í° ê¸°ë¶€', 'ì¿ í° íŒë§¤',\r\n            'COUPON_EARN', 'COUPON_USE', 'COUPON_GIVE', 'COUPON_TAKE',\r\n            'COUPON_TRANSFER_SEND', 'COUPON_TRANSFER_RECEIVE',\r\n            'COUPON_DONATE', 'COUPON_SELL'\r\n          ];\r\n          return couponTypes.some(t => type === t) ||\r\n                 type.includes('ì¿ í°') ||\r\n                 desc.includes('ì¿ í°');\r\n        },\r\n        'item': (log) => {\r\n          const type = log.type?.toString() || '';\r\n          const desc = log.description?.toString() || '';\r\n          const itemTypes = [\r\n            'ì•„ì´í…œ êµ¬ë§¤', 'ì•„ì´í…œ ì‚¬ìš©', 'ì•„ì´í…œ íŒë§¤',\r\n            'ì•„ì´í…œ ì‹œì¥ ë“±ë¡', 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤', 'ì•„ì´í…œ íšë“', 'ì•„ì´í…œ ì´ë™',\r\n            'ITEM_PURCHASE', 'ITEM_USE', 'ITEM_SELL',\r\n            'ITEM_MARKET_LIST', 'ITEM_MARKET_BUY', 'ITEM_OBTAIN', 'ITEM_MOVE'\r\n          ];\r\n          return itemTypes.some(t => type === t) ||\r\n                 type.includes('ì•„ì´í…œ') ||\r\n                 desc.includes('ì•„ì´í…œ');\r\n        },\r\n        'cash': (log) => {\r\n          const type = log.type?.toString() || '';\r\n          return type.includes('CASH') || type.includes('ì†¡ê¸ˆ') ||\r\n                 type.includes('ì…ê¸ˆ') || type.includes('ì¶œê¸ˆ') ||\r\n                 type.includes('ADMIN_CASH') || type.includes('TRANSFER') ||\r\n                 type.includes('í˜„ê¸ˆ');\r\n        },\r\n        'stock': (log) => {\r\n          const type = log.type?.toString() || '';\r\n          return type.includes('STOCK') || type.includes('ì£¼ì‹') ||\r\n                 type.includes('ê±°ë˜ì„¸') || type.includes('TAX');\r\n        },\r\n        'game': (log) => {\r\n          const type = log.type?.toString() || '';\r\n          return type.includes('GAME') || type.includes('ê²Œì„');\r\n        }\r\n      };\r\n\r\n      Object.entries(filters).forEach(([filterName, filterFunc]) => {\r\n        const matchedLogs = activityData.filter(log => filterFunc(log));\r\n        info.push(`${filterName}: ${matchedLogs.length}ê°œ`);\r\n\r\n        const matchedTypes = new Set(matchedLogs.map(log => log.type));\r\n        if (matchedTypes.size > 0) {\r\n          info.push(`  ë§¤ì¹­ëœ íƒ€ì…: ${Array.from(matchedTypes).join(', ')}`);\r\n        }\r\n      });\r\n\r\n      const debugText = info.join('\\n');\r\n      setDebugInfo(debugText);\r\n\r\n    } catch (error) {\r\n      logger.error('[AdminDatabase DEBUG] ì˜¤ë¥˜:', error);\r\n      setDebugInfo(`ì˜¤ë¥˜: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleLoadMore = () => {\r\n    if (!loading && hasMore) {\r\n      loadData(false, lastDoc);\r\n    }\r\n  };\r\n\r\n  const getActivityTypeText = (type) => {\r\n    const typeMap = {\r\n      'ì¿ í° íšë“': 'ì¿ í° íšë“',\r\n      'ì¿ í° ì‚¬ìš©': 'ì¿ í° ì‚¬ìš©',\r\n      'ì¿ í° ì§€ê¸‰': 'ì¿ í° ì§€ê¸‰',\r\n      'ì¿ í° íšŒìˆ˜': 'ì¿ í° íšŒìˆ˜',\r\n      'ì•„ì´í…œ êµ¬ë§¤': 'ì•„ì´í…œ êµ¬ë§¤',\r\n      'ì•„ì´í…œ ì‚¬ìš©': 'ì•„ì´í…œ ì‚¬ìš©',\r\n      'ì•„ì´í…œ íŒë§¤': 'ì•„ì´í…œ íŒë§¤',\r\n      'ì•„ì´í…œ ì‹œì¥ ë“±ë¡': 'ì•„ì´í…œ ì‹œì¥ ë“±ë¡',\r\n      'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤': 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤',\r\n      'ì£¼ì‹ ë§¤ìˆ˜': 'ì£¼ì‹ ë§¤ìˆ˜',\r\n      'ì£¼ì‹ ë§¤ë„': 'ì£¼ì‹ ë§¤ë„',\r\n      'ì£¼ì‹ ê±°ë˜ì„¸': 'ì£¼ì‹ ê±°ë˜ì„¸',\r\n      'ê±°ë˜ì„¸': 'ì£¼ì‹ ê±°ë˜ì„¸',\r\n      'ì†¡ê¸ˆ': 'ì†¡ê¸ˆ',\r\n      'ì†¡ê¸ˆ ìˆ˜ì‹ ': 'ì†¡ê¸ˆ ìˆ˜ì‹ ',\r\n      'ëˆ ì†¡ê¸ˆ': 'ì†¡ê¸ˆ',\r\n      'ëˆ ì¶œê¸ˆ': 'ì¶œê¸ˆ',\r\n      'ëˆ ì…ê¸ˆ': 'ì…ê¸ˆ',\r\n      'í˜„ê¸ˆ ì¶œê¸ˆ': 'ì¶œê¸ˆ',\r\n      'í˜„ê¸ˆ ì…ê¸ˆ': 'ì…ê¸ˆ',\r\n      'COUPON_EARN': 'ì¿ í° íšë“',\r\n      'COUPON_USE': 'ì¿ í° ì‚¬ìš©',\r\n      'COUPON_GIVE': 'ì¿ í° ì§€ê¸‰',\r\n      'COUPON_TAKE': 'ì¿ í° íšŒìˆ˜',\r\n      'COUPON_TRANSFER_SEND': 'ì¿ í° ì†¡ê¸ˆ',\r\n      'COUPON_TRANSFER_RECEIVE': 'ì¿ í° ìˆ˜ì‹ ',\r\n      'ITEM_PURCHASE': 'ì•„ì´í…œ êµ¬ë§¤',\r\n      'ITEM_USE': 'ì•„ì´í…œ ì‚¬ìš©',\r\n      'ITEM_SELL': 'ì•„ì´í…œ íŒë§¤',\r\n      'ITEM_MARKET_LIST': 'ì•„ì´í…œ ì‹œì¥ ë“±ë¡',\r\n      'ITEM_MARKET_BUY': 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤',\r\n      'CASH_TRANSFER_SEND': 'ì†¡ê¸ˆ',\r\n      'CASH_TRANSFER_RECEIVE': 'ì†¡ê¸ˆ ìˆ˜ì‹ ',\r\n      'CASH_WITHDRAW': 'ì¶œê¸ˆ',\r\n      'CASH_DEPOSIT': 'ì…ê¸ˆ',\r\n      'STOCK_BUY': 'ì£¼ì‹ ë§¤ìˆ˜',\r\n      'STOCK_SELL': 'ì£¼ì‹ ë§¤ë„',\r\n      'STOCK_TAX': 'ì£¼ì‹ ê±°ë˜ì„¸',\r\n      'TAX_PAYMENT': 'ì£¼ì‹ ê±°ë˜ì„¸',\r\n      'ADMIN_CASH_SEND': 'ê´€ë¦¬ì ì§€ê¸‰',\r\n      'ADMIN_CASH_TAKE': 'ê´€ë¦¬ì íšŒìˆ˜',\r\n      'ADMIN_COUPON_GIVE': 'ê´€ë¦¬ì ì¿ í° ì§€ê¸‰',\r\n      'ADMIN_COUPON_TAKE': 'ê´€ë¦¬ì ì¿ í° íšŒìˆ˜',\r\n      'TASK_COMPLETE': 'ê³¼ì œ ì™„ë£Œ',\r\n      'GAME_WIN': 'ê²Œì„ ìŠ¹ë¦¬',\r\n      'GAME_LOSE': 'ê²Œì„ íŒ¨ë°°',\r\n    };\r\n    return typeMap[type] || type;\r\n  };\r\n\r\n  const getActivityTypeColor = (type) => {\r\n    if (!type) return 'text-gray-600';\r\n    const typeStr = type.toString().toLowerCase();\r\n    if (typeStr.includes('ì¿ í°') && (typeStr.includes('íšë“') || typeStr.includes('ì§€ê¸‰'))) return 'text-green-600';\r\n    if (typeStr.includes('ì¿ í°') && (typeStr.includes('ì‚¬ìš©') || typeStr.includes('íšŒìˆ˜'))) return 'text-red-600';\r\n    if (type === 'COUPON_EARN' || type === 'COUPON_GIVE' || type === 'COUPON_TRANSFER_RECEIVE' || type === 'ADMIN_COUPON_GIVE') return 'text-green-600';\r\n    if (type === 'COUPON_USE' || type === 'COUPON_TAKE' || type === 'COUPON_TRANSFER_SEND' || type === 'ADMIN_COUPON_TAKE') return 'text-red-600';\r\n    if (typeStr.includes('ì•„ì´í…œ') && typeStr.includes('êµ¬ë§¤')) return 'text-blue-600';\r\n    if (typeStr.includes('ì•„ì´í…œ') && typeStr.includes('ì‚¬ìš©')) return 'text-orange-600';\r\n    if (typeStr.includes('ì•„ì´í…œ') && (typeStr.includes('íŒë§¤') || typeStr.includes('ë“±ë¡'))) return 'text-purple-600';\r\n    if (type === 'ITEM_PURCHASE' || type === 'ITEM_MARKET_BUY') return 'text-blue-600';\r\n    if (type === 'ITEM_USE') return 'text-orange-600';\r\n    if (type === 'ITEM_SELL' || type === 'ITEM_MARKET_LIST') return 'text-purple-600';\r\n    if (typeStr.includes('ì§€ê¸‰') || typeStr.includes('ì…ê¸ˆ') || typeStr.includes('ìˆ˜ì‹ ')) return 'text-green-600';\r\n    if (typeStr.includes('íšŒìˆ˜') || typeStr.includes('ì¶œê¸ˆ') || typeStr.includes('ì†¡ê¸ˆ')) return 'text-red-600';\r\n    if (type === 'ADMIN_CASH_SEND' || type === 'CASH_TRANSFER_RECEIVE' || type === 'CASH_DEPOSIT' || type === 'í˜„ê¸ˆ ì…ê¸ˆ') return 'text-green-600';\r\n    if (type === 'ADMIN_CASH_TAKE' || type === 'CASH_TRANSFER_SEND' || type === 'CASH_WITHDRAW' || type === 'í˜„ê¸ˆ ì¶œê¸ˆ') return 'text-red-600';\r\n    if (typeStr.includes('ë§¤ìˆ˜')) return 'text-blue-600';\r\n    if (typeStr.includes('ë§¤ë„')) return 'text-indigo-600';\r\n    if (typeStr.includes('ê±°ë˜ì„¸') || typeStr.includes('ì„¸ê¸ˆ')) return 'text-yellow-600';\r\n    if (type === 'STOCK_BUY') return 'text-blue-600';\r\n    if (type === 'STOCK_SELL') return 'text-indigo-600';\r\n    if (type === 'STOCK_TAX' || type === 'TAX_PAYMENT') return 'text-yellow-600';\r\n    if (type === 'GAME_WIN') return 'text-green-600';\r\n    if (type === 'GAME_LOSE') return 'text-red-600';\r\n    return 'text-gray-600';\r\n  };\r\n\r\n  const formatDate = (date) => {\r\n    if (!date) return '-';\r\n    const d = date instanceof Date ? date : new Date(date);\r\n    return d.toLocaleString('ko-KR', {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const filteredActivityData = activityData.filter(log => {\r\n    // ê²€ìƒ‰ì–´ í•„í„°\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      const matchesSearch = (\r\n        log.description?.toLowerCase().includes(term) ||\r\n        log.userName?.toLowerCase().includes(term) ||\r\n        log.type?.toLowerCase().includes(term)\r\n      );\r\n      if (!matchesSearch) return false;\r\n    }\r\n\r\n    // í™œë™ íƒ€ì… í•„í„°\r\n    if (activityTypeFilter !== 'all') {\r\n      const logType = log.type?.toString() || '';\r\n      const logDesc = log.description?.toString() || '';\r\n\r\n      if (activityTypeFilter === 'coupon') {\r\n        // ì¿ í° ê´€ë ¨ - Functionsì—ì„œ ì‚¬ìš©í•˜ëŠ” í•œê¸€ íƒ€ì…ë“¤\r\n        const couponTypes = [\r\n          'ì¿ í° íšë“', 'ì¿ í° ì‚¬ìš©', 'ì¿ í° ì§€ê¸‰', 'ì¿ í° íšŒìˆ˜',\r\n          'ì¿ í° ì†¡ê¸ˆ', 'ì¿ í° ìˆ˜ì‹ ', 'ì¿ í° ê¸°ë¶€', 'ì¿ í° íŒë§¤',\r\n          'COUPON_EARN', 'COUPON_USE', 'COUPON_GIVE', 'COUPON_TAKE',\r\n          'COUPON_TRANSFER_SEND', 'COUPON_TRANSFER_RECEIVE',\r\n          'COUPON_DONATE', 'COUPON_SELL'\r\n        ];\r\n        const isCouponType = couponTypes.some(type => logType === type) ||\r\n                            logType.includes('ì¿ í°') ||\r\n                            logDesc.includes('ì¿ í°');\r\n        if (!isCouponType) return false;\r\n      } else if (activityTypeFilter === 'item') {\r\n        // ì•„ì´í…œ ê´€ë ¨ - Functionsì—ì„œ ì‚¬ìš©í•˜ëŠ” í•œê¸€ íƒ€ì…ë“¤\r\n        const itemTypes = [\r\n          'ì•„ì´í…œ êµ¬ë§¤', 'ì•„ì´í…œ ì‚¬ìš©', 'ì•„ì´í…œ íŒë§¤',\r\n          'ì•„ì´í…œ ì‹œì¥ ë“±ë¡', 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤', 'ì•„ì´í…œ íšë“', 'ì•„ì´í…œ ì´ë™',\r\n          'ITEM_PURCHASE', 'ITEM_USE', 'ITEM_SELL',\r\n          'ITEM_MARKET_LIST', 'ITEM_MARKET_BUY', 'ITEM_OBTAIN', 'ITEM_MOVE'\r\n        ];\r\n        const isItemType = itemTypes.some(type => logType === type) ||\r\n                          logType.includes('ì•„ì´í…œ') ||\r\n                          logDesc.includes('ì•„ì´í…œ');\r\n        if (!isItemType) return false;\r\n      } else if (activityTypeFilter === 'cash') {\r\n        // í˜„ê¸ˆ ê´€ë ¨\r\n        const isCashType = logType.includes('CASH') || logType.includes('ì†¡ê¸ˆ') ||\r\n                          logType.includes('ì…ê¸ˆ') || logType.includes('ì¶œê¸ˆ') ||\r\n                          logType.includes('ADMIN_CASH') || logType.includes('TRANSFER') ||\r\n                          logType.includes('í˜„ê¸ˆ');\r\n        if (!isCashType) return false;\r\n      } else if (activityTypeFilter === 'stock') {\r\n        // ì£¼ì‹ ê´€ë ¨\r\n        const isStockType = logType.includes('STOCK') || logType.includes('ì£¼ì‹') ||\r\n                           logType.includes('ê±°ë˜ì„¸') || logType.includes('TAX');\r\n        if (!isStockType) return false;\r\n      } else if (activityTypeFilter === 'game') {\r\n        // ê²Œì„ ê´€ë ¨\r\n        const isGameType = logType.includes('GAME') || logType.includes('ê²Œì„');\r\n        if (!isGameType) return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  });\r\n\r\n  const renderActivityLogs = () => {\r\n    if (filteredActivityData.length === 0) {\r\n      return (\r\n        <div className=\"text-center py-12 text-gray-500\">\r\n          <p className=\"text-lg mb-2\">{searchTerm ? 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>\r\n          <p className=\"text-sm\">ì „ì²´ ë°ì´í„°: {activityData.length}ê°œ</p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <div className=\"text-sm text-gray-600 mb-4\">\r\n          ì´ {filteredActivityData.length}ê°œì˜ í™œë™ (ê²€ìƒ‰: {activityData.length}ê°œ ì¤‘)\r\n        </div>\r\n\r\n        {filteredActivityData.map((log, index) => {\r\n          return (\r\n            <div key={log.id || index} className=\"bg-white border-2 border-gray-300 rounded-lg p-4 hover:shadow-lg transition-shadow\">\r\n              <div className=\"flex justify-between items-start\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"flex items-center gap-3 mb-2\">\r\n                    <span className={`font-bold text-base ${getActivityTypeColor(log.type)}`}>\r\n                      {getActivityTypeText(log.type)}\r\n                    </span>\r\n                    <span className=\"text-sm font-medium text-gray-700\">{log.userName || 'ì•Œ ìˆ˜ ì—†ìŒ'}</span>\r\n                    <span className=\"text-xs text-gray-500\">{formatDate(log.timestamp)}</span>\r\n                  </div>\r\n                  <p className=\"text-gray-800 text-sm mb-2 font-medium\">{log.description || 'ì„¤ëª… ì—†ìŒ'}</p>\r\n                  {log.metadata && Object.keys(log.metadata).length > 0 && (\r\n                    <div className=\"bg-gray-50 p-3 rounded text-sm text-gray-700 border border-gray-200\">\r\n                      {log.metadata.activity && (\r\n                        <div className=\"mb-1\"><strong>í™œë™:</strong> {log.metadata.activity}</div>\r\n                      )}\r\n                      {log.metadata.reason && (\r\n                        <div className=\"mb-1\"><strong>ì‚¬ìœ :</strong> {log.metadata.reason}</div>\r\n                      )}\r\n                      {log.metadata.itemName && (\r\n                        <div className=\"mb-1\"><strong>ì•„ì´í…œ:</strong> {log.metadata.itemName}</div>\r\n                      )}\r\n                      {log.metadata.quantity && (\r\n                        <div className=\"mb-1\"><strong>ìˆ˜ëŸ‰:</strong> {log.metadata.quantity}</div>\r\n                      )}\r\n                      {log.metadata.amount !== undefined && (\r\n                        <div className=\"mb-1\"><strong>ê¸ˆì•¡:</strong> {log.metadata.amount.toLocaleString()}ì›</div>\r\n                      )}\r\n                      {log.metadata.couponAmount !== undefined && (\r\n                        <div className=\"mb-1\"><strong>ì¿ í°:</strong> {log.metadata.couponAmount}ê°œ</div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n\r\n        {hasMore && (\r\n          <div className=\"text-center py-4\">\r\n            <button\r\n              onClick={handleLoadMore}\r\n              disabled={loading}\r\n              className=\"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300\"\r\n            >\r\n              {loading ? 'ë¡œë”© ì¤‘...' : 'ë”ë³´ê¸°'}\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"admin-database p-6\">\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">í•™ê¸‰ ë°ì´í„°ë² ì´ìŠ¤</h2>\r\n        <p className=\"text-gray-600\">í•™ê¸‰ í•™ìƒë“¤ì˜ ëª¨ë“  í™œë™ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\r\n      </div>\r\n\r\n      {/* í•„í„° ë° ì»¨íŠ¸ë¡¤ */}\r\n      <div className=\"bg-white p-4 rounded-lg shadow-sm mb-6\">\r\n        <div className=\"flex flex-wrap gap-4 items-center\">\r\n          {/* í•™ìƒ ì„ íƒ */}\r\n          <div className=\"flex-1 min-w-[200px]\">\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">í•™ìƒ ì„ íƒ</label>\r\n            <select\r\n              value={selectedUser}\r\n              onChange={(e) => setSelectedUser(e.target.value)}\r\n              className=\"w-full p-2 border rounded-md\"\r\n            >\r\n              <option value=\"all\">ì „ì²´ í•™ìƒ</option>\r\n              {allClassMembers && allClassMembers.map(member => (\r\n                <option key={member.id || member.uid} value={member.id || member.id}>\r\n                  {member.name || member.nickname || 'ì´ë¦„ ì—†ìŒ'}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* í™œë™ íƒ€ì… í•„í„° */}\r\n          <div className=\"flex-1 min-w-[200px]\">\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">í™œë™ íƒ€ì…</label>\r\n            <select\r\n              value={activityTypeFilter}\r\n              onChange={(e) => setActivityTypeFilter(e.target.value)}\r\n              className=\"w-full p-2 border rounded-md\"\r\n            >\r\n              <option value=\"all\">ì „ì²´ í™œë™</option>\r\n              <option value=\"coupon\">ì¿ í° ê´€ë ¨</option>\r\n              <option value=\"item\">ì•„ì´í…œ ê´€ë ¨</option>\r\n              <option value=\"cash\">í˜„ê¸ˆ ê´€ë ¨</option>\r\n              <option value=\"stock\">ì£¼ì‹ ê´€ë ¨</option>\r\n              <option value=\"game\">ê²Œì„ ê´€ë ¨</option>\r\n            </select>\r\n          </div>\r\n\r\n          {/* ê²€ìƒ‰ì°½ */}\r\n          <div className=\"flex-1 min-w-[200px]\">\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">ê²€ìƒ‰</label>\r\n            <input\r\n              type=\"text\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              placeholder=\"í•™ìƒëª…, í™œë™ ë‚´ìš© ê²€ìƒ‰...\"\r\n              className=\"w-full p-2 border rounded-md\"\r\n            />\r\n          </div>\r\n\r\n          {/* ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ */}\r\n          <div className=\"flex items-end gap-2\">\r\n            <button\r\n              onClick={handleRefresh}\r\n              disabled={loading}\r\n              className=\"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:bg-gray-300\"\r\n            >\r\n              ìƒˆë¡œê³ ì¹¨\r\n            </button>\r\n            <button\r\n              onClick={handleDebugFirestore}\r\n              className=\"px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600\"\r\n            >\r\n              ë””ë²„ê·¸\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ */}\r\n        {debugInfo && (\r\n          <div className=\"mt-4 p-4 bg-gray-100 rounded-md\">\r\n            <h4 className=\"font-semibold mb-2\">ë””ë²„ê·¸ ì •ë³´:</h4>\r\n            <pre className=\"text-xs whitespace-pre-wrap\">{debugInfo}</pre>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* í†µê³„ ìš”ì•½ */}\r\n      {activityData.length > 0 && (() => {\r\n        const couponCount = activityData.filter(log => {\r\n          const type = log.type?.toString() || '';\r\n          const desc = log.description?.toString() || '';\r\n          const couponTypes = [\r\n            'ì¿ í° íšë“', 'ì¿ í° ì‚¬ìš©', 'ì¿ í° ì§€ê¸‰', 'ì¿ í° íšŒìˆ˜',\r\n            'ì¿ í° ì†¡ê¸ˆ', 'ì¿ í° ìˆ˜ì‹ ', 'ì¿ í° ê¸°ë¶€', 'ì¿ í° íŒë§¤',\r\n            'COUPON_EARN', 'COUPON_USE', 'COUPON_GIVE', 'COUPON_TAKE',\r\n            'COUPON_TRANSFER_SEND', 'COUPON_TRANSFER_RECEIVE',\r\n            'COUPON_DONATE', 'COUPON_SELL'\r\n          ];\r\n          return couponTypes.some(t => type === t) ||\r\n                 type.includes('ì¿ í°') ||\r\n                 desc.includes('ì¿ í°');\r\n        }).length;\r\n\r\n        const itemCount = activityData.filter(log => {\r\n          const type = log.type?.toString() || '';\r\n          const desc = log.description?.toString() || '';\r\n          const itemTypes = [\r\n            'ì•„ì´í…œ êµ¬ë§¤', 'ì•„ì´í…œ ì‚¬ìš©', 'ì•„ì´í…œ íŒë§¤',\r\n            'ì•„ì´í…œ ì‹œì¥ ë“±ë¡', 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤', 'ì•„ì´í…œ íšë“', 'ì•„ì´í…œ ì´ë™',\r\n            'ITEM_PURCHASE', 'ITEM_USE', 'ITEM_SELL',\r\n            'ITEM_MARKET_LIST', 'ITEM_MARKET_BUY', 'ITEM_OBTAIN', 'ITEM_MOVE'\r\n          ];\r\n          return itemTypes.some(t => type === t) ||\r\n                 type.includes('ì•„ì´í…œ') ||\r\n                 desc.includes('ì•„ì´í…œ');\r\n        }).length;\r\n\r\n        const cashCount = activityData.filter(log => {\r\n          const type = log.type?.toString() || '';\r\n          return type.includes('CASH') || type.includes('ì†¡ê¸ˆ') ||\r\n                 type.includes('ì…ê¸ˆ') || type.includes('ì¶œê¸ˆ') ||\r\n                 type.includes('ADMIN_CASH') || type.includes('TRANSFER');\r\n        }).length;\r\n\r\n        const stockCount = activityData.filter(log => {\r\n          const type = log.type?.toString() || '';\r\n          return type.includes('STOCK') || type.includes('ì£¼ì‹') ||\r\n                 type.includes('ê±°ë˜ì„¸') || type.includes('TAX');\r\n        }).length;\r\n\r\n        const gameCount = activityData.filter(log => {\r\n          const type = log.type?.toString() || '';\r\n          return type.includes('GAME') || type.includes('ê²Œì„');\r\n        }).length;\r\n\r\n        return (\r\n          <div className=\"bg-white p-4 rounded-lg shadow-sm mb-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-800 mb-3\">í™œë™ í†µê³„ (í´ë¦­í•˜ì—¬ í•„í„°)</h3>\r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\r\n              <div\r\n                className=\"bg-blue-50 p-3 rounded cursor-pointer hover:shadow-md transition-shadow\"\r\n                onClick={() => setActivityTypeFilter('all')}\r\n              >\r\n                <div className=\"text-xs text-gray-600 mb-1\">ì „ì²´ í™œë™</div>\r\n                <div className=\"text-xl font-bold text-blue-600\">\r\n                  {activityData.length}\r\n                </div>\r\n              </div>\r\n              <div\r\n                className={`p-3 rounded transition-shadow ${\r\n                  couponCount > 0\r\n                    ? 'bg-green-50 cursor-pointer hover:shadow-md'\r\n                    : 'bg-gray-100 cursor-not-allowed opacity-50'\r\n                }`}\r\n                onClick={() => couponCount > 0 && setActivityTypeFilter('coupon')}\r\n                title={couponCount === 0 ? 'ì•„ì§ ì¿ í° ê´€ë ¨ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤' : 'í´ë¦­í•˜ì—¬ ì¿ í° ê´€ë ¨ í™œë™ë§Œ ë³´ê¸°'}\r\n              >\r\n                <div className=\"text-xs text-gray-600 mb-1\">ì¿ í° ê´€ë ¨</div>\r\n                <div className={`text-xl font-bold ${couponCount > 0 ? 'text-green-600' : 'text-gray-400'}`}>\r\n                  {couponCount}\r\n                </div>\r\n              </div>\r\n              <div\r\n                className={`p-3 rounded transition-shadow ${\r\n                  itemCount > 0\r\n                    ? 'bg-purple-50 cursor-pointer hover:shadow-md'\r\n                    : 'bg-gray-100 cursor-not-allowed opacity-50'\r\n                }`}\r\n                onClick={() => itemCount > 0 && setActivityTypeFilter('item')}\r\n                title={itemCount === 0 ? 'ì•„ì§ ì•„ì´í…œ ê´€ë ¨ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤' : 'í´ë¦­í•˜ì—¬ ì•„ì´í…œ ê´€ë ¨ í™œë™ë§Œ ë³´ê¸°'}\r\n              >\r\n                <div className=\"text-xs text-gray-600 mb-1\">ì•„ì´í…œ ê´€ë ¨</div>\r\n                <div className={`text-xl font-bold ${itemCount > 0 ? 'text-purple-600' : 'text-gray-400'}`}>\r\n                  {itemCount}\r\n                </div>\r\n              </div>\r\n              <div\r\n                className={`p-3 rounded transition-shadow ${\r\n                  cashCount > 0\r\n                    ? 'bg-yellow-50 cursor-pointer hover:shadow-md'\r\n                    : 'bg-gray-100 cursor-not-allowed opacity-50'\r\n                }`}\r\n                onClick={() => cashCount > 0 && setActivityTypeFilter('cash')}\r\n                title={cashCount === 0 ? 'ì•„ì§ í˜„ê¸ˆ ê´€ë ¨ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤' : 'í´ë¦­í•˜ì—¬ í˜„ê¸ˆ ê´€ë ¨ í™œë™ë§Œ ë³´ê¸°'}\r\n              >\r\n                <div className=\"text-xs text-gray-600 mb-1\">í˜„ê¸ˆ ê´€ë ¨</div>\r\n                <div className={`text-xl font-bold ${cashCount > 0 ? 'text-yellow-600' : 'text-gray-400'}`}>\r\n                  {cashCount}\r\n                </div>\r\n              </div>\r\n              <div\r\n                className={`p-3 rounded transition-shadow ${\r\n                  stockCount > 0\r\n                    ? 'bg-indigo-50 cursor-pointer hover:shadow-md'\r\n                    : 'bg-gray-100 cursor-not-allowed opacity-50'\r\n                }`}\r\n                onClick={() => stockCount > 0 && setActivityTypeFilter('stock')}\r\n                title={stockCount === 0 ? 'ì•„ì§ ì£¼ì‹ ê´€ë ¨ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤' : 'í´ë¦­í•˜ì—¬ ì£¼ì‹ ê´€ë ¨ í™œë™ë§Œ ë³´ê¸°'}\r\n              >\r\n                <div className=\"text-xs text-gray-600 mb-1\">ì£¼ì‹ ê´€ë ¨</div>\r\n                <div className={`text-xl font-bold ${stockCount > 0 ? 'text-indigo-600' : 'text-gray-400'}`}>\r\n                  {stockCount}\r\n                </div>\r\n              </div>\r\n              <div\r\n                className={`p-3 rounded transition-shadow ${\r\n                  gameCount > 0\r\n                    ? 'bg-red-50 cursor-pointer hover:shadow-md'\r\n                    : 'bg-gray-100 cursor-not-allowed opacity-50'\r\n                }`}\r\n                onClick={() => gameCount > 0 && setActivityTypeFilter('game')}\r\n                title={gameCount === 0 ? 'ì•„ì§ ê²Œì„ ê´€ë ¨ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤' : 'í´ë¦­í•˜ì—¬ ê²Œì„ ê´€ë ¨ í™œë™ë§Œ ë³´ê¸°'}\r\n              >\r\n                <div className=\"text-xs text-gray-600 mb-1\">ê²Œì„ ê´€ë ¨</div>\r\n                <div className={`text-xl font-bold ${gameCount > 0 ? 'text-red-600' : 'text-gray-400'}`}>\r\n                  {gameCount}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n      })()}\r\n\r\n      {/* ì œëª© */}\r\n      <div className=\"mb-6\">\r\n        <h3 className=\"text-xl font-semibold text-gray-800\">ì „ì²´ í™œë™ ë‚´ì—­</h3>\r\n        <p className=\"text-sm text-gray-600 mt-1\">ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬ëœ ëª¨ë“  í™œë™ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\r\n      </div>\r\n\r\n      {/* ì—ëŸ¬ ë©”ì‹œì§€ */}\r\n      {error && (\r\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* ë¡œë”© ìƒíƒœ */}\r\n      {loading && activityData.length === 0 && (\r\n        <div className=\"text-center py-12\">\r\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* ë‚´ìš© */}\r\n      {!loading || activityData.length > 0 ? (\r\n        <div>\r\n          {renderActivityLogs()}\r\n        </div>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDatabase;"],"names":["normalizeType","type","cache","Map","getCacheKey","classCode","options","arguments","length","undefined","concat","JSON","stringify","getFromCache","key","cached","get","Date","now","timestamp","delete","data","setCache","set","getActivityLogs","async","userId","startDate","endDate","limitCount","lastDoc","cacheKey","logger","log","constraints","where","push","startTimestamp","Timestamp","fromDate","endTimestamp","useServerTypeFilter","orderBy","limit","q","query","collection","db","snapshot","getDocs","logs","forEach","doc","_data$timestamp","_objectSpread","id","toDate","normalizedFilterType","filter","hasMore","paginatedLogs","slice","newLastDoc","result","error","AdminDatabase","userDoc","allClassMembers","useAuth","selectedUser","setSelectedUser","useState","activityData","setActivityData","loading","setLoading","setError","setHasMore","setLastDoc","debugInfo","setDebugInfo","searchTerm","setSearchTerm","activityTypeFilter","setActivityTypeFilter","loadData","useCallback","refresh","lastDocForPagination","isFiltered","trim","useCache","userIds","map","m","uid","transactions","userIdsCount","warn","batches","i","allTransactions","batch","_data$timestamp3","getTransactionsData","tx","description","includes","amount","userName","metadata","category","convertTransactionsToLogs","prev","err","useEffect","handleLoadMore","getActivityTypeColor","typeStr","toString","toLowerCase","formatDate","date","toLocaleString","year","month","day","hour","minute","filteredActivityData","_log$description3","_log$userName","_log$type6","term","_log$type7","_log$description4","logType","logDesc","some","_jsxs","className","children","_jsx","value","onChange","e","target","member","name","nickname","placeholder","onClick","handleRefresh","keysToDelete","startsWith","clearClassCache","disabled","info","typeCounts","typeExamples","Object","entries","sort","a","b","_ref","count","filters","_log$type","_log$description","desc","t","_log$type2","_log$description2","_log$type3","_log$type4","_log$type5","_ref2","filterName","filterFunc","matchedLogs","matchedTypes","Set","size","Array","from","join","debugText","message","couponCount","_log$type8","_log$description5","itemCount","_log$type9","_log$description6","cashCount","_log$type0","stockCount","_log$type1","gameCount","_log$type10","title","index","keys","activity","reason","itemName","quantity","couponAmount"],"ignoreList":[],"sourceRoot":""}