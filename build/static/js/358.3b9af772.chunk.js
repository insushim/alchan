"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[358],{4358:(e,s,a)=>{a.r(s),a.d(s,{default:()=>r});var n=a(4919),c=a(5043),t=a(5010),i=a(5472),l=a(5016),o=a(579);const r=function(){const{userDoc:e,allClassMembers:s,loading:a,addCouponsToUserById:r,deductCouponsFromUserById:d,updateLocalUserState:u}=(0,l.As)(),[m,h]=(0,c.useState)(""),[p,v]=(0,c.useState)(""),[x,N]=(0,c.useState)(!1),[j,f]=(0,c.useState)([]),[g,b]=(0,c.useState)(""),[y,k]=(0,c.useState)("fixed"),[S,C]=(0,c.useState)("send"),[L,w]=(0,c.useState)("delete"),[I,A]=(0,c.useState)(!1),[E,M]=(0,c.useState)([]),[T,U]=(0,c.useState)(null),_=(null===e||void 0===e?void 0:e.isAdmin)||!1,B=null===e||void 0===e?void 0:e.name,D=null===e||void 0===e?void 0:e.uid,K=null===e||void 0===e?void 0:e.classCode;(0,c.useEffect)(()=>{if(s){const e=[...s].sort((e,s)=>{const a=e.name||"",n=s.name||"";return a.localeCompare(n,"ko-KR")});M(e)}},[s]),(0,c.useEffect)(()=>{e&&U(e)},[e]);const R=E.length>0?E:(s||[]).sort((e,s)=>{const a=e.name||"",n=s.name||"";return a.localeCompare(n,"ko-KR")}),q=T||e;(0,c.useEffect)(()=>{f([]),b(""),h(""),v(""),A(!1)},[]);const F=(e,s)=>"percentage"===y?Math.floor(e*Number(s)/100):Number(s);if(!_)return(0,o.jsx)("div",{className:"coupon-transfer-container",children:(0,o.jsx)("div",{className:"alert alert-error",children:"\uad00\ub9ac\uc790\ub9cc \uc774 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."})});if(a&&0===R.length)return(0,o.jsx)("div",{className:"coupon-transfer-container",children:(0,o.jsx)("div",{className:"loading",children:"\ub370\uc774\ud130\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."})});const H=(()=>{if(!g||0===j.length)return{};const e={};return j.forEach(s=>{const a=R.find(e=>e.id===s);if(a){const n=F(Number(a.coupons||0),g);e[s]=n}}),e})();return(0,o.jsxs)("div",{className:"coupon-transfer-container",children:[(0,o.jsxs)("div",{className:"header",children:[(0,o.jsx)("h3",{children:"\ucfe0\ud3f0 \ub300\ub7c9 \uad00\ub9ac"}),(0,o.jsxs)("div",{className:"admin-info",children:[(0,o.jsx)("span",{className:"admin-label",children:(null===q||void 0===q?void 0:q.name)||"\uc0ac\uc6a9\uc790"}),(0,o.jsxs)("span",{className:"admin-coupons",children:["\ubcf4\uc720 \ucfe0\ud3f0: ",((null===q||void 0===q?void 0:q.coupons)||0).toLocaleString(),"\uac1c"]}),(0,o.jsxs)("span",{className:"admin-cash",style:{marginLeft:"10px"},children:["\ud604\uae08: ",((null===q||void 0===q?void 0:q.cash)||0).toLocaleString(),"\uc6d0"]})]})]}),p&&(0,o.jsx)("div",{className:"alert alert-error",children:p}),m&&(0,o.jsx)("div",{className:"alert alert-success",children:m}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),j.length&&g&&!isNaN(Number(g))){N(!0),h(""),v("");try{const e=(0,i.wP)(t.db);let a=0,c=0;const l=[];for(const n of j){const o=R.find(e=>e.id===n);if(!o)continue;const u=Number(o.coupons||0),m=F(u,g);c+=m;try{"send"===S?(await r(n,m),l.push({userId:n,change:m})):"transfer"===L?(await d(n,m),await r(D,m),l.push({userId:n,change:-m}),l.push({userId:D,change:m})):(await d(n,m),l.push({userId:n,change:-m}));const s=(0,i.H9)((0,i.rJ)(t.db,"activity_logs")),c="send"===S?"\ub300\ub7c9 \uc9c0\uae09":"transfer"===L?"\ub300\ub7c9 \ud68c\uc218(\uad00\ub9ac\uc790 \uc774\uc804)":"\ub300\ub7c9 \uc0ad\uc81c",u="\uad00\ub9ac\uc790(".concat(B,")\uac00 ").concat(o.name,"\ub2d8\uc5d0\uac8c \ucfe0\ud3f0 ").concat(m.toLocaleString(),"\uac1c\ub97c ").concat(c,"\ud588\uc2b5\ub2c8\ub2e4. (").concat("percentage"===y?"".concat(g,"% \uc801\uc6a9"):"\uace0\uc815 \uac1c\uc218",")");e.set(s,{userId:n,userName:o.name,timestamp:(0,i.O5)(),type:"couponAdminAction",description:u,classCode:K,adminId:D,adminName:B}),a++}catch(s){console.error("\uc0ac\uc6a9\uc790 ".concat(n," \ucc98\ub9ac \uc911 \uc624\ub958:"),s)}}await e.commit(),l.forEach(e=>{let{userId:s,change:a}=e;((e,s)=>{M(a=>a.map(a=>a.id===e?(0,n.A)((0,n.A)({},a),{},{coupons:Math.max(0,(a.coupons||0)+s)}):a)),e===D&&U(e=>(0,n.A)((0,n.A)({},e),{},{coupons:Math.max(0,((null===e||void 0===e?void 0:e.coupons)||0)+s)}))})(s,a)}),h("".concat(a,"\uba85\uc5d0\uac8c \ucfe0\ud3f0 \ucc98\ub9ac\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4. (\ucd1d ").concat(c.toLocaleString(),"\uac1c)")),b(""),f([]),A(!1),setTimeout(()=>h(""),3e3)}catch(a){console.error("\ub300\ub7c9 \ucc98\ub9ac \uc911 \uc624\ub958:",a),v("\uc624\ub958 \ubc1c\uc0dd: ".concat(a.message)),setTimeout(()=>v(""),5e3)}finally{N(!1)}}else v("\uc0ac\uc6a9\uc790\ub97c \uc120\ud0dd\ud558\uace0 \uc720\ud6a8\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694.")},className:"transfer-form",children:[(0,o.jsxs)("div",{className:"action-selector",children:[(0,o.jsx)("button",{type:"button",className:"action-btn ".concat("send"===S?"active send":""),onClick:()=>C("send"),children:"\ud83d\udce4 \ubcf4\ub0b4\uae30"}),(0,o.jsx)("button",{type:"button",className:"action-btn ".concat("take"===S?"active take":""),onClick:()=>C("take"),children:"\ud83d\udce5 \uac00\uc838\uc624\uae30"})]}),"take"===S&&(0,o.jsxs)("div",{className:"amount-type-selector",style:{margin:"10px 0"},children:[(0,o.jsxs)("label",{className:"type-option ".concat("delete"===L?"active":""),children:[(0,o.jsx)("input",{type:"radio",value:"delete",checked:"delete"===L,onChange:e=>w(e.target.value)}),"\uc0ad\uc81c\ud558\uae30"]}),(0,o.jsxs)("label",{className:"type-option ".concat("transfer"===L?"active":""),children:[(0,o.jsx)("input",{type:"radio",value:"transfer",checked:"transfer"===L,onChange:e=>w(e.target.value)}),"\ub098\uc5d0\uac8c \uac00\uc838\uc624\uae30"]})]}),(0,o.jsxs)("div",{className:"amount-section",children:[(0,o.jsxs)("div",{className:"amount-type-selector",children:[(0,o.jsxs)("label",{className:"type-option ".concat("fixed"===y?"active":""),children:[(0,o.jsx)("input",{type:"radio",value:"fixed",checked:"fixed"===y,onChange:e=>k(e.target.value)}),"\uace0\uc815 \uac1c\uc218"]}),(0,o.jsxs)("label",{className:"type-option ".concat("percentage"===y?"active":""),children:[(0,o.jsx)("input",{type:"radio",value:"percentage",checked:"percentage"===y,onChange:e=>k(e.target.value)}),"\ud37c\uc13c\ud2b8 (%)"]})]}),(0,o.jsxs)("div",{className:"amount-input-group",children:[(0,o.jsx)("input",{type:"number",value:g,onChange:e=>b(e.target.value),placeholder:"fixed"===y?"\ucfe0\ud3f0 \uac1c\uc218":"\ud37c\uc13c\ud2b8",min:"1",required:!0,className:"amount-input"}),(0,o.jsx)("span",{className:"amount-unit",children:"fixed"===y?"\uac1c":"%"})]})]}),(0,o.jsxs)("div",{className:"user-selection-section",children:[(0,o.jsxs)("div",{className:"section-header",children:[(0,o.jsx)("h3",{children:"\ub300\uc0c1 \uc120\ud0dd"}),(0,o.jsxs)("label",{className:"select-all-label",children:[(0,o.jsx)("input",{type:"checkbox",checked:I,onChange:()=>{A(!I),f(I?[]:R.map(e=>e.id))},className:"checkbox-custom"}),(0,o.jsx)("span",{className:"checkmark"}),"\uc804\uccb4 \uc120\ud0dd"]})]}),(0,o.jsx)("div",{className:"user-list",children:R.map(e=>{var s;return(0,o.jsx)("div",{className:"user-item",children:(0,o.jsxs)("label",{className:"user-label",children:[(0,o.jsx)("input",{type:"checkbox",className:"checkbox-custom",checked:j.includes(e.id),onChange:()=>{return s=e.id,void f(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s}}),(0,o.jsx)("span",{className:"checkmark"}),(0,o.jsxs)("div",{className:"user-info",children:[(0,o.jsx)("span",{className:"user-name",children:e.name}),(0,o.jsxs)("span",{className:"user-balance",children:["\ucfe0\ud3f0: ",(null===(s=e.coupons)||void 0===s?void 0:s.toLocaleString())||0,"\uac1c"]}),void 0!==H[e.id]&&(0,o.jsxs)("span",{className:"preview-amount ".concat(S),children:["send"===S?"+":"-",H[e.id].toLocaleString(),"\uac1c"]})]})]})},e.id)})})]}),(0,o.jsx)("button",{type:"submit",className:"submit-btn ".concat(S),disabled:x,children:x?"\ucc98\ub9ac \uc911...":"\uc2e4\ud589"})]}),(0,o.jsxs)("div",{className:"recent-users",children:[(0,o.jsx)("h4",{children:"\ud559\uae09 \uc0ac\uc6a9\uc790 \ubaa9\ub85d"}),(0,o.jsx)("div",{className:"users-grid",children:R.map(e=>{var s,a;return(0,o.jsxs)("div",{className:"user-card",children:[(0,o.jsx)("div",{className:"user-name",children:e.name}),(0,o.jsxs)("div",{className:"user-coupons",children:["\ucfe0\ud3f0: ",(null===(s=e.coupons)||void 0===s?void 0:s.toLocaleString())||0,"\uac1c"]}),(0,o.jsxs)("div",{className:"user-cash",children:["\ud604\uae08: ",(null===(a=e.cash)||void 0===a?void 0:a.toLocaleString())||0,"\uc6d0"]})]},e.id)})})]})]})}}}]);
//# sourceMappingURL=358.3b9af772.chunk.js.map