"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[251],{3251:(t,a,o)=>{o.d(a,{D_:()=>c,FG:()=>s,Mx:()=>n});var e=o(791);o(7262);const c={CASH_INCOME:"\ud604\uae08 \uc785\uae08",CASH_EXPENSE:"\ud604\uae08 \ucd9c\uae08",CASH_TRANSFER_SEND:"\uc1a1\uae08",CASH_TRANSFER_RECEIVE:"\uc1a1\uae08 \uc218\uc2e0",ADMIN_CASH_SEND:"\uad00\ub9ac\uc790 \uc9c0\uae09",ADMIN_CASH_TAKE:"\uad00\ub9ac\uc790 \ud68c\uc218",COUPON_EARN:"\ucfe0\ud3f0 \ud68d\ub4dd",COUPON_USE:"\ucfe0\ud3f0 \uc0ac\uc6a9",COUPON_GIVE:"\ucfe0\ud3f0 \uc9c0\uae09",COUPON_TAKE:"\ucfe0\ud3f0 \ud68c\uc218",COUPON_TRANSFER_SEND:"\ucfe0\ud3f0 \uc1a1\uae08",COUPON_TRANSFER_RECEIVE:"\ucfe0\ud3f0 \uc218\uc2e0",ITEM_PURCHASE:"\uc544\uc774\ud15c \uad6c\ub9e4",ITEM_USE:"\uc544\uc774\ud15c \uc0ac\uc6a9",ITEM_SELL:"\uc544\uc774\ud15c \ud310\ub9e4",ITEM_MARKET_LIST:"\uc544\uc774\ud15c \uc2dc\uc7a5 \ub4f1\ub85d",ITEM_MARKET_BUY:"\uc544\uc774\ud15c \uc2dc\uc7a5 \uad6c\ub9e4",ITEM_OBTAIN:"\uc544\uc774\ud15c \ud68d\ub4dd",ITEM_MOVE:"\uc544\uc774\ud15c \uc774\ub3d9",TASK_COMPLETE:"\uacfc\uc81c \uc644\ub8cc",TASK_REWARD:"\uacfc\uc81c \ubcf4\uc0c1",GAME_WIN:"\uac8c\uc784 \uc2b9\ub9ac",GAME_LOSE:"\uac8c\uc784 \ud328\ubc30",GAME_REWARD:"\uac8c\uc784 \ubcf4\uc0c1",OMOK_GAME:"\uc624\ubaa9 \uac8c\uc784",CHESS_GAME:"\uccb4\uc2a4 \uac8c\uc784",STOCK_BUY:"\uc8fc\uc2dd \ub9e4\uc218",STOCK_SELL:"\uc8fc\uc2dd \ub9e4\ub3c4",TAX_PAYMENT:"\uc138\uae08 \ub0a9\ubd80",TAX_REFUND:"\uc138\uae08 \ud658\uae09",FINE_PAYMENT:"\ubc8c\uae08 \ub0a9\ubd80",SALARY_PAYMENT:"\uc6d4\uae09 \uc9c0\uae09",BONUS_PAYMENT:"\ubcf4\ub108\uc2a4 \uc9c0\uae09",SYSTEM:"\uc2dc\uc2a4\ud15c",ADMIN_ACTION:"\uad00\ub9ac\uc790 \uc870\uce58",TREASURY_DEPOSIT:"\uae08\uace0 \uc785\uae08",TREASURY_WITHDRAW:"\uae08\uace0 \ucd9c\uae08"},n=async function(t,a,o){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t&&"system"!==t)try{await(0,e.TB)(t,a,o,c),Object.keys(c).length>0&&console.log("[Activity Log] User: ".concat(t,", Type: ").concat(a),c)}catch(n){console.error("[Activity Log Error]",n)}else console.log("[System Log] ".concat(a,": ").concat(o))},s=async t=>{let{adminName:a,adminClassCode:o,targetUsers:c,action:n,takeMode:s,amountType:E,amount:r,taxRate:i}=t;console.log("[database.js] adminCashAction \uc2dc\uc791:",{adminName:a,action:n,takeMode:s,amountType:E,amount:r,taxRate:i,targetUsersCount:c.length});const A=(0,e.wP)(e.db);let _=0,m=0;const S=[];for(const T of c)try{const t=Number(T.cash||0);let c;if(c="percentage"===E?Math.floor(t*r/100):Number(r),c<=0){console.log("[database.js] ".concat(T.name,": \ucc98\ub9ac\ud560 \uae08\uc561\uc774 0\uc6d0\uc774\ubbc0\ub85c \uc2a4\ud0b5"));continue}let d,l=c,N=0;"send"===n&&i>0&&(N=Math.floor(c*i/100),l=c-N),d="send"===n?t+l:t-c,S.push({id:T.id,newCash:d}),console.log("[database.js] ".concat(T.name," \ucc98\ub9ac:"),{"\ud604\uc7ac\uc794\uc561":t,"\uae30\ubcf8\uae08\uc561":c,"\uc138\uae08":N,"\ucd5c\uc885\uae08\uc561":l,"\uc0c8\uc794\uc561":d});const C=(0,e.H9)(e.db,"users",T.id);A.update(C,{cash:d,updatedAt:(0,e.O5)()}),_+=c,m++;const M=(0,e.H9)((0,e.rJ)(e.db,"activity_logs"));let u,g;"send"===n?(u="ADMIN_CASH_SEND","percentage"===E?(g="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(T.name,"\ub2d8\uc5d0\uac8c ").concat(r,"% (").concat(l.toLocaleString(),"\uc6d0)\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),N>0&&(g+=" (\uc6d0\uae08 ".concat(c.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(N.toLocaleString(),"\uc6d0 \uc81c\uc678)"))):(g="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(T.name,"\ub2d8\uc5d0\uac8c ").concat(l.toLocaleString(),"\uc6d0\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),N>0&&(g+=" (\uc6d0\uae08 ".concat(c.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(N.toLocaleString(),"\uc6d0 \uc81c\uc678)")))):"take"===n&&("remove"===s?(u="ADMIN_CASH_REMOVE",g="percentage"===E?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(T.name,"\ub2d8\uc758 ").concat(r,"% (").concat(c.toLocaleString(),"\uc6d0)\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(T.name,"\ub2d8\uc758 ").concat(c.toLocaleString(),"\uc6d0\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4.")):(u="ADMIN_CASH_TAKE",g="percentage"===E?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(T.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(r,"% (").concat(c.toLocaleString(),"\uc6d0)\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(T.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(c.toLocaleString(),"\uc6d0\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4.")));const R={userId:T.id,userName:T.name,timestamp:(0,e.O5)(),type:u,description:g,classCode:o,metadata:{adminName:a,action:n,amountType:E,inputValue:r,taxRate:"send"===n?i:0,baseAmount:c,taxAmount:N,finalAmount:l,previousCash:t,newCash:d}};A.set(M,R);const O=(0,e.H9)((0,e.rJ)(e.db,"transactions")),I={userId:T.id,amount:"send"===n?l:-c,type:"send"===n?"income":"expense",category:"admin",description:"send"===n?"\uad00\ub9ac\uc790 \uc9c0\uae09":"\uad00\ub9ac\uc790 \ud68c\uc218",timestamp:(0,e.O5)(),metadata:{adminName:a,amountType:E,taxRate:"send"===n?i:0}};A.set(O,I)}catch(d){console.error("[database.js] \uc0ac\uc6a9\uc790 ".concat(T.name," \ucc98\ub9ac \uc911 \uc624\ub958:"),d)}try{return await A.commit(),console.log("[database.js] adminCashAction \uc644\ub8cc: ".concat(m,"\uba85 \ucc98\ub9ac, \ucd1d ").concat(_.toLocaleString(),"\uc6d0")),{count:m,totalProcessed:_,updatedUsers:S}}catch(l){throw console.error("[database.js] batch commit \uc624\ub958:",l),l}}},7262:(t,a,o)=>{o(4919),o(791),o(5472)}}]);
//# sourceMappingURL=251.0fc762cc.chunk.js.map