"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[757],{6757(e,t,a){a.r(t),a.d(t,{default:()=>j});var n=a(2555),s=a(5043),r=a(5016),l=a(577),c=a(2419),i=a(9270),o=a(3122),u=a(5452),d=a(579);const m=(0,s.lazy)(()=>Promise.all([a.e(985),a.e(886)]).then(a.bind(a,3886))),h={wK:"\u2654",wQ:"\u2655",wR:"\u2656",wB:"\u2657",wN:"\u2658",wP:"\u2659",bK:"\u265a",bQ:"\u265b",bR:"\u265c",bB:"\u265d",bN:"\u265e",bP:"\u265f"},w=[{name:"Unranked",minPoints:0},{name:"C",minPoints:800},{name:"B",minPoints:1e3},{name:"A",minPoints:1200},{name:"S",minPoints:1400},{name:"SS",minPoints:1600}],f=15,b=-10,p=e=>{const t={};return e.forEach((e,a)=>{e.forEach((e,n)=>{e&&(t["".concat(a,"-").concat(n)]=e)})}),t},v=e=>{const t=Array(8).fill(null).map(()=>Array(8).fill(null));for(const a in e){const[n,s]=a.split("-").map(Number);t[n][s]=e[a]}return t},g={P:100,N:320,B:330,R:500,Q:900,K:2e4},y=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],x=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]],k=(e,t,a,n,s,r,l)=>{if(0===t)return((e,t)=>{let a=0;for(let n=0;n<8;n++)for(let s=0;s<8;s++){const r=e[n][s];if(!r)continue;const l=r[0],c=r[1],i=g[c]||0;let o=0;"P"===c?o=y["w"===l?n:7-n][s]:"N"===c&&(o=x[n][s]);const u=i+o;l===t?a+=u:a-=u}return a})(e,r);const c=a?r:"w"===r?"b":"w",i=[];for(let o=0;o<8;o++)for(let t=0;t<8;t++){const a=e[o][t];if(a&&a[0]===c){l(e,o,t,a,!0).forEach(e=>{let[n,s]=e;i.push({from:[o,t],to:[n,s],piece:a})})}}if(0===i.length)return a?-999999:999999;if(a){let a=-1/0;for(const c of i){const i=e.map(e=>[...e]);i[c.to[0]][c.to[1]]=c.piece,i[c.from[0]][c.from[1]]=null;const o=k(i,t-1,!1,n,s,r,l);if(a=Math.max(a,o),s<=(n=Math.max(n,o)))break}return a}{let a=1/0;for(const c of i){const i=e.map(e=>[...e]);i[c.to[0]][c.to[1]]=c.piece,i[c.from[0]][c.from[1]]=null;const o=k(i,t-1,!0,n,s,r,l);if(a=Math.min(a,o),(s=Math.min(s,o))<=n)break}return a}},j=()=>{var e,t,a,g,y;const{user:x,userDoc:j,isAdmin:N}=(0,r.As)(),[C,R]=(0,s.useState)(null),[P,S]=(0,s.useState)(null),[E,M]=(0,s.useState)(!0),[I,A]=(0,s.useState)(""),[H,K]=(0,s.useState)({message:"",type:""}),[G,Q]=(0,s.useState)(null),[T,B]=(0,s.useState)([]),[D,_]=(0,s.useState)([]),[F,L]=(0,s.useState)(600),[U,q]=(0,s.useState)(600),[V,W]=(0,s.useState)(600),[z,J]=(0,s.useState)(null),[O,X]=(0,s.useState)([]),Y=(0,s.useRef)(null),Z=(0,s.useRef)(null),$=(0,s.useRef)(null),ee=(0,s.useRef)(0),[te,ae]=(0,s.useState)("player"),[ne,se]=(0,s.useState)("intermediate"),[re,le]=(0,s.useState)(!1),[ce,ie]=(0,s.useState)(!1),[oe,ue]=(0,s.useState)(!0),[de,me]=(0,s.useState)(!1),[he,we]=(0,s.useState)([]),[fe,be]=(0,s.useState)(0),pe=P&&x&&(P.aiMode?P.playerColor:P.players.white===x.uid?"w":"b"),ve=P&&P.turn===pe,{rank:ge,nextRank:ye,pointsForNextRank:xe}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=w[0];for(let r=w.length-1;r>=0;r--)if(e>=w[r].minPoints){t=w[r];break}const a=w.findIndex(e=>e.name===t.name)+1,n=a<w.length?w[a]:null,s=n?n.minPoints-e:0;return{rank:t.name,nextRank:null===n||void 0===n?void 0:n.name,pointsForNextRank:s}}(null===j||void 0===j?void 0:j.chessRating),ke=(0,s.useRef)(C);(0,s.useEffect)(()=>{ke.current=C},[C]);const je=(0,s.useRef)(P);(0,s.useEffect)(()=>{je.current=P},[P]);const Ne=(0,s.useRef)(x);(0,s.useEffect)(()=>{Ne.current=x},[x]),(0,s.useEffect)(()=>{const e=()=>{var e;const t=ke.current,a=je.current,n=Ne.current;t&&a&&n&&(null===(e=a.players)||void 0===e?void 0:e.white)===n.uid&&(0,c.kd)((0,c.H9)(c.db,"chessGames",t))};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);const Ce=(0,s.useCallback)(async e=>{if(!C)return;const t=(0,c.H9)(c.db,"chessGames",C),a="w"===e?"b":"w";await(0,c.c4)(c.db,async n=>{const s=await n.get(t);if(!s.exists()||"active"!==s.data().status)return;s.data().players["w"===a?"white":"black"],s.data().players["w"===e?"white":"black"];n.update(t,{status:"finished",winner:a,endReason:"timeout",ratingChange:{["w"===a?"white":"black"]:f,["w"===e?"white":"black"]:b}})}),Z.current&&await Z.current()},[C]);(0,s.useEffect)(()=>(P&&"active"===P.status&&ve&&(Y.current=setInterval(async()=>{(0,c.H9)(c.db,"chessGames",C);if("w"===P.turn){const e=Math.max(0,U-1);q(e),e<=0&&await Ce("w")}else{const e=Math.max(0,V-1);W(e),e<=0&&await Ce("b")}},1e3)),()=>clearInterval(Y.current)),[P,ve,U,V,C,Ce]);const Re=(0,s.useCallback)(async()=>{if(x)try{const e=(0,c.P)((0,c.rJ)(c.db,"chessGames"),(0,c._M)("status","==","waiting")),t=await(0,c.GG)(e),a=[];t.forEach(e=>{const t=e.data();t.players.white!==x.uid&&a.push((0,n.A)({id:e.id},t))}),_(a)}catch(e){u.vF.error("Error fetching rooms:",e)}},[x]);(0,s.useEffect)(()=>{if(E&&x){Re();const e=setInterval(Re,6e4);return()=>clearInterval(e)}},[E,x,Re]);const Pe=(0,s.useCallback)(async()=>{if(!C)return;const e=(0,c.H9)(c.db,"chessGames",C),t=await(0,c.x7)(e);if(t.exists()){const e=t.data(),a=(0,n.A)((0,n.A)({},e),{},{board:v(e.board)});S(a),M(!1),void 0!==e.whiteTime&&q(e.whiteTime),void 0!==e.blackTime&&W(e.blackTime),e.moveHistory&&X(e.moveHistory)}else K({message:"\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"}),R(null),S(null),M(!0)},[C]),{refetch:Se}=(0,l.nm)(Pe,{interval:18e4,enabled:!!C});(0,s.useEffect)(()=>{Z.current=Se},[Se]),(0,s.useEffect)(()=>{(()=>{if(!x)return;const e=(new Date).toDateString(),t="chessPlayCount_".concat(x.uid,"_").concat(e),a=parseInt(localStorage.getItem(t)||"0",10);be(a)})()},[x]),(0,s.useEffect)(()=>{if(H.message){const e=setTimeout(()=>K({message:"",type:""}),3e3);return()=>clearTimeout(e)}},[H.message]);const Ee=(0,s.useCallback)(function(e,t,a,n){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=[],l=n[0],c=n[1],i=(c,i)=>{if(c>=0&&c<8&&i>=0&&i<8){const o=e[c][i];if(!o||o[0]!==l)if(s){const s=e.map(e=>[...e]);s[c][i]=n,s[t][a]=null,Ie(s,l)||r.push([c,i])}else r.push([c,i])}};switch(c){case"P":const n="w"===l?-1:1,r="w"===l?6:1;if(t+n>=0&&t+n<8&&!e[t+n][a]&&(i(t+n,a),t!==r||e[t+2*n][a]||i(t+2*n,a)),[-1,1].forEach(s=>{if(t+n>=0&&t+n<8&&a+s>=0&&a+s<8){const r=e[t+n][a+s];r&&r[0]!==l&&i(t+n,a+s)}}),null!==P&&void 0!==P&&P.enPassant){const[e,s]=P.enPassant;t+n===e&&1===Math.abs(a-s)&&i(e,s)}break;case"N":[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(e=>{let[n,s]=e;i(t+n,a+s)});break;case"B":case"R":case"Q":({B:[[1,1],[1,-1],[-1,1],[-1,-1]],R:[[0,1],[0,-1],[1,0],[-1,0]],Q:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]]})[c].forEach(n=>{let[s,r]=n;for(let c=1;c<8;c++){const n=t+s*c,o=a+r*c;if(!(n>=0&&n<8&&o>=0&&o<8))break;if(e[n][o]){e[n][o][0]!==l&&i(n,o);break}i(n,o)}});break;case"K":if([[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(e=>{let[n,s]=e;i(t+n,a+s)}),s&&null!==P&&void 0!==P&&P.castling){const n="w"===l?7:0;t===n&&4===a&&(!P.castling[l+"K"]||e[n][5]||e[n][6]||e[n][7]!==l+"R"||Me(e,n,4,l)||Me(e,n,5,l)||Me(e,n,6,l)||i(n,6),!P.castling[l+"Q"]||e[n][3]||e[n][2]||e[n][1]||e[n][0]!==l+"R"||Me(e,n,4,l)||Me(e,n,3,l)||Me(e,n,2,l)||i(n,2))}}return r},[P]),Me=(0,s.useCallback)((e,t,a,n)=>{const s="w"===n?"b":"w";for(let r=0;r<8;r++)for(let n=0;n<8;n++){const l=e[r][n];if(l&&l[0]===s){if(Ee(e,r,n,l,!1).some(e=>{let[n,s]=e;return n===t&&s===a}))return!0}}return!1},[Ee]),Ie=(0,s.useCallback)((e,t)=>{let a=null;for(let n=0;n<8;n++){for(let s=0;s<8;s++)if(e[n][s]===t+"K"){a=[n,s];break}if(a)break}return!!a&&Me(e,a[0],a[1],t)},[Me]),Ae=(0,s.useCallback)((e,t)=>{for(let a=0;a<8;a++)for(let n=0;n<8;n++){const s=e[a][n];if(s&&s[0]===t){if(Ee(e,a,n,s,!0).length>0)return null}}return Ie(e,t)?"checkmate":"stalemate"},[Ee,Ie]),He=async()=>{if(!x)return void K({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});if("ai"===te){const e=(new Date).toDateString(),t="chessPlayCount_".concat(x.uid,"_").concat(e);if(parseInt(localStorage.getItem(t)||"0",10)>=3)return void K({message:"\uc624\ub298\uc758 AI \ub300\uc804 \ud69f\uc218\ub97c \ubaa8\ub450 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. (3/3)",type:"error"})}const e=Math.random().toString(36).substring(2,8),t=(0,c.H9)(c.db,"chessGames",e),a="ai"===te,n=Math.random()>.5?"w":"b",s="w"===n?"b":"w",r={board:p([["bR","bN","bB","bQ","bK","bB","bN","bR"],["bP","bP","bP","bP","bP","bP","bP","bP"],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],["wP","wP","wP","wP","wP","wP","wP","wP"],["wR","wN","wB","wQ","wK","wB","wN","wR"]]),players:a?"w"===n?{white:x.uid,black:"AI"}:{white:"AI",black:x.uid}:{white:x.uid,black:null},playerNames:a?"w"===n?{white:j.name,black:"AI (".concat("beginner"===ne?"\ucd08\uae09":"intermediate"===ne?"\uc911\uae09":"\uace0\uae09",")")}:{white:"AI (".concat("beginner"===ne?"\ucd08\uae09":"intermediate"===ne?"\uc911\uae09":"\uace0\uae09",")"),black:j.name}:{white:j.name,black:null},playerRanks:a?"w"===n?{white:ge,black:"AI"}:{white:"AI",black:ge}:{white:ge,black:"Unranked"},playerRatings:a?"w"===n?{white:j.chessRating||0,black:0}:{white:0,black:j.chessRating||0}:{white:j.chessRating||0,black:null},turn:"w",status:a?"active":"waiting",winner:null,timeControl:F,whiteTime:F,blackTime:F,castling:{wK:!0,wQ:!0,bK:!0,bQ:!0},enPassant:null,moveHistory:[],createdAt:(0,c.O5)(),ratingChange:null,aiMode:a,aiDifficulty:a?ne:null,aiColor:a?s:null,playerColor:a?n:null};try{await(0,c.BN)(t,r),R(e),K({message:a?"AI \ub300\uc804 \uc2dc\uc791!":"\uccb4\uc2a4 \ubc29 \uc0dd\uc131 \uc644\ub8cc! \ucf54\ub4dc: ".concat(e),type:"success"}),Z.current&&await Z.current()}catch(l){u.vF.error("Error creating room:",l),K({message:"\ubc29 \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}},Ke=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||I.trim();if(!e)return void K({message:"\ucc38\uac00\ud560 \ubc29 \ucf54\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694.",type:"error"});if(!x)return void K({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});const t=(0,c.H9)(c.db,"chessGames",e);try{await(0,c.c4)(c.db,async e=>{const a=await e.get(t);if(!a.exists())throw new Error("\ubc29\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const n=a.data();if(n.players.black)throw new Error("\ubc29\uc774 \uac00\ub4dd \ucc3c\uc2b5\ub2c8\ub2e4.");if(n.players.white===x.uid)throw new Error("\uc790\uc2e0\uc774 \ub9cc\ub4e0 \ubc29\uc5d0\ub294 \ucc38\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");e.update(t,{"players.black":x.uid,"playerNames.black":j.name,"playerRanks.black":ge,"playerRatings.black":j.chessRating||0,status:"active"})}),R(e),Z.current&&await Z.current()}catch(a){u.vF.error("Error joining room: ",a),K({message:"\ucc38\uac00 \uc2e4\ud328: ".concat(a.message),type:"error"})}},Ge=(e,t)=>{if(!ve||"active"!==P.status||ce)return;const a=P.board[e][t];if(G&&T.some(a=>{let[n,s]=a;return n===e&&s===t}))Qe(e,t);else if(a&&a[0]===pe){Q({row:e,col:t,piece:a});const n=Ee(P.board,e,t,a);B(n)}else Q(null),B([])},Qe=async(e,t)=>{if(!G||!P)return;const{row:a,col:n,piece:s}=G;"P"!==s[1]||0!==e&&7!==e?await Be(a,n,e,t,s):J({toRow:e,toCol:t,fromRow:a,fromCol:n})},Te=(0,s.useCallback)(async()=>{var e;if(P&&C&&(null===(e=P.players)||void 0===e?void 0:e.white)===(null===x||void 0===x?void 0:x.uid))try{await(0,c.kd)((0,c.H9)(c.db,"chessGames",C))}catch(t){u.vF.error("Error deleting room:",t)}R(null),S(null),M(!0),Q(null),B([])},[P,C,x]),Be=(0,s.useCallback)(async function(e,t,a,s,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!C||ce)return;ie(!0);const i=(0,c.H9)(c.db,"chessGames",C);try{const o=await(0,c.c4)(c.db,async c=>{const o=await c.get(i);if(!o.exists())throw new Error("\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const u=o.data();if("active"!==u.status)return{status:u.status,winner:u.winner,aiMode:u.aiMode,moveMade:!1};const d=r[0];if(u.turn!==d)throw new Error("\uc0c1\ub300\ubc29\uc758 \ud134\uc785\ub2c8\ub2e4.");let m=v(u.board).map(e=>[...e]);m[e][t]=null,m[a][s]=l?d+l:r;const h=(0,n.A)({},u.castling);let w=null;if("wK"===r&&(h.wK=!1,h.wQ=!1),"bK"===r&&(h.bK=!1,h.bQ=!1),"wR"===r&&7===e&&0===t&&(h.wQ=!1),"wR"===r&&7===e&&7===t&&(h.wK=!1),"bR"===r&&0===e&&0===t&&(h.bQ=!1),"bR"===r&&0===e&&7===t&&(h.bK=!1),"K"===r[1]&&2===Math.abs(t-s)&&(6===s?(m[e][5]=m[e][7],m[e][7]=null):(m[e][3]=m[e][0],m[e][0]=null)),"P"===r[1]&&u.enPassant){const[t,n]=u.enPassant;a===t&&s===n&&(m[e][s]=null)}"P"===r[1]&&2===Math.abs(e-a)&&(w=[(e+a)/2,t]);const g="abcdefgh",y="".concat("P"!==r[1]?r[1]:"").concat(g[t]).concat(8-e," -> ").concat(g[s]).concat(8-a),x=[...u.moveHistory,y],k="w"===d?"b":"w";let j=u.status,N=null,C=null,R=null;const P=Ae(m,k);P&&(j="finished",C=P,N="checkmate"===P?d:"draw"),"finished"===j&&"draw"!==N&&(R={["w"===N?"white":"black"]:f,["w"===N?"black":"white"]:b});const S={board:p(m),turn:k,castling:h,enPassant:w,moveHistory:x,status:j,winner:N,endReason:C,ratingChange:R};return c.update(i,S),{status:j,winner:N,aiMode:u.aiMode,moveMade:!0}});if(o.moveMade&&"finished"===o.status&&o.aiMode){const e=o.winner===pe,t="draw"===o.winner;if(e||t&&Math.random()<.5){const e=(()=>{const e=e=>{const t=e.reduce((e,t)=>e+t.weight,0);let a=Math.random()*t;for(const n of e)if(a-=n.weight,a<=0)return n.amount;return e[e.length-1].amount};return[{type:"cash",amount:e([{amount:5e4,weight:5},{amount:3e4,weight:10},{amount:2e4,weight:15},{amount:1e4,weight:20},{amount:5e3,weight:18},{amount:3e3,weight:12},{amount:1e3,weight:10},{amount:500,weight:7},{amount:100,weight:3}])},{type:"coupon",amount:e([{amount:20,weight:10},{amount:10,weight:20},{amount:5,weight:20},{amount:3,weight:20},{amount:1,weight:30}])}]})();we(e),me(!0)}else{const e=(new Date).toDateString(),a="chessPlayCount_".concat(x.uid,"_").concat(e),n=fe+1;localStorage.setItem(a,n.toString()),be(n),t&&K({message:"\ubb34\uc2b9\ubd80! \uc544\uc27d\uc9c0\ub9cc \ubcf4\uc0c1\uc740 \ub2e4\uc74c \uae30\ud68c\uc5d0!",type:"info"}),setTimeout(()=>Te(),2e3)}}Q(null),B([]),Z.current&&await Z.current()}catch(o){u.vF.error("Error making move: ",o),K({message:"\uc774\ub3d9 \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(o.message),type:"error"}),Z.current&&await Z.current()}finally{ie(!1)}},[C,ce,pe,fe,x,Ae,we,me,be,K,Te,Q,B]);(0,s.useEffect)(()=>()=>{$.current&&(clearTimeout($.current),$.current=null)},[]),(0,s.useEffect)(()=>{(async()=>{var e;if(!P||!C||"active"!==P.status)return;if(!P.aiMode)return;if(re||ce)return;const t=P.aiColor;if(P.turn!==t)return;const a=(null===(e=P.moveHistory)||void 0===e?void 0:e.length)||0;if(a===ee.current&&a>0)return;le(!0),ee.current=a+1;const n=500+1e3*Math.random();$.current=setTimeout(async()=>{try{const e=(0,c.H9)(c.db,"chessGames",C),a=await(0,c.x7)(e);if(!a.exists())return void le(!1);const n=a.data();if("active"!==n.status||n.turn!==t)return void le(!1);const s=((e,t,a,n)=>{const s=[];for(let i=0;i<8;i++)for(let a=0;a<8;a++){const r=e[i][a];r&&r[0]===t&&n(e,i,a,r,!0).forEach(e=>{let[t,n]=e;s.push({from:[i,a],to:[t,n],piece:r})})}if(0===s.length)return null;if("beginner"===a)return s[Math.floor(Math.random()*s.length)];const r="intermediate"===a?2:3;let l=null,c=-1/0;for(const i of s){const a=e.map(e=>[...e]);a[i.to[0]][i.to[1]]=i.piece,a[i.from[0]][i.from[1]]=null;const s=k(a,r-1,!1,-1/0,1/0,t,n);s>c&&(c=s,l=i)}return l})(v(n.board),t,ne,Ee);if(s){const{from:e,to:t,piece:a}=s;await Be(e[0],e[1],t[0],t[1],a)}}catch(e){u.vF.error("AI move error:",e),le(!1)}le(!1),$.current=null},n)})()},[null===P||void 0===P?void 0:P.turn,null===P||void 0===P?void 0:P.status,null===P||void 0===P||null===(e=P.moveHistory)||void 0===e?void 0:e.length,C,ne,Be,Ee,ce]);const De=e=>{const t=Math.floor(e/60),a=e%60;return"".concat(t,":").concat(a.toString().padStart(2,"0"))};if(E){return(0,d.jsx)("div",{className:"chess-container",children:(0,d.jsxs)("div",{className:"room-creation",children:[(0,d.jsx)("h2",{children:"\u265a \uccb4\uc2a4 \uac8c\uc784 \u2654"}),(0,d.jsx)("p",{children:"\uc804\ub7b5\uc801 \uc0ac\uace0\ub825\uc744 \uae30\ub974\ub294 \ucd5c\uace0\uc758 \ub450\ub1cc \uac8c\uc784!"}),(0,d.jsxs)("div",{className:"user-rank-info",children:[(0,d.jsxs)("p",{children:["\ub0b4 \ub4f1\uae09: ",(0,d.jsx)("strong",{children:ge})," (",(null===j||void 0===j?void 0:j.chessRating)||0,"\uc810)"]}),ye&&(0,d.jsxs)("p",{className:"next-rank-guide",children:["\ub2e4\uc74c \ub4f1\uae09 (",ye,")\uae4c\uc9c0 ",(0,d.jsxs)("strong",{children:[xe,"\uc810"]})," \ub0a8\uc558\uc2b5\ub2c8\ub2e4."]})]}),(0,d.jsxs)("div",{className:"game-mode-selector",children:[(0,d.jsx)("h3",{children:"\uac8c\uc784 \ubaa8\ub4dc \uc120\ud0dd"}),(0,d.jsxs)("div",{className:"mode-options",children:[(0,d.jsx)("button",{className:"player"===te?"selected":"",onClick:()=>ae("player"),children:"\ud83d\udc65 \ud50c\ub808\uc774\uc5b4 \ub300\uc804"}),(0,d.jsxs)("button",{className:"ai"===te?"selected":"",onClick:()=>ae("ai"),children:["\ud83e\udd16 AI \ub300\uc804 (",fe,"/3)"]})]})]}),"ai"===te&&(0,d.jsxs)("div",{className:"ai-difficulty-selector",children:[(0,d.jsx)("h3",{children:"AI \ub09c\uc774\ub3c4"}),(0,d.jsxs)("div",{className:"difficulty-options",children:[(0,d.jsx)("button",{className:"beginner"===ne?"selected":"",onClick:()=>se("beginner"),children:"\ud83d\ude0a \ucd08\uae09"}),(0,d.jsx)("button",{className:"intermediate"===ne?"selected":"",onClick:()=>se("intermediate"),children:"\ud83e\udd14 \uc911\uae09"}),(0,d.jsx)("button",{className:"advanced"===ne?"selected":"",onClick:()=>se("advanced"),children:"\ud83d\udd25 \uace0\uae09"})]})]}),H.message&&(0,d.jsx)("div",{className:"feedback ".concat(H.type),children:H.message}),(0,d.jsxs)("div",{className:"time-control-selector",children:[(0,d.jsx)("h3",{children:"\uc2dc\uac04 \uc81c\ud55c \uc120\ud0dd"}),(0,d.jsx)("div",{className:"time-options",children:[180,300,600,900].map(e=>(0,d.jsxs)("button",{className:F===e?"selected":"",onClick:()=>L(e),children:[e/60,"\ubd84"]},e))})]}),(0,d.jsxs)("div",{className:"room-actions",children:[(0,d.jsx)("button",{onClick:He,className:"create-room-btn",children:"ai"===te?"\ud83e\udd16 AI \ub300\uc804 \uc2dc\uc791":"\uc0c8\ub85c\uc6b4 \ubc29 \ub9cc\ub4e4\uae30"}),"player"===te&&(0,d.jsxs)("div",{className:"join-room",children:[(0,d.jsx)("input",{type:"text",value:I,onChange:e=>A(e.target.value),placeholder:"\ubc29 \ucf54\ub4dc \uc785\ub825",maxLength:"6"}),(0,d.jsx)("button",{onClick:()=>Ke(),children:"\ucf54\ub4dc\ub85c \ucc38\uac00"})]})]}),D.length>0&&(0,d.jsxs)("div",{className:"available-rooms",children:[(0,d.jsx)("h3",{children:"\ud83d\udccb \ub300\uae30 \uc911\uc778 \ubc29 \ubaa9\ub85d"}),(0,d.jsx)("div",{className:"rooms-list",children:D.map(e=>{var t,a;return(0,d.jsxs)("div",{className:"room-item",children:[(0,d.jsxs)("div",{className:"room-info",children:[(0,d.jsxs)("span",{className:"room-host",children:["\ud638\uc2a4\ud2b8: ",e.playerNames.white," (",(null===(t=e.playerRanks)||void 0===t?void 0:t.white)||"Unranked",", ",(null===(a=e.playerRatings)||void 0===a?void 0:a.white)||0,"\uc810)"]}),(0,d.jsxs)("span",{className:"room-time",children:["\u23f1 ",De(e.timeControl)]}),(0,d.jsxs)("span",{className:"room-code",children:["\ucf54\ub4dc: ",e.id]})]}),(0,d.jsxs)("div",{className:"room-item-buttons",children:[(0,d.jsx)("button",{onClick:()=>Ke(e.id),className:"join-btn",children:"\ucc38\uac00"}),(null===N||void 0===N?void 0:N())&&(0,d.jsx)("button",{onClick:()=>(async e=>{if(null!==N&&void 0!==N&&N())try{await(0,c.kd)((0,c.H9)(c.db,"chessGames",e)),K({message:"\ubc29 ".concat(e,"\uac00 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),type:"success"}),Re()}catch(t){u.vF.error("Error deleting room by admin:",t),K({message:"\ubc29 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}else K({message:"\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"})})(e.id),className:"delete-btn",children:"\uc0ad\uc81c"})]})]},e.id)})})]}),(0,d.jsxs)("div",{className:"chess-rules",children:[(0,d.jsx)("h3",{children:"\uccb4\uc2a4 \uae30\ubcf8 \uaddc\uce59"}),(0,d.jsxs)("ul",{children:[(0,d.jsx)("li",{children:"\ubc31(White)\uc774 \uba3c\uc800 \uc2dc\uc791\ud569\ub2c8\ub2e4."}),(0,d.jsx)("li",{children:"\uc0c1\ub300\ubc29\uc758 \ud0b9\uc744 \uccb4\ud06c\uba54\uc774\ud2b8\ud558\uba74 \uc2b9\ub9ac\ud569\ub2c8\ub2e4."}),(0,d.jsxs)("li",{children:["\ud50c\ub808\uc774\uc5b4 \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,d.jsx)("strong",{children:"\uc810\uc218(+15)"}),"\uc640 \ucfe0\ud3f0 3\uac1c, \ud328\ubc30 \uc2dc ",(0,d.jsx)("strong",{children:"\uc810\uc218(-10)"})]}),(0,d.jsxs)("li",{children:["AI \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,d.jsx)("strong",{children:"\uce74\ub4dc \ubcf4\uc0c1"})," \uc120\ud0dd (\ud604\uae08 \ub610\ub294 \ucfe0\ud3f0), \ud558\ub8e8 3\ud68c \uc81c\ud55c"]})]})]})]})})}if(!P)return(0,d.jsx)(o.AlchanLoading,{});const _e=P.players.white,Fe=P.players.black;return(0,d.jsxs)("div",{className:"chess-container",style:{backgroundColor:"#0a0a12",minHeight:"100%",width:"100%"},children:[(0,d.jsxs)("div",{className:"game-info",children:[(0,d.jsxs)("div",{className:"player black ".concat("b"===P.turn?"active":""," ").concat((null===x||void 0===x?void 0:x.uid)===Fe?"my-player":"opponent-player"),children:[(0,d.jsxs)("span",{className:"player-name",children:["\u265b ",P.playerNames.black||"\ub300\uae30\uc911...",(0,d.jsxs)("span",{className:"player-rank",children:["[",(null===(t=P.playerRanks)||void 0===t?void 0:t.black)||"Unranked","] (",(null===(a=P.playerRatings)||void 0===a?void 0:a.black)||0,"\uc810)"]})]}),(0,d.jsx)("span",{className:"player-time",children:De(V)})]}),(0,d.jsx)("div",{className:"game-status",children:"finished"===P.status?"draw"===P.winner?(0,d.jsx)("span",{children:"\ubb34\uc2b9\ubd80!"}):P.winner===pe?(0,d.jsxs)("span",{className:"winner",children:["\ud83c\udf89 \uc2b9\ub9ac! (",P.ratingChange["w"===pe?"white":"black"]>0?"+":"",P.ratingChange["w"===pe?"white":"black"],"\uc810) \ucfe0\ud3f0 3\uac1c \ud68d\ub4dd!"]}):(0,d.jsxs)("span",{className:"loser",children:["\ud328\ubc30! (",P.ratingChange["w"===pe?"white":"black"],"\uc810)"]}):"waiting"===P.status?(0,d.jsxs)("span",{children:["\uc0c1\ub300\ubc29\uc744 \uae30\ub2e4\ub9ac\ub294 \uc911... (\ucf54\ub4dc: ",C,")"]}):(0,d.jsx)("span",{children:ve?"\ub2f9\uc2e0\uc758 \ucc28\ub840":"\uc0c1\ub300\ubc29 \ucc28\ub840"})}),(0,d.jsxs)("div",{className:"player white ".concat("w"===P.turn?"active":""," ").concat((null===x||void 0===x?void 0:x.uid)===_e?"my-player":"opponent-player"),children:[(0,d.jsxs)("span",{className:"player-name",children:["\u2655 ",P.playerNames.white,(0,d.jsxs)("span",{className:"player-rank",children:["[",(null===(g=P.playerRanks)||void 0===g?void 0:g.white)||"Unranked","] (",(null===(y=P.playerRatings)||void 0===y?void 0:y.white)||0,"\uc810)"]})]}),(0,d.jsx)("span",{className:"player-time",children:De(U)})]})]}),(0,d.jsxs)("div",{className:"board-container",children:[(0,d.jsxs)("div",{className:"view-toggle",children:[(0,d.jsx)("button",{className:"toggle-btn ".concat(oe?"":"active"),onClick:()=>ue(!1),children:"2D"}),(0,d.jsx)("button",{className:"toggle-btn ".concat(oe?"active":""),onClick:()=>ue(!0),children:"3D"})]}),oe?(0,d.jsx)("div",{className:"chess-board-3d",children:(0,d.jsx)(s.Suspense,{fallback:(0,d.jsx)("div",{className:"loading-3d",children:"3D \ubcf4\ub4dc \ub85c\ub529 \uc911..."}),children:(0,d.jsx)(m,{board:P.board,selectedPiece:G,possibleMoves:T,onSquareClick:Ge,myColor:pe,isInCheck:Ie})})}):(0,d.jsx)("div",{className:"chess-board ".concat("b"===pe?"flipped":""),children:P.board.map((e,t)=>e.map((e,a)=>{const n=(null===G||void 0===G?void 0:G.row)===t&&(null===G||void 0===G?void 0:G.col)===a,s=T.some(e=>{let[n,s]=e;return n===t&&s===a}),r=(t+a)%2===0,l=e&&"K"===e[1]&&Ie(P.board,e[0]);return(0,d.jsxs)("div",{className:"square ".concat(r?"light":"dark","\n                                                   ").concat(n?"selected":"","\n                                                   ").concat(s?"possible":"","\n                                                   ").concat(l?"check":""),onClick:()=>Ge(t,a),children:[e&&(0,d.jsx)("div",{className:"piece ".concat("w"===e[0]?"white-piece":"black-piece"),children:h[e]}),s&&!e&&(0,d.jsx)("div",{className:"move-dot"}),s&&e&&(0,d.jsx)("div",{className:"capture-hint"})]},"".concat(t,"-").concat(a))}))}),z&&(0,d.jsx)("div",{className:"promotion-modal",children:(0,d.jsxs)("div",{className:"promotion-content",children:[(0,d.jsx)("h3",{children:"\ud504\ub85c\ubaa8\uc158 \uc120\ud0dd"}),(0,d.jsx)("div",{className:"promotion-pieces",children:["Q","R","B","N"].map(e=>(0,d.jsx)("button",{onClick:()=>(async e=>{if(!z)return;const{fromRow:t,fromCol:a,toRow:n,toCol:s}=z,r=P.board[t][a];await Be(t,a,n,s,r,e),J(null)})(e),className:"promotion-piece",children:h[pe+e]},e))})]})}),re&&(0,d.jsx)("div",{className:"ai-thinking",children:(0,d.jsxs)("div",{className:"thinking-content",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"AI\uac00 \uc218\ub97c \uace0\ubbfc\ud558\ub294 \uc911..."})]})}),de&&2===he.length&&(0,d.jsx)("div",{className:"reward-modal",children:(0,d.jsxs)("div",{className:"reward-content",children:[(0,d.jsx)("h3",{children:"\ud83c\udf89 \uc2b9\ub9ac \ubcf4\uc0c1!"}),(0,d.jsx)("p",{children:"\ud558\ub098\uc758 \uce74\ub4dc\ub97c \uc120\ud0dd\ud558\uc138\uc694"}),(0,d.jsx)("div",{className:"reward-cards",children:he.map((e,t)=>(0,d.jsxs)("div",{className:"reward-card",onClick:()=>(async e=>{if(x&&C)try{const t=(0,c.H9)(c.db,"users",x.uid),a=(new Date).toDateString(),n="chessPlayCount_".concat(x.uid,"_").concat(a);await(0,c.c4)(c.db,async a=>{if(!(await a.get(t)).exists())return;const n={};"cash"===e.type?n.balance=(0,c.GV)(e.amount):"coupon"===e.type&&(n.couponBalance=(0,c.GV)(e.amount)),a.update(t,n)});const s=fe+1;localStorage.setItem(n,s.toString()),be(s),me(!1),K({message:"cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0\uc744 \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c\ub97c \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"),type:"success"}),(0,i.Mx)(c.db,{classCode:null===j||void 0===j?void 0:j.classCode,userId:x.uid,userName:(null===j||void 0===j?void 0:j.name)||"\uc0ac\uc6a9\uc790",type:i.gI.GAME_WIN,description:"\uccb4\uc2a4 AI(".concat(ne,") \uc2b9\ub9ac - ").concat("cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c")," \ud68d\ub4dd"),amount:"cash"===e.type?e.amount:0,couponAmount:"coupon"===e.type?e.amount:0,metadata:{gameType:"chess",opponent:"AI",difficulty:ne,rewardType:e.type,rewardAmount:e.amount}}),setTimeout(()=>{Te()},2e3)}catch(t){u.vF.error("Error applying reward:",t),K({message:"\ubcf4\uc0c1 \uc9c0\uae09\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}})(e),children:[(0,d.jsx)("div",{className:"card-icon",children:"cash"===e.type?"\ud83d\udcb5":"\ud83c\udfab"}),(0,d.jsx)("div",{className:"card-title",children:"cash"===e.type?"\ud604\uae08":"\ucfe0\ud3f0"}),(0,d.jsx)("div",{className:"card-amount",children:"cash"===e.type?"".concat(e.amount.toLocaleString(),"\uc6d0"):"".concat(e.amount,"\uac1c")})]},t))})]})})]}),H.message&&(0,d.jsx)("div",{className:"feedback ".concat(H.type),children:H.message}),(0,d.jsx)("div",{className:"game-controls",children:(0,d.jsx)("button",{onClick:Te,className:"leave-button",children:"\uac8c\uc784 \ub098\uac00\uae30"})}),O.length>0&&(0,d.jsxs)("div",{className:"move-history",children:[(0,d.jsx)("h4",{children:"\uc774\ub3d9 \uae30\ub85d"}),(0,d.jsx)("div",{className:"moves-list",children:O.map((e,t)=>(0,d.jsxs)("span",{className:"move",children:[t%2===0?"".concat(Math.floor(t/2)+1,". "):"",e]},t))})]})]})}}}]);
//# sourceMappingURL=757.f15444f9.chunk.js.map