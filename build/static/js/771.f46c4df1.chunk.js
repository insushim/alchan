"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[771],{1771:(e,s,a)=>{a.r(s),a.d(s,{default:()=>p});var r=a(4919),n=a(5043),t=a(5016),l=a(791),i=a(5472),c=a(577),o=(a(9270),a(8180)),d=a(579);const u={hobak:{name:"\ud638\ubc15\uace0\ub204",description:"\uac01 \ud50c\ub808\uc774\uc5b4\uac00 5\uac1c\uc758 \ub9d0\uc744 \uac00\uc9c0\uace0 \uc2dc\uc791. \uc0c1\ud558\uc88c\uc6b0\ub85c\ub9cc \uc774\ub3d9 \uac00\ub2a5.",rules:["\ub9d0\uc740 \uc0c1\ud558\uc88c\uc6b0 \uc778\uc811\ud55c \ube48 \uce78\uc73c\ub85c\ub9cc \uc774\ub3d9 \uac00\ub2a5","\uc0c1\ub300\ubc29\uc774 \ub354 \uc774\uc0c1 \uc6c0\uc9c1\uc77c \uc218 \uc5c6\uac8c \ub9cc\ub4e4\uba74 \uc2b9\ub9ac","\ub300\uac01\uc120 \uc774\ub3d9 \ubd88\uac00","\ub9d0\uc744 \uc7a1\ub294 \uae30\ub2a5\uc740 \uc5c6\uc74c"],initialBoard:()=>{const e=Array(5).fill(null).map(()=>Array(5).fill(null));return e[0][0]="B",e[0][1]="B",e[0][2]="B",e[0][3]="B",e[0][4]="B",e[4][0]="R",e[4][1]="R",e[4][2]="R",e[4][3]="R",e[4][4]="R",e},canCapture:!1,allowDiagonal:!1},cham:{name:"\ucc38\uace0\ub204",description:"\uac01 \ud50c\ub808\uc774\uc5b4\uac00 4\uac1c\uc758 \ub9d0\uc744 \uac00\uc9c0\uace0 \uc2dc\uc791. \uc0c1\ud558\uc88c\uc6b0\uc640 \ub300\uac01\uc120 \uc774\ub3d9 \uac00\ub2a5.",rules:["\ub9d0\uc740 \uc0c1\ud558\uc88c\uc6b0 \ubc0f \ub300\uac01\uc120 \uc778\uc811\ud55c \ube48 \uce78\uc73c\ub85c \uc774\ub3d9 \uac00\ub2a5","\uc0c1\ub300\ubc29 \ub9d0\uc744 \ub6f0\uc5b4\ub118\uc5b4 \uc7a1\uc744 \uc218 \uc788\uc74c","\uc0c1\ub300\ubc29 \ub9d0\uc744 \ubaa8\ub450 \uc7a1\uc73c\uba74 \uc2b9\ub9ac"],initialBoard:()=>{const e=Array(5).fill(null).map(()=>Array(5).fill(null));return e[0][1]="B",e[0][3]="B",e[1][1]="B",e[1][3]="B",e[3][1]="R",e[3][3]="R",e[4][1]="R",e[4][3]="R",e},canCapture:!0,allowDiagonal:!0},gonjil:{name:"\uace4\uc9c8\uace0\ub204",description:"\uac01 \ud50c\ub808\uc774\uc5b4\uac00 6\uac1c\uc758 \ub9d0\uc744 \uac00\uc9c0\uace0 \uc2dc\uc791. \ud3ec\uc704\ud558\uc5ec \uc7a1\uae30 \uac00\ub2a5.",rules:["\ub9d0\uc740 \uc0c1\ud558\uc88c\uc6b0\ub85c\ub9cc \uc774\ub3d9 \uac00\ub2a5","\uc0c1\ub300\ubc29 \ub9d0\uc744 \ud3ec\uc704\ud558\uba74 \uc7a1\uc744 \uc218 \uc788\uc74c","\uc0c1\ub300\ubc29 \ub9d0\uc744 \ubaa8\ub450 \uc7a1\uac70\ub098 \uc6c0\uc9c1\uc77c \uc218 \uc5c6\uac8c \ub9cc\ub4e4\uba74 \uc2b9\ub9ac"],initialBoard:()=>{const e=Array(5).fill(null).map(()=>Array(5).fill(null));return e[0][0]="B",e[0][2]="B",e[0][4]="B",e[1][1]="B",e[1][2]="B",e[1][3]="B",e[3][1]="R",e[3][2]="R",e[3][3]="R",e[4][0]="R",e[4][2]="R",e[4][4]="R",e},canCapture:!0,allowDiagonal:!1}},m=e=>{const s={};return e.forEach((e,a)=>{e.forEach((e,r)=>{e&&(s["".concat(a,"-").concat(r)]=e)})}),s},h=e=>{const s=Array(5).fill(null).map(()=>Array(5).fill(null));for(const a in e){const[r,n]=a.split("-").map(Number);s[r][n]=e[a]}return s},p=()=>{const{user:e,userDoc:s}=(0,t.As)(),[a,p]=(0,n.useState)(null),[g,y]=(0,n.useState)(null),[f,b]=(0,n.useState)(!0),[x,j]=(0,n.useState)(""),[v,N]=(0,n.useState)({message:"",type:""}),[w,B]=(0,n.useState)(null),[R,k]=(0,n.useState)("hobak"),[E,C]=(0,n.useState)([]),[A,S]=(0,n.useState)(!1),[G,H]=(0,n.useState)(!1),D=g&&e&&g.turn===(g.players.B===e.uid?"B":"R"),M=g&&e&&(g.players.B===e.uid?"B":"R"),T=(0,n.useRef)(a);(0,n.useEffect)(()=>{T.current=a},[a]);const L=(0,n.useRef)(g);(0,n.useEffect)(()=>{L.current=g},[g]);const _=(0,n.useRef)(e);(0,n.useEffect)(()=>{_.current=e},[e]),(0,n.useEffect)(()=>{const e=()=>{const e=T.current,s=L.current,a=_.current;e&&s&&a&&"waiting"===s.status&&s.players.B===a.uid&&(0,i.kd)((0,i.H9)(l.db,"gonuGames",e))};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);const I=(0,n.useCallback)(async()=>{if(e){H(!0);try{const s=(0,i.P)((0,i.rJ)(l.db,"gonuGames"),(0,i._M)("status","==","waiting")),a=await(0,i.GG)(s),n=[];a.forEach(s=>{const a=s.data();a.players.B!==e.uid&&n.push((0,r.A)({id:s.id},a))}),C(n)}catch(s){console.error("Error fetching rooms:",s)}finally{H(!1)}}},[e]);(0,n.useEffect)(()=>{if(f&&e){I();const e=setInterval(I,6e4);return()=>clearInterval(e)}},[f,e,I]);const O=(0,n.useCallback)(async()=>{if(!a)return;const e=(0,i.H9)(l.db,"gonuGames",a);try{const s=await(0,i.x7)(e);if(s.exists()){const a=s.data(),n=(0,r.A)((0,r.A)({},a),{},{board:h(a.board)});y(n),b(!1),"finished"===a.status&&setTimeout(async()=>{try{await(0,i.kd)(e)}catch(s){console.error("Error deleting finished game:",s)}},1e4)}else N({message:"\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"}),p(null),y(null),b(!0)}catch(s){console.error("Error fetching game data:",s)}},[a]);(0,c.nm)(O,{interval:18e4,enabled:!!a}),(0,n.useEffect)(()=>{if(v.message){const e=setTimeout(()=>N({message:"",type:""}),3e3);return()=>clearTimeout(e)}},[v.message]);const J=async()=>{if(!e)return void N({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});H(!0);const a=Math.random().toString(36).substring(2,8),r=(0,i.H9)(l.db,"gonuGames",a),n=u[R],t={board:m(n.initialBoard()),players:{B:e.uid,R:null},playerNames:{B:s.name,R:null},turn:"B",status:"waiting",winner:null,gameType:R,gameName:n.name,createdAt:(0,i.O5)()};try{await(0,i.BN)(r,t),p(a),N({message:"".concat(n.name," \ubc29 \uc0dd\uc131 \uc644\ub8cc! \ucf54\ub4dc: ").concat(a),type:"success"}),await O()}catch(c){console.error("Error creating room:",c),N({message:"\ubc29 \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}finally{H(!1)}},P=async a=>{const r=a||x.trim();if(!r)return void N({message:"\ucc38\uac00\ud560 \ubc29 \ucf54\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694.",type:"error"});if(!e)return void N({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});H(!0);const n=(0,i.H9)(l.db,"gonuGames",r);try{await(0,i.c4)(l.db,async a=>{const r=await a.get(n);if(!r.exists())throw new Error("\ubc29\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const t=r.data();if(t.players.R)throw new Error("\ubc29\uc774 \uac00\ub4dd \ucc3c\uc2b5\ub2c8\ub2e4.");if(t.players.B===e.uid)throw new Error("\uc790\uc2e0\uc774 \ub9cc\ub4e0 \ubc29\uc5d0\ub294 \ucc38\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");a.update(n,{"players.R":e.uid,"playerNames.R":s.name,status:"active"})}),p(r),await O()}catch(t){console.error("Error joining room: ",t),N({message:"\ucc38\uac00 \uc2e4\ud328: ".concat(t.message),type:"error"})}finally{H(!1)}},q=(0,n.useCallback)(async(e,s)=>{if(!D||!w||!g)return;const{row:r,col:n}=w,t=g.board,c=t[r][n],o=u[g.gameType||"hobak"];if(c!==M)return;const d="B"===M?"R":"B",p=[[-1,0],[1,0],[0,-1],[0,1]];o.allowDiagonal&&p.push([-1,-1],[-1,1],[1,-1],[1,1]);let y=e,f=s,b=[],x=!1;if(e<0||e>=5||s<0||s>=5)return;if("\ucc38\uace0\ub204"===o.name&&o.canCapture){const a=t[e][s];if(Math.abs(e-r)<=1&&Math.abs(s-n)<=1&&a===d){const a=e+(e-r),l=s+(s-n);a>=0&&a<5&&l>=0&&l<5&&null===t[a][l]&&(y=a,f=l,b.push([e,s]),x=!0)}else null===t[e][s]&&(x=p.some(a=>{let[t,l]=a;return r+t===e&&n+l===s}))}else null===t[e][s]&&(x=p.some(a=>{let[t,l]=a;return r+t===e&&n+l===s}));if(!x)return void N({message:"\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uc774\ub3d9\uc785\ub2c8\ub2e4.",type:"error"});const j=(0,i.H9)(l.db,"gonuGames",a);try{await(0,i.c4)(l.db,async e=>{const s=await e.get(j);if(!s.exists())throw new Error("\uac8c\uc784\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");const a=s.data();if(a.turn!==M)throw new Error("\uc0c1\ub300\ubc29\uc758 \ud134\uc785\ub2c8\ub2e4.");let t=h(a.board);t[r][n]=null,b.forEach(e=>{let[s,a]=e;t[s][a]=null}),t[y][f]=M;let l=null;e.update(j,{board:m(t),turn:d,status:"active",winner:l})}),B(null)}catch(v){console.error("Move error:",v),N({message:"\uc774\ub3d9 \uc2e4\ud328: ".concat(v.message),type:"error"})}},[a,g,D,M,w,null===e||void 0===e?void 0:e.uid]);if(f)return(0,d.jsx)("div",{className:"gonu-container",children:(0,d.jsxs)("div",{className:"room-creation",children:[(0,d.jsx)("h2",{children:"\ud83c\udfaf \uace0\ub204 \uac8c\uc784"}),(0,d.jsx)("p",{children:"\uc804\ud1b5 \ud55c\uad6d \ubcf4\ub4dc\uac8c\uc784\uc744 \uc628\ub77c\uc778\uc73c\ub85c \uc990\uaca8\ubcf4\uc138\uc694!"}),v.message&&(0,d.jsx)("div",{className:"feedback ".concat(v.type),children:v.message}),(0,d.jsxs)("div",{className:"game-type-selector",children:[(0,d.jsx)("h3",{children:"\uac8c\uc784 \uc885\ub958 \uc120\ud0dd"}),(0,d.jsx)("div",{className:"game-types",children:Object.entries(u).map(e=>{let[s,a]=e;return(0,d.jsxs)("label",{className:"game-type-option ".concat(R===s?"selected":""),children:[(0,d.jsx)("input",{type:"radio",value:s,checked:R===s,onChange:e=>k(e.target.value)}),(0,d.jsxs)("div",{className:"game-type-info",children:[(0,d.jsx)("strong",{children:a.name}),(0,d.jsx)("small",{children:a.description})]})]},s)})}),(0,d.jsx)("button",{onClick:()=>S(!A),className:"rules-toggle-btn",children:A?"\uaddc\uce59 \uc228\uae30\uae30":"\uaddc\uce59 \ubcf4\uae30"}),A&&(0,d.jsxs)("div",{className:"rules-display",children:[(0,d.jsxs)("h4",{children:[u[R].name," \uaddc\uce59"]}),(0,d.jsx)("ul",{children:u[R].rules.map((e,s)=>(0,d.jsx)("li",{children:e},s))})]})]}),(0,d.jsxs)("div",{className:"room-actions",children:[(0,d.jsx)("button",{onClick:J,className:"create-room-btn",disabled:G,children:G?(0,d.jsx)("span",{className:"loading"}):"\uc0c8\ub85c\uc6b4 \ubc29 \ub9cc\ub4e4\uae30"}),(0,d.jsxs)("div",{className:"join-room",children:[(0,d.jsx)("input",{type:"text",value:x,onChange:e=>j(e.target.value),placeholder:"\ubc29 \ucf54\ub4dc \uc785\ub825",maxLength:"6"}),(0,d.jsx)("button",{onClick:()=>P(),disabled:G,children:G?(0,d.jsx)("span",{className:"loading"}):"\ucf54\ub4dc\ub85c \ucc38\uac00"})]})]}),E.length>0&&(0,d.jsxs)("div",{className:"available-rooms",children:[(0,d.jsx)("h3",{children:"\ud83d\udccb \ub300\uae30 \uc911\uc778 \ubc29 \ubaa9\ub85d"}),(0,d.jsx)("div",{className:"rooms-list",children:E.map(e=>(0,d.jsxs)("div",{className:"room-item",children:[(0,d.jsxs)("div",{className:"room-info",children:[(0,d.jsx)("span",{className:"room-type",children:e.gameName}),(0,d.jsxs)("span",{className:"room-host",children:["\ud638\uc2a4\ud2b8: ",e.playerNames.B]}),(0,d.jsxs)("span",{className:"room-code",children:["\ucf54\ub4dc: ",e.id]})]}),(0,d.jsxs)("div",{className:"room-item-buttons",children:[(0,d.jsx)("button",{onClick:()=>P(e.id),className:"join-btn",disabled:G,children:"\ucc38\uac00"}),(null===s||void 0===s?void 0:s.isAdmin)&&(0,d.jsx)("button",{onClick:()=>(async e=>{if(null!==s&&void 0!==s&&s.isAdmin)try{await(0,i.kd)((0,i.H9)(l.db,"gonuGames",e)),N({message:"\ubc29 ".concat(e,"\uac00 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),type:"success"}),I()}catch(a){console.error("Error deleting room by admin:",a),N({message:"\ubc29 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}else N({message:"\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"})})(e.id),className:"delete-btn",children:"\uc0ad\uc81c"})]})]},e.id))})]})]})});if(!g)return(0,d.jsx)(o.AlchanLoading,{});return(0,d.jsxs)("div",{className:"gonu-container",style:{backgroundColor:"#0a0a12",minHeight:"100%",width:"100%"},children:[(0,d.jsxs)("div",{className:"game-info",children:[(0,d.jsxs)("h2",{children:[g.gameName||"\uace0\ub204 \uac8c\uc784"," (\ubc29: ",a,")"]}),(0,d.jsxs)("div",{className:"player-info",children:[(0,d.jsxs)("p",{className:"player-b ".concat("B"===g.turn?"active-turn":""),children:["\u26ab ",g.playerNames.B||"\ud50c\ub808\uc774\uc5b4 1"," ",g.players.B===(null===e||void 0===e?void 0:e.uid)&&"(\ub098)"]}),(0,d.jsxs)("p",{className:"player-r ".concat("R"===g.turn?"active-turn":""),children:["\ud83d\udd34 ",g.playerNames.R||"\ub300\uae30\uc911..."," ",g.players.R===(null===e||void 0===e?void 0:e.uid)&&"(\ub098)"]})]}),"finished"===g.status?(0,d.jsx)("div",{className:"game-status winner",children:g.winner===M?"\ud83c\udf89 \uc2b9\ub9ac! \ucfe0\ud3f0 1\uac1c\ub97c \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!":"\ud83d\ude22 \ud328\ubc30\ud588\uc2b5\ub2c8\ub2e4."}):"waiting"===g.status?(0,d.jsx)("div",{className:"game-status",children:"\uc0c1\ub300\ubc29\uc744 \uae30\ub2e4\ub9ac\ub294 \uc911..."}):(0,d.jsx)("div",{className:"game-status",children:D?"\ud83c\udfaf \ub2f9\uc2e0\uc758 \ud134\uc785\ub2c8\ub2e4.":"\u23f3 \uc0c1\ub300\ubc29\uc758 \ud134\uc744 \uae30\ub2e4\ub9ac\ub294 \uc911..."})]}),(0,d.jsx)("div",{className:"board-area",children:(0,d.jsx)("div",{className:"gonu-board",children:g.board.map((e,s)=>e.map((e,a)=>(0,d.jsxs)("div",{className:"cell ".concat(w&&w.row===s&&w.col===a?"selected":""),onClick:()=>((e,s)=>{if(!D||"active"!==g.status)return;g.board[e][s]===M?B({row:e,col:s}):w&&q(e,s)})(s,a),children:["B"===e&&(0,d.jsx)("div",{className:"piece black"}),"R"===e&&(0,d.jsx)("div",{className:"piece red"})]},"".concat(s,"-").concat(a))))})}),v.message&&(0,d.jsx)("div",{className:"feedback ".concat(v.type),children:v.message}),(0,d.jsx)("button",{onClick:async()=>{if(g&&"waiting"===g.status&&a&&g.players.B===e.uid)try{await(0,i.kd)((0,i.H9)(l.db,"gonuGames",a))}catch(s){console.error("Error deleting room:",s)}p(null),y(null),b(!0),B(null)},className:"leave-button",children:"finished"===g.status?"\ub098\uac00\uae30":"\uac8c\uc784 \ub098\uac00\uae30"})]})}}}]);
//# sourceMappingURL=771.f46c4df1.chunk.js.map