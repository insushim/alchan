"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[757],{6757:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var a=n(4919),s=n(5043),r=n(5016),c=n(577),l=n(791),i=n(9270),o=n(8180),u=n(579);const d={wK:"\u2654",wQ:"\u2655",wR:"\u2656",wB:"\u2657",wN:"\u2658",wP:"\u2659",bK:"\u265a",bQ:"\u265b",bR:"\u265c",bB:"\u265d",bN:"\u265e",bP:"\u265f"},m=[{name:"Unranked",minPoints:0},{name:"C",minPoints:800},{name:"B",minPoints:1e3},{name:"A",minPoints:1200},{name:"S",minPoints:1400},{name:"SS",minPoints:1600}],h=15,w=-10,f=e=>{const t={};return e.forEach((e,n)=>{e.forEach((e,a)=>{e&&(t["".concat(n,"-").concat(a)]=e)})}),t},p=e=>{const t=Array(8).fill(null).map(()=>Array(8).fill(null));for(const n in e){const[a,s]=n.split("-").map(Number);t[a][s]=e[n]}return t},b={P:100,N:320,B:330,R:500,Q:900,K:2e4},v=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],g=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]],y=(e,t,n,a,s,r,c)=>{if(0===t)return((e,t)=>{let n=0;for(let a=0;a<8;a++)for(let s=0;s<8;s++){const r=e[a][s];if(!r)continue;const c=r[0],l=r[1],i=b[l]||0;let o=0;"P"===l?o=v["w"===c?a:7-a][s]:"N"===l&&(o=g[a][s]);const u=i+o;c===t?n+=u:n-=u}return n})(e,r);const l=n?r:"w"===r?"b":"w",i=[];for(let o=0;o<8;o++)for(let t=0;t<8;t++){const n=e[o][t];if(n&&n[0]===l){c(e,o,t,n,!0).forEach(e=>{let[a,s]=e;i.push({from:[o,t],to:[a,s],piece:n})})}}if(0===i.length)return n?-999999:999999;if(n){let n=-1/0;for(const l of i){const i=e.map(e=>[...e]);i[l.to[0]][l.to[1]]=l.piece,i[l.from[0]][l.from[1]]=null;const o=y(i,t-1,!1,a,s,r,c);if(n=Math.max(n,o),s<=(a=Math.max(a,o)))break}return n}{let n=1/0;for(const l of i){const i=e.map(e=>[...e]);i[l.to[0]][l.to[1]]=l.piece,i[l.from[0]][l.from[1]]=null;const o=y(i,t-1,!0,a,s,r,c);if(n=Math.min(n,o),(s=Math.min(s,o))<=a)break}return n}},x=()=>{var e,t,n,b,v;const{user:g,userDoc:x}=(0,r.As)(),[k,j]=(0,s.useState)(null),[N,C]=(0,s.useState)(null),[R,P]=(0,s.useState)(!0),[S,E]=(0,s.useState)(""),[M,A]=(0,s.useState)({message:"",type:""}),[I,H]=(0,s.useState)(null),[K,G]=(0,s.useState)([]),[Q,T]=(0,s.useState)([]),[B,_]=(0,s.useState)(600),[D,L]=(0,s.useState)(600),[U,F]=(0,s.useState)(600),[V,W]=(0,s.useState)(null),[q,J]=(0,s.useState)([]),O=(0,s.useRef)(null),z=(0,s.useRef)(null),X=(0,s.useRef)(null),Y=(0,s.useRef)(0),[Z,$]=(0,s.useState)("player"),[ee,te]=(0,s.useState)("intermediate"),[ne,ae]=(0,s.useState)(!1),[se,re]=(0,s.useState)(!1),[ce,le]=(0,s.useState)(!1),[ie,oe]=(0,s.useState)([]),[ue,de]=(0,s.useState)(0),me=N&&g&&(N.aiMode?N.playerColor:N.players.white===g.uid?"w":"b"),he=N&&N.turn===me,{rank:we,nextRank:fe,pointsForNextRank:pe}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=m[0];for(let r=m.length-1;r>=0;r--)if(e>=m[r].minPoints){t=m[r];break}const n=m.findIndex(e=>e.name===t.name)+1,a=n<m.length?m[n]:null,s=a?a.minPoints-e:0;return{rank:t.name,nextRank:null===a||void 0===a?void 0:a.name,pointsForNextRank:s}}(null===x||void 0===x?void 0:x.chessRating),be=(0,s.useRef)(k);(0,s.useEffect)(()=>{be.current=k},[k]);const ve=(0,s.useRef)(N);(0,s.useEffect)(()=>{ve.current=N},[N]);const ge=(0,s.useRef)(g);(0,s.useEffect)(()=>{ge.current=g},[g]),(0,s.useEffect)(()=>{const e=()=>{var e;const t=be.current,n=ve.current,a=ge.current;t&&n&&a&&(null===(e=n.players)||void 0===e?void 0:e.white)===a.uid&&(0,l.kd)((0,l.H9)(l.db,"chessGames",t))};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);const ye=(0,s.useCallback)(async e=>{if(!k)return;const t=(0,l.H9)(l.db,"chessGames",k),n="w"===e?"b":"w";await(0,l.c4)(l.db,async a=>{const s=await a.get(t);if(!s.exists()||"active"!==s.data().status)return;s.data().players["w"===n?"white":"black"],s.data().players["w"===e?"white":"black"];a.update(t,{status:"finished",winner:n,endReason:"timeout",ratingChange:{["w"===n?"white":"black"]:h,["w"===e?"white":"black"]:w}})}),z.current&&await z.current()},[k]);(0,s.useEffect)(()=>(N&&"active"===N.status&&he&&(O.current=setInterval(async()=>{(0,l.H9)(l.db,"chessGames",k);if("w"===N.turn){const e=Math.max(0,D-1);L(e),e<=0&&await ye("w")}else{const e=Math.max(0,U-1);F(e),e<=0&&await ye("b")}},1e3)),()=>clearInterval(O.current)),[N,he,D,U,k,ye]);const xe=(0,s.useCallback)(async()=>{if(g)try{const e=(0,l.P)((0,l.rJ)(l.db,"chessGames"),(0,l._M)("status","==","waiting")),t=await(0,l.GG)(e),n=[];t.forEach(e=>{const t=e.data();t.players.white!==g.uid&&n.push((0,a.A)({id:e.id},t))}),T(n)}catch(e){console.error("Error fetching rooms:",e)}},[g]);(0,s.useEffect)(()=>{if(R&&g){xe();const e=setInterval(xe,6e4);return()=>clearInterval(e)}},[R,g,xe]);const ke=(0,s.useCallback)(async()=>{if(!k)return;const e=(0,l.H9)(l.db,"chessGames",k),t=await(0,l.x7)(e);if(t.exists()){const e=t.data(),n=(0,a.A)((0,a.A)({},e),{},{board:p(e.board)});C(n),P(!1),void 0!==e.whiteTime&&L(e.whiteTime),void 0!==e.blackTime&&F(e.blackTime),e.moveHistory&&J(e.moveHistory)}else A({message:"\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"}),j(null),C(null),P(!0)},[k]),{refetch:je}=(0,c.nm)(ke,{interval:18e4,enabled:!!k});(0,s.useEffect)(()=>{z.current=je},[je]),(0,s.useEffect)(()=>{(()=>{if(!g)return;const e=(new Date).toDateString(),t="chessPlayCount_".concat(g.uid,"_").concat(e),n=parseInt(localStorage.getItem(t)||"0",10);de(n)})()},[g]),(0,s.useEffect)(()=>{if(M.message){const e=setTimeout(()=>A({message:"",type:""}),3e3);return()=>clearTimeout(e)}},[M.message]);const Ne=(0,s.useCallback)(function(e,t,n,a){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=[],c=a[0],l=a[1],i=(l,i)=>{if(l>=0&&l<8&&i>=0&&i<8){const o=e[l][i];if(!o||o[0]!==c)if(s){const s=e.map(e=>[...e]);s[l][i]=a,s[t][n]=null,Re(s,c)||r.push([l,i])}else r.push([l,i])}};switch(l){case"P":const a="w"===c?-1:1,r="w"===c?6:1;if(t+a>=0&&t+a<8&&!e[t+a][n]&&(i(t+a,n),t!==r||e[t+2*a][n]||i(t+2*a,n)),[-1,1].forEach(s=>{if(t+a>=0&&t+a<8&&n+s>=0&&n+s<8){const r=e[t+a][n+s];r&&r[0]!==c&&i(t+a,n+s)}}),null!==N&&void 0!==N&&N.enPassant){const[e,s]=N.enPassant;t+a===e&&1===Math.abs(n-s)&&i(e,s)}break;case"N":[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(e=>{let[a,s]=e;i(t+a,n+s)});break;case"B":case"R":case"Q":({B:[[1,1],[1,-1],[-1,1],[-1,-1]],R:[[0,1],[0,-1],[1,0],[-1,0]],Q:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]]})[l].forEach(a=>{let[s,r]=a;for(let l=1;l<8;l++){const a=t+s*l,o=n+r*l;if(!(a>=0&&a<8&&o>=0&&o<8))break;if(e[a][o]){e[a][o][0]!==c&&i(a,o);break}i(a,o)}});break;case"K":if([[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(e=>{let[a,s]=e;i(t+a,n+s)}),s&&null!==N&&void 0!==N&&N.castling){const a="w"===c?7:0;t===a&&4===n&&(!N.castling[c+"K"]||e[a][5]||e[a][6]||e[a][7]!==c+"R"||Ce(e,a,4,c)||Ce(e,a,5,c)||Ce(e,a,6,c)||i(a,6),!N.castling[c+"Q"]||e[a][3]||e[a][2]||e[a][1]||e[a][0]!==c+"R"||Ce(e,a,4,c)||Ce(e,a,3,c)||Ce(e,a,2,c)||i(a,2))}}return r},[N]),Ce=(0,s.useCallback)((e,t,n,a)=>{const s="w"===a?"b":"w";for(let r=0;r<8;r++)for(let a=0;a<8;a++){const c=e[r][a];if(c&&c[0]===s){if(Ne(e,r,a,c,!1).some(e=>{let[a,s]=e;return a===t&&s===n}))return!0}}return!1},[Ne]),Re=(0,s.useCallback)((e,t)=>{let n=null;for(let a=0;a<8;a++){for(let s=0;s<8;s++)if(e[a][s]===t+"K"){n=[a,s];break}if(n)break}return!!n&&Ce(e,n[0],n[1],t)},[Ce]),Pe=(0,s.useCallback)((e,t)=>{for(let n=0;n<8;n++)for(let a=0;a<8;a++){const s=e[n][a];if(s&&s[0]===t){if(Ne(e,n,a,s,!0).length>0)return null}}return Re(e,t)?"checkmate":"stalemate"},[Ne,Re]),Se=async()=>{if(!g)return void A({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});if("ai"===Z){const e=(new Date).toDateString(),t="chessPlayCount_".concat(g.uid,"_").concat(e);if(parseInt(localStorage.getItem(t)||"0",10)>=3)return void A({message:"\uc624\ub298\uc758 AI \ub300\uc804 \ud69f\uc218\ub97c \ubaa8\ub450 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. (3/3)",type:"error"})}const e=Math.random().toString(36).substring(2,8),t=(0,l.H9)(l.db,"chessGames",e),n="ai"===Z,a=Math.random()>.5?"w":"b",s="w"===a?"b":"w",r={board:f([["bR","bN","bB","bQ","bK","bB","bN","bR"],["bP","bP","bP","bP","bP","bP","bP","bP"],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],["wP","wP","wP","wP","wP","wP","wP","wP"],["wR","wN","wB","wQ","wK","wB","wN","wR"]]),players:n?"w"===a?{white:g.uid,black:"AI"}:{white:"AI",black:g.uid}:{white:g.uid,black:null},playerNames:n?"w"===a?{white:x.name,black:"AI (".concat("beginner"===ee?"\ucd08\uae09":"intermediate"===ee?"\uc911\uae09":"\uace0\uae09",")")}:{white:"AI (".concat("beginner"===ee?"\ucd08\uae09":"intermediate"===ee?"\uc911\uae09":"\uace0\uae09",")"),black:x.name}:{white:x.name,black:null},playerRanks:n?"w"===a?{white:we,black:"AI"}:{white:"AI",black:we}:{white:we,black:"Unranked"},playerRatings:n?"w"===a?{white:x.chessRating||0,black:0}:{white:0,black:x.chessRating||0}:{white:x.chessRating||0,black:null},turn:"w",status:n?"active":"waiting",winner:null,timeControl:B,whiteTime:B,blackTime:B,castling:{wK:!0,wQ:!0,bK:!0,bQ:!0},enPassant:null,moveHistory:[],createdAt:(0,l.O5)(),ratingChange:null,aiMode:n,aiDifficulty:n?ee:null,aiColor:n?s:null,playerColor:n?a:null};try{await(0,l.BN)(t,r),j(e),A({message:n?"AI \ub300\uc804 \uc2dc\uc791!":"\uccb4\uc2a4 \ubc29 \uc0dd\uc131 \uc644\ub8cc! \ucf54\ub4dc: ".concat(e),type:"success"}),z.current&&await z.current()}catch(c){console.error("Error creating room:",c),A({message:"\ubc29 \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}},Ee=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||S.trim();if(!e)return void A({message:"\ucc38\uac00\ud560 \ubc29 \ucf54\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694.",type:"error"});if(!g)return void A({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});const t=(0,l.H9)(l.db,"chessGames",e);try{await(0,l.c4)(l.db,async e=>{const n=await e.get(t);if(!n.exists())throw new Error("\ubc29\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const a=n.data();if(a.players.black)throw new Error("\ubc29\uc774 \uac00\ub4dd \ucc3c\uc2b5\ub2c8\ub2e4.");if(a.players.white===g.uid)throw new Error("\uc790\uc2e0\uc774 \ub9cc\ub4e0 \ubc29\uc5d0\ub294 \ucc38\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");e.update(t,{"players.black":g.uid,"playerNames.black":x.name,"playerRanks.black":we,"playerRatings.black":x.chessRating||0,status:"active"})}),j(e),z.current&&await z.current()}catch(n){console.error("Error joining room: ",n),A({message:"\ucc38\uac00 \uc2e4\ud328: ".concat(n.message),type:"error"})}},Me=async(e,t)=>{if(!I||!N)return;const{row:n,col:a,piece:s}=I;"P"!==s[1]||0!==e&&7!==e?await Ie(n,a,e,t,s):W({toRow:e,toCol:t,fromRow:n,fromCol:a})},Ae=(0,s.useCallback)(async()=>{var e;if(N&&k&&(null===(e=N.players)||void 0===e?void 0:e.white)===(null===g||void 0===g?void 0:g.uid))try{await(0,l.kd)((0,l.H9)(l.db,"chessGames",k))}catch(t){console.error("Error deleting room:",t)}j(null),C(null),P(!0),H(null),G([])},[N,k,g]),Ie=(0,s.useCallback)(async function(e,t,n,s,r){let c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!k||se)return;re(!0);const i=(0,l.H9)(l.db,"chessGames",k);try{const o=await(0,l.c4)(l.db,async l=>{const o=await l.get(i);if(!o.exists())throw new Error("\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const u=o.data();if("active"!==u.status)return{status:u.status,winner:u.winner,aiMode:u.aiMode,moveMade:!1};const d=r[0];if(u.turn!==d)throw new Error("\uc0c1\ub300\ubc29\uc758 \ud134\uc785\ub2c8\ub2e4.");let m=p(u.board).map(e=>[...e]);m[e][t]=null,m[n][s]=c?d+c:r;const b=(0,a.A)({},u.castling);let v=null;if("wK"===r&&(b.wK=!1,b.wQ=!1),"bK"===r&&(b.bK=!1,b.bQ=!1),"wR"===r&&7===e&&0===t&&(b.wQ=!1),"wR"===r&&7===e&&7===t&&(b.wK=!1),"bR"===r&&0===e&&0===t&&(b.bQ=!1),"bR"===r&&0===e&&7===t&&(b.bK=!1),"K"===r[1]&&2===Math.abs(t-s)&&(6===s?(m[e][5]=m[e][7],m[e][7]=null):(m[e][3]=m[e][0],m[e][0]=null)),"P"===r[1]&&u.enPassant){const[t,a]=u.enPassant;n===t&&s===a&&(m[e][s]=null)}"P"===r[1]&&2===Math.abs(e-n)&&(v=[(e+n)/2,t]);const g="abcdefgh",y="".concat("P"!==r[1]?r[1]:"").concat(g[t]).concat(8-e," -> ").concat(g[s]).concat(8-n),x=[...u.moveHistory,y],k="w"===d?"b":"w";let j=u.status,N=null,C=null,R=null;const P=Pe(m,k);P&&(j="finished",C=P,N="checkmate"===P?d:"draw"),"finished"===j&&"draw"!==N&&(R={["w"===N?"white":"black"]:h,["w"===N?"black":"white"]:w});const S={board:f(m),turn:k,castling:b,enPassant:v,moveHistory:x,status:j,winner:N,endReason:C,ratingChange:R};return l.update(i,S),{status:j,winner:N,aiMode:u.aiMode,moveMade:!0}});if(o.moveMade&&"finished"===o.status&&o.aiMode){const e=o.winner===me,t="draw"===o.winner;if(e||t&&Math.random()<.5){const e=(()=>{const e=e=>{const t=e.reduce((e,t)=>e+t.weight,0);let n=Math.random()*t;for(const a of e)if(n-=a.weight,n<=0)return a.amount;return e[e.length-1].amount};return[{type:"cash",amount:e([{amount:5e4,weight:5},{amount:3e4,weight:10},{amount:2e4,weight:15},{amount:1e4,weight:20},{amount:5e3,weight:18},{amount:3e3,weight:12},{amount:1e3,weight:10},{amount:500,weight:7},{amount:100,weight:3}])},{type:"coupon",amount:e([{amount:20,weight:10},{amount:10,weight:20},{amount:5,weight:20},{amount:3,weight:20},{amount:1,weight:30}])}]})();oe(e),le(!0)}else{const e=(new Date).toDateString(),n="chessPlayCount_".concat(g.uid,"_").concat(e),a=ue+1;localStorage.setItem(n,a.toString()),de(a),t&&A({message:"\ubb34\uc2b9\ubd80! \uc544\uc27d\uc9c0\ub9cc \ubcf4\uc0c1\uc740 \ub2e4\uc74c \uae30\ud68c\uc5d0!",type:"info"}),setTimeout(()=>Ae(),2e3)}}H(null),G([]),z.current&&await z.current()}catch(o){console.error("Error making move: ",o),A({message:"\uc774\ub3d9 \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(o.message),type:"error"}),z.current&&await z.current()}finally{re(!1)}},[k,se,me,ue,g,Pe,oe,le,de,A,Ae,H,G]);(0,s.useEffect)(()=>()=>{X.current&&(clearTimeout(X.current),X.current=null)},[]),(0,s.useEffect)(()=>{(async()=>{var e;if(!N||!k||"active"!==N.status)return;if(!N.aiMode)return;if(ne||se)return;const t=N.aiColor;if(N.turn!==t)return;const n=(null===(e=N.moveHistory)||void 0===e?void 0:e.length)||0;if(n===Y.current&&n>0)return;ae(!0),Y.current=n+1;const a=500+1e3*Math.random();X.current=setTimeout(async()=>{try{const e=(0,l.H9)(l.db,"chessGames",k),n=await(0,l.x7)(e);if(!n.exists())return void ae(!1);const a=n.data();if("active"!==a.status||a.turn!==t)return void ae(!1);const s=((e,t,n,a)=>{const s=[];for(let i=0;i<8;i++)for(let n=0;n<8;n++){const r=e[i][n];r&&r[0]===t&&a(e,i,n,r,!0).forEach(e=>{let[t,a]=e;s.push({from:[i,n],to:[t,a],piece:r})})}if(0===s.length)return null;if("beginner"===n)return s[Math.floor(Math.random()*s.length)];const r="intermediate"===n?2:3;let c=null,l=-1/0;for(const i of s){const n=e.map(e=>[...e]);n[i.to[0]][i.to[1]]=i.piece,n[i.from[0]][i.from[1]]=null;const s=y(n,r-1,!1,-1/0,1/0,t,a);s>l&&(l=s,c=i)}return c})(p(a.board),t,ee,Ne);if(s){const{from:e,to:t,piece:n}=s;await Ie(e[0],e[1],t[0],t[1],n)}}catch(e){console.error("AI move error:",e),ae(!1)}ae(!1),X.current=null},a)})()},[null===N||void 0===N?void 0:N.turn,null===N||void 0===N?void 0:N.status,null===N||void 0===N||null===(e=N.moveHistory)||void 0===e?void 0:e.length,k,ee,Ie,Ne,se]);const He=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))};if(R){return(0,u.jsx)("div",{className:"chess-container",children:(0,u.jsxs)("div",{className:"room-creation",children:[(0,u.jsx)("h2",{children:"\u265a \uccb4\uc2a4 \uac8c\uc784 \u2654"}),(0,u.jsx)("p",{children:"\uc804\ub7b5\uc801 \uc0ac\uace0\ub825\uc744 \uae30\ub974\ub294 \ucd5c\uace0\uc758 \ub450\ub1cc \uac8c\uc784!"}),(0,u.jsxs)("div",{className:"user-rank-info",children:[(0,u.jsxs)("p",{children:["\ub0b4 \ub4f1\uae09: ",(0,u.jsx)("strong",{children:we})," (",(null===x||void 0===x?void 0:x.chessRating)||0,"\uc810)"]}),fe&&(0,u.jsxs)("p",{className:"next-rank-guide",children:["\ub2e4\uc74c \ub4f1\uae09 (",fe,")\uae4c\uc9c0 ",(0,u.jsxs)("strong",{children:[pe,"\uc810"]})," \ub0a8\uc558\uc2b5\ub2c8\ub2e4."]})]}),(0,u.jsxs)("div",{className:"game-mode-selector",children:[(0,u.jsx)("h3",{children:"\uac8c\uc784 \ubaa8\ub4dc \uc120\ud0dd"}),(0,u.jsxs)("div",{className:"mode-options",children:[(0,u.jsx)("button",{className:"player"===Z?"selected":"",onClick:()=>$("player"),children:"\ud83d\udc65 \ud50c\ub808\uc774\uc5b4 \ub300\uc804"}),(0,u.jsxs)("button",{className:"ai"===Z?"selected":"",onClick:()=>$("ai"),children:["\ud83e\udd16 AI \ub300\uc804 (",ue,"/3)"]})]})]}),"ai"===Z&&(0,u.jsxs)("div",{className:"ai-difficulty-selector",children:[(0,u.jsx)("h3",{children:"AI \ub09c\uc774\ub3c4"}),(0,u.jsxs)("div",{className:"difficulty-options",children:[(0,u.jsx)("button",{className:"beginner"===ee?"selected":"",onClick:()=>te("beginner"),children:"\ud83d\ude0a \ucd08\uae09"}),(0,u.jsx)("button",{className:"intermediate"===ee?"selected":"",onClick:()=>te("intermediate"),children:"\ud83e\udd14 \uc911\uae09"}),(0,u.jsx)("button",{className:"advanced"===ee?"selected":"",onClick:()=>te("advanced"),children:"\ud83d\udd25 \uace0\uae09"})]})]}),M.message&&(0,u.jsx)("div",{className:"feedback ".concat(M.type),children:M.message}),(0,u.jsxs)("div",{className:"time-control-selector",children:[(0,u.jsx)("h3",{children:"\uc2dc\uac04 \uc81c\ud55c \uc120\ud0dd"}),(0,u.jsx)("div",{className:"time-options",children:[180,300,600,900].map(e=>(0,u.jsxs)("button",{className:B===e?"selected":"",onClick:()=>_(e),children:[e/60,"\ubd84"]},e))})]}),(0,u.jsxs)("div",{className:"room-actions",children:[(0,u.jsx)("button",{onClick:Se,className:"create-room-btn",children:"ai"===Z?"\ud83e\udd16 AI \ub300\uc804 \uc2dc\uc791":"\uc0c8\ub85c\uc6b4 \ubc29 \ub9cc\ub4e4\uae30"}),"player"===Z&&(0,u.jsxs)("div",{className:"join-room",children:[(0,u.jsx)("input",{type:"text",value:S,onChange:e=>E(e.target.value),placeholder:"\ubc29 \ucf54\ub4dc \uc785\ub825",maxLength:"6"}),(0,u.jsx)("button",{onClick:()=>Ee(),children:"\ucf54\ub4dc\ub85c \ucc38\uac00"})]})]}),Q.length>0&&(0,u.jsxs)("div",{className:"available-rooms",children:[(0,u.jsx)("h3",{children:"\ud83d\udccb \ub300\uae30 \uc911\uc778 \ubc29 \ubaa9\ub85d"}),(0,u.jsx)("div",{className:"rooms-list",children:Q.map(e=>{var t,n;return(0,u.jsxs)("div",{className:"room-item",children:[(0,u.jsxs)("div",{className:"room-info",children:[(0,u.jsxs)("span",{className:"room-host",children:["\ud638\uc2a4\ud2b8: ",e.playerNames.white," (",(null===(t=e.playerRanks)||void 0===t?void 0:t.white)||"Unranked",", ",(null===(n=e.playerRatings)||void 0===n?void 0:n.white)||0,"\uc810)"]}),(0,u.jsxs)("span",{className:"room-time",children:["\u23f1 ",He(e.timeControl)]}),(0,u.jsxs)("span",{className:"room-code",children:["\ucf54\ub4dc: ",e.id]})]}),(0,u.jsxs)("div",{className:"room-item-buttons",children:[(0,u.jsx)("button",{onClick:()=>Ee(e.id),className:"join-btn",children:"\ucc38\uac00"}),(null===x||void 0===x?void 0:x.isAdmin)&&(0,u.jsx)("button",{onClick:()=>(async e=>{if(null!==x&&void 0!==x&&x.isAdmin)try{await(0,l.kd)((0,l.H9)(l.db,"chessGames",e)),A({message:"\ubc29 ".concat(e,"\uac00 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),type:"success"}),xe()}catch(t){console.error("Error deleting room by admin:",t),A({message:"\ubc29 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}else A({message:"\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"})})(e.id),className:"delete-btn",children:"\uc0ad\uc81c"})]})]},e.id)})})]}),(0,u.jsxs)("div",{className:"chess-rules",children:[(0,u.jsx)("h3",{children:"\uccb4\uc2a4 \uae30\ubcf8 \uaddc\uce59"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"\ubc31(White)\uc774 \uba3c\uc800 \uc2dc\uc791\ud569\ub2c8\ub2e4."}),(0,u.jsx)("li",{children:"\uc0c1\ub300\ubc29\uc758 \ud0b9\uc744 \uccb4\ud06c\uba54\uc774\ud2b8\ud558\uba74 \uc2b9\ub9ac\ud569\ub2c8\ub2e4."}),(0,u.jsxs)("li",{children:["\ud50c\ub808\uc774\uc5b4 \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,u.jsx)("strong",{children:"\uc810\uc218(+15)"}),"\uc640 \ucfe0\ud3f0 3\uac1c, \ud328\ubc30 \uc2dc ",(0,u.jsx)("strong",{children:"\uc810\uc218(-10)"})]}),(0,u.jsxs)("li",{children:["AI \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,u.jsx)("strong",{children:"\uce74\ub4dc \ubcf4\uc0c1"})," \uc120\ud0dd (\ud604\uae08 \ub610\ub294 \ucfe0\ud3f0), \ud558\ub8e8 3\ud68c \uc81c\ud55c"]})]})]})]})})}if(!N)return(0,u.jsx)(o.AlchanLoading,{});const Ke=N.players.white,Ge=N.players.black;return(0,u.jsxs)("div",{className:"chess-container",style:{backgroundColor:"#0a0a12",minHeight:"100%",width:"100%"},children:[(0,u.jsxs)("div",{className:"game-info",children:[(0,u.jsxs)("div",{className:"player black ".concat("b"===N.turn?"active":""," ").concat((null===g||void 0===g?void 0:g.uid)===Ge?"my-player":"opponent-player"),children:[(0,u.jsxs)("span",{className:"player-name",children:["\u265b ",N.playerNames.black||"\ub300\uae30\uc911...",(0,u.jsxs)("span",{className:"player-rank",children:["[",(null===(t=N.playerRanks)||void 0===t?void 0:t.black)||"Unranked","] (",(null===(n=N.playerRatings)||void 0===n?void 0:n.black)||0,"\uc810)"]})]}),(0,u.jsx)("span",{className:"player-time",children:He(U)})]}),(0,u.jsx)("div",{className:"game-status",children:"finished"===N.status?"draw"===N.winner?(0,u.jsx)("span",{children:"\ubb34\uc2b9\ubd80!"}):N.winner===me?(0,u.jsxs)("span",{className:"winner",children:["\ud83c\udf89 \uc2b9\ub9ac! (",N.ratingChange["w"===me?"white":"black"]>0?"+":"",N.ratingChange["w"===me?"white":"black"],"\uc810) \ucfe0\ud3f0 3\uac1c \ud68d\ub4dd!"]}):(0,u.jsxs)("span",{className:"loser",children:["\ud328\ubc30! (",N.ratingChange["w"===me?"white":"black"],"\uc810)"]}):"waiting"===N.status?(0,u.jsxs)("span",{children:["\uc0c1\ub300\ubc29\uc744 \uae30\ub2e4\ub9ac\ub294 \uc911... (\ucf54\ub4dc: ",k,")"]}):(0,u.jsx)("span",{children:he?"\ub2f9\uc2e0\uc758 \ucc28\ub840":"\uc0c1\ub300\ubc29 \ucc28\ub840"})}),(0,u.jsxs)("div",{className:"player white ".concat("w"===N.turn?"active":""," ").concat((null===g||void 0===g?void 0:g.uid)===Ke?"my-player":"opponent-player"),children:[(0,u.jsxs)("span",{className:"player-name",children:["\u2655 ",N.playerNames.white,(0,u.jsxs)("span",{className:"player-rank",children:["[",(null===(b=N.playerRanks)||void 0===b?void 0:b.white)||"Unranked","] (",(null===(v=N.playerRatings)||void 0===v?void 0:v.white)||0,"\uc810)"]})]}),(0,u.jsx)("span",{className:"player-time",children:He(D)})]})]}),(0,u.jsxs)("div",{className:"board-container",children:[(0,u.jsx)("div",{className:"chess-board ".concat("b"===me?"flipped":""),children:N.board.map((e,t)=>e.map((e,n)=>{const a=(null===I||void 0===I?void 0:I.row)===t&&(null===I||void 0===I?void 0:I.col)===n,s=K.some(e=>{let[a,s]=e;return a===t&&s===n}),r=(t+n)%2===0,c=e&&"K"===e[1]&&Re(N.board,e[0]);return(0,u.jsxs)("div",{className:"square ".concat(r?"light":"dark"," \n                                               ").concat(a?"selected":""," \n                                               ").concat(s?"possible":"","\n                                               ").concat(c?"check":""),onClick:()=>((e,t)=>{if(!he||"active"!==N.status||se)return;const n=N.board[e][t];if(I&&K.some(n=>{let[a,s]=n;return a===e&&s===t}))Me(e,t);else if(n&&n[0]===me){H({row:e,col:t,piece:n});const a=Ne(N.board,e,t,n);G(a)}else H(null),G([])})(t,n),children:[e&&(0,u.jsx)("div",{className:"piece ".concat("w"===e[0]?"white-piece":"black-piece"),children:d[e]}),s&&!e&&(0,u.jsx)("div",{className:"move-dot"}),s&&e&&(0,u.jsx)("div",{className:"capture-hint"})]},"".concat(t,"-").concat(n))}))}),V&&(0,u.jsx)("div",{className:"promotion-modal",children:(0,u.jsxs)("div",{className:"promotion-content",children:[(0,u.jsx)("h3",{children:"\ud504\ub85c\ubaa8\uc158 \uc120\ud0dd"}),(0,u.jsx)("div",{className:"promotion-pieces",children:["Q","R","B","N"].map(e=>(0,u.jsx)("button",{onClick:()=>(async e=>{if(!V)return;const{fromRow:t,fromCol:n,toRow:a,toCol:s}=V,r=N.board[t][n];await Ie(t,n,a,s,r,e),W(null)})(e),className:"promotion-piece",children:d[me+e]},e))})]})}),ne&&(0,u.jsx)("div",{className:"ai-thinking",children:(0,u.jsxs)("div",{className:"thinking-content",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"AI\uac00 \uc218\ub97c \uace0\ubbfc\ud558\ub294 \uc911..."})]})}),ce&&2===ie.length&&(0,u.jsx)("div",{className:"reward-modal",children:(0,u.jsxs)("div",{className:"reward-content",children:[(0,u.jsx)("h3",{children:"\ud83c\udf89 \uc2b9\ub9ac \ubcf4\uc0c1!"}),(0,u.jsx)("p",{children:"\ud558\ub098\uc758 \uce74\ub4dc\ub97c \uc120\ud0dd\ud558\uc138\uc694"}),(0,u.jsx)("div",{className:"reward-cards",children:ie.map((e,t)=>(0,u.jsxs)("div",{className:"reward-card",onClick:()=>(async e=>{if(g&&k)try{const t=(0,l.H9)(l.db,"users",g.uid),n=(new Date).toDateString(),a="chessPlayCount_".concat(g.uid,"_").concat(n);await(0,l.c4)(l.db,async n=>{if(!(await n.get(t)).exists())return;const a={};"cash"===e.type?a.balance=(0,l.GV)(e.amount):"coupon"===e.type&&(a.couponBalance=(0,l.GV)(e.amount)),n.update(t,a)});const s=ue+1;localStorage.setItem(a,s.toString()),de(s),le(!1),A({message:"cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0\uc744 \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c\ub97c \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"),type:"success"}),(0,i.Mx)(l.db,{classCode:null===x||void 0===x?void 0:x.classCode,userId:g.uid,userName:(null===x||void 0===x?void 0:x.name)||"\uc0ac\uc6a9\uc790",type:i.gI.GAME_WIN,description:"\uccb4\uc2a4 AI(".concat(ee,") \uc2b9\ub9ac - ").concat("cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c")," \ud68d\ub4dd"),amount:"cash"===e.type?e.amount:0,couponAmount:"coupon"===e.type?e.amount:0,metadata:{gameType:"chess",opponent:"AI",difficulty:ee,rewardType:e.type,rewardAmount:e.amount}}),setTimeout(()=>{Ae()},2e3)}catch(t){console.error("Error applying reward:",t),A({message:"\ubcf4\uc0c1 \uc9c0\uae09\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}})(e),children:[(0,u.jsx)("div",{className:"card-icon",children:"cash"===e.type?"\ud83d\udcb5":"\ud83c\udfab"}),(0,u.jsx)("div",{className:"card-title",children:"cash"===e.type?"\ud604\uae08":"\ucfe0\ud3f0"}),(0,u.jsx)("div",{className:"card-amount",children:"cash"===e.type?"".concat(e.amount.toLocaleString(),"\uc6d0"):"".concat(e.amount,"\uac1c")})]},t))})]})})]}),M.message&&(0,u.jsx)("div",{className:"feedback ".concat(M.type),children:M.message}),(0,u.jsx)("div",{className:"game-controls",children:(0,u.jsx)("button",{onClick:Ae,className:"leave-button",children:"\uac8c\uc784 \ub098\uac00\uae30"})}),q.length>0&&(0,u.jsxs)("div",{className:"move-history",children:[(0,u.jsx)("h4",{children:"\uc774\ub3d9 \uae30\ub85d"}),(0,u.jsx)("div",{className:"moves-list",children:q.map((e,t)=>(0,u.jsxs)("span",{className:"move",children:[t%2===0?"".concat(Math.floor(t/2)+1,". "):"",e]},t))})]})]})}}}]);
//# sourceMappingURL=757.465f4f2d.chunk.js.map