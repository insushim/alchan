{"version":3,"file":"static/js/757.d17fbd92.chunk.js","mappings":"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","sources":["pages/games/ChessGame.js"],"sourcesContent":["// src/ChessGame.js\r\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { usePolling } from '../../hooks/usePolling';\r\nimport {\r\n    db,\r\n    doc,\r\n    setDoc,\r\n    getDoc,\r\n    runTransaction,\r\n    increment,\r\n    serverTimestamp,\r\n    collection,\r\n    query,\r\n    where,\r\n    getDocs,\r\n    deleteDoc,\r\n    // âœ¨ updateUserChessResult import êµ¬ë¬¸ì„ ì—¬ê¸°ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤.\r\n} from '../../firebase';\r\nimport { logActivity, ACTIVITY_TYPES } from '../../utils/firestoreHelpers';\r\nimport './ChessGame.css';\r\nimport { AlchanLoading } from '../../components/AlchanLayout';\r\n\r\nconst PIECES = {\r\n    'wK': 'â™”', 'wQ': 'â™•', 'wR': 'â™–', 'wB': 'â™—', 'wN': 'â™˜', 'wP': 'â™™',\r\n    'bK': 'â™š', 'bQ': 'â™›', 'bR': 'â™œ', 'bB': 'â™', 'bN': 'â™ž', 'bP': 'â™Ÿ'\r\n};\r\n\r\nconst RANKS = [\r\n    { name: 'Unranked', minPoints: 0 },\r\n    { name: 'C', minPoints: 800 },\r\n    { name: 'B', minPoints: 1000 },\r\n    { name: 'A', minPoints: 1200 },\r\n    { name: 'S', minPoints: 1400 },\r\n    { name: 'SS', minPoints: 1600 },\r\n];\r\n\r\nconst RATING_CHANGE = { WIN: 15, LOSS: -10, MIN_RATING: 800 };\r\n\r\nconst getRankInfo = (points = 0) => {\r\n    let currentRank = RANKS[0];\r\n    for (let i = RANKS.length - 1; i >= 0; i--) {\r\n        if (points >= RANKS[i].minPoints) {\r\n            currentRank = RANKS[i];\r\n            break;\r\n        }\r\n    }\r\n    const nextRankIndex = RANKS.findIndex(r => r.name === currentRank.name) + 1;\r\n    const nextRank = nextRankIndex < RANKS.length ? RANKS[nextRankIndex] : null;\r\n    const pointsForNextRank = nextRank ? nextRank.minPoints - points : 0;\r\n\r\n    return {\r\n        rank: currentRank.name,\r\n        nextRank: nextRank?.name,\r\n        pointsForNextRank: pointsForNextRank,\r\n    };\r\n};\r\n\r\n\r\nconst getInitialBoard = () => {\r\n    return [\r\n        ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],\r\n        ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],\r\n        [null, null, null, null, null, null, null, null],\r\n        [null, null, null, null, null, null, null, null],\r\n        [null, null, null, null, null, null, null, null],\r\n        [null, null, null, null, null, null, null, null],\r\n        ['wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP'],\r\n        ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR']\r\n    ];\r\n};\r\n\r\nconst serializeBoard = (board) => {\r\n    const serialized = {};\r\n    board.forEach((row, rIndex) => {\r\n        row.forEach((cell, cIndex) => {\r\n            if (cell) {\r\n                serialized[`${rIndex}-${cIndex}`] = cell;\r\n            }\r\n        });\r\n    });\r\n    return serialized;\r\n};\r\n\r\nconst deserializeBoard = (serializedBoard) => {\r\n    const board = Array(8).fill(null).map(() => Array(8).fill(null));\r\n    for (const key in serializedBoard) {\r\n        const [r, c] = key.split('-').map(Number);\r\n        board[r][c] = serializedBoard[key];\r\n    }\r\n    return board;\r\n};\r\n\r\n// ===== AI ì—”ì§„ =====\r\nconst PIECE_VALUES = {\r\n    'P': 100,\r\n    'N': 320,\r\n    'B': 330,\r\n    'R': 500,\r\n    'Q': 900,\r\n    'K': 20000\r\n};\r\n\r\n// ìœ„ì¹˜ ê°€ì¤‘ì¹˜ í…Œì´ë¸” (í°ì˜ ì¤‘ì•™ ì§„ì¶œ ì„ í˜¸)\r\nconst PAWN_POSITION_BONUS = [\r\n    [0, 0, 0, 0, 0, 0, 0, 0],\r\n    [50, 50, 50, 50, 50, 50, 50, 50],\r\n    [10, 10, 20, 30, 30, 20, 10, 10],\r\n    [5, 5, 10, 25, 25, 10, 5, 5],\r\n    [0, 0, 0, 20, 20, 0, 0, 0],\r\n    [5, -5, -10, 0, 0, -10, -5, 5],\r\n    [5, 10, 10, -20, -20, 10, 10, 5],\r\n    [0, 0, 0, 0, 0, 0, 0, 0]\r\n];\r\n\r\nconst KNIGHT_POSITION_BONUS = [\r\n    [-50, -40, -30, -30, -30, -30, -40, -50],\r\n    [-40, -20, 0, 0, 0, 0, -20, -40],\r\n    [-30, 0, 10, 15, 15, 10, 0, -30],\r\n    [-30, 5, 15, 20, 20, 15, 5, -30],\r\n    [-30, 0, 15, 20, 20, 15, 0, -30],\r\n    [-30, 5, 10, 15, 15, 10, 5, -30],\r\n    [-40, -20, 0, 5, 5, 0, -20, -40],\r\n    [-50, -40, -30, -30, -30, -30, -40, -50]\r\n];\r\n\r\n// ë³´ë“œ í‰ê°€ í•¨ìˆ˜\r\nconst evaluateBoard = (board, color) => {\r\n    let score = 0;\r\n\r\n    for (let r = 0; r < 8; r++) {\r\n        for (let c = 0; c < 8; c++) {\r\n            const piece = board[r][c];\r\n            if (!piece) continue;\r\n\r\n            const pieceColor = piece[0];\r\n            const pieceType = piece[1];\r\n            const pieceValue = PIECE_VALUES[pieceType] || 0;\r\n\r\n            let positionBonus = 0;\r\n            if (pieceType === 'P') {\r\n                const row = pieceColor === 'w' ? r : 7 - r;\r\n                positionBonus = PAWN_POSITION_BONUS[row][c];\r\n            } else if (pieceType === 'N') {\r\n                positionBonus = KNIGHT_POSITION_BONUS[r][c];\r\n            }\r\n\r\n            const totalValue = pieceValue + positionBonus;\r\n\r\n            if (pieceColor === color) {\r\n                score += totalValue;\r\n            } else {\r\n                score -= totalValue;\r\n            }\r\n        }\r\n    }\r\n\r\n    return score;\r\n};\r\n\r\n// Minimax ì•Œê³ ë¦¬ì¦˜\r\nconst minimax = (board, depth, isMaximizing, alpha, beta, color, getValidMovesFunc) => {\r\n    if (depth === 0) {\r\n        return evaluateBoard(board, color);\r\n    }\r\n\r\n    const currentColor = isMaximizing ? color : (color === 'w' ? 'b' : 'w');\r\n\r\n    // ëª¨ë“  ê°€ëŠ¥í•œ ìˆ˜ ì°¾ê¸°\r\n    const allMoves = [];\r\n    for (let r = 0; r < 8; r++) {\r\n        for (let c = 0; c < 8; c++) {\r\n            const piece = board[r][c];\r\n            if (piece && piece[0] === currentColor) {\r\n                const moves = getValidMovesFunc(board, r, c, piece, true);\r\n                moves.forEach(([toR, toC]) => {\r\n                    allMoves.push({ from: [r, c], to: [toR, toC], piece });\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (allMoves.length === 0) {\r\n        return isMaximizing ? -999999 : 999999;\r\n    }\r\n\r\n    if (isMaximizing) {\r\n        let maxEval = -Infinity;\r\n        for (const move of allMoves) {\r\n            const newBoard = board.map(row => [...row]);\r\n            newBoard[move.to[0]][move.to[1]] = move.piece;\r\n            newBoard[move.from[0]][move.from[1]] = null;\r\n\r\n            const evaluation = minimax(newBoard, depth - 1, false, alpha, beta, color, getValidMovesFunc);\r\n            maxEval = Math.max(maxEval, evaluation);\r\n            alpha = Math.max(alpha, evaluation);\r\n            if (beta <= alpha) break;\r\n        }\r\n        return maxEval;\r\n    } else {\r\n        let minEval = Infinity;\r\n        for (const move of allMoves) {\r\n            const newBoard = board.map(row => [...row]);\r\n            newBoard[move.to[0]][move.to[1]] = move.piece;\r\n            newBoard[move.from[0]][move.from[1]] = null;\r\n\r\n            const evaluation = minimax(newBoard, depth - 1, true, alpha, beta, color, getValidMovesFunc);\r\n            minEval = Math.min(minEval, evaluation);\r\n            beta = Math.min(beta, evaluation);\r\n            if (beta <= alpha) break;\r\n        }\r\n        return minEval;\r\n    }\r\n};\r\n\r\n// AIê°€ ìµœì ì˜ ìˆ˜ ì°¾ê¸°\r\nconst findBestMove = (board, color, difficulty, getValidMovesFunc) => {\r\n    const allMoves = [];\r\n\r\n    for (let r = 0; r < 8; r++) {\r\n        for (let c = 0; c < 8; c++) {\r\n            const piece = board[r][c];\r\n            if (piece && piece[0] === color) {\r\n                const moves = getValidMovesFunc(board, r, c, piece, true);\r\n                moves.forEach(([toR, toC]) => {\r\n                    allMoves.push({ from: [r, c], to: [toR, toC], piece });\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (allMoves.length === 0) return null;\r\n\r\n    // ì´ˆê¸‰: ëžœë¤ ì„ íƒ\r\n    if (difficulty === 'beginner') {\r\n        return allMoves[Math.floor(Math.random() * allMoves.length)];\r\n    }\r\n\r\n    // ì¤‘ê¸‰: Depth 2\r\n    // ê³ ê¸‰: Depth 3\r\n    const depth = difficulty === 'intermediate' ? 2 : 3;\r\n\r\n    let bestMove = null;\r\n    let bestValue = -Infinity;\r\n\r\n    for (const move of allMoves) {\r\n        const newBoard = board.map(row => [...row]);\r\n        newBoard[move.to[0]][move.to[1]] = move.piece;\r\n        newBoard[move.from[0]][move.from[1]] = null;\r\n\r\n        const moveValue = minimax(newBoard, depth - 1, false, -Infinity, Infinity, color, getValidMovesFunc);\r\n\r\n        if (moveValue > bestValue) {\r\n            bestValue = moveValue;\r\n            bestMove = move;\r\n        }\r\n    }\r\n\r\n    return bestMove;\r\n};\r\n\r\n\r\nconst ChessGame = () => {\r\n    const { user, userDoc, isAdmin } = useAuth();\r\n    // ... (state definitions)\r\n\r\n    // Force strict dark mode background via inline style\r\n    const containerStyle = {\r\n        backgroundColor: '#0a0a12',\r\n        minHeight: '100%',\r\n        width: '100%'\r\n    };\r\n    const [gameId, setGameId] = useState(null);\r\n    const [gameData, setGameData] = useState(null);\r\n    const [showCreateRoom, setShowCreateRoom] = useState(true);\r\n    const [newRoomId, setNewRoomId] = useState('');\r\n    const [feedback, setFeedback] = useState({ message: '', type: '' });\r\n    const [selectedPiece, setSelectedPiece] = useState(null);\r\n    const [possibleMoves, setPossibleMoves] = useState([]);\r\n    const [availableRooms, setAvailableRooms] = useState([]);\r\n    const [timeControl, setTimeControl] = useState(600);\r\n    const [whiteTime, setWhiteTime] = useState(600);\r\n    const [blackTime, setBlackTime] = useState(600);\r\n    const [showPromotion, setShowPromotion] = useState(null);\r\n    const [moveHistory, setMoveHistory] = useState([]);\r\n    const intervalRef = useRef(null);\r\n    const refetchRef = useRef(null);\r\n    const aiTimeoutRef = useRef(null);\r\n    const lastAiMoveCountRef = useRef(0);\r\n\r\n    // AI ëª¨ë“œ ê´€ë ¨ state\r\n    const [gameMode, setGameMode] = useState('player'); // 'player' or 'ai'\r\n    const [aiDifficulty, setAiDifficulty] = useState('intermediate'); // 'beginner', 'intermediate', 'advanced'\r\n    const [isAiThinking, setIsAiThinking] = useState(false);\r\n    const [isMoving, setIsMoving] = useState(false);\r\n\r\n    // ë³´ìƒ ê´€ë ¨ state\r\n    const [showRewardSelection, setShowRewardSelection] = useState(false);\r\n    const [rewardCards, setRewardCards] = useState([]);\r\n\r\n    // ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜\r\n    const [dailyPlayCount, setDailyPlayCount] = useState(0);\r\n\r\n    const myColor = gameData && user && (\r\n        gameData.aiMode\r\n            ? gameData.playerColor\r\n            : (gameData.players.white === user.uid ? 'w' : 'b')\r\n    );\r\n    const isMyTurn = gameData && gameData.turn === myColor;\r\n\r\n    const { rank: userRank, nextRank, pointsForNextRank } = getRankInfo(userDoc?.chessRating);\r\n\r\n    const gameIdRef = useRef(gameId);\r\n    useEffect(() => { gameIdRef.current = gameId; }, [gameId]);\r\n    const gameDataRef = useRef(gameData);\r\n    useEffect(() => { gameDataRef.current = gameData; }, [gameData]);\r\n    const userRef = useRef(user);\r\n    useEffect(() => { userRef.current = user; }, [user]);\r\n\r\n    useEffect(() => {\r\n        const cleanup = () => {\r\n            const currentGameId = gameIdRef.current;\r\n            const currentGameData = gameDataRef.current;\r\n            const currentUser = userRef.current;\r\n            // í˜¸ìŠ¤íŠ¸(ë°± í”Œë ˆì´ì–´)ê°€ ë‚˜ê°€ë©´ í•­ìƒ ë°© ì‚­ì œ (ìƒíƒœ ë¬´ê´€)\r\n            if (\r\n                currentGameId &&\r\n                currentGameData &&\r\n                currentUser &&\r\n                currentGameData.players?.white === currentUser.uid\r\n            ) {\r\n                deleteDoc(doc(db, 'chessGames', currentGameId));\r\n            }\r\n        };\r\n\r\n        window.addEventListener('beforeunload', cleanup);\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeunload', cleanup);\r\n        };\r\n    }, []);\r\n\r\n    const handleTimeout = useCallback(async (loserColor) => {\r\n        if (!gameId) return;\r\n        const gameRef = doc(db, 'chessGames', gameId);\r\n        const winnerColor = loserColor === 'w' ? 'b' : 'w';\r\n\r\n        await runTransaction(db, async (transaction) => {\r\n            const gameDoc = await transaction.get(gameRef);\r\n            if (!gameDoc.exists() || gameDoc.data().status !== 'active') {\r\n                return;\r\n            }\r\n\r\n            const winnerId = gameDoc.data().players[winnerColor === 'w' ? 'white' : 'black'];\r\n            const loserId = gameDoc.data().players[loserColor === 'w' ? 'white' : 'black'];\r\n\r\n            transaction.update(gameRef, {\r\n                status: 'finished',\r\n                winner: winnerColor,\r\n                endReason: 'timeout',\r\n                ratingChange: {\r\n                    [winnerColor === 'w' ? 'white' : 'black']: RATING_CHANGE.WIN,\r\n                    [loserColor === 'w' ? 'white' : 'black']: RATING_CHANGE.LOSS\r\n                }\r\n            });\r\n\r\n            // âœ¨ updateUserChessResult í•¨ìˆ˜ í˜¸ì¶œì„ ì—¬ê¸°ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤.\r\n        });\r\n        if (refetchRef.current) await refetchRef.current();\r\n    }, [gameId]);\r\n\r\n    useEffect(() => {\r\n        if (gameData && gameData.status === 'active' && isMyTurn) {\r\n            intervalRef.current = setInterval(async () => {\r\n                const gameDocRef = doc(db, 'chessGames', gameId);\r\n                const currentTurn = gameData.turn;\r\n                if (currentTurn === 'w') {\r\n                    const newTime = Math.max(0, whiteTime - 1);\r\n                    setWhiteTime(newTime);\r\n                    if (newTime <= 0) {\r\n                        await handleTimeout('w');\r\n                    }\r\n                } else {\r\n                    const newTime = Math.max(0, blackTime - 1);\r\n                    setBlackTime(newTime);\r\n                    if (newTime <= 0) {\r\n                        await handleTimeout('b');\r\n                    }\r\n                }\r\n            }, 1000);\r\n        }\r\n        return () => clearInterval(intervalRef.current);\r\n    }, [gameData, isMyTurn, whiteTime, blackTime, gameId, handleTimeout]);\r\n\r\n    const fetchAvailableRooms = useCallback(async () => {\r\n        if (!user) return;\r\n\r\n        try {\r\n            const q = query(\r\n                collection(db, 'chessGames'),\r\n                where('status', '==', 'waiting')\r\n            );\r\n            const querySnapshot = await getDocs(q);\r\n            const rooms = [];\r\n            querySnapshot.forEach((doc) => {\r\n                const data = doc.data();\r\n                if (data.players.white !== user.uid) {\r\n                    rooms.push({\r\n                        id: doc.id,\r\n                        ...data\r\n                    });\r\n                }\r\n            });\r\n            setAvailableRooms(rooms);\r\n        } catch (error) {\r\n            console.error(\"Error fetching rooms:\", error);\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (showCreateRoom && user) {\r\n            fetchAvailableRooms();\r\n            // ðŸ”¥ [ìµœì í™”] 5ì´ˆ â†’ 60ì´ˆë¡œ ë³€ê²½ (ì½ê¸° ë¹„ìš© ì ˆê°)\r\n            const interval = setInterval(fetchAvailableRooms, 60000);\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [showCreateRoom, user, fetchAvailableRooms]);\r\n\r\n    const fetchGameData = useCallback(async () => {\r\n        if (!gameId) return;\r\n\r\n        const gameRef = doc(db, 'chessGames', gameId);\r\n        const docSnap = await getDoc(gameRef);\r\n\r\n        if (docSnap.exists()) {\r\n            const rawData = docSnap.data();\r\n            const deserializedData = {\r\n                ...rawData,\r\n                board: deserializeBoard(rawData.board),\r\n            };\r\n            setGameData(deserializedData);\r\n            setShowCreateRoom(false);\r\n\r\n            if (rawData.whiteTime !== undefined) setWhiteTime(rawData.whiteTime);\r\n            if (rawData.blackTime !== undefined) setBlackTime(rawData.blackTime);\r\n            if (rawData.moveHistory) setMoveHistory(rawData.moveHistory);\r\n\r\n        } else {\r\n            setFeedback({ message: 'ê²Œìž„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', type: 'error' });\r\n            setGameId(null);\r\n            setGameData(null);\r\n            setShowCreateRoom(true);\r\n        }\r\n    }, [gameId]);\r\n\r\n    // ðŸ”¥ [ìµœì í™”] 60ì´ˆ â†’ 3ë¶„ìœ¼ë¡œ ë³€ê²½ (ì½ê¸° ë¹„ìš© ì ˆê°)\r\n    const { refetch } = usePolling(fetchGameData, { interval: 180000, enabled: !!gameId });\r\n\r\n    useEffect(() => {\r\n        refetchRef.current = refetch;\r\n    }, [refetch]);\r\n\r\n    // ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜ ë¡œë“œ\r\n    useEffect(() => {\r\n        const loadDailyPlayCount = () => {\r\n            if (!user) return;\r\n\r\n            const today = new Date().toDateString();\r\n            const storageKey = `chessPlayCount_${user.uid}_${today}`;\r\n            const count = parseInt(localStorage.getItem(storageKey) || '0', 10);\r\n            setDailyPlayCount(count);\r\n        };\r\n\r\n        loadDailyPlayCount();\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (feedback.message) {\r\n            const timer = setTimeout(() => setFeedback({ message: '', type: '' }), 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [feedback.message]);\r\n\r\n    const getValidMoves = useCallback((board, row, col, piece, checkForCheck = true) => {\r\n        const moves = [];\r\n        const color = piece[0];\r\n        const type = piece[1];\r\n\r\n        const addMove = (r, c) => {\r\n            if (r >= 0 && r < 8 && c >= 0 && c < 8) {\r\n                const target = board[r][c];\r\n                if (!target || target[0] !== color) {\r\n                    if (checkForCheck) {\r\n                        const testBoard = board.map(row => [...row]);\r\n                        testBoard[r][c] = piece;\r\n                        testBoard[row][col] = null;\r\n                        if (!isInCheck(testBoard, color)) {\r\n                            moves.push([r, c]);\r\n                        }\r\n                    } else {\r\n                        moves.push([r, c]);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        switch (type) {\r\n            case 'P':\r\n                const direction = color === 'w' ? -1 : 1;\r\n                const startRow = color === 'w' ? 6 : 1;\r\n\r\n                if (row + direction >= 0 && row + direction < 8 && !board[row + direction][col]) {\r\n                    addMove(row + direction, col);\r\n                    if (row === startRow && !board[row + 2 * direction][col]) {\r\n                        addMove(row + 2 * direction, col);\r\n                    }\r\n                }\r\n\r\n                [-1, 1].forEach(dc => {\r\n                    if (row + direction >= 0 && row + direction < 8 && col + dc >= 0 && col + dc < 8) {\r\n                        const target = board[row + direction][col + dc];\r\n                        if (target && target[0] !== color) {\r\n                            addMove(row + direction, col + dc);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (gameData?.enPassant) {\r\n                    const [epRow, epCol] = gameData.enPassant;\r\n                    if (row + direction === epRow && Math.abs(col - epCol) === 1) {\r\n                        addMove(epRow, epCol);\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case 'N':\r\n                [[-2, -1], [-2, 1], [-1, -2], [-1, 2], [1, -2], [1, 2], [2, -1], [2, 1]].forEach(([dr, dc]) => {\r\n                    addMove(row + dr, col + dc);\r\n                });\r\n                break;\r\n\r\n            case 'B': case 'R': case 'Q':\r\n                const directions = {\r\n                    'B': [[1, 1], [1, -1], [-1, 1], [-1, -1]],\r\n                    'R': [[0, 1], [0, -1], [1, 0], [-1, 0]],\r\n                    'Q': [[0, 1], [0, -1], [1, 0], [-1, 0], [1, 1], [1, -1], [-1, 1], [-1, -1]]\r\n                }[type];\r\n\r\n                directions.forEach(([dr, dc]) => {\r\n                    for (let i = 1; i < 8; i++) {\r\n                        const r = row + dr * i;\r\n                        const c = col + dc * i;\r\n                        if (r >= 0 && r < 8 && c >= 0 && c < 8) {\r\n                            if (!board[r][c]) {\r\n                                addMove(r, c);\r\n                            } else {\r\n                                if (board[r][c][0] !== color) addMove(r, c);\r\n                                break;\r\n                            }\r\n                        } else break;\r\n                    }\r\n                });\r\n                break;\r\n\r\n            case 'K':\r\n                [[-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 0], [1, 1]].forEach(([dr, dc]) => {\r\n                    addMove(row + dr, col + dc);\r\n                });\r\n\r\n                if (checkForCheck && gameData?.castling) {\r\n                    const kingRow = color === 'w' ? 7 : 0;\r\n                    if (row === kingRow && col === 4) {\r\n                        if (gameData.castling[color + 'K'] &&\r\n                            !board[kingRow][5] && !board[kingRow][6] &&\r\n                            board[kingRow][7] === color + 'R') {\r\n                            if (!isSquareUnderAttack(board, kingRow, 4, color) &&\r\n                                !isSquareUnderAttack(board, kingRow, 5, color) &&\r\n                                !isSquareUnderAttack(board, kingRow, 6, color)) {\r\n                                addMove(kingRow, 6);\r\n                            }\r\n                        }\r\n                        if (gameData.castling[color + 'Q'] &&\r\n                            !board[kingRow][3] && !board[kingRow][2] && !board[kingRow][1] &&\r\n                            board[kingRow][0] === color + 'R') {\r\n                            if (!isSquareUnderAttack(board, kingRow, 4, color) &&\r\n                                !isSquareUnderAttack(board, kingRow, 3, color) &&\r\n                                !isSquareUnderAttack(board, kingRow, 2, color)) {\r\n                                addMove(kingRow, 2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            default: break;\r\n        }\r\n\r\n        return moves;\r\n    }, [gameData]);\r\n\r\n    const isSquareUnderAttack = useCallback((board, row, col, color) => {\r\n        const opponentColor = color === 'w' ? 'b' : 'w';\r\n\r\n        for (let r = 0; r < 8; r++) {\r\n            for (let c = 0; c < 8; c++) {\r\n                const piece = board[r][c];\r\n                if (piece && piece[0] === opponentColor) {\r\n                    const moves = getValidMoves(board, r, c, piece, false);\r\n                    if (moves.some(([mr, mc]) => mr === row && mc === col)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }, [getValidMoves]);\r\n\r\n    const isInCheck = useCallback((board, color) => {\r\n        let kingPos = null;\r\n        for (let r = 0; r < 8; r++) {\r\n            for (let c = 0; c < 8; c++) {\r\n                if (board[r][c] === color + 'K') {\r\n                    kingPos = [r, c];\r\n                    break;\r\n                }\r\n            }\r\n            if (kingPos) break;\r\n        }\r\n\r\n        if (!kingPos) return false;\r\n\r\n        return isSquareUnderAttack(board, kingPos[0], kingPos[1], color);\r\n    }, [isSquareUnderAttack]);\r\n\r\n    const checkGameEnd = useCallback((board, color) => {\r\n        for (let r = 0; r < 8; r++) {\r\n            for (let c = 0; c < 8; c++) {\r\n                const piece = board[r][c];\r\n                if (piece && piece[0] === color) {\r\n                    const moves = getValidMoves(board, r, c, piece, true);\r\n                    if (moves.length > 0) return null;\r\n                }\r\n            }\r\n        }\r\n        if (isInCheck(board, color)) {\r\n            return 'checkmate';\r\n        } else {\r\n            return 'stalemate';\r\n        }\r\n    }, [getValidMoves, isInCheck]);\r\n\r\n    // ë³´ìƒ ì¹´ë“œ ìƒì„±\r\n    const generateRewardCards = () => {\r\n        const cashRewards = [\r\n            { amount: 50000, weight: 5 },\r\n            { amount: 30000, weight: 10 },\r\n            { amount: 20000, weight: 15 },\r\n            { amount: 10000, weight: 20 },\r\n            { amount: 5000, weight: 18 },\r\n            { amount: 3000, weight: 12 },\r\n            { amount: 1000, weight: 10 },\r\n            { amount: 500, weight: 7 },\r\n            { amount: 100, weight: 3 }\r\n        ];\r\n\r\n        const couponRewards = [\r\n            { amount: 20, weight: 10 },\r\n            { amount: 10, weight: 20 },\r\n            { amount: 5, weight: 20 },\r\n            { amount: 3, weight: 20 },\r\n            { amount: 1, weight: 30 }\r\n        ];\r\n\r\n        const weightedRandom = (items) => {\r\n            const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);\r\n            let random = Math.random() * totalWeight;\r\n\r\n            for (const item of items) {\r\n                random -= item.weight;\r\n                if (random <= 0) {\r\n                    return item.amount;\r\n                }\r\n            }\r\n\r\n            return items[items.length - 1].amount;\r\n        };\r\n\r\n        return [\r\n            { type: 'cash', amount: weightedRandom(cashRewards) },\r\n            { type: 'coupon', amount: weightedRandom(couponRewards) }\r\n        ];\r\n    };\r\n\r\n    // ë³´ìƒ ì„ íƒ ì²˜ë¦¬\r\n    const handleRewardSelection = async (selectedCard) => {\r\n        if (!user || !gameId) return;\r\n\r\n        try {\r\n            const userRef = doc(db, 'users', user.uid);\r\n            const today = new Date().toDateString();\r\n            const storageKey = `chessPlayCount_${user.uid}_${today}`;\r\n\r\n            await runTransaction(db, async (transaction) => {\r\n                const userDocSnap = await transaction.get(userRef);\r\n                if (!userDocSnap.exists()) return;\r\n\r\n                const updateData = {};\r\n\r\n                if (selectedCard.type === 'cash') {\r\n                    updateData.balance = increment(selectedCard.amount);\r\n                } else if (selectedCard.type === 'coupon') {\r\n                    updateData.couponBalance = increment(selectedCard.amount);\r\n                }\r\n\r\n                transaction.update(userRef, updateData);\r\n            });\r\n\r\n            // ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜ ì¦ê°€\r\n            const newCount = dailyPlayCount + 1;\r\n            localStorage.setItem(storageKey, newCount.toString());\r\n            setDailyPlayCount(newCount);\r\n\r\n            setShowRewardSelection(false);\r\n            setFeedback({\r\n                message: selectedCard.type === 'cash'\r\n                    ? `í˜„ê¸ˆ ${selectedCard.amount.toLocaleString()}ì›ì„ íšë“í–ˆìŠµë‹ˆë‹¤!`\r\n                    : `ì¿ í° ${selectedCard.amount}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`,\r\n                type: 'success'\r\n            });\r\n\r\n            // ðŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (AI ì²´ìŠ¤ ìŠ¹ë¦¬ ë³´ìƒ)\r\n            logActivity(db, {\r\n                classCode: userDoc?.classCode,\r\n                userId: user.uid,\r\n                userName: userDoc?.name || 'ì‚¬ìš©ìž',\r\n                type: ACTIVITY_TYPES.GAME_WIN,\r\n                description: `ì²´ìŠ¤ AI(${aiDifficulty}) ìŠ¹ë¦¬ - ${selectedCard.type === 'cash' ? `í˜„ê¸ˆ ${selectedCard.amount.toLocaleString()}ì›` : `ì¿ í° ${selectedCard.amount}ê°œ`} íšë“`,\r\n                amount: selectedCard.type === 'cash' ? selectedCard.amount : 0,\r\n                couponAmount: selectedCard.type === 'coupon' ? selectedCard.amount : 0,\r\n                metadata: {\r\n                    gameType: 'chess',\r\n                    opponent: 'AI',\r\n                    difficulty: aiDifficulty,\r\n                    rewardType: selectedCard.type,\r\n                    rewardAmount: selectedCard.amount\r\n                }\r\n            });\r\n\r\n            // ê²Œìž„ ë‚˜ê°€ê¸°\r\n            setTimeout(() => {\r\n                handleLeaveGame();\r\n            }, 2000);\r\n\r\n        } catch (error) {\r\n            console.error(\"Error applying reward:\", error);\r\n            setFeedback({ message: 'ë³´ìƒ ì§€ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', type: 'error' });\r\n        }\r\n    };\r\n\r\n\r\n    const handleCreateRoom = async () => {\r\n        if (!user) {\r\n            setFeedback({ message: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', type: 'error' });\r\n            return;\r\n        }\r\n\r\n        // AI ëª¨ë“œì¼ ë•Œ ì¼ì¼ í”Œë ˆì´ íšŸìˆ˜ ì²´í¬ (localStorageì—ì„œ ì§ì ‘ í™•ì¸)\r\n        if (gameMode === 'ai') {\r\n            const today = new Date().toDateString();\r\n            const storageKey = `chessPlayCount_${user.uid}_${today}`;\r\n            const currentCount = parseInt(localStorage.getItem(storageKey) || '0', 10);\r\n\r\n            if (currentCount >= 3) {\r\n                setFeedback({ message: 'ì˜¤ëŠ˜ì˜ AI ëŒ€ì „ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. (3/3)', type: 'error' });\r\n                return;\r\n            }\r\n        }\r\n\r\n        const newGameId = Math.random().toString(36).substring(2, 8);\r\n        const gameRef = doc(db, 'chessGames', newGameId);\r\n\r\n        const isAiMode = gameMode === 'ai';\r\n        const playerColor = Math.random() > 0.5 ? 'w' : 'b'; // AI ëª¨ë“œì—ì„œ ëžœë¤ ìƒ‰ìƒ\r\n        const aiColor = playerColor === 'w' ? 'b' : 'w';\r\n\r\n        const initialGameData = {\r\n            board: serializeBoard(getInitialBoard()),\r\n            players: isAiMode\r\n                ? (playerColor === 'w'\r\n                    ? { white: user.uid, black: 'AI' }\r\n                    : { white: 'AI', black: user.uid })\r\n                : { white: user.uid, black: null },\r\n            playerNames: isAiMode\r\n                ? (playerColor === 'w'\r\n                    ? { white: userDoc.name, black: `AI (${aiDifficulty === 'beginner' ? 'ì´ˆê¸‰' : aiDifficulty === 'intermediate' ? 'ì¤‘ê¸‰' : 'ê³ ê¸‰'})` }\r\n                    : { white: `AI (${aiDifficulty === 'beginner' ? 'ì´ˆê¸‰' : aiDifficulty === 'intermediate' ? 'ì¤‘ê¸‰' : 'ê³ ê¸‰'})`, black: userDoc.name })\r\n                : { white: userDoc.name, black: null },\r\n            playerRanks: isAiMode\r\n                ? (playerColor === 'w'\r\n                    ? { white: userRank, black: 'AI' }\r\n                    : { white: 'AI', black: userRank })\r\n                : { white: userRank, black: 'Unranked' },\r\n            playerRatings: isAiMode\r\n                ? (playerColor === 'w'\r\n                    ? { white: userDoc.chessRating || 0, black: 0 }\r\n                    : { white: 0, black: userDoc.chessRating || 0 })\r\n                : { white: userDoc.chessRating || 0, black: null },\r\n            turn: 'w',\r\n            status: isAiMode ? 'active' : 'waiting',\r\n            winner: null,\r\n            timeControl: timeControl,\r\n            whiteTime: timeControl,\r\n            blackTime: timeControl,\r\n            castling: { wK: true, wQ: true, bK: true, bQ: true },\r\n            enPassant: null,\r\n            moveHistory: [],\r\n            createdAt: serverTimestamp(),\r\n            ratingChange: null,\r\n            aiMode: isAiMode,\r\n            aiDifficulty: isAiMode ? aiDifficulty : null,\r\n            aiColor: isAiMode ? aiColor : null,\r\n            playerColor: isAiMode ? playerColor : null,\r\n        };\r\n\r\n        try {\r\n            await setDoc(gameRef, initialGameData);\r\n            setGameId(newGameId);\r\n            setFeedback({ message: isAiMode ? `AI ëŒ€ì „ ì‹œìž‘!` : `ì²´ìŠ¤ ë°© ìƒì„± ì™„ë£Œ! ì½”ë“œ: ${newGameId}`, type: 'success' });\r\n            if (refetchRef.current) await refetchRef.current();\r\n        } catch (error) {\r\n            console.error(\"Error creating room:\", error);\r\n            setFeedback({ message: 'ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', type: 'error' });\r\n        }\r\n    };\r\n\r\n    const handleJoinRoom = async (roomId = null) => {\r\n        const targetRoomId = roomId || newRoomId.trim();\r\n\r\n        if (!targetRoomId) {\r\n            setFeedback({ message: 'ì°¸ê°€í•  ë°© ì½”ë“œë¥¼ ìž…ë ¥í•˜ì„¸ìš”.', type: 'error' });\r\n            return;\r\n        }\r\n        if (!user) {\r\n            setFeedback({ message: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', type: 'error' });\r\n            return;\r\n        }\r\n\r\n        const gameRef = doc(db, 'chessGames', targetRoomId);\r\n\r\n        try {\r\n            await runTransaction(db, async (transaction) => {\r\n                const gameDoc = await transaction.get(gameRef);\r\n                if (!gameDoc.exists()) throw new Error(\"ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n\r\n                const data = gameDoc.data();\r\n                if (data.players.black) throw new Error(\"ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.\");\r\n                if (data.players.white === user.uid) throw new Error(\"ìžì‹ ì´ ë§Œë“  ë°©ì—ëŠ” ì°¸ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n\r\n                transaction.update(gameRef, {\r\n                    'players.black': user.uid,\r\n                    'playerNames.black': userDoc.name,\r\n                    'playerRanks.black': userRank,\r\n                    'playerRatings.black': userDoc.chessRating || 0,\r\n                    status: 'active',\r\n                });\r\n            });\r\n            setGameId(targetRoomId);\r\n            if (refetchRef.current) await refetchRef.current();\r\n        } catch (error) {\r\n            console.error(\"Error joining room: \", error);\r\n            setFeedback({ message: `ì°¸ê°€ ì‹¤íŒ¨: ${error.message}`, type: 'error' });\r\n        }\r\n    };\r\n\r\n    const handleAdminDeleteRoom = async (roomId) => {\r\n        if (!isAdmin?.()) {\r\n            setFeedback({ message: 'ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.', type: 'error' });\r\n            return;\r\n        }\r\n        try {\r\n            await deleteDoc(doc(db, 'chessGames', roomId));\r\n            setFeedback({ message: `ë°© ${roomId}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, type: 'success' });\r\n            fetchAvailableRooms();\r\n        } catch (error) {\r\n            console.error(\"Error deleting room by admin:\", error);\r\n            setFeedback({ message: 'ë°© ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', type: 'error' });\r\n        }\r\n    };\r\n\r\n    const handlePieceClick = (row, col) => {\r\n        if (!isMyTurn || gameData.status !== 'active' || isMoving) return;\r\n\r\n        const piece = gameData.board[row][col];\r\n\r\n        if (selectedPiece && possibleMoves.some(([r, c]) => r === row && c === col)) {\r\n            handleMove(row, col);\r\n        } else if (piece && piece[0] === myColor) {\r\n            setSelectedPiece({ row, col, piece });\r\n            const moves = getValidMoves(gameData.board, row, col, piece);\r\n            setPossibleMoves(moves);\r\n        } else {\r\n            setSelectedPiece(null);\r\n            setPossibleMoves([]);\r\n        }\r\n    };\r\n\r\n    const handleMove = async (toRow, toCol) => {\r\n        if (!selectedPiece || !gameData) return;\r\n\r\n        const { row: fromRow, col: fromCol, piece } = selectedPiece;\r\n\r\n        if (piece[1] === 'P' && (toRow === 0 || toRow === 7)) {\r\n            setShowPromotion({ toRow, toCol, fromRow, fromCol });\r\n            return;\r\n        }\r\n\r\n        await executeMove(fromRow, fromCol, toRow, toCol, piece);\r\n    };\r\n\r\n    const handlePromotion = async (promoteTo) => {\r\n        if (!showPromotion) return;\r\n        const { fromRow, fromCol, toRow, toCol } = showPromotion;\r\n        const piece = gameData.board[fromRow][fromCol];\r\n\r\n        await executeMove(fromRow, fromCol, toRow, toCol, piece, promoteTo);\r\n        setShowPromotion(null);\r\n    };\r\n\r\n\r\n\r\n    const handleLeaveGame = useCallback(async () => {\r\n        // í˜¸ìŠ¤íŠ¸(ë°± í”Œë ˆì´ì–´)ê°€ ë‚˜ê°€ë©´ í•­ìƒ ë°© ì‚­ì œ (ìƒíƒœ ë¬´ê´€)\r\n        if (gameData && gameId && gameData.players?.white === user?.uid) {\r\n            try {\r\n                await deleteDoc(doc(db, 'chessGames', gameId));\r\n            } catch (error) {\r\n                console.error(\"Error deleting room:\", error);\r\n            }\r\n        }\r\n\r\n        setGameId(null);\r\n        setGameData(null);\r\n        setShowCreateRoom(true);\r\n        setSelectedPiece(null);\r\n        setPossibleMoves([]);\r\n    }, [gameData, gameId, user]);\r\n\r\n    const executeMove = useCallback(async (fromRow, fromCol, toRow, toCol, piece, promotionPiece = null) => {\r\n        if (!gameId || isMoving) return;\r\n        setIsMoving(true);\r\n        const gameRef = doc(db, 'chessGames', gameId);\r\n\r\n        try {\r\n            const result = await runTransaction(db, async (transaction) => {\r\n                const gameDoc = await transaction.get(gameRef);\r\n                if (!gameDoc.exists()) {\r\n                    throw new Error(\"ê²Œìž„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n                }\r\n\r\n                const currentData = gameDoc.data();\r\n                if (currentData.status !== 'active') {\r\n                    return { status: currentData.status, winner: currentData.winner, aiMode: currentData.aiMode, moveMade: false };\r\n                }\r\n\r\n                const color = piece[0];\r\n                if (currentData.turn !== color) {\r\n                    throw new Error(\"ìƒëŒ€ë°©ì˜ í„´ìž…ë‹ˆë‹¤.\");\r\n                }\r\n\r\n                const board = deserializeBoard(currentData.board);\r\n\r\n                let newBoard = board.map(r => [...r]);\r\n                newBoard[fromRow][fromCol] = null;\r\n                newBoard[toRow][toCol] = promotionPiece ? color + promotionPiece : piece;\r\n\r\n                const newCastling = { ...currentData.castling };\r\n                let newEnPassant = null;\r\n\r\n                if (piece === 'wK') { newCastling.wK = false; newCastling.wQ = false; }\r\n                if (piece === 'bK') { newCastling.bK = false; newCastling.bQ = false; }\r\n                if (piece === 'wR' && fromRow === 7 && fromCol === 0) newCastling.wQ = false;\r\n                if (piece === 'wR' && fromRow === 7 && fromCol === 7) newCastling.wK = false;\r\n                if (piece === 'bR' && fromRow === 0 && fromCol === 0) newCastling.bQ = false;\r\n                if (piece === 'bR' && fromRow === 0 && fromCol === 7) newCastling.bK = false;\r\n\r\n                if (piece[1] === 'K' && Math.abs(fromCol - toCol) === 2) {\r\n                    if (toCol === 6) {\r\n                        newBoard[fromRow][5] = newBoard[fromRow][7];\r\n                        newBoard[fromRow][7] = null;\r\n                    } else {\r\n                        newBoard[fromRow][3] = newBoard[fromRow][0];\r\n                        newBoard[fromRow][0] = null;\r\n                    }\r\n                }\r\n\r\n                if (piece[1] === 'P' && currentData.enPassant) {\r\n                    const [epRow, epCol] = currentData.enPassant;\r\n                    if (toRow === epRow && toCol === epCol) {\r\n                        newBoard[fromRow][toCol] = null;\r\n                    }\r\n                }\r\n\r\n                if (piece[1] === 'P' && Math.abs(fromRow - toRow) === 2) {\r\n                    newEnPassant = [(fromRow + toRow) / 2, fromCol];\r\n                }\r\n\r\n                const files = 'abcdefgh';\r\n                const moveNotation = `${piece[1] !== 'P' ? piece[1] : ''}${files[fromCol]}${8 - fromRow} -> ${files[toCol]}${8 - toRow}`;\r\n                const newMoveHistory = [...currentData.moveHistory, moveNotation];\r\n\r\n                const nextTurn = color === 'w' ? 'b' : 'w';\r\n                let newStatus = currentData.status;\r\n                let newWinner = null;\r\n                let endReason = null;\r\n                let newRatingChange = null;\r\n\r\n                const gameEndState = checkGameEnd(newBoard, nextTurn);\r\n                if (gameEndState) {\r\n                    newStatus = 'finished';\r\n                    endReason = gameEndState;\r\n                    if (gameEndState === 'checkmate') {\r\n                        newWinner = color;\r\n                    } else {\r\n                        newWinner = 'draw';\r\n                    }\r\n                }\r\n\r\n                if (newStatus === 'finished' && newWinner !== 'draw') {\r\n                    newRatingChange = {\r\n                        [newWinner === 'w' ? 'white' : 'black']: RATING_CHANGE.WIN,\r\n                        [newWinner === 'w' ? 'black' : 'white']: RATING_CHANGE.LOSS,\r\n                    };\r\n                }\r\n\r\n                const updateData = {\r\n                    board: serializeBoard(newBoard),\r\n                    turn: nextTurn,\r\n                    castling: newCastling,\r\n                    enPassant: newEnPassant,\r\n                    moveHistory: newMoveHistory,\r\n                    status: newStatus,\r\n                    winner: newWinner,\r\n                    endReason: endReason,\r\n                    ratingChange: newRatingChange,\r\n                };\r\n\r\n                transaction.update(gameRef, updateData);\r\n\r\n                return {\r\n                    status: newStatus,\r\n                    winner: newWinner,\r\n                    aiMode: currentData.aiMode,\r\n                    moveMade: true,\r\n                };\r\n            });\r\n\r\n            if (result.moveMade && result.status === 'finished' && result.aiMode) {\r\n                const playerIsWinner = result.winner === myColor;\r\n                const isDraw = result.winner === 'draw';\r\n\r\n                if (playerIsWinner || (isDraw && Math.random() < 0.5)) {\r\n                    const cards = generateRewardCards();\r\n                    setRewardCards(cards);\r\n                    setShowRewardSelection(true);\r\n                } else {\r\n                    const today = new Date().toDateString();\r\n                    const storageKey = `chessPlayCount_${user.uid}_${today}`;\r\n                    const newCount = dailyPlayCount + 1;\r\n                    localStorage.setItem(storageKey, newCount.toString());\r\n                    setDailyPlayCount(newCount);\r\n\r\n                    if (isDraw) {\r\n                        setFeedback({ message: 'ë¬´ìŠ¹ë¶€! ì•„ì‰½ì§€ë§Œ ë³´ìƒì€ ë‹¤ìŒ ê¸°íšŒì—!', type: 'info' });\r\n                    }\r\n                    setTimeout(() => handleLeaveGame(), 2000);\r\n                }\r\n            }\r\n\r\n            setSelectedPiece(null);\r\n            setPossibleMoves([]);\r\n\r\n            if (refetchRef.current) {\r\n                await refetchRef.current();\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(\"Error making move: \", error);\r\n            setFeedback({ message: `ì´ë™ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, type: 'error' });\r\n            if (refetchRef.current) {\r\n                await refetchRef.current();\r\n            }\r\n        } finally {\r\n            setIsMoving(false);\r\n        }\r\n    }, [gameId, isMoving, myColor, dailyPlayCount, user, checkGameEnd, setRewardCards, setShowRewardSelection, setDailyPlayCount, setFeedback, handleLeaveGame, setSelectedPiece, setPossibleMoves]);\r\n\r\n    // AI í„´ ì²˜ë¦¬ (ëª¨ë“  í•¨ìˆ˜ê°€ ì •ì˜ëœ í›„ ì‹¤í–‰)\r\n    useEffect(() => {\r\n        // Cleanup ì´ì „ timeout\r\n        return () => {\r\n            if (aiTimeoutRef.current) {\r\n                clearTimeout(aiTimeoutRef.current);\r\n                aiTimeoutRef.current = null;\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const makeAiMove = async () => {\r\n            if (!gameData || !gameId || gameData.status !== 'active') return;\r\n            if (!gameData.aiMode) return;\r\n            if (isAiThinking || isMoving) return;\r\n\r\n            const aiColor = gameData.aiColor;\r\n            if (gameData.turn !== aiColor) return;\r\n\r\n            // ê°™ì€ í„´ì— ì´ë¯¸ ì²˜ë¦¬í–ˆëŠ”ì§€ í™•ì¸ (moveHistory ê¸¸ì´ë¡œ ì²´í¬)\r\n            const currentMoveCount = gameData.moveHistory?.length || 0;\r\n            if (currentMoveCount === lastAiMoveCountRef.current && currentMoveCount > 0) {\r\n                return;\r\n            }\r\n\r\n            setIsAiThinking(true);\r\n            lastAiMoveCountRef.current = currentMoveCount + 1; // ë‹¤ìŒ ìˆ˜ë¥¼ ì˜ˆìƒ\r\n\r\n            // AI ì‚¬ê³  ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ (500ms ~ 1500ms)\r\n            const thinkingTime = 500 + Math.random() * 1000;\r\n\r\n            aiTimeoutRef.current = setTimeout(async () => {\r\n                try {\r\n                    // ìµœì‹  ê²Œìž„ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜´\r\n                    const gameRef = doc(db, 'chessGames', gameId);\r\n                    const gameSnap = await getDoc(gameRef);\r\n\r\n                    if (!gameSnap.exists()) {\r\n                        setIsAiThinking(false);\r\n                        return;\r\n                    }\r\n\r\n                    const currentGameData = gameSnap.data();\r\n\r\n                    // ì—¬ì „ížˆ AI í„´ì¸ì§€ í™•ì¸\r\n                    if (currentGameData.status !== 'active' || currentGameData.turn !== aiColor) {\r\n                        setIsAiThinking(false);\r\n                        return;\r\n                    }\r\n\r\n                    const currentBoard = deserializeBoard(currentGameData.board);\r\n                    const bestMove = findBestMove(currentBoard, aiColor, aiDifficulty, getValidMoves);\r\n\r\n                    if (bestMove) {\r\n                        const { from, to, piece } = bestMove;\r\n                        await executeMove(from[0], from[1], to[0], to[1], piece);\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"AI move error:\", error);\r\n                    setIsAiThinking(false);\r\n                }\r\n\r\n                setIsAiThinking(false);\r\n                aiTimeoutRef.current = null;\r\n            }, thinkingTime);\r\n        };\r\n\r\n        makeAiMove();\r\n    }, [gameData?.turn, gameData?.status, gameData?.moveHistory?.length, gameId, aiDifficulty, executeMove, getValidMoves, isMoving]);\r\n\r\n    const formatTime = (seconds) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    if (showCreateRoom) {\r\n        const canPlayAi = dailyPlayCount < 3;\r\n\r\n        return (\r\n            <div className=\"chess-container\">\r\n                <div className=\"room-creation\">\r\n                    <h2>â™š ì²´ìŠ¤ ê²Œìž„ â™”</h2>\r\n                    <p>ì „ëžµì  ì‚¬ê³ ë ¥ì„ ê¸°ë¥´ëŠ” ìµœê³ ì˜ ë‘ë‡Œ ê²Œìž„!</p>\r\n\r\n                    <div className=\"user-rank-info\">\r\n                        <p>ë‚´ ë“±ê¸‰: <strong>{userRank}</strong> ({userDoc?.chessRating || 0}ì )</p>\r\n                        {nextRank && (\r\n                            <p className=\"next-rank-guide\">\r\n                                ë‹¤ìŒ ë“±ê¸‰ ({nextRank})ê¹Œì§€ <strong>{pointsForNextRank}ì </strong> ë‚¨ì•˜ìŠµë‹ˆë‹¤.\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* ê²Œìž„ ëª¨ë“œ ì„ íƒ */}\r\n                    <div className=\"game-mode-selector\">\r\n                        <h3>ê²Œìž„ ëª¨ë“œ ì„ íƒ</h3>\r\n                        <div className=\"mode-options\">\r\n                            <button\r\n                                className={gameMode === 'player' ? 'selected' : ''}\r\n                                onClick={() => setGameMode('player')}\r\n                            >\r\n                                ðŸ‘¥ í”Œë ˆì´ì–´ ëŒ€ì „\r\n                            </button>\r\n                            <button\r\n                                className={gameMode === 'ai' ? 'selected' : ''}\r\n                                onClick={() => setGameMode('ai')}\r\n                            >\r\n                                ðŸ¤– AI ëŒ€ì „ ({dailyPlayCount}/3)\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* AI ë‚œì´ë„ ì„ íƒ (AI ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ) */}\r\n                    {gameMode === 'ai' && (\r\n                        <div className=\"ai-difficulty-selector\">\r\n                            <h3>AI ë‚œì´ë„</h3>\r\n                            <div className=\"difficulty-options\">\r\n                                <button\r\n                                    className={aiDifficulty === 'beginner' ? 'selected' : ''}\r\n                                    onClick={() => setAiDifficulty('beginner')}\r\n                                >\r\n                                    ðŸ˜Š ì´ˆê¸‰\r\n                                </button>\r\n                                <button\r\n                                    className={aiDifficulty === 'intermediate' ? 'selected' : ''}\r\n                                    onClick={() => setAiDifficulty('intermediate')}\r\n                                >\r\n                                    ðŸ¤” ì¤‘ê¸‰\r\n                                </button>\r\n                                <button\r\n                                    className={aiDifficulty === 'advanced' ? 'selected' : ''}\r\n                                    onClick={() => setAiDifficulty('advanced')}\r\n                                >\r\n                                    ðŸ”¥ ê³ ê¸‰\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {feedback.message && (\r\n                        <div className={`feedback ${feedback.type}`}>{feedback.message}</div>\r\n                    )}\r\n\r\n                    <div className=\"time-control-selector\">\r\n                        <h3>ì‹œê°„ ì œí•œ ì„ íƒ</h3>\r\n                        <div className=\"time-options\">\r\n                            {[180, 300, 600, 900].map(time => (\r\n                                <button\r\n                                    key={time}\r\n                                    className={timeControl === time ? 'selected' : ''}\r\n                                    onClick={() => setTimeControl(time)}\r\n                                >\r\n                                    {time / 60}ë¶„\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"room-actions\">\r\n                        <button onClick={handleCreateRoom} className=\"create-room-btn\">\r\n                            {gameMode === 'ai' ? 'ðŸ¤– AI ëŒ€ì „ ì‹œìž‘' : 'ìƒˆë¡œìš´ ë°© ë§Œë“¤ê¸°'}\r\n                        </button>\r\n\r\n                        {/* í”Œë ˆì´ì–´ ëŒ€ì „ ëª¨ë“œì¼ ë•Œë§Œ ë°© ì°¸ê°€ ê¸°ëŠ¥ í‘œì‹œ */}\r\n                        {gameMode === 'player' && (\r\n                            <div className=\"join-room\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={newRoomId}\r\n                                    onChange={(e) => setNewRoomId(e.target.value)}\r\n                                    placeholder=\"ë°© ì½”ë“œ ìž…ë ¥\"\r\n                                    maxLength=\"6\"\r\n                                />\r\n                                <button onClick={() => handleJoinRoom()}>ì½”ë“œë¡œ ì°¸ê°€</button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {availableRooms.length > 0 && (\r\n                        <div className=\"available-rooms\">\r\n                            <h3>ðŸ“‹ ëŒ€ê¸° ì¤‘ì¸ ë°© ëª©ë¡</h3>\r\n                            <div className=\"rooms-list\">\r\n                                {availableRooms.map((room) => (\r\n                                    <div key={room.id} className=\"room-item\">\r\n                                        <div className=\"room-info\">\r\n                                            <span className=\"room-host\">\r\n                                                í˜¸ìŠ¤íŠ¸: {room.playerNames.white} ({room.playerRanks?.white || 'Unranked'}, {room.playerRatings?.white || 0}ì )\r\n                                            </span>\r\n                                            <span className=\"room-time\">â± {formatTime(room.timeControl)}</span>\r\n                                            <span className=\"room-code\">ì½”ë“œ: {room.id}</span>\r\n                                        </div>\r\n                                        <div className=\"room-item-buttons\">\r\n                                            <button\r\n                                                onClick={() => handleJoinRoom(room.id)}\r\n                                                className=\"join-btn\"\r\n                                            >\r\n                                                ì°¸ê°€\r\n                                            </button>\r\n                                            {isAdmin?.() && (\r\n                                                <button\r\n                                                    onClick={() => handleAdminDeleteRoom(room.id)}\r\n                                                    className=\"delete-btn\"\r\n                                                >\r\n                                                    ì‚­ì œ\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"chess-rules\">\r\n                        <h3>ì²´ìŠ¤ ê¸°ë³¸ ê·œì¹™</h3>\r\n                        <ul>\r\n                            <li>ë°±(White)ì´ ë¨¼ì € ì‹œìž‘í•©ë‹ˆë‹¤.</li>\r\n                            <li>ìƒëŒ€ë°©ì˜ í‚¹ì„ ì²´í¬ë©”ì´íŠ¸í•˜ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤.</li>\r\n                            <li>í”Œë ˆì´ì–´ ëŒ€ì „: ìŠ¹ë¦¬ ì‹œ <strong>ì ìˆ˜(+15)</strong>ì™€ ì¿ í° 3ê°œ, íŒ¨ë°° ì‹œ <strong>ì ìˆ˜(-10)</strong></li>\r\n                            <li>AI ëŒ€ì „: ìŠ¹ë¦¬ ì‹œ <strong>ì¹´ë“œ ë³´ìƒ</strong> ì„ íƒ (í˜„ê¸ˆ ë˜ëŠ” ì¿ í°), í•˜ë£¨ 3íšŒ ì œí•œ</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!gameData) {\r\n        return <AlchanLoading />;\r\n    }\r\n\r\n    const whitePlayerId = gameData.players.white;\r\n    const blackPlayerId = gameData.players.black;\r\n\r\n    return (\r\n        <div className=\"chess-container\" style={containerStyle}>\r\n            <div className=\"game-info\">\r\n                <div className={`player black ${gameData.turn === 'b' ? 'active' : ''} ${user?.uid === blackPlayerId ? 'my-player' : 'opponent-player'}`}>\r\n                    <span className=\"player-name\">\r\n                        â™› {gameData.playerNames.black || 'ëŒ€ê¸°ì¤‘...'}\r\n                        <span className=\"player-rank\">[{gameData.playerRanks?.black || 'Unranked'}] ({gameData.playerRatings?.black || 0}ì )</span>\r\n                    </span>\r\n                    <span className=\"player-time\">{formatTime(blackTime)}</span>\r\n                </div>\r\n\r\n                <div className=\"game-status\">\r\n                    {gameData.status === 'finished' ? (\r\n                        gameData.winner === 'draw' ? (\r\n                            <span>ë¬´ìŠ¹ë¶€!</span>\r\n                        ) : gameData.winner === myColor ? (\r\n                            <span className=\"winner\">ðŸŽ‰ ìŠ¹ë¦¬! ({gameData.ratingChange[myColor === 'w' ? 'white' : 'black'] > 0 ? '+' : ''}{gameData.ratingChange[myColor === 'w' ? 'white' : 'black']}ì ) ì¿ í° 3ê°œ íšë“!</span>\r\n                        ) : (\r\n                            <span className=\"loser\">íŒ¨ë°°! ({gameData.ratingChange[myColor === 'w' ? 'white' : 'black']}ì )</span>\r\n                        )\r\n                    ) : gameData.status === 'waiting' ? (\r\n                        <span>ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘... (ì½”ë“œ: {gameId})</span>\r\n                    ) : (\r\n                        <span>{isMyTurn ? 'ë‹¹ì‹ ì˜ ì°¨ë¡€' : 'ìƒëŒ€ë°© ì°¨ë¡€'}</span>\r\n                    )}\r\n                </div>\r\n\r\n                <div className={`player white ${gameData.turn === 'w' ? 'active' : ''} ${user?.uid === whitePlayerId ? 'my-player' : 'opponent-player'}`}>\r\n                    <span className=\"player-name\">\r\n                        â™• {gameData.playerNames.white}\r\n                        <span className=\"player-rank\">[{gameData.playerRanks?.white || 'Unranked'}] ({gameData.playerRatings?.white || 0}ì )</span>\r\n                    </span>\r\n                    <span className=\"player-time\">{formatTime(whiteTime)}</span>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"board-container\">\r\n                <div className={`chess-board ${myColor === 'b' ? 'flipped' : ''}`}>\r\n                    {gameData.board.map((row, rIndex) => (\r\n                        row.map((piece, cIndex) => {\r\n                            const isSelected = selectedPiece?.row === rIndex && selectedPiece?.col === cIndex;\r\n                            const isPossibleMove = possibleMoves.some(([r, c]) => r === rIndex && c === cIndex);\r\n                            const isLight = (rIndex + cIndex) % 2 === 0;\r\n                            const isCheck = piece && piece[1] === 'K' && isInCheck(gameData.board, piece[0]);\r\n\r\n                            return (\r\n                                <div\r\n                                    key={`${rIndex}-${cIndex}`}\r\n                                    className={`square ${isLight ? 'light' : 'dark'} \r\n                                               ${isSelected ? 'selected' : ''} \r\n                                               ${isPossibleMove ? 'possible' : ''}\r\n                                               ${isCheck ? 'check' : ''}`}\r\n                                    onClick={() => handlePieceClick(rIndex, cIndex)}\r\n                                >\r\n                                    {piece && (\r\n                                        <div className={`piece ${piece[0] === 'w' ? 'white-piece' : 'black-piece'}`}>\r\n                                            {PIECES[piece]}\r\n                                        </div>\r\n                                    )}\r\n                                    {isPossibleMove && !piece && <div className=\"move-dot\" />}\r\n                                    {isPossibleMove && piece && <div className=\"capture-hint\" />}\r\n                                </div>\r\n                            );\r\n                        })\r\n                    ))}\r\n                </div>\r\n\r\n                {showPromotion && (\r\n                    <div className=\"promotion-modal\">\r\n                        <div className=\"promotion-content\">\r\n                            <h3>í”„ë¡œëª¨ì…˜ ì„ íƒ</h3>\r\n                            <div className=\"promotion-pieces\">\r\n                                {['Q', 'R', 'B', 'N'].map(type => (\r\n                                    <button\r\n                                        key={type}\r\n                                        onClick={() => handlePromotion(type)}\r\n                                        className=\"promotion-piece\"\r\n                                    >\r\n                                        {PIECES[myColor + type]}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* AI ì‚¬ê³  ì¤‘ í‘œì‹œ */}\r\n                {isAiThinking && (\r\n                    <div className=\"ai-thinking\">\r\n                        <div className=\"thinking-content\">\r\n                            <div className=\"spinner\"></div>\r\n                            <p>AIê°€ ìˆ˜ë¥¼ ê³ ë¯¼í•˜ëŠ” ì¤‘...</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* ë³´ìƒ ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ */}\r\n                {showRewardSelection && rewardCards.length === 2 && (\r\n                    <div className=\"reward-modal\">\r\n                        <div className=\"reward-content\">\r\n                            <h3>ðŸŽ‰ ìŠ¹ë¦¬ ë³´ìƒ!</h3>\r\n                            <p>í•˜ë‚˜ì˜ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>\r\n                            <div className=\"reward-cards\">\r\n                                {rewardCards.map((card, index) => (\r\n                                    <div\r\n                                        key={index}\r\n                                        className=\"reward-card\"\r\n                                        onClick={() => handleRewardSelection(card)}\r\n                                    >\r\n                                        <div className=\"card-icon\">\r\n                                            {card.type === 'cash' ? 'ðŸ’µ' : 'ðŸŽ«'}\r\n                                        </div>\r\n                                        <div className=\"card-title\">\r\n                                            {card.type === 'cash' ? 'í˜„ê¸ˆ' : 'ì¿ í°'}\r\n                                        </div>\r\n                                        <div className=\"card-amount\">\r\n                                            {card.type === 'cash'\r\n                                                ? `${card.amount.toLocaleString()}ì›`\r\n                                                : `${card.amount}ê°œ`}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {feedback.message && (\r\n                <div className={`feedback ${feedback.type}`}>{feedback.message}</div>\r\n            )}\r\n\r\n            <div className=\"game-controls\">\r\n                <button onClick={handleLeaveGame} className=\"leave-button\">\r\n                    ê²Œìž„ ë‚˜ê°€ê¸°\r\n                </button>\r\n            </div>\r\n\r\n            {moveHistory.length > 0 && (\r\n                <div className=\"move-history\">\r\n                    <h4>ì´ë™ ê¸°ë¡</h4>\r\n                    <div className=\"moves-list\">\r\n                        {moveHistory.map((move, idx) => (\r\n                            <span key={idx} className=\"move\">\r\n                                {idx % 2 === 0 ? `${Math.floor(idx / 2) + 1}. ` : ''}{move}\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChessGame;"],"names":["PIECES","RANKS","name","minPoints","RATING_CHANGE","serializeBoard","board","serialized","forEach","row","rIndex","cell","cIndex","concat","deserializeBoard","serializedBoard","Array","fill","map","key","r","c","split","Number","PIECE_VALUES","PAWN_POSITION_BONUS","KNIGHT_POSITION_BONUS","minimax","depth","isMaximizing","alpha","beta","color","getValidMovesFunc","evaluateBoard","score","piece","pieceColor","pieceType","pieceValue","positionBonus","totalValue","currentColor","allMoves","_ref","toR","toC","push","from","to","length","maxEval","Infinity","move","newBoard","evaluation","Math","max","minEval","min","ChessGame","_gameData$moveHistory2","_gameData$playerRanks","_gameData$playerRatin","_gameData$playerRanks2","_gameData$playerRatin2","user","userDoc","isAdmin","useAuth","gameId","setGameId","useState","gameData","setGameData","showCreateRoom","setShowCreateRoom","newRoomId","setNewRoomId","feedback","setFeedback","message","type","selectedPiece","setSelectedPiece","possibleMoves","setPossibleMoves","availableRooms","setAvailableRooms","timeControl","setTimeControl","whiteTime","setWhiteTime","blackTime","setBlackTime","showPromotion","setShowPromotion","moveHistory","setMoveHistory","intervalRef","useRef","refetchRef","aiTimeoutRef","lastAiMoveCountRef","gameMode","setGameMode","aiDifficulty","setAiDifficulty","isAiThinking","setIsAiThinking","isMoving","setIsMoving","showRewardSelection","setShowRewardSelection","rewardCards","setRewardCards","dailyPlayCount","setDailyPlayCount","myColor","aiMode","playerColor","players","white","uid","isMyTurn","turn","rank","userRank","nextRank","pointsForNextRank","points","arguments","undefined","currentRank","i","nextRankIndex","findIndex","getRankInfo","chessRating","gameIdRef","useEffect","current","gameDataRef","userRef","cleanup","_currentGameData$play","currentGameId","currentGameData","currentUser","deleteDoc","doc","db","window","addEventListener","removeEventListener","handleTimeout","useCallback","async","gameRef","winnerColor","loserColor","runTransaction","gameDoc","transaction","get","exists","data","status","update","winner","endReason","ratingChange","setInterval","newTime","clearInterval","fetchAvailableRooms","q","query","collection","where","querySnapshot","getDocs","rooms","_objectSpread","id","error","console","interval","fetchGameData","docSnap","getDoc","rawData","deserializedData","refetch","usePolling","enabled","loadDailyPlayCount","today","Date","toDateString","storageKey","count","parseInt","localStorage","getItem","timer","setTimeout","clearTimeout","getValidMoves","col","checkForCheck","moves","addMove","target","testBoard","isInCheck","direction","startRow","dc","enPassant","epRow","epCol","abs","_ref3","dr","_ref4","_ref5","castling","kingRow","isSquareUnderAttack","opponentColor","some","_ref6","mr","mc","kingPos","checkGameEnd","handleCreateRoom","newGameId","random","toString","substring","isAiMode","aiColor","initialGameData","black","playerNames","playerRanks","playerRatings","wK","wQ","bK","bQ","createdAt","serverTimestamp","setDoc","handleJoinRoom","targetRoomId","trim","Error","handleMove","toRow","toCol","fromRow","fromCol","executeMove","handleLeaveGame","_gameData$players","promotionPiece","result","currentData","moveMade","newCastling","newEnPassant","files","moveNotation","newMoveHistory","nextTurn","newStatus","newWinner","newRatingChange","gameEndState","updateData","playerIsWinner","isDraw","cards","generateRewardCards","weightedRandom","items","totalWeight","reduce","sum","item","weight","amount","newCount","setItem","_gameData$moveHistory","currentMoveCount","thinkingTime","gameSnap","bestMove","findBestMove","difficulty","_ref2","floor","bestValue","moveValue","makeAiMove","formatTime","seconds","mins","secs","padStart","_jsx","className","children","_jsxs","onClick","time","value","onChange","e","placeholder","maxLength","room","_room$playerRanks","_room$playerRatings","roomId","handleAdminDeleteRoom","AlchanLoading","whitePlayerId","blackPlayerId","style","backgroundColor","minHeight","width","isSelected","isPossibleMove","_ref8","isLight","isCheck","handlePieceClick","_ref7","promoteTo","handlePromotion","card","index","selectedCard","balance","increment","couponBalance","toLocaleString","logActivity","classCode","userId","userName","ACTIVITY_TYPES","GAME_WIN","description","couponAmount","metadata","gameType","opponent","rewardType","rewardAmount","handleRewardSelection","idx"],"sourceRoot":""}