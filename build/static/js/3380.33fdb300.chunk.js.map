{"version":3,"file":"static/js/3380.33fdb300.chunk.js","mappings":"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","sources":["pages/student/StudentRequest.js","utils/youtube-api.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { db } from '../../firebase';\r\nimport { doc, getDoc, collection, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { searchVideos } from '../../utils/youtube-api';\r\nimport { logger } from '../../utils/logger';\r\nimport './StudentRequest.css';\r\n\r\nconst StudentRequest = () => {\r\n    const { roomId } = useParams();\r\n    const [roomName, setRoomName] = useState('');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [videos, setVideos] = useState([]);\r\n    const [selectedVideo, setSelectedVideo] = useState(null);\r\n    const [requesterName, setRequesterName] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [requestSuccess, setRequestSuccess] = useState(false); // 신청 성공 상태 추가\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        const fetchRoomInfo = async () => {\r\n            const roomDoc = await getDoc(doc(db, 'musicRooms', roomId));\r\n            if (roomDoc.exists()) {\r\n                setRoomName(roomDoc.data().name);\r\n            } else {\r\n                setError('존재하지 않는 방입니다.');\r\n            }\r\n        };\r\n        fetchRoomInfo();\r\n    }, [roomId]);\r\n\r\n    const handleSearch = async (e) => {\r\n        e.preventDefault();\r\n        if (!searchTerm.trim()) return;\r\n        setIsLoading(true);\r\n        setError('');\r\n        try {\r\n            const results = await searchVideos(searchTerm);\r\n            setVideos(results);\r\n            setRequestSuccess(false); // 새로운 검색 시 성공 상태 초기화\r\n        } catch (err) {\r\n            setError('YouTube 영상을 검색하는 중 오류가 발생했습니다.');\r\n            logger.error(err);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleRequest = async () => {\r\n        if (!selectedVideo || !requesterName.trim()) {\r\n            alert('영상과 신청자 이름을 모두 입력해주세요.');\r\n            return;\r\n        }\r\n        try {\r\n            await addDoc(collection(db, 'musicRooms', roomId, 'playlist'), {\r\n                videoId: selectedVideo.id.videoId,\r\n                title: selectedVideo.snippet.title,\r\n                requesterName: requesterName.trim(),\r\n                requestedAt: serverTimestamp()\r\n            });\r\n            setRequestSuccess(true); // 신청 성공 상태로 변경\r\n        } catch (err) {\r\n            setError('음악을 신청하는 중 오류가 발생했습니다.');\r\n            logger.error(err);\r\n        }\r\n    };\r\n\r\n    const resetForNextRequest = () => {\r\n        setRequestSuccess(false);\r\n        setSelectedVideo(null);\r\n        setSearchTerm('');\r\n        setVideos([]);\r\n    };\r\n\r\n    if (error) {\r\n        return <div className=\"student-request-container error-container\">{error}</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"student-request-container\">\r\n            <h2>{roomName}</h2>\r\n            \r\n            {requestSuccess ? (\r\n                <div className=\"success-section\">\r\n                    <h3>\"{selectedVideo.snippet.title}\"</h3>\r\n                    <p>음악 신청이 완료되었습니다!</p>\r\n                    <div className=\"success-actions\">\r\n                        <button onClick={resetForNextRequest} className=\"action-btn continue-btn\">계속 신청하기</button>\r\n                        <button onClick={() => navigate('/learning-board/music-request')} className=\"action-btn back-btn\">돌아가기</button>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    <form onSubmit={handleSearch} className=\"search-form\">\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"search-input\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            placeholder=\"신청할 노래 제목이나 아티스트를 검색하세요\"\r\n                        />\r\n                        <button type=\"submit\" className=\"search-btn\" disabled={isLoading}>\r\n                            {isLoading ? '검색 중...' : '검색'}\r\n                        </button>\r\n                    </form>\r\n\r\n                    {videos.length > 0 && (\r\n                        <div className=\"search-results\">\r\n                            <h4>검색 결과</h4>\r\n                            <ul className=\"video-list\">\r\n                                {videos.map(video => (\r\n                                    <li\r\n                                        key={video.id.videoId}\r\n                                        className={`video-item ${selectedVideo?.id.videoId === video.id.videoId ? 'selected' : ''}`}\r\n                                        onClick={() => setSelectedVideo(video)}\r\n                                    >\r\n                                        <img src={video.snippet.thumbnails.default.url} alt={video.snippet.title} loading=\"lazy\" width=\"120\" height=\"90\" />\r\n                                        <p>{video.snippet.title}</p>\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        </div>\r\n                    )}\r\n\r\n                    {selectedVideo && (\r\n                        <div className=\"request-section\">\r\n                            <h4>신청 정보</h4>\r\n                            <p>선택된 곡: {selectedVideo.snippet.title}</p>\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"requester-name-input\"\r\n                                value={requesterName}\r\n                                onChange={(e) => setRequesterName(e.target.value)}\r\n                                placeholder=\"신청자 이름을 입력하세요\"\r\n                            />\r\n                            <button onClick={handleRequest} className=\"request-btn\">\r\n                                이 곡으로 신청하기\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StudentRequest;","import { logger } from './logger';\r\nconst API_KEY = process.env.REACT_APP_YOUTUBE_API_KEY; // .env 파일에서 API 키를 불러옵니다.\r\n\r\nexport const searchVideos = async (query) => {\r\n    const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}&maxResults=10`);\r\n    \r\n    if (!response.ok) {\r\n        const errorData = await response.json();\r\n        logger.error(\"YouTube API Error:\", errorData);\r\n        throw new Error('YouTube 영상을 검색하는 데 실패했습니다. API 키나 요청을 확인해주세요.');\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return data.items;\r\n};"],"names":["StudentRequest","roomId","useParams","roomName","setRoomName","useState","searchTerm","setSearchTerm","videos","setVideos","selectedVideo","setSelectedVideo","requesterName","setRequesterName","isLoading","setIsLoading","error","setError","requestSuccess","setRequestSuccess","navigate","useNavigate","useEffect","async","roomDoc","getDoc","doc","db","exists","data","name","fetchRoomInfo","_jsx","className","children","_jsxs","snippet","title","onClick","resetForNextRequest","_Fragment","onSubmit","e","preventDefault","trim","results","response","fetch","concat","encodeURIComponent","query","process","ok","errorData","json","logger","Error","items","searchVideos","err","type","value","onChange","target","placeholder","disabled","length","map","video","id","videoId","src","thumbnails","default","url","alt","loading","width","height","addDoc","collection","requestedAt","serverTimestamp","alert"],"ignoreList":[],"sourceRoot":""}