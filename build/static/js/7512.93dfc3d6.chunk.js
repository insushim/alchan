/*! For license information please see 7512.93dfc3d6.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[7512],{2024(e,s,t){t.d(s,{A:()=>a});const a=(0,t(7784).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6555(e,s,t){t.d(s,{Gu:()=>r,LN:()=>l,pp:()=>o,rA:()=>c,zY:()=>i});t(5043);var a=t(2024),n=(t(5881),t(579));const l=e=>{let{children:s,className:t=""}=e;return(0,n.jsx)("div",{className:"min-h-full w-full bg-[#0a0a12] ".concat(t),children:(0,n.jsx)("div",{className:"w-full max-w-none px-2 md:px-3 lg:px-4 py-1 md:py-2",children:s})})},i=e=>{let{title:s,subtitle:t,icon:a,badge:l,action:i,backButton:r,className:o=""}=e;return(0,n.jsxs)("section",{className:"bg-[#14142380] backdrop-blur-sm rounded-lg px-3 py-1.5 md:px-4 md:py-2 shadow-lg border border-cyan-900/30 flex flex-col md:flex-row md:items-center justify-between gap-1.5 md:gap-2 mb-2 md:mb-3 ".concat(o),children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[r,a&&(0,n.jsx)("div",{className:"w-9 h-9 md:w-10 md:h-10 bg-cyan-900/30 rounded-lg flex items-center justify-center text-cyan-400 shrink-0 shadow-sm border border-cyan-500/30",children:(0,n.jsx)(a,{className:"w-5 h-5"})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("h2",{className:"text-lg md:text-xl font-bold text-white tracking-tight",children:s}),l]}),t&&(0,n.jsx)("p",{className:"text-xs md:text-sm text-slate-400 font-medium",children:t})]})]}),i&&(0,n.jsx)("div",{className:"flex flex-wrap items-center gap-2 md:gap-3 md:ml-auto",children:i})]})},r=e=>{let{message:s="\ub370\uc774\ud130\ub97c \ubd88\ub7ec\uc624\ub294 \uc911..."}=e;return null},o=e=>{let{icon:s,title:t,description:a,action:l}=e;return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[s&&(0,n.jsx)("div",{className:"w-16 h-16 rounded-full bg-[#14142380] shadow-lg flex items-center justify-center mb-4 border border-cyan-900/30",children:(0,n.jsx)(s,{className:"w-8 h-8 text-slate-400"})}),t&&(0,n.jsx)("h3",{className:"text-lg font-bold text-slate-300 mb-2",children:t}),a&&(0,n.jsx)("p",{className:"text-slate-400 font-medium mb-6 max-w-md",children:a}),l]})},c=e=>{let{children:s,icon:t,variant:l="primary",size:i="md",loading:r=!1,disabled:o=!1,onClick:c,className:d="",title:m}=e;return(0,n.jsxs)("button",{onClick:c,disabled:o||r,title:m,className:"inline-flex items-center justify-center gap-2 font-bold rounded-xl transition-all duration-200 active:scale-95 whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ".concat({primary:"bg-cyan-500 text-slate-900 hover:bg-cyan-400 ring-1 ring-cyan-400 shadow-cyan-500/30",secondary:"bg-slate-800 hover:bg-slate-700 text-slate-200",outline:"bg-transparent text-slate-300 ring-1 ring-slate-600 hover:bg-slate-800 hover:ring-slate-500 shadow-sm","outline-green":"bg-transparent text-emerald-400 ring-1 ring-emerald-600 hover:bg-emerald-900/30 hover:ring-emerald-500 shadow-sm","outline-red":"bg-transparent text-rose-400 ring-1 ring-rose-600 hover:bg-rose-900/30 hover:ring-rose-500 shadow-sm",danger:"bg-transparent text-rose-400 ring-1 ring-rose-600 hover:bg-rose-900/30 hover:ring-rose-500 shadow-sm",success:"bg-transparent text-emerald-400 ring-1 ring-emerald-600 hover:bg-emerald-900/30 hover:ring-emerald-500 shadow-sm",ghost:"text-slate-400 hover:bg-slate-800 hover:text-white",indigo:"bg-purple-900/30 text-purple-300 hover:bg-purple-900/50"}[l]," ").concat({sm:"px-4 py-2 text-sm",md:"px-5 py-2.5 text-sm",lg:"px-6 py-3 text-base"}[i]," ").concat(d),children:[r?(0,n.jsx)(a.A,{className:"w-4 h-4 animate-spin"}):t?(0,n.jsx)(t,{className:"w-4 h-4"}):null,s]})}},7512(e,s,t){t.r(s),t.d(s,{default:()=>I});var a=t(3986),n=t(2555),l=t(5043),i=t(7950),r=t(5016),o=t(2864),c=t(579);const d=e=>{let{onSubmitComplaint:s,users:t=[],currentUserId:a,isAdmin:n=!1}=e;const[i,r]=(0,l.useState)(""),[o,d]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[p,h]=(0,l.useState)(""),[v,x]=(0,l.useState)("custom"),[j,g]=(0,l.useState)([]),[b,f]=(0,l.useState)(""),[y,N]=(0,l.useState)([]),[w,I]=(0,l.useState)(""),[C,k]=(0,l.useState)(""),[S,A]=(0,l.useState)(!1);(0,l.useEffect)(()=>{const e=localStorage.getItem("predefinedComplaintReasons");if(e)try{g(JSON.parse(e))}catch(t){}else{const e=["\uc218\uc5c5 \uc911 \uc18c\ub780 \ud589\uc704","\uc7ac\uc0b0 \uc190\uad34","\uc9d1\ub2e8 \ub530\ub3cc\ub9bc","\uc695\uc124 \uc0ac\uc6a9","\uae09\uc2dd\uc9c8\uc11c \uc704\ubc18"];g(e),localStorage.setItem("predefinedComplaintReasons",JSON.stringify(e))}const s=localStorage.getItem("nationalAssemblyLaws");if(s){let e;try{e=JSON.parse(s)}catch(a){e=[]}const t=e.filter(e=>"approved"===e.status||"veto_overridden"===e.status||"final_approved"===e.finalStatus);N(t)}},[]),(0,l.useEffect)(()=>{j.length>0&&localStorage.setItem("predefinedComplaintReasons",JSON.stringify(j))},[j]);const F=e=>{x(e),"custom"===e?u(""):"predefined"===e?(f(""),u("")):"law"===e&&(I(""),u(""))};(0,l.useEffect)(()=>{if("predefined"===v&&b)u(b);else if("law"===v&&w){const e=y.find(e=>e.id===parseInt(w));e&&u("\ubc95\uc548 \uc704\ubc18: ".concat(e.title," - ").concat(e.description))}},[b,w,y,v]);const R=t.filter(e=>e.id!==a).map(e=>(0,c.jsxs)("option",{value:e.id,children:[e.name," "]},e.id));return(0,c.jsxs)("div",{className:"complaint-submission-container",children:[(0,c.jsx)("h2",{className:"section-title",children:"\uace0\uc18c\uc7a5 \uc81c\ucd9c"}),(0,c.jsxs)("form",{onSubmit:e=>{var t;e.preventDefault(),o?m.trim()?(s({complainantName:i,defendantId:o,reason:m,desiredResolution:p,lawViolation:"law"===v?{lawId:parseInt(w),lawTitle:(null===(t=y.find(e=>e.id===parseInt(w)))||void 0===t?void 0:t.title)||""}:null}),d(""),u(""),h(""),x("custom"),f(""),I("")):alert("\uace0\uc18c \uc0ac\uc720\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."):alert("\ud53c\uace0\uc18c\uc778\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694.")},className:"submit-complaint-form",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"defendantSelect",className:"form-label",children:"\ud53c\uace0\uc18c\uc778 \uc120\ud0dd"}),(0,c.jsxs)("select",{id:"defendantSelect",className:"form-select",value:o,onChange:e=>d(e.target.value),required:!0,children:[(0,c.jsx)("option",{value:"",children:"-- \ud53c\uace0\uc18c\uc778\uc744 \uc120\ud0dd\ud558\uc138\uc694 --"}),R]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{className:"form-label",children:"\uace0\uc18c \uc0ac\uc720 \uc120\ud0dd \ubc29\ubc95"}),(0,c.jsxs)("div",{className:"reason-type-selection",children:[(0,c.jsxs)("div",{className:"reason-type-option",children:[(0,c.jsx)("input",{type:"radio",id:"reasonTypeCustom",name:"reasonType",value:"custom",checked:"custom"===v,onChange:()=>F("custom")}),(0,c.jsx)("label",{htmlFor:"reasonTypeCustom",children:"\uc9c1\uc811 \uc785\ub825"})]}),(0,c.jsxs)("div",{className:"reason-type-option",children:[(0,c.jsx)("input",{type:"radio",id:"reasonTypePredefined",name:"reasonType",value:"predefined",checked:"predefined"===v,onChange:()=>F("predefined")}),(0,c.jsx)("label",{htmlFor:"reasonTypePredefined",children:"\uc77c\ubc18 \uace0\uc18c \uc0ac\uc720"})]}),(0,c.jsxs)("div",{className:"reason-type-option",children:[(0,c.jsx)("input",{type:"radio",id:"reasonTypeLaw",name:"reasonType",value:"law",checked:"law"===v,onChange:()=>F("law")}),(0,c.jsx)("label",{htmlFor:"reasonTypeLaw",children:"\ubc95\uc548 \uc704\ubc18"})]})]})]}),"custom"===v&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"reason",className:"form-label",children:"\uace0\uc18c \uc0ac\uc720"}),(0,c.jsx)("textarea",{id:"reason",className:"form-textarea",value:m,onChange:e=>u(e.target.value),placeholder:"\uace0\uc18c \uc0ac\uc720\ub97c \uc9c1\uc811 \uc785\ub825\ud558\uc138\uc694",required:!0})]}),"predefined"===v&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"predefinedReason",className:"form-label",children:"\uace0\uc18c \uc0ac\uc720 \uc120\ud0dd"}),(0,c.jsxs)("div",{className:"predefined-reason-container",children:[(0,c.jsxs)("select",{id:"predefinedReason",className:"form-select",value:b,onChange:e=>f(e.target.value),required:!0,children:[(0,c.jsx)("option",{value:"",children:"-- \uace0\uc18c \uc0ac\uc720\ub97c \uc120\ud0dd\ud558\uc138\uc694 --"}),j.map((e,s)=>(0,c.jsx)("option",{value:e,children:e},s))]}),n&&(0,c.jsx)("button",{type:"button",className:"add-reason-button",onClick:()=>A(!0),children:"+ \uace0\uc18c \uc0ac\uc720 \ucd94\uac00"})]}),b&&(0,c.jsx)("div",{className:"selected-reason-display",children:(0,c.jsxs)("p",{children:["\uc120\ud0dd\ub41c \uace0\uc18c \uc0ac\uc720: ",b]})})]}),"law"===v&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"lawViolation",className:"form-label",children:"\uc704\ubc18 \ubc95\uc548 \uc120\ud0dd"}),(0,c.jsxs)("select",{id:"lawViolation",className:"form-select",value:w,onChange:e=>I(e.target.value),required:!0,children:[(0,c.jsx)("option",{value:"",children:"-- \uc704\ubc18\ud55c \ubc95\uc548\uc744 \uc120\ud0dd\ud558\uc138\uc694 --"}),y.map(e=>(0,c.jsxs)("option",{value:e.id,children:[e.title," (\ubc8c\uae08: ",e.fine,")"]},e.id))]}),w&&(0,c.jsx)("div",{className:"selected-law-display",children:y.find(e=>e.id===parseInt(w))&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"\ubc95\uc548 \ucde8\uc9c0:"})," ",y.find(e=>e.id===parseInt(w)).purpose]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"\ubc95\uc548 \uc124\uba85:"})," ",y.find(e=>e.id===parseInt(w)).description]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"\ubc8c\uae08:"})," ",y.find(e=>e.id===parseInt(w)).fine]})]})})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"desiredResolution",className:"form-label",children:"\uc6d0\ud558\ub294 \uacb0\uacfc"}),(0,c.jsx)("textarea",{id:"desiredResolution",className:"form-textarea",value:p,onChange:e=>h(e.target.value),placeholder:"\uc6d0\ud558\ub294 \ucc98\ubc8c\uc774\ub098 \uacb0\uacfc\ub97c \uc785\ub825\ud558\uc138\uc694 (\uc120\ud0dd\uc0ac\ud56d)"})]}),(0,c.jsx)("button",{type:"submit",className:"submit-button",children:"\uace0\uc18c\uc7a5 \uc81c\ucd9c"})]}),S&&(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-container small",children:[(0,c.jsx)("div",{className:"modal-header",children:(0,c.jsx)("h3",{className:"modal-title",children:"\uc0c8 \uace0\uc18c \uc0ac\uc720 \ucd94\uac00"})}),(0,c.jsx)("div",{className:"modal-content",children:(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"newReason",className:"form-label",children:"\uace0\uc18c \uc0ac\uc720"}),(0,c.jsx)("input",{type:"text",id:"newReason",className:"form-input",value:C,onChange:e=>k(e.target.value),placeholder:"\uc0c8\ub85c\uc6b4 \uace0\uc18c \uc0ac\uc720\ub97c \uc785\ub825\ud558\uc138\uc694"})]})}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{type:"button",className:"modal-button cancel",onClick:()=>{A(!1),k("")},children:"\ucde8\uc18c"}),(0,c.jsx)("button",{type:"button",className:"modal-button submit",onClick:()=>{if(!C.trim())return void alert("\uace0\uc18c \uc0ac\uc720\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694.");const e=[...j,C.trim()];g(e),k(""),A(!1)},disabled:!C.trim(),children:"\ucd94\uac00"})]})]})}),n&&"predefined"===v&&j.length>0&&(0,c.jsxs)("div",{className:"admin-reasons-management",children:[(0,c.jsx)("h3",{children:"\uace0\uc18c \uc0ac\uc720 \uad00\ub9ac"}),(0,c.jsx)("div",{className:"reasons-list",children:j.map((e,s)=>(0,c.jsxs)("div",{className:"reason-item",children:[(0,c.jsx)("span",{className:"reason-text",children:e}),(0,c.jsx)("button",{type:"button",className:"delete-reason-button",onClick:()=>(e=>{if(window.confirm("\uc774 \uace0\uc18c \uc0ac\uc720\ub97c \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?")){const s=[...j];s.splice(e,1),g(s)}})(s),children:"\uc0ad\uc81c"})]},s))})]})]})},m=e=>{let{complaints:s,users:t,isAdmin:a,currentUserId:n,onVote:l,onStartTrial:i,onOpenJudgment:r,onEditComplaint:o,onDeleteComplaint:d,onIndictComplaint:m,onDismissComplaint:u}=e;const p=e=>{var s;return(null===(s=t.find(s=>s.id===e))||void 0===s?void 0:s.name)||"\uc54c \uc218 \uc5c6\uc74c"};return(0,c.jsx)("div",{className:"complaint-list-container",children:(0,c.jsxs)("ul",{className:"complaint-list",children:[" ",0===s.length?(0,c.jsx)("li",{className:"empty-state",children:"\ud574\ub2f9 \uc0c1\ud0dc\uc758 \uc0ac\uac74\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."}):s.map(e=>{var s,t,h,v;const x=(null===(s=e.likedBy)||void 0===s?void 0:s.length)||0,j=(null===(t=e.dislikedBy)||void 0===t?void 0:t.length)||0,g=null===(h=e.likedBy)||void 0===h?void 0:h.includes(n),b=null===(v=e.dislikedBy)||void 0===v?void 0:v.includes(n);let f="complaint-card";return"indicted"===e.status?f+=" indicted-card":"on_trial"===e.status?f+=" on-trial-card":"dismissed"===e.status&&(f+=" dismissed-card"),(0,c.jsxs)("li",{className:f,children:[" ",(0,c.jsxs)("div",{className:"complaint-card-header",children:[(0,c.jsxs)("span",{className:"case-id",children:["ID: ",e.id.slice(-6)]}),(0,c.jsxs)("span",{className:"parties-display",children:[p(e.complainantId)," *"," ",p(e.defendantId)]}),(0,c.jsx)("span",{className:"case-status status-".concat(e.status),children:"pending"===e.status?"\uac80\ud1a0\ub300\uae30":"indicted"===e.status?"\uae30\uc18c\ub428":"on_trial"===e.status?"\uc7ac\ud310\uc911":"dismissed"===e.status?"\uae30\uac01/\ubd88\uae30\uc18c":"resolved"===e.status?"\uc7ac\ud310\uc644\ub8cc":e.status})]}),(0,c.jsxs)("div",{className:"complaint-card-content",children:[(0,c.jsx)("h4",{children:"\uace0\uc18c \uc0ac\uc720"}),(0,c.jsx)("p",{children:e.reason}),e.desiredResolution&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h4",{children:"\uc6d0\ud558\ub294 \uacb0\uacfc"}),(0,c.jsx)("p",{children:e.desiredResolution})]})]}),"pending"===e.status&&(0,c.jsxs)("div",{className:"complaint-voting",children:[(0,c.jsxs)("button",{className:"vote-button like-button ".concat(g?"voted":""),onClick:()=>l(e.id,"like"),disabled:!n,title:"\uc88b\uc544\uc694",children:["\ud83d\udc4d ",(0,c.jsx)("span",{className:"vote-count",children:x})]}),(0,c.jsxs)("button",{className:"vote-button dislike-button ".concat(b?"voted":""),onClick:()=>l(e.id,"dislike"),disabled:!n,title:"\uc2eb\uc5b4\uc694",children:["\ud83d\udc4e ",(0,c.jsx)("span",{className:"vote-count",children:j})]})]}),a&&(0,c.jsxs)("div",{className:"complaint-card-actions",children:["pending"===e.status&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:()=>m(e.id),className:"indict-button",children:"\uae30\uc18c"}),(0,c.jsx)("button",{onClick:()=>u(e.id),className:"dismiss-button",children:"\uae30\uac01"}),(0,c.jsx)("button",{onClick:()=>o(e),className:"edit-button",children:"\uc218\uc815"}),(0,c.jsx)("button",{onClick:()=>d(e.id),className:"delete-button",children:"\uc0ad\uc81c"})]}),"indicted"===e.status&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:()=>i(e.id),className:"start-trial-button",children:"\uc7ac\ud310\ud558\uae30"}),(0,c.jsx)("button",{onClick:()=>o(e),className:"edit-button",children:"\uc815\ubcf4 \uc218\uc815"})," ",(0,c.jsx)("button",{onClick:()=>d(e.id),className:"delete-button",children:"\uae30\uc18c \ucde8\uc18c/\uc0ad\uc81c"})," "]}),"on_trial"===e.status&&(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("button",{onClick:()=>r(e),className:"write-judgment-button",children:"\ud310\uacb0\ubb38 \uc4f0\uae30"})}),("dismissed"===e.status||"resolved"===e.status)&&(0,c.jsx)("button",{onClick:()=>d(e.id),className:"delete-button",children:"\uae30\ub85d \uc0ad\uc81c"})]})]},e.id)})]})})};var u=t(5472),p=t(8147),h=t(577),v=t(5452);const x=e=>{let{role:s,name:t,isActive:a,userId:n,onAvatarClick:i,showSpeechBubble:r,canGrantPermission:o}=e;const[d,m]=(0,l.useState)(!1),[u,p]=(0,l.useState)({x:0,y:0}),[h,v]=(0,l.useState)(!1),x={judge:{bg:"#6f42c1",icon:"\u2696\ufe0f",title:"\ud310\uc0ac"},prosecutor:{bg:"#dc3545",icon:"\ud83d\udccb",title:"\uac80\uc0ac"},lawyer:{bg:"#0d6efd",icon:"\ud83d\udcbc",title:"\ubcc0\ud638\uc0ac"},complainant:{bg:"#198754",icon:"\ud83d\udcdd",title:"\uc6d0\uace0"},defendant:{bg:"#fd7e14",icon:"\ud83d\udee1\ufe0f",title:"\ud53c\uace0"},jury:{bg:"#0dcaf0",icon:"\ud83d\udc65",title:"\ubc30\uc2ec\uc6d0"},spectator:{bg:"#6c757d",icon:"\ud83d\udc40",title:"\ubc29\uccad\uac1d"}},j=x[s]||x.spectator;(0,l.useEffect)(()=>{if(a){const e=setInterval(()=>{v(!0),p({x:10*Math.random()-5,y:10*Math.random()-5}),setTimeout(()=>v(!1),500)},5e3);return()=>clearInterval(e)}},[a]);return(0,c.jsxs)("div",{className:"avatar ".concat(a?"active":""," ").concat(h?"walking":""),onClick:()=>{i&&i(n)},onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),"data-role":s,style:{transform:"translate(".concat(u.x,"px, ").concat(u.y,"px)"),cursor:o?"pointer":"default"},children:[(d||r)&&(0,c.jsx)("div",{className:"speech-bubble ".concat(r?"show":""),children:r?"\u26a0\ufe0f \uce68\ubb35 \uc911":o&&n?"\ud074\ub9ad\ud558\uc5ec \uce68\ubb35 \ud328\ub110\ud2f0 \uad00\ub9ac":t}),(0,c.jsx)("div",{className:"avatar-circle",style:{backgroundColor:j.bg},children:(0,c.jsx)("span",{className:"avatar-icon",children:j.icon})}),(0,c.jsx)("div",{className:"avatar-name",children:t||"\ube48 \uc790\ub9ac"}),(0,c.jsx)("div",{className:"avatar-role",children:j.title})]})},j=e=>{var s,t,a,i,r,d,m,j,g;let{roomId:b,classCode:f,currentUser:y,users:N,onClose:w}=e;const[I,C]=(0,l.useState)(null),[k,S]=(0,l.useState)([]),[A,F]=(0,l.useState)(""),[R,D]=(0,l.useState)("spectator"),[E,O]=(0,l.useState)(!0),[B,J]=(0,l.useState)([]),[T,P]=(0,l.useState)(!1),[H,U]=(0,l.useState)(!1),[q,G]=(0,l.useState)(null),[M,Z]=(0,l.useState)(null),_=(0,l.useRef)(null),L=(0,l.useRef)(null);(0,l.useEffect)(()=>{(()=>{var e;null===(e=_.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[k]);const z=(0,l.useCallback)(async()=>{if(!b||!f)return null;const e=(0,u.H9)(o.db,"classes",f,"trialRooms",b),s=await(0,u.x7)(e);return s.exists()?(0,n.A)({id:s.id},s.data()):null},[b,f]),{data:V,loading:K}=(0,h.nm)(z,{interval:6e5,enabled:!!b&&!!f,deps:[b,f]});(0,l.useEffect)(()=>{var e,s;if(K)return;if(!V)return C(null),G(null),void O(!1);C(V);const t=V.voting||null;G(t),t&&t.isActive||Z(null);let a="spectator";V.judgeId===y.id?a="judge":V.complainantId===y.id?a="complainant":V.defendantId===y.id?a="defendant":V.prosecutorId===y.id?a="prosecutor":V.lawyerId===y.id?a="lawyer":null!==(e=V.juryIds)&&void 0!==e&&e.includes(y.id)&&(a="jury"),D(a),U(Boolean(null===(s=V.silencedUsers)||void 0===s?void 0:s.includes(y.id))),O(!1)},[V,K,y.id]),(0,l.useEffect)(()=>{if(b&&f)return $(),()=>{ee()}},[b,f]);const W=(0,l.useCallback)(async()=>{if(!b||!f)return[];const e=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages"),s=(0,u.query)(e,(0,u.orderBy)("timestamp","asc"),(0,u.limit)(100));return(await(0,u.getDocs)(s)).docs.map(e=>(0,n.A)({id:e.id},e.data()))},[b,f]),Y=(0,l.useCallback)(async()=>{if(!b||!f)return[];const e=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"evidence"),s=(0,u.query)(e,(0,u.orderBy)("uploadedAt","desc"),(0,u.limit)(50));return(await(0,u.getDocs)(s)).docs.map(e=>(0,n.A)({id:e.id},e.data()))},[b,f]),{data:Q}=(0,h.nm)(W,{interval:6e5,enabled:!!b&&!!f,deps:[b,f]}),{data:X}=(0,h.nm)(Y,{interval:h.v5.NORMAL,enabled:!!b&&!!f,deps:[b,f]});(0,l.useEffect)(()=>{Q&&S(Q)},[Q]),(0,l.useEffect)(()=>{X&&J(X)},[X]);const $=async()=>{try{const e=(0,u.H9)(o.db,"classes",f,"trialRooms",b),s=await(0,u.x7)(e);if(!s.exists())return void v.vF.error("Trial room not found!");const t=s.data();let a={participants:(0,u.hq)(y.id),lastActivity:(0,u.O5)()},n="";"\ud310\uc0ac"!==y.job||t.judgeId?"\uac80\uc0ac"!==y.job||t.prosecutorId?"\ubcc0\ud638\uc0ac"!==y.job||t.lawyerId||(a.lawyerId=y.id,a.lawyerName=y.name||y.displayName,n="\ubcc0\ud638\uc0ac"):(a.prosecutorId=y.id,a.prosecutorName=y.name||y.displayName,n="\uac80\uc0ac"):(a.judgeId=y.id,a.judgeName=y.name||y.displayName,n="\ud310\uc0ac"),await(0,u.mZ)(e,a);const l=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages"),i="".concat(y.name||y.displayName,"\ub2d8\uc774 \uc785\uc7a5\ud588\uc2b5\ub2c8\ub2e4."),r=n?" ".concat(n," \uc5ed\ud560\uc744 \uc790\ub3d9\uc73c\ub85c \ubc30\uc815\ubc1b\uc558\uc2b5\ub2c8\ub2e4."):"";await(0,u.addDoc)(l,{type:"system",text:i+r,timestamp:(0,u.O5)()})}catch(e){v.vF.error("Error joining room:",e)}},ee=async()=>{try{const e=(0,u.H9)(o.db,"classes",f,"trialRooms",b);await(0,u.mZ)(e,{participants:(0,u.C3)(y.id),lastActivity:(0,u.O5)()})}catch(e){v.vF.error("Error leaving room:",e)}},se=async e=>{var s,t;if(!I)return;const a=(0,u.H9)(o.db,"classes",f,"trialRooms",b);let l={},i="";switch(e){case"prosecutor":if(I.prosecutorId)return alert("\uc774\ubbf8 \uac80\uc0ac\uac00 \uc788\uc2b5\ub2c8\ub2e4.");l.prosecutorId=y.id,l.prosecutorName=y.name||y.displayName,i="\uac80\uc0ac";break;case"lawyer":if(I.lawyerId)return alert("\uc774\ubbf8 \ubcc0\ud638\uc0ac\uac00 \uc788\uc2b5\ub2c8\ub2e4.");l.lawyerId=y.id,l.lawyerName=y.name||y.displayName,i="\ubcc0\ud638\uc0ac";break;case"jury":if(null!==(s=I.juryIds)&&void 0!==s&&s.includes(y.id))return alert("\uc774\ubbf8 \ubc30\uc2ec\uc6d0\uc785\ub2c8\ub2e4.");if(((null===(t=I.juryIds)||void 0===t?void 0:t.length)||0)>=6)return alert("\ubc30\uc2ec\uc6d0 \uc815\uc6d0\uc774 \ucc3c\uc2b5\ub2c8\ub2e4.");l.juryIds=(0,u.hq)(y.id),i="\ubc30\uc2ec\uc6d0";break;default:return}try{await(0,u.mZ)(a,(0,n.A)((0,n.A)({},l),{},{lastActivity:(0,u.O5)()}));const e=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(e,{type:"system",text:"".concat(y.name||y.displayName,"\ub2d8\uc774 ").concat(i," \uc5ed\ud560\uc744 \ub9e1\uc558\uc2b5\ub2c8\ub2e4."),timestamp:(0,u.O5)()})}catch(r){v.vF.error("Error taking role:",r),alert("\uc5ed\ud560 \ubc30\uc815 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},te=async()=>{if(A.trim()&&I)if(H)alert("\uce68\ubb35 \ud328\ub110\ud2f0\uac00 \uc801\uc6a9\ub418\uc5b4 \ubc1c\uc5b8\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");else try{const e=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(e,{type:"chat",userId:y.id,userName:y.name||y.displayName,userRole:R,text:A,timestamp:(0,u.O5)()}),F("")}catch(e){v.vF.error("Error sending message:",e)}},ae=async e=>{if("jury"===R&&null!==q&&void 0!==q&&q.isActive)try{const s=(0,u.H9)(o.db,"classes",f,"trialRooms",b);let t={};q.isAnonymous?t["voting.".concat(e)]=(I.voting[e]||0)+1:t["voting.votes.".concat(y.id)]={vote:e,voterName:y.name||y.displayName,timestamp:(0,u.O5)()},await(0,u.mZ)(s,t),Z(e),alert("\ud22c\ud45c\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4: ".concat("guilty"===e?"\uc720\uc8c4":"\ubb34\uc8c4"))}catch(s){v.vF.error("Error voting:",s)}},ne=async e=>{var s;"judge"===R&&e&&e!==y.id&&(null!==I&&void 0!==I&&null!==(s=I.silencedUsers)&&void 0!==s&&s.includes(e)?window.confirm("".concat(le(e),"\ub2d8\uc758 \uce68\ubb35 \ud328\ub110\ud2f0\ub97c \ud574\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))&&await(async e=>{if("judge"===R&&e)try{const s=(0,u.H9)(o.db,"classes",f,"trialRooms",b);await(0,u.mZ)(s,{silencedUsers:(0,u.C3)(e)});const t=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(t,{type:"system",text:"\u2705 \ud310\uc0ac\uac00 ".concat(le(e),"\ub2d8\uc758 \uce68\ubb35 \ud328\ub110\ud2f0\ub97c \ud574\uc81c\ud588\uc2b5\ub2c8\ub2e4."),timestamp:(0,u.O5)()})}catch(s){v.vF.error("Error removing silence:",s)}})(e):window.confirm("".concat(le(e),"\ub2d8\uc5d0\uac8c \uce68\ubb35 \ud328\ub110\ud2f0\ub97c \uc801\uc6a9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))&&await(async e=>{if("judge"===R&&e)try{const s=(0,u.H9)(o.db,"classes",f,"trialRooms",b);await(0,u.mZ)(s,{silencedUsers:(0,u.hq)(e)});const t=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(t,{type:"system",text:"\u26a0\ufe0f \ud310\uc0ac\uac00 ".concat(le(e),"\ub2d8\uc5d0\uac8c \uce68\ubb35 \ud328\ub110\ud2f0\ub97c \uc801\uc6a9\ud588\uc2b5\ub2c8\ub2e4."),timestamp:(0,u.O5)()})}catch(s){v.vF.error("Error applying silence:",s)}})(e))},le=e=>{const s=N.find(s=>s.id===e);return(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.displayName)||e||"\uc54c \uc218 \uc5c6\uc74c"},ie=e=>({judge:"#6f42c1",prosecutor:"#dc3545",lawyer:"#0d6efd",complainant:"#198754",defendant:"#fd7e14",jury:"#0dcaf0",spectator:"#6c757d"}[e]||"#6c757d");return E?(0,c.jsx)("div",{className:"trial-room-loading",children:"\uc7ac\ud310\ubc29 \ub85c\ub529 \uc911..."}):I?(0,c.jsxs)("div",{className:"trial-room-container",children:[(0,c.jsxs)("div",{className:"trial-room-header",children:[(0,c.jsxs)("h2",{children:["\uc7ac\ud310\uc815 - \uc0ac\uac74\ubc88\ud638 ",I.caseNumber]}),(0,c.jsx)("button",{onClick:w,className:"close-room-btn",children:"\uc7ac\ud310\ubc29 \ub098\uac00\uae30"})]}),(0,c.jsxs)("div",{className:"trial-room-layout",children:[(0,c.jsxs)("div",{className:"courtroom-view",children:[(0,c.jsx)("div",{className:"judge-bench",children:(0,c.jsx)(x,{role:"judge",name:I.judgeName,isActive:null===(s=I.participants)||void 0===s?void 0:s.includes(I.judgeId),userId:I.judgeId,onAvatarClick:ne,canGrantPermission:"judge"===R})}),(0,c.jsxs)("div",{className:"court-floor",children:[(0,c.jsxs)("div",{className:"left-side",children:[(0,c.jsx)("div",{className:"role-position",children:I.prosecutorId?(0,c.jsx)(x,{role:"prosecutor",name:I.prosecutorName,isActive:null===(t=I.participants)||void 0===t?void 0:t.includes(I.prosecutorId),userId:I.prosecutorId,onAvatarClick:ne,canGrantPermission:"judge"===R,showSpeechBubble:null===(a=I.silencedUsers)||void 0===a?void 0:a.includes(I.prosecutorId)}):(0,c.jsx)("div",{className:"empty-role",children:(0,c.jsx)("button",{onClick:()=>se("prosecutor"),className:"take-role-btn",disabled:"spectator"!==R,children:"\uac80\uc0ac \ub418\uae30"})})}),(0,c.jsx)("div",{className:"role-position",children:(0,c.jsx)(x,{role:"complainant",name:le(I.complainantId),isActive:null===(i=I.participants)||void 0===i?void 0:i.includes(I.complainantId),userId:I.complainantId,onAvatarClick:ne,canGrantPermission:"judge"===R,showSpeechBubble:null===(r=I.silencedUsers)||void 0===r?void 0:r.includes(I.complainantId)})})]}),(0,c.jsxs)("div",{className:"right-side",children:[(0,c.jsx)("div",{className:"role-position",children:I.lawyerId?(0,c.jsx)(x,{role:"lawyer",name:I.lawyerName,isActive:null===(d=I.participants)||void 0===d?void 0:d.includes(I.lawyerId),userId:I.lawyerId,onAvatarClick:ne,canGrantPermission:"judge"===R,showSpeechBubble:null===(m=I.silencedUsers)||void 0===m?void 0:m.includes(I.lawyerId)}):(0,c.jsx)("div",{className:"empty-role",children:(0,c.jsx)("button",{onClick:()=>se("lawyer"),className:"take-role-btn",disabled:"spectator"!==R,children:"\ubcc0\ud638\uc0ac \ub418\uae30"})})}),(0,c.jsx)("div",{className:"role-position",children:(0,c.jsx)(x,{role:"defendant",name:le(I.defendantId),isActive:null===(j=I.participants)||void 0===j?void 0:j.includes(I.defendantId),userId:I.defendantId,onAvatarClick:ne,canGrantPermission:"judge"===R,showSpeechBubble:null===(g=I.silencedUsers)||void 0===g?void 0:g.includes(I.defendantId)})})]})]}),(0,c.jsxs)("div",{className:"jury-box",children:[(0,c.jsx)("div",{className:"jury-label",children:"\ubc30\uc2ec\uc6d0\ub2e8"}),(0,c.jsx)("div",{className:"jury-seats",children:[...Array(6)].map((e,s)=>{var t,a,n;return(0,c.jsx)("div",{className:"jury-position",children:null!==(t=I.juryIds)&&void 0!==t&&t[s]?(0,c.jsx)(x,{role:"jury",name:le(I.juryIds[s]),isActive:null===(a=I.participants)||void 0===a?void 0:a.includes(I.juryIds[s]),userId:I.juryIds[s],onAvatarClick:ne,canGrantPermission:"judge"===R,showSpeechBubble:null===(n=I.silencedUsers)||void 0===n?void 0:n.includes(I.juryIds[s])}):(0,c.jsx)("button",{onClick:()=>se("jury"),className:"take-jury-btn",disabled:"spectator"!==R,children:"\ubc30\uc2ec\uc6d0 \ub418\uae30"})},s)})})]})]}),(0,c.jsxs)("div",{className:"trial-sidebar",children:[(0,c.jsxs)("div",{className:"participant-info",children:[(0,c.jsx)("h3",{children:"\ub0b4 \uc815\ubcf4"}),(0,c.jsx)("div",{className:"my-role",style:{color:ie(R)},children:(re=R,{judge:"\ud83d\udc68\u200d\u2696\ufe0f \ud310\uc0ac",prosecutor:"\ud83d\udc54 \uac80\uc0ac",lawyer:"\ud83d\udcbc \ubcc0\ud638\uc0ac",complainant:"\ud83d\udcdd \uc6d0\uace0",defendant:"\ud83d\udee1\ufe0f \ud53c\uace0",jury:"\ud83d\udc65 \ubc30\uc2ec\uc6d0",spectator:"\ud83d\udc40 \ubc29\uccad\uac1d"}[re]||"\ubc29\uccad\uac1d")}),(0,c.jsx)("div",{className:"my-name",children:y.name||y.displayName}),H&&(0,c.jsx)("div",{className:"silence-badge",style:{marginTop:"10px",background:"#dc3545",color:"white",padding:"6px 12px",borderRadius:"15px",fontSize:"0.85rem"},children:"\u26a0\ufe0f \uce68\ubb35 \ud328\ub110\ud2f0 \uc801\uc6a9 \uc911"})]}),(0,c.jsxs)("div",{className:"chat-section",children:[(0,c.jsx)("h3",{children:"\uc7ac\ud310 \uc9c4\ud589"}),(0,c.jsxs)("div",{className:"messages-container",children:[k.map(e=>(0,c.jsx)("div",{className:"message ".concat(e.type),children:"system"===e.type?(0,c.jsx)("div",{className:"system-message",children:e.text}):(0,c.jsxs)("div",{className:"chat-message",children:[(0,c.jsxs)("span",{className:"message-author",style:{color:ie(e.userRole)},children:[e.userName,":"]}),(0,c.jsx)("span",{className:"message-text",children:e.text})]})},e.id)),(0,c.jsx)("div",{ref:_})]}),(0,c.jsxs)("div",{className:"message-input-container",children:[(0,c.jsx)("input",{type:"text",value:A,onChange:e=>F(e.target.value),onKeyPress:e=>"Enter"===e.key&&te(),placeholder:H?"\uce68\ubb35 \ud328\ub110\ud2f0\uac00 \uc801\uc6a9\ub418\uc5c8\uc2b5\ub2c8\ub2e4":"\uba54\uc2dc\uc9c0 \uc785\ub825...",disabled:H,className:"message-input"}),(0,c.jsx)("button",{onClick:te,className:"send-btn",disabled:H,children:"\uc804\uc1a1"})]})]}),(0,c.jsxs)("div",{className:"evidence-section",children:[(0,c.jsx)("h3",{children:"\uc99d\uac70 \uc790\ub8cc"}),(0,c.jsx)("div",{className:"evidence-list",children:B.map(e=>(0,c.jsxs)("div",{className:"evidence-item",children:[(0,c.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.fileName}),(0,c.jsxs)("span",{className:"evidence-uploader",children:["- ",e.uploaderName]})]},e.id))}),["judge","prosecutor","lawyer"].includes(R)&&(0,c.jsxs)("div",{className:"evidence-upload",children:[(0,c.jsx)("input",{type:"file",ref:L,onChange:async e=>{const s=e.target.files[0];if(!s)return;if(s.size>10485760)return alert("\ud30c\uc77c \ud06c\uae30\ub294 10MB \uc774\ud558\uc5ec\uc57c \ud569\ub2c8\ub2e4.");if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))return alert("\ud5c8\uc6a9\ub418\uc9c0 \uc54a\ub294 \ud30c\uc77c \ud615\uc2dd\uc785\ub2c8\ub2e4. (\uc774\ubbf8\uc9c0, PDF, Word\ub9cc \uac00\ub2a5)");P(!0);try{const e=(0,p.KR)(o.IG,"trial-evidence/".concat(f,"/").concat(b,"/").concat(Date.now(),"_").concat(s.name)),t=await(0,p.D)(e,s),a=await(0,p.qk)(t.ref),n=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"evidence");await(0,u.addDoc)(n,{fileName:s.name,fileType:s.type,fileSize:s.size,url:a,uploadedBy:y.id,uploaderName:y.name||y.displayName,uploaderRole:R,uploadedAt:(0,u.O5)()});const l=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(l,{type:"system",text:"".concat(y.name||y.displayName,'\ub2d8\uc774 \uc99d\uac70 \uc790\ub8cc "').concat(s.name,'"\ub97c \uc81c\ucd9c\ud588\uc2b5\ub2c8\ub2e4.'),timestamp:(0,u.O5)()}),alert("\uc99d\uac70 \uc790\ub8cc\uac00 \uc81c\ucd9c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(t){v.vF.error("Error uploading evidence:",t),alert("\uc99d\uac70 \uc790\ub8cc \uc5c5\ub85c\ub4dc \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}finally{P(!1),L.current&&(L.current.value="")}},style:{display:"none"},accept:"image/*,application/pdf,.doc,.docx"}),(0,c.jsx)("button",{onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.click()},disabled:T,className:"upload-btn",children:T?"\uc5c5\ub85c\ub4dc \uc911...":"\uc99d\uac70 \uc81c\ucd9c"})]})]}),"judge"===R&&(0,c.jsxs)("div",{className:"judge-controls",children:[(0,c.jsx)("h3",{children:"\ud310\uc0ac \uad8c\ud55c"}),(0,c.jsx)("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"10px"},children:"\uc544\ubc14\ud0c0 \ud074\ub9ad\uc73c\ub85c \uce68\ubb35 \ud328\ub110\ud2f0 \uc801\uc6a9/\ud574\uc81c"}),(0,c.jsx)("button",{className:"judge-action-btn",onClick:()=>{const e=window.prompt("\ud22c\ud45c \uc9c8\ubb38\uc744 \uc785\ub825\ud558\uc138\uc694:");if(e){!async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("judge"===R)try{const t=(0,u.H9)(o.db,"classes",f,"trialRooms",b);await(0,u.mZ)(t,{voting:{question:e,isAnonymous:s,isActive:!0,startedAt:(0,u.O5)(),votes:{},guilty:0,notGuilty:0}});const a=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(a,{type:"system",text:'\ud310\uc0ac\uac00 \ud22c\ud45c\ub97c \uc2dc\uc791\ud588\uc2b5\ub2c8\ub2e4: "'.concat(e,'"'),timestamp:(0,u.O5)()})}catch(t){v.vF.error("Error starting vote:",t)}}(e,window.confirm("\uc775\uba85 \ud22c\ud45c\ub85c \uc9c4\ud589\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))}},children:"\ud83d\udcca \ud22c\ud45c \uc2dc\uc791"}),(null===q||void 0===q?void 0:q.isActive)&&(0,c.jsx)("button",{className:"judge-action-btn",onClick:async()=>{if("judge"===R&&null!==q&&void 0!==q&&q.isActive)try{const e=(0,u.H9)(o.db,"classes",f,"trialRooms",b),s=await(0,u.x7)(e),t=s.data().voting;let a="\ud22c\ud45c\uac00 \uc885\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4. ";if(t.isAnonymous)a+="\uc720\uc8c4: ".concat(t.guilty||0,"\ud45c, \ubb34\uc8c4: ").concat(t.notGuilty||0,"\ud45c");else{const e=Object.values(t.votes||{}).filter(e=>"guilty"===e.vote).length,s=Object.values(t.votes||{}).filter(e=>"notGuilty"===e.vote).length;a+="\uc720\uc8c4: ".concat(e,"\ud45c, \ubb34\uc8c4: ").concat(s,"\ud45c")}await(0,u.mZ)(e,{"voting.isActive":!1,"voting.endedAt":(0,u.O5)()});const n=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(n,{type:"system",text:a,timestamp:(0,u.O5)()})}catch(e){v.vF.error("Error ending vote:",e)}},children:"\u2705 \ud22c\ud45c \uc885\ub8cc"}),(0,c.jsx)("button",{className:"judge-action-btn",onClick:async()=>{if("judge"!==R)return;const e=window.prompt("\ud310\uacb0\uc744 \uc785\ub825\ud558\uc138\uc694 (\uc608: \uc720\uc8c4, \ubb34\uc8c4, \ubc8c\uae08 10,000\uc6d0, \ud569\uc758\uae08 5,000\uc6d0):");if(!e||!e.trim())return;const s=window.prompt("\ud310\uacb0 \uc774\uc720\ub97c \uc785\ub825\ud558\uc138\uc694:");if(s&&s.trim()){v.vF.log("Making verdict...",{verdict:e,reason:s});try{let t=0,a=null;const n=/\ubc8c\uae08\s*([0-9,]+)/,l=/\ud569\uc758\uae08\s*([0-9,]+)/,i=e.match(n),r=e.match(l);i&&i[1]?(a="fine",t=parseInt(i[1].replace(/,/g,""),10),v.vF.log("Fine detected: ".concat(t))):r&&r[1]&&(a="settlement",t=parseInt(r[1].replace(/,/g,""),10),v.vF.log("Settlement detected: ".concat(t))),a&&t>0&&("fine"===a?(v.vF.log("Processing fine of ".concat(t," from ").concat(I.defendantId)),await(0,o.ef)(I.defendantId,f,t,"\uc7ac\ud310 \ud310\uacb0 \ubc8c\uae08: ".concat(s)),v.vF.log("Fine processed successfully.")):"settlement"===a&&(v.vF.log("Processing settlement of ".concat(t," from ").concat(I.defendantId," to ").concat(I.complainantId)),await(0,o.xU)(I.defendantId,I.complainantId,t,"\uc7ac\ud310 \ud569\uc758\uae08: ".concat(s)),v.vF.log("Settlement processed successfully."))),v.vF.log("Saving trial result...");const c=(0,u.rJ)(o.db,"classes",f,"trialResults");await(0,u.addDoc)(c,{roomId:b,caseNumber:I.caseNumber,caseTitle:I.caseTitle||"\uc81c\ubaa9 \uc5c6\uc74c",judgeId:I.judgeId,judgeName:I.judgeName,complainantId:I.complainantId,defendantId:I.defendantId,verdict:e,verdictReason:s,verdictDate:(0,u.O5)(),votingResult:q||null,participants:I.participants||[],paymentAmount:t||0,paymentType:a||null}),v.vF.log("Trial result saved."),v.vF.log("Updating trial room status...");const d=(0,u.H9)(o.db,"classes",f,"trialRooms",b);await(0,u.mZ)(d,{status:"completed",verdict:e,verdictDate:(0,u.O5)()}),v.vF.log("Trial room status updated."),v.vF.log("Posting system message...");const m=(0,u.rJ)(o.db,"classes",f,"trialRooms",b,"messages");await(0,u.addDoc)(m,{type:"system",text:"\u2696\ufe0f \ud310\uacb0\uc774 \ub0b4\ub824\uc84c\uc2b5\ub2c8\ub2e4: ".concat(e,"\n\uc0ac\uc720: ").concat(s),timestamp:(0,u.O5)()}),v.vF.log("System message posted."),alert("\ud310\uacb0\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc7ac\ud310 \uacb0\uacfc \ud0ed\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),w&&w()}catch(t){v.vF.error("Error making verdict:",t),alert("\ud310\uacb0 \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(t.message))}}},style:{background:"#6f42c1",fontWeight:"bold",marginTop:"10px"},children:"\u2696\ufe0f \ud310\uacb0\ud558\uae30"})]}),"jury"===R&&(null===q||void 0===q?void 0:q.isActive)&&!M&&(0,c.jsxs)("div",{className:"voting-section",children:[(0,c.jsx)("h3",{children:"\ubc30\uc2ec\uc6d0 \ud22c\ud45c"}),(0,c.jsx)("p",{className:"voting-question",children:q.question}),(0,c.jsxs)("div",{className:"voting-buttons",children:[(0,c.jsx)("button",{onClick:()=>ae("guilty"),className:"vote-btn guilty",children:"\uc720\uc8c4"}),(0,c.jsx)("button",{onClick:()=>ae("notGuilty"),className:"vote-btn not-guilty",children:"\ubb34\uc8c4"})]})]}),q&&!q.isActive&&(0,c.jsxs)("div",{className:"voting-results",children:[(0,c.jsx)("h3",{children:"\ud22c\ud45c \uacb0\uacfc"}),(0,c.jsx)("p",{children:q.question}),q.isAnonymous?(0,c.jsxs)("div",{children:[(0,c.jsxs)("p",{children:["\uc720\uc8c4: ",q.guilty||0,"\ud45c"]}),(0,c.jsxs)("p",{children:["\ubb34\uc8c4: ",q.notGuilty||0,"\ud45c"]})]}):(0,c.jsx)("div",{children:Object.entries(q.votes||{}).map(e=>{let[s,t]=e;return(0,c.jsxs)("p",{children:[t.voterName,": ","guilty"===t.vote?"\uc720\uc8c4":"\ubb34\uc8c4"]},s)})})]})]})]})]}):(0,c.jsx)("div",{className:"trial-room-error",children:"\uc7ac\ud310\ubc29\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."});var re};t(6555);const g=["id","classCode"],b=e=>{let{complaint:s,onSave:t,onCancel:a,users:r}=e;const[o,d]=(0,l.useState)(s.reason),[m,u]=(0,l.useState)(s.desiredResolution),[p,h]=(0,l.useState)(s.defendantId),v=r.filter(e=>e.id!==s.complainantId).map(e=>(0,c.jsx)("option",{value:e.id,children:e.name||e.displayName||e.id},e.id));if(!document.getElementById("modal-root")){const e=document.createElement("div");e.id="modal-root",document.body.appendChild(e)}return i.createPortal((0,c.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,c.jsxs)("div",{className:"edit-modal-container modal-container",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsxs)("h3",{children:["\uace0\uc18c\uc7a5 \uc218\uc815 (ID: ",s.id.slice(-6),")"]}),(0,c.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"defendantSelectEdit",className:"form-label",children:"\ud53c\uace0\uc18c\uc778"}),(0,c.jsxs)("select",{id:"defendantSelectEdit",className:"form-select",value:p,onChange:e=>h(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"-- \uc120\ud0dd --"}),v]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{className:"form-label",children:"\uace0\uc18c \uc0ac\uc720"}),(0,c.jsx)("textarea",{className:"form-textarea",value:o,onChange:e=>d(e.target.value),rows:5})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{className:"form-label",children:"\uc6d0\ud558\ub294 \uacb0\uacfc"}),(0,c.jsx)("textarea",{className:"form-textarea",value:m,onChange:e=>u(e.target.value),rows:3})]})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:a,className:"modal-button cancel",children:"\ucde8\uc18c"}),(0,c.jsx)("button",{onClick:()=>{p&&o.trim()&&m.trim()?t((0,n.A)((0,n.A)({},s),{},{reason:o,desiredResolution:m,defendantId:p})):alert("\ubaa8\ub4e0 \ud544\ub4dc\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694.")},className:"modal-button process",children:"\uc800\uc7a5"})]})]})}),document.getElementById("modal-root")||document.body)},f=e=>{let{complaint:s,onSave:t,onCancel:a}=e;const[n,r]=(0,l.useState)(s.judgment||"");return i.createPortal((0,c.jsx)("div",{className:"modal-overlay",onClick:a,children:(0,c.jsxs)("div",{className:"modal-container",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsxs)("h3",{children:["\ud310\uacb0\ubb38 \uc791\uc131 (ID: ",s.id.slice(-6),")"]}),(0,c.jsx)("button",{className:"close-button",onClick:a,children:"\xd7"})]}),(0,c.jsx)("div",{className:"modal-content",children:(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"judgmentText",className:"form-label",children:"\ud310\uacb0 \ub0b4\uc6a9"}),(0,c.jsx)("textarea",{id:"judgmentText",className:"form-textarea judgment-textarea",value:n,onChange:e=>r(e.target.value),rows:10,placeholder:"\ud310\uacb0 \ub0b4\uc6a9\uc744 \uc0c1\uc138\ud788 \uc791\uc131\ud574\uc8fc\uc138\uc694..."})]})}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:a,className:"modal-button cancel",children:"\ucde8\uc18c"}),(0,c.jsx)("button",{onClick:()=>{n.trim()?t(s.id,n):alert("\ud310\uacb0 \ub0b4\uc6a9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.")},className:"modal-button process",children:"\ud310\uacb0 \uc800\uc7a5"})]})]})}),document.getElementById("modal-root")||document.body)},y=e=>{var s;let{complaint:t,users:a,onSave:n,onCancel:r,getUserNameById:o}=e;const[d,m]=(0,l.useState)(""),[u,p]=(0,l.useState)(t.defendantId||""),[h,x]=(0,l.useState)(t.complainantId||"");return i.createPortal((0,c.jsx)("div",{className:"modal-overlay",onClick:r,children:(0,c.jsxs)("div",{className:"modal-container",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsxs)("h3",{children:["\ud569\uc758\uae08 \uc9c0\uae09 \ucc98\ub9ac (\uc0ac\uac74\ubc88\ud638: ",(null===(s=t.id)||void 0===s?void 0:s.slice(-6))||"\uc5c6\uc74c",")"]}),(0,c.jsx)("button",{className:"close-button",onClick:r,children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"\uace0\uc18c\uc778:"})," ",o(t.complainantId)]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"\ud53c\uace0\uc18c\uc778:"})," ",o(t.defendantId)]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"settlementSender",className:"form-label",children:"\uc1a1\uae08\uc790:"}),(0,c.jsxs)("select",{id:"settlementSender",className:"form-select",value:u,onChange:e=>p(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"-- \uc120\ud0dd --"}),a.filter(e=>e.id!==h).map(e=>(0,c.jsx)("option",{value:e.id,children:o(e.id)},e.id))]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"settlementRecipient",className:"form-label",children:"\uc218\uae08\uc790:"}),(0,c.jsxs)("select",{id:"settlementRecipient",className:"form-select",value:h,onChange:e=>x(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"-- \uc120\ud0dd --"}),a.filter(e=>e.id!==u).map(e=>(0,c.jsx)("option",{value:e.id,children:o(e.id)},e.id))]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"settlementAmount",className:"form-label",children:"\ud569\uc758\uae08 (\uc6d0):"}),(0,c.jsx)("input",{type:"number",id:"settlementAmount",className:"form-input",value:d,onChange:e=>m(e.target.value),placeholder:"\uae08\uc561 \uc785\ub825",min:"1"})]})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:r,className:"modal-button cancel",children:"\ucde8\uc18c"}),(0,c.jsx)("button",{onClick:async()=>{if(!d||isNaN(parseInt(d))||parseInt(d)<=0)alert("\uc720\ud6a8\ud55c \uae08\uc561\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");else if(u&&h)if(u!==h)try{await n(t.id,parseInt(d),u,h)&&r()}catch(e){v.vF.error("Settlement error:",e),alert("\ud569\uc758\uae08 \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}else alert("\ubcf4\ub0b4\ub294 \uc0ac\ub78c\uacfc \ubc1b\ub294 \uc0ac\ub78c\uc740 \uac19\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");else alert("\ubcf4\ub0b4\ub294 \uc0ac\ub78c\uacfc \ubc1b\ub294 \uc0ac\ub78c\uc744 \ubaa8\ub450 \uc120\ud0dd\ud574\uc8fc\uc138\uc694.")},className:"modal-button process",children:"\uc9c0\uae09 \ucc98\ub9ac"})]})]})}),document.getElementById("modal-root")||document.body)},N=e=>{let{complaints:s,users:t,onOpenSettlementModal:a}=e;const n=e=>{const s=t.find(s=>s.id===e);return(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.displayName)||e||"\uc54c \uc218 \uc5c6\uc74c"},l=(s||[]).filter(e=>"resolved"===e.status);return 0===l.length?(0,c.jsx)("p",{className:"empty-state",children:"\uc644\ub8cc\ub41c \uc7ac\ud310\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."}):(0,c.jsx)("div",{className:"trial-results-container",children:l.map(e=>(0,c.jsxs)("div",{className:"result-card",children:[(0,c.jsxs)("div",{className:"result-header",children:[(0,c.jsxs)("span",{className:"case-id",children:["\uc0ac\uac74\ubc88\ud638: ",e.id.slice(-6)]}),(0,c.jsxs)("span",{className:"parties",children:[n(e.complainantId)," vs"," ",n(e.defendantId)]}),(0,c.jsx)("span",{className:"case-status status-resolved",children:"\uc7ac\ud310\uc644\ub8cc"})]}),(0,c.jsxs)("div",{className:"result-content",children:[(0,c.jsx)("h4",{children:"\uace0\uc18c \uc694\uc9c0"}),(0,c.jsxs)("p",{className:"summary",children:[e.reason.substring(0,100),e.reason.length>100?"...":""]}),(0,c.jsx)("h4",{children:"\ud310\uacb0\ubb38"}),(0,c.jsx)("div",{className:"judgment-display",children:(0,c.jsx)("p",{children:e.judgment||"\ud310\uacb0\ubb38 \ub0b4\uc6a9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})})]}),(0,c.jsx)("div",{className:"result-actions",children:e.settlementPaid?(0,c.jsx)("button",{className:"settlement-button paid",disabled:!0,children:"\uc9c0\uae09 \uc644\ub8cc"}):(0,c.jsx)("button",{className:"settlement-button",onClick:()=>a(e),children:"\ud569\uc758\uae08 \uc9c0\uae09"})})]},e.id))})},w=e=>{let{refetchComplaints:s}=e;const{userDoc:t,classCode:a}=(0,r.As)(),[n,i]=(0,l.useState)(!1),[d,m]=(0,l.useState)(!0);(0,l.useEffect)(()=>{if(null!==t&&void 0!==t&&t.id&&a){(async()=>{m(!0);try{const e=(0,u.rJ)(o.db,"classes",a,"courtComplaints"),s=(0,u.query)(e,(0,u.where)("complainantId","==",t.id),(0,u.where)("caseType","==","bankruptcy"),(0,u.where)("status","==","pending"),(0,u.limit)(10)),n=await(0,u.getDocs)(s);i(!n.empty)}catch(e){v.vF.error("\ud30c\uc0b0 \uc2e0\uccad \ud655\uc778 \uc911 \uc624\ub958:",e)}finally{m(!1)}})()}else m(!1)},[t,a]);return d?(0,c.jsx)("p",{children:"\ud30c\uc0b0 \uc2e0\uccad \uc815\ubcf4\ub97c \ubd88\ub7ec\uc624\ub294 \uc911..."}):(0,c.jsxs)("div",{className:"bankruptcy-section",children:[(0,c.jsx)("h3",{children:"\ud30c\uc0b0 \uc2e0\uccad"}),(0,c.jsxs)("p",{children:["\ud604\uc7ac \uc790\uc0b0: ",null!==t&&void 0!==t&&t.money?t.money.toLocaleString():0,"\uc6d0"]}),(null===t||void 0===t?void 0:t.money)<0?(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{children:"\uc790\uc0b0\uc774 \ub9c8\uc774\ub108\uc2a4 \uc0c1\ud0dc\uc785\ub2c8\ub2e4. \ud30c\uc0b0\uc744 \uc2e0\uccad\ud558\uc5ec \ubaa8\ub4e0 \ube5a\uc744 \uccad\uc0b0\ud558\uace0 \uc0c8\ub86d\uac8c \uc2dc\uc791\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (\uc7ac\ud310 \ud544\uc694)"}),n?(0,c.jsx)("p",{children:(0,c.jsx)("strong",{children:"\ud604\uc7ac \ud30c\uc0b0 \uc7ac\ud310\uc774 \uc9c4\ud589 \uc911\uc785\ub2c8\ub2e4."})}):(0,c.jsx)("button",{onClick:async()=>{if(window.confirm("\uc815\ub9d0\ub85c \ud30c\uc0b0\uc744 \uc2e0\uccad\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c? \uc7ac\ud310 \uacb0\uacfc\uc5d0 \ub530\ub77c \ubaa8\ub4e0 \uc790\uc0b0\uc774 \ucd08\uae30\ud654\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4."))try{const e=(0,u.rJ)(o.db,"classes",a,"courtComplaints");await(0,u.addDoc)(e,{complainantId:t.id,complainantName:t.name,caseType:"bankruptcy",defendantId:"system",defendantName:"\uc2dc\uc2a4\ud15c",status:"pending",reason:"\uc790\uc0b0 ".concat(t.money.toLocaleString(),"\uc6d0\uc73c\ub85c \uc778\ud55c \ud30c\uc0b0 \uc2e0\uccad"),desiredResolution:"\ubaa8\ub4e0 \ubd80\ucc44\ub97c \uccad\uc0b0\ud558\uace0 \uc790\uc0b0\uc744 0\uc73c\ub85c \ucd08\uae30\ud654 \uc694\uccad",submissionDate:(0,u.O5)(),likedBy:[],dislikedBy:[]}),s(),alert("\ud30c\uc0b0 \uc2e0\uccad\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc811\uc218\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc7ac\ud310 \uacb0\uacfc\ub97c \uae30\ub2e4\ub824\uc8fc\uc138\uc694."),i(!0)}catch(e){v.vF.error("\ud30c\uc0b0 \uc2e0\uccad \uc911 \uc624\ub958 \ubc1c\uc0dd:",e),alert("\uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc5ec \ud30c\uc0b0 \uc2e0\uccad\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.")}},className:"action-button delete",children:"\ud30c\uc0b0 \uc2e0\uccad\ud558\uae30"})]}):(0,c.jsx)("p",{children:"\uc790\uc0b0\uc774 \ub9c8\uc774\ub108\uc2a4 \uc0c1\ud0dc\uc77c \ub54c \ud30c\uc0b0\uc744 \uc2e0\uccad\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."})]})},I=()=>{const e=(0,r.As)(),s=null===e||void 0===e?void 0:e.userDoc,t=null===s||void 0===s?void 0:s.id,i=null===s||void 0===s?void 0:s.classCode,p=null!==e&&void 0!==e&&e.isAdmin?e.isAdmin():(null===s||void 0===s?void 0:s.isAdmin)||"admin1"===(null===s||void 0===s?void 0:s.id),[x,I]=(0,l.useState)("submit"),[C,k]=(0,l.useState)(!1),[S,A]=(0,l.useState)(null),[F,R]=(0,l.useState)(!1),[D,E]=(0,l.useState)(null),[O,B]=(0,l.useState)([]),[J,T]=(0,l.useState)(!0),[P,H]=(0,l.useState)(!1),[U,q]=(0,l.useState)(null),[G,M]=(0,l.useState)(null);(0,l.useEffect)(()=>{if(!document.getElementById("modal-root")){const e=document.createElement("div");e.id="modal-root",document.body.appendChild(e)}},[]),(0,l.useEffect)(()=>{!e.loading&&e.allClassMembers&&(B(e.allClassMembers||[]),T(!1))},[e.loading,e.allClassMembers]);const{data:Z=[],loading:_,refetch:L}=(0,h.nm)(async()=>{if(!i)return[];const e=(0,u.rJ)(o.db,"classes",i,"courtComplaints"),s=(0,u.query)(e,(0,u.orderBy)("submissionDate","desc"),(0,u.limit)(100));return(await(0,u.getDocs)(s)).docs.map(e=>{var s,t;return(0,n.A)((0,n.A)({id:e.id},e.data()),{},{submissionDate:null!==(s=e.data().submissionDate)&&void 0!==s&&s.toDate?e.data().submissionDate.toDate().toISOString():null,indictmentDate:null!==(t=e.data().indictmentDate)&&void 0!==t&&t.toDate?e.data().indictmentDate.toDate().toISOString():null})})},{interval:6e5,enabled:!!i,deps:[i]}),{data:z=[],loading:V,refetch:K}=(0,h.nm)(async()=>{if(!i)return[];const e=(0,u.rJ)(o.db,"classes",i,"trialRooms"),s=(0,u.query)(e,(0,u.limit)(50));return(await(0,u.getDocs)(s)).docs.map(e=>(0,n.A)({id:e.id},e.data()))},{interval:6e5,enabled:!!i,deps:[i]}),W=(0,l.useMemo)(()=>{if(!i)return null;const e=(0,u.rJ)(o.db,"jobs");return(0,u.query)(e,(0,u.where)("classCode","==",i))},[i]),{data:Y,loading:Q}=(0,h.nm)(async()=>{if(!W)return[];return(await(0,u.getDocs)(W)).docs.map(e=>(0,n.A)({id:e.id},e.data()))},{interval:18e5,enabled:!!i,deps:[i]}),X=(0,l.useMemo)(()=>{if(null===s||void 0===s||!s.selectedJobIds||!Y)return!1;return Y.filter(e=>s.selectedJobIds.includes(e.id)).some(e=>"\uac80\ucc30\ucd1d\uc7a5"===e.title)},[null===s||void 0===s?void 0:s.selectedJobIds,Y]),$=(0,l.useMemo)(()=>{if(null===s||void 0===s||!s.selectedJobIds||!Y)return!1;return Y.filter(e=>s.selectedJobIds.includes(e.id)).some(e=>"\ud310\uc0ac"===e.title)},[null===s||void 0===s?void 0:s.selectedJobIds,Y]),ee=p||X,se=p||$,te=se,ae=async e=>{if(!t||!i)return void alert("\ub85c\uadf8\uc778 \uc815\ubcf4 \ub610\ub294 \ud559\uae09 \uc815\ubcf4\uac00 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");const a=O.find(e=>e.id===t)||s,l=(0,n.A)((0,n.A)({},e),{},{caseType:"general",status:"pending",submissionDate:(0,u.O5)(),complainantId:t,complainantName:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.displayName)||"\uc54c \uc218 \uc5c6\uc74c",likedBy:[],dislikedBy:[],judgment:null,indictmentDate:null,settlementPaid:!1,classCode:i});try{const e=(0,u.rJ)(o.db,"classes",i,"courtComplaints");await(0,u.addDoc)(e,l),L(),I("status"),alert("\uace0\uc18c\uc7a5\uc774 \uc131\uacf5\uc801\uc73c\ub85c \uc81c\ucd9c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(r){v.vF.error("Error adding complaint to Firestore:",r),alert("\uace0\uc18c\uc7a5 \uc81c\ucd9c \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},ne=async e=>{if(!ee&&!te||!i)return alert("\uae30\uc18c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");const s=(0,u.H9)(o.db,"classes",i,"courtComplaints",e);try{await(0,u.mZ)(s,{status:"indicted",indictmentDate:(0,u.O5)()}),L(),alert("\uc0ac\uac74\ubc88\ud638 ".concat(e.slice(-6),"\uc774(\uac00) \uae30\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."))}catch(t){v.vF.error("Error indicting complaint:",t),alert("\uae30\uc18c \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},le=async e=>{if(!(ee||se||te)||!i)return alert("\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");if(window.confirm("\uc0ac\uac74\ubc88\ud638 ".concat(e.slice(-6)," \uae30\ub85d\uc744 \uc815\ub9d0 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))){const t=(0,u.H9)(o.db,"classes",i,"courtComplaints",e);try{await(0,u.kd)(t),L(),alert("\uae30\ub85d\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(s){v.vF.error("Error deleting complaint:",s),alert("\uae30\ub85d \uc0ad\uc81c \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}},ie=async e=>{if(!(ee||se||te)||!i)return alert("\ucc98\ub9ac \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");const s=(0,u.H9)(o.db,"classes",i,"courtComplaints",e);try{await(0,u.mZ)(s,{status:"dismissed"}),L(),alert("\uc0ac\uac74\ubc88\ud638 ".concat(e.slice(-6),"\uc774(\uac00) \ubd88\uae30\uc18c/\uae30\uac01 \ucc98\ub9ac\ub418\uc5c8\uc2b5\ub2c8\ub2e4."))}catch(t){v.vF.error("Error dismissing complaint:",t),alert("\ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},re=e=>{if(!t)return void alert("\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.");const s=ee||se||te,a=e.complainantId===t;return s||a?!s&&a&&"pending"!==e.status?alert("\uc9c4\ud589 \uc911\uc774\uac70\ub098 \uc644\ub8cc\ub41c \uc0ac\uac74\uc740 \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."):["resolved","dismissed"].includes(e.status)&&!p?alert("\uc644\ub8cc\ub41c \uc0ac\uac74\uc740 \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."):"bankruptcy"===e.caseType?alert("\ud30c\uc0b0 \uc2e0\uccad\uc11c\ub294 \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."):(A(e),void k(!0)):alert("\ubcf8\uc778\uc774 \uc791\uc131\ud588\uac70\ub098 \uad8c\ud55c\uc774 \uc788\ub294 \uace0\uc18c\uc7a5\ub9cc \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.")},oe=async(e,s)=>{if(!t||!i)return alert("\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.");const a=(0,u.H9)(o.db,"classes",i,"courtComplaints",e);try{await(0,u.c4)(o.db,async e=>{const n=await e.get(a);if(!n.exists())throw"\uace0\uc18c\uc7a5\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.";const l=n.data();let i=l.likedBy||[],r=l.dislikedBy||[];const o=i.includes(t),c=r.includes(t);"like"===s?(i=o?i.filter(e=>e!==t):[...i,t],r=r.filter(e=>e!==t)):"dislike"===s&&(r=c?r.filter(e=>e!==t):[...r,t],i=i.filter(e=>e!==t)),e.update(a,{likedBy:i,dislikedBy:r,updatedAt:(0,u.O5)()})}),L()}catch(n){v.vF.error("Error voting on complaint:",n),alert("\ud22c\ud45c \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: "+n.message)}},ce=async e=>{if(!se||!i)return alert("\uc7ac\ud310 \uc2dc\uc791 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");const a=(Z||[]).find(s=>s.id===e);if(!a)return alert("\uc0ac\uac74\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");try{const n={caseId:e,caseNumber:e.slice(-6),judgeId:t,judgeName:(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.displayName)||"\ud310\uc0ac",complainantId:a.complainantId,defendantId:a.defendantId,prosecutorId:null,lawyerId:null,juryIds:[],status:"active",createdAt:(0,u.O5)(),participants:[t]},l=(0,u.rJ)(o.db,"classes",i,"trialRooms"),r=await(0,u.addDoc)(l,n),c=(0,u.H9)(o.db,"classes",i,"courtComplaints",e);await(0,u.mZ)(c,{status:"on_trial",trialRoomId:r.id}),L(),K(),alert("\uc0ac\uac74\ubc88\ud638 ".concat(e.slice(-6),"\uc758 \uc7ac\ud310\ubc29\uc774 \uc0dd\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc7ac\ud310\uc744 \uc2dc\uc791\ud569\ub2c8\ub2e4.")),M(r.id),I("trial-room")}catch(n){v.vF.error("Error starting trial:",n),alert("\uc7ac\ud310 \uc2dc\uc791 \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},de=e=>se?"on_trial"!==e.status?alert("\uc7ac\ud310 \uc9c4\ud589 \uc911\uc778 \uc0ac\uac74\ub9cc \ud310\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."):(E(e),void R(!0)):alert("\ud310\uacb0\ubb38 \uc791\uc131 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."),me=e=>se||te?"resolved"!==e.status?alert("\uc7ac\ud310\uc774 \uc644\ub8cc\ub41c \uc0ac\uac74\uc5d0 \ub300\ud574\uc11c\ub9cc \ud569\uc758\uae08\uc744 \ucc98\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."):e.settlementPaid?alert("\uc774\ubbf8 \ud569\uc758\uae08 \uc9c0\uae09\uc774 \uc644\ub8cc\ub41c \uc0ac\uac74\uc785\ub2c8\ub2e4."):(q(e),void H(!0)):alert("\ud569\uc758\uae08 \uc9c0\uae09 \ucc98\ub9ac \uad8c\ud55c\uc740 \ud310\uc0ac \ub610\ub294 \uad00\ub9ac\uc790\uc5d0\uac8c \uc788\uc2b5\ub2c8\ub2e4."),ue=()=>{H(!1),q(null)},pe=e=>{const s=O.find(s=>s.id===e);return(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.displayName)||e||"\uc54c \uc218 \uc5c6\uc74c"},he=e=>{if(!e)return"-";try{const s=new Date(e);return isNaN(s.getTime())?"\ub0a0\uc9dc \uc815\ubcf4 \uc5c6\uc74c":s.toLocaleString("ko-KR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(s){return v.vF.error("Date formatting error:",e,s),"\ub0a0\uc9dc \ubcc0\ud658 \uc624\ub958"}};return e.loading||J||Q?(0,c.jsx)("div",{className:"court-container",children:(0,c.jsx)("div",{className:"p-8 text-center text-gray-400",children:"\uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ubd88\ub7ec\uc624\ub294 \uc911..."})}):s?i?_?(0,c.jsx)("div",{className:"court-container",children:(0,c.jsx)("div",{className:"p-8 text-center text-gray-400",children:"\ub370\uc774\ud130\ub97c \ubd88\ub7ec\uc624\ub294 \uc911..."})}):(0,c.jsxs)("div",{className:"court-container",children:[(0,c.jsx)("div",{className:"court-header-container",children:(0,c.jsxs)("h1",{className:"court-header",children:["\ubc95\uc6d0 \uc2dc\uc2a4\ud15c (\ud559\uae09: ",i,")",se&&" - \ud310\uc0ac \uad8c\ud55c",te&&" \ud83d\udd28"]})}),(0,c.jsx)("div",{className:"court-tabs",children:(0,c.jsxs)("div",{className:"main-tabs",children:[(0,c.jsx)("button",{className:"court-tab-button ".concat("submit"===x?"active":""),onClick:()=>I("submit"),children:"\uace0\uc18c\uc7a5 \uc81c\ucd9c"}),(0,c.jsx)("button",{className:"court-tab-button ".concat("status"===x?"active":""),onClick:()=>I("status"),children:"\uc0ac\uac74 \ud604\ud669"}),(0,c.jsx)("button",{className:"court-tab-button ".concat("results"===x?"active":""),onClick:()=>I("results"),children:"\uc7ac\ud310 \uacb0\uacfc"}),(0,c.jsx)("button",{className:"court-tab-button ".concat("trial-room"===x?"active":""),onClick:()=>I("trial-room"),children:"\uc7ac\ud310\ubc29 \u2696\ufe0f"}),(0,c.jsx)("button",{className:"court-tab-button bankruptcy-tab-button ".concat("bankruptcy"===x?"active":""),onClick:()=>I("bankruptcy"),children:"\ud30c\uc0b0 \uc2e0\uccad"})]})}),(0,c.jsx)("div",{className:"court-tab-content",children:(()=>{if(!t&&("submit"===x||"bankruptcy"===x))return(0,c.jsx)("p",{className:"empty-state",children:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."});switch(x){case"submit":return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(d,{onSubmitComplaint:ae,users:O.filter(e=>e.id!==t&&e.classCode===i),currentUserId:t})});case"bankruptcy":return(0,c.jsx)(w,{refetchComplaints:L});case"status":return(0,c.jsx)(m,{complaints:(Z||[]).filter(e=>["pending","indicted","on_trial","dismissed"].includes(e.status)),onEditComplaint:re,onDeleteComplaint:le,onIndictComplaint:ne,onDismissComplaint:ie,onStartTrial:ce,onOpenJudgment:de,onVote:oe,isAdmin:ee||se||te,currentUserId:t,users:O,formatDate:he,getUserNameById:pe});case"results":return(0,c.jsx)(N,{complaints:Z,users:O,onOpenSettlementModal:me});case"trial-room":return G?(0,c.jsx)(j,{roomId:G,classCode:i,currentUser:s,users:O,onClose:()=>{M(null),I("status")}}):(0,c.jsxs)("div",{className:"trial-rooms-list",children:[(0,c.jsx)("h3",{children:"\uc9c4\ud589 \uc911\uc778 \uc7ac\ud310\ubc29"}),z.filter(e=>"active"===e.status).length>0?(0,c.jsx)("div",{className:"rooms-grid",children:z.filter(e=>"active"===e.status).map(e=>{var s;return(0,c.jsxs)("div",{className:"room-card",children:[(0,c.jsxs)("h4",{children:["\uc0ac\uac74\ubc88\ud638: ",e.caseNumber]}),(0,c.jsxs)("p",{children:["\ud310\uc0ac: ",e.judgeName]}),(0,c.jsxs)("p",{children:["\ucc38\uc5ec\uc790: ",(null===(s=e.participants)||void 0===s?void 0:s.length)||0,"\uba85"]}),(0,c.jsx)("button",{className:"enter-room-btn",onClick:()=>{M(e.id)},children:"\uc7ac\ud310\ubc29 \uc785\uc7a5"})]},e.id)})}):(0,c.jsx)("p",{className:"empty-state",children:"\uc9c4\ud589 \uc911\uc778 \uc7ac\ud310\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})]});default:return(0,c.jsx)("p",{children:"\ud0ed\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."})}})()}),C&&S&&(0,c.jsx)(b,{complaint:S,onSave:async e=>{if(!i||null===S||void 0===S||!S.id)return;const s=(0,u.H9)(o.db,"classes",i,"courtComplaints",S.id),{id:t,classCode:l}=e,r=(0,a.A)(e,g);try{await(0,u.mZ)(s,(0,n.A)((0,n.A)({},r),{},{updatedAt:(0,u.O5)()})),L(),k(!1),A(null),alert("\uc0ac\uac74\ubc88\ud638 ".concat(S.id.slice(-6)," \uc815\ubcf4\uac00 \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."))}catch(c){v.vF.error("Error updating complaint:",c),alert("\uace0\uc18c\uc7a5 \uc218\uc815 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},onCancel:()=>{k(!1),A(null)},users:O.filter(e=>e.id!==S.complainantId&&e.classCode===i)}),F&&D&&(0,c.jsx)(f,{complaint:D,onSave:async(e,s)=>{if(!i)return;const t=(0,u.H9)(o.db,"classes",i,"courtComplaints",e);try{await(0,u.mZ)(t,{judgment:s,status:"resolved",resolvedAt:(0,u.O5)()});const a=(Z||[]).find(s=>s.id===e);if(null!==a&&void 0!==a&&a.trialRoomId){const e=(0,u.H9)(o.db,"classes",i,"trialRooms",a.trialRoomId);await(0,u.mZ)(e,{status:"completed",completedAt:(0,u.O5)()}),K()}L(),R(!1),E(null),alert("\uc0ac\uac74\ubc88\ud638 ".concat(e.slice(-6),"\uc758 \ud310\uacb0\ubb38\uc774 \uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")),I("results")}catch(a){v.vF.error("Error saving judgment:",a),alert("\ud310\uacb0\ubb38 \uc800\uc7a5 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}},onCancel:()=>{R(!1),E(null)}}),P&&U&&(0,c.jsx)(y,{complaint:U,users:O,onSave:async(e,s,t,a)=>{if(!i)return alert("\ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc5b4 \ud569\uc758\uae08 \uc9c0\uae09\uc744 \ucc98\ub9ac\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."),!1;const n=parseInt(s,10);if(isNaN(n)||n<=0)return alert("\uc720\ud6a8\ud55c \uae08\uc561\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."),!1;if(!t||!a)return alert("\ubcf4\ub0b4\ub294 \uc0ac\ub78c\uacfc \ubc1b\ub294 \uc0ac\ub78c\uc744 \ubaa8\ub450 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."),!1;if(t===a)return alert("\ubcf4\ub0b4\ub294 \uc0ac\ub78c\uacfc \ubc1b\ub294 \uc0ac\ub78c\uc740 \uac19\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."),!1;const l=O.find(e=>e.id===t),r=O.find(e=>e.id===a);if(!l||!r)return alert("\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uc0ac\uc6a9\uc790 \uc815\ubcf4\uc785\ub2c8\ub2e4."),!1;const c=(null===l||void 0===l?void 0:l.name)||(null===l||void 0===l?void 0:l.displayName)||t,d=(null===r||void 0===r?void 0:r.name)||(null===r||void 0===r?void 0:r.displayName)||a;try{return await(0,u.c4)(o.db,async s=>{const l=(0,u.H9)(o.db,"users",t),r=(0,u.H9)(o.db,"users",a),m=(0,u.H9)(o.db,"classes",i,"courtComplaints",e),p=await s.get(l),h=await s.get(r),v=await s.get(m);if(!p.exists())throw new Error("".concat(c,"\ub2d8\uc758 \uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));if(!h.exists())throw new Error("".concat(d,"\ub2d8\uc758 \uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));if(!v.exists())throw new Error("\ud574\ub2f9 \uace0\uc18c \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const x=p.data().cash||0;if(x<n)throw new Error("".concat(c,"\ub2d8\uc758 \ud604\uae08\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. (\ubcf4\uc720: ").concat(x.toLocaleString(),"\uc6d0)"));s.update(l,{cash:(0,u.GV)(-n)}),s.update(r,{cash:(0,u.GV)(n)}),s.update(m,{settlementPaid:!0,settlementAmount:n,settlementDate:(0,u.O5)()})}),L(),alert("".concat(c,"\ub2d8\uc774 ").concat(d,"\ub2d8\uc5d0\uac8c ").concat(n.toLocaleString(),"\uc6d0 \ud569\uc758\uae08 \uc9c0\uae09\uc744 \uc644\ub8cc\ud588\uc2b5\ub2c8\ub2e4.")),ue(),!0}catch(m){return v.vF.error("\ud569\uc758\uae08 \uc9c0\uae09 \ud2b8\ub79c\uc7ad\uc158 \uc624\ub958:",m),alert("\ud569\uc758\uae08 \uc9c0\uae09\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4: ".concat(m.message)),!1}},onCancel:ue,getUserNameById:pe})]}):(0,c.jsx)("div",{className:"court-container",children:(0,c.jsx)("div",{className:"p-8 text-center text-gray-400",children:"\ubc95\uc6d0 \uc2dc\uc2a4\ud15c\uc744 \uc774\uc6a9\ud558\ub824\uba74 \ud559\uae09 \ucf54\ub4dc\uac00 \uc124\uc815\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4."})}):(0,c.jsx)("div",{className:"court-container",children:(0,c.jsx)("div",{className:"p-8 text-center text-gray-400",children:"\ub85c\uadf8\uc778 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \ub85c\uadf8\uc778\ud574\uc8fc\uc138\uc694."})})}}}]);
//# sourceMappingURL=7512.93dfc3d6.chunk.js.map