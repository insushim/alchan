"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[510],{4510(e,t,o){o.r(t),o.d(t,{default:()=>h});var s=o(2555),a=o(5043),n=o(5016),r=o(2419),l=o(579);const c=e=>{let{percentage:t,size:o=140,strokeWidth:s=12,color:a,children:n}=e;const r=(o-s)/2,c=2*r*Math.PI,i=c-t/100*c;return(0,l.jsxs)("div",{className:"relative",style:{width:o,height:o},children:[(0,l.jsxs)("svg",{width:o,height:o,style:{transform:"rotate(-90deg)"},children:[(0,l.jsx)("circle",{cx:o/2,cy:o/2,r:r,fill:"none",stroke:"rgba(255, 255, 255, 0.1)",strokeWidth:s}),(0,l.jsx)("circle",{cx:o/2,cy:o/2,r:r,fill:"none",stroke:a,strokeWidth:s,strokeDasharray:c,strokeDashoffset:i,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.5s ease"}})]}),(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center",children:n})]})};function i(e){let{classCouponGoal:t,goalProgress:o,myContribution:s,currentCoupons:a,couponValue:n,setShowDonateModal:r,setShowSellCouponModal:i,setShowDonationHistoryModal:d,setShowGiftCouponModal:u,goalAchieved:m,resetGoalButton:x,isResettingGoal:p}=e;const g="number"===typeof t&&t>0?t:1,f=Math.min(Math.round(o/g*100),100),h=g>0?Math.min(Math.round(s/g*100),100):0,b=m?"#10b981":"#6366f1";return(0,l.jsxs)("div",{className:"class-coupon-goal p-6 rounded-2xl relative overflow-hidden",style:{backgroundColor:"rgba(20, 20, 35, 0.6)",boxShadow:m?"0 4px 20px rgba(16, 185, 129, 0.25)":"0 4px 20px rgba(0, 255, 242, 0.15)",border:m?"2px solid #10b981":"1px solid rgba(0, 255, 242, 0.2)",backdropFilter:"blur(10px)"},children:[(0,l.jsx)("div",{className:"absolute -top-12 -right-12 w-36 h-36 rounded-full",style:{background:m?"radial-gradient(circle, rgba(16,185,129,0.1) 0%, transparent 70%)":"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)"}}),(0,l.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("span",{className:"text-3xl",children:"\ud83c\udfaf"}),(0,l.jsx)("h3",{className:"text-xl font-bold m-0",style:{color:"#e8e8ff",textShadow:"0 0 5px rgba(0, 255, 242, 0.5)"},children:"\ud559\uae09 \ucfe0\ud3f0 \ubaa9\ud45c"})]}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[m&&(0,l.jsx)("span",{className:"text-white px-3.5 py-1.5 rounded-2xl text-sm font-bold",style:{background:"linear-gradient(135deg, #10b981, #059669)",boxShadow:"0 2px 8px rgba(16, 185, 129, 0.4)",animation:"pulse 2s infinite"},children:"\ud83c\udf89 \ubaa9\ud45c \ub2ec\uc131!"}),x&&(0,l.jsx)("button",{onClick:x,disabled:p,className:"text-white border-none rounded-xl px-3 py-1.5 text-xs font-semibold",style:{backgroundColor:p?"#9ca3af":"#ef4444",cursor:p?"not-allowed":"pointer",opacity:p?.7:1},children:p?"\ucd08\uae30\ud654 \uc911...":"\ucd08\uae30\ud654"})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-center gap-7 py-5 flex-wrap",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)(c,{percentage:f,size:150,strokeWidth:14,color:b,children:[(0,l.jsxs)("div",{className:"text-3xl font-extrabold",style:{color:b},children:[f,"%"]}),(0,l.jsx)("div",{className:"text-xs font-medium",style:{color:"#a0a0c0"},children:"\ub2ec\uc131\ub960"})]}),(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsxs)("div",{className:"text-2xl font-extrabold",style:{color:"#e8e8ff"},children:[(o||0).toLocaleString(),(0,l.jsxs)("span",{className:"text-sm font-medium",style:{color:"#a0a0c0"},children:[" / ",g.toLocaleString()]})]}),(0,l.jsx)("div",{className:"text-xs mt-0.5",style:{color:"#6b7280"},children:"\ud559\uae09 \uc804\uccb4 \uae30\ubd80\ub7c9"})]})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)(c,{percentage:h,size:120,strokeWidth:10,color:"#f59e0b",children:[(0,l.jsxs)("div",{className:"text-2xl font-extrabold",style:{color:"#f59e0b"},children:[h,"%"]}),(0,l.jsx)("div",{className:"text-xs font-medium",style:{color:"#a0a0c0"},children:"\ub0b4 \uae30\uc5ec"})]}),(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsxs)("div",{className:"text-lg font-bold",style:{color:"#e8e8ff"},children:[(s||0).toLocaleString(),(0,l.jsx)("span",{className:"text-xs font-medium",style:{color:"#a0a0c0"},children:" \ucfe0\ud3f0"})]}),(0,l.jsx)("div",{className:"text-xs mt-0.5",style:{color:"#6b7280"},children:"\ub0b4\uac00 \uae30\ubd80\ud55c \ucfe0\ud3f0"})]})]}),(0,l.jsxs)("div",{className:"rounded-2xl p-5 text-center min-w-[130px]",style:{background:"linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%)",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)"},children:[(0,l.jsx)("div",{className:"text-3xl mb-2",children:"\ud83c\udfab"}),(0,l.jsx)("div",{className:"text-3xl font-extrabold",style:{color:"#fbbf24",textShadow:"0 0 10px rgba(251, 191, 36, 0.3)"},children:(a||0).toLocaleString()}),(0,l.jsx)("div",{className:"text-xs font-semibold mt-1",style:{color:"#fcd34d"},children:"\ubcf4\uc720 \ucfe0\ud3f0"}),(0,l.jsxs)("div",{className:"text-xs mt-2 px-2 py-1 rounded-lg",style:{color:"#fcd34d",background:"rgba(0,0,0,0.3)"},children:["1\ucfe0\ud3f0 = ","number"===typeof n?n.toLocaleString():"0","\uc6d0"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-2 mt-5",children:[(0,l.jsxs)("button",{onClick:()=>r(!0),className:"border-none rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all",style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",boxShadow:"0 4px 12px rgba(99, 102, 241, 0.35)"},children:[(0,l.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"}),(0,l.jsx)("span",{className:"text-white text-sm font-bold",children:"\ucfe0\ud3f0 \uc751\ubaa8"})]}),(0,l.jsxs)("button",{onClick:()=>i(!0),className:"border-none rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all",style:{background:"linear-gradient(135deg, #f87171 0%, #ef4444 100%)",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.35)"},children:[(0,l.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb5"}),(0,l.jsx)("span",{className:"text-white text-sm font-bold",children:"\ucfe0\ud3f0 \ud310\ub9e4"})]}),(0,l.jsxs)("button",{onClick:()=>u(!0),className:"border-none rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all",style:{background:"linear-gradient(135deg, #34d399 0%, #10b981 100%)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.35)"},children:[(0,l.jsx)("span",{className:"text-2xl",children:"\ud83c\udf81"}),(0,l.jsx)("span",{className:"text-white text-sm font-bold",children:"\ucfe0\ud3f0 \uc120\ubb3c"})]}),(0,l.jsxs)("button",{onClick:()=>d(!0),className:"rounded-xl py-3.5 px-2 cursor-pointer flex flex-col justify-center items-center gap-1.5 transition-all",style:{background:"linear-gradient(135deg, #374151 0%, #1f2937 100%)",border:"1px solid #4b5563"},children:[(0,l.jsx)("span",{className:"text-2xl",children:"\ud83d\udccb"}),(0,l.jsx)("span",{className:"text-sm font-bold",style:{color:"#4b5563"},children:"\uae30\ubd80 \ub0b4\uc5ed"})]})]}),(0,l.jsx)("style",{children:"\n        .class-coupon-goal { font-size: 1.05rem; }\n        .class-coupon-goal h3 { font-size: 1.3rem !important; }\n        .class-coupon-goal .text-xs { font-size: 0.85rem !important; }\n        .class-coupon-goal .text-sm { font-size: 0.95rem !important; }\n        .class-coupon-goal .text-2xl { font-size: 1.6rem !important; }\n        .class-coupon-goal .text-3xl { font-size: 2rem !important; }\n      "}),(0,l.jsx)("style",{children:"\n        @keyframes pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(1.05); }\n        }\n        .class-coupon-goal button:hover {\n          transform: translateY(-2px);\n        }\n      "})]})}var d=o(262),u=o(5226),m=o(783),x=o(813),p=o(3057),g=o(1166),f=o(5452);function h(){const{user:e,userDoc:t,users:o,classmates:c,allClassMembers:h,loading:b,optimisticUpdate:y}=(0,n.As)(),S=null===e||void 0===e?void 0:e.uid,j=null===t||void 0===t?void 0:t.classCode,[v,C]=(0,a.useState)(!0),N=(0,a.useRef)(!1),w=(0,a.useRef)(null),[k,A]=(0,a.useState)([]),I=(0,r.Qg)(r.Cn,"donateCoupon"),_=(0,r.Qg)(r.Cn,"sellCoupon"),D=(0,r.Qg)(r.Cn,"giftCoupon"),G=3e5,M=j?"".concat(j,"_goal"):null,[z,O]=(0,a.useState)(1e3),[H,P]=(0,a.useState)(1e3);(0,a.useEffect)(()=>{S&&(async()=>{try{const e=(0,r.H9)(r.db,"settings","mainSettings"),t=await(0,r.x7)(e);if(t.exists()){const e=t.data();e.couponValue&&P(Number(e.couponValue))}}catch(e){f.vF.error("[CouponGoalPage] \ucfe0\ud3f0 \uac00\uce58 \uc124\uc815 \ub85c\ub4dc \uc2e4\ud328:",e)}})()},[S]);const[R,W]=(0,a.useState)(0),[F,L]=(0,a.useState)(0),[B,V]=(0,a.useState)(!1),[E,T]=(0,a.useState)(!1),[J,Q]=(0,a.useState)(!1),[U,Y]=(0,a.useState)(!1),[q,K]=(0,a.useState)(""),[X,Z]=(0,a.useState)(!1),[$,ee]=(0,a.useState)(""),[te,oe]=(0,a.useState)(""),[se,ae]=(0,a.useState)(!1),ne=(0,a.useCallback)(e=>{try{const t=localStorage.getItem("firestore_cache_".concat(e,"_").concat(S));if(t){const{data:e,timestamp:o}=JSON.parse(t);if(Date.now()-o<G)return e}}catch(t){}return null},[S,G]),re=(0,a.useCallback)((e,t)=>{try{const o={data:t,timestamp:Date.now()};localStorage.setItem("firestore_cache_".concat(e,"_").concat(S),JSON.stringify(o))}catch(o){}},[S]),le=(0,a.useCallback)(e=>{O(Number(e.targetAmount)||1e3),W(Number(e.progress)||0);const t=Array.isArray(e.donations)?e.donations.map(e=>{let t;return t=e.timestamp&&e.timestamp.toDate?e.timestamp.toDate().toISOString():e.timestamp&&e.timestamp.seconds?new Date(1e3*e.timestamp.seconds).toISOString():e.timestampISO?e.timestampISO:"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),(0,s.A)((0,s.A)({},e),{},{amount:Number(e.amount)||0,timestamp:t,userId:e.userId||"",userName:e.userName||"\uc54c \uc218 \uc5c6\ub294 \uc0ac\uc6a9\uc790",message:e.message||"",classCode:e.classCode||j})}):[];A(t);const o=t.filter(e=>e.userId===S).reduce((e,t)=>e+t.amount,0);L(o)},[j,S]);w.current=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(S&&j&&M){if(!N.current){N.current=!0,C(!0);try{const t="goal_".concat(M);if(!e){const e=ne(t);if(e)return le(e),C(!1),void(N.current=!1)}const o=(0,r.H9)(r.db,"goals",M),s=await(0,r.x7)(o);if(s.exists()){const e=s.data();le(e);const t="goal_".concat(M);re(t,e)}else f.vF.warn("[CouponGoalPage] \ubaa9\ud45c \ubb38\uc11c\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4")}catch(t){f.vF.error("[CouponGoalPage] \ubaa9\ud45c \ub370\uc774\ud130 \ub85c\ub4dc \uc2e4\ud328:",t)}finally{C(!1),N.current=!1}}}else C(!1)},(0,a.useEffect)(()=>{!b&&e&&j&&M?w.current&&w.current():b||e?b&&C(!0):C(!1)},[b,e,j,M]),(0,a.useEffect)(()=>{V(R>=z&&z>0)},[R,z]);return b||v?(0,l.jsx)(g.AlchanLoading,{}):e?j||b?(0,l.jsx)("div",{className:"w-full min-h-full",style:{backgroundColor:"#0a0a12"},children:(0,l.jsxs)("div",{className:"w-full px-4 md:px-6 lg:px-8 py-6",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold text-emerald-400 border-b-2 border-emerald-900 pb-3 mb-6",style:{textShadow:"0 0 10px rgba(52, 211, 153, 0.3)"},children:["\ud83c\udfaf \ucfe0\ud3f0 \ubaa9\ud45c (\ud559\uae09: ",j,")"]}),j&&M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i,{classCouponGoal:z,goalProgress:R,myContribution:F,currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,couponValue:H,setShowDonateModal:Q,setShowSellCouponModal:Y,setShowDonationHistoryModal:ae,setShowGiftCouponModal:Z,goalAchieved:B,resetGoalButton:null!==t&&void 0!==t&&t.isAdmin||null!==t&&void 0!==t&&t.isSuperAdmin?async()=>{if(null!==t&&void 0!==t&&t.isAdmin||null!==t&&void 0!==t&&t.isSuperAdmin)if(j&&M){if(window.confirm("\uc815\ub9d0\ub85c ".concat(j," \ud559\uae09\uc758 \ucfe0\ud3f0 \ubaa9\ud45c\uc640 \uae30\uc5ec \uae30\ub85d\uc744 \ucd08\uae30\ud654\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))){T(!0);try{const e=(0,r.wP)(r.db),t=(0,r.H9)(r.db,"goals",M),o=(0,r.P)((0,r.rJ)(r.db,"users"),(0,r._M)("classCode","==",j));(await(0,r.GG)(o)).forEach(t=>{const o=(0,r.H9)(r.db,"users",t.id);e.update(o,{myContribution:0,updatedAt:(0,r.O5)()})}),e.update(t,{progress:0,donations:[],donationCount:0,updatedAt:(0,r.O5)(),resetAt:(0,r.O5)(),resetBy:S}),await e.commit(),localStorage.removeItem("goalDonationHistory_".concat(j,"_goal")),localStorage.removeItem("firestore_cache_goal_".concat(M,"_").concat(S)),L(0),W(0),A([]),alert("\ud559\uae09(".concat(j,")\uc758 \ucfe0\ud3f0 \ubaa9\ud45c\uc640 \uae30\uc5ec \uae30\ub85d\uc774 \ucd08\uae30\ud654\ub418\uc5c8\uc2b5\ub2c8\ub2e4."))}catch(e){alert("\ubaa9\ud45c \ucd08\uae30\ud654 \uc624\ub958: ".concat(e.message))}finally{T(!1)}}}else alert("\ud559\uae09 \ucf54\ub4dc\ub098 \ubaa9\ud45c \uc815\ubcf4\uac00 \uc5c6\uc5b4 \ucd08\uae30\ud654\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");else alert("\uad00\ub9ac\uc790\ub9cc \ucd08\uae30\ud654 \uac00\ub2a5\ud569\ub2c8\ub2e4.")}:null,isResettingGoal:E}),(0,l.jsxs)("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"rgba(20, 20, 35, 0.85)",borderRadius:"8px",border:"1px solid rgba(0, 255, 242, 0.15)"},children:[(0,l.jsx)("h4",{style:{fontSize:"14px",color:"#00fff2",marginBottom:"10px",fontWeight:"600"},children:"\ud83d\udd27 \ub370\uc774\ud130 \uad00\ub9ac \ub3c4\uad6c"}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[(0,l.jsx)("button",{onClick:async()=>{if(M&&j){C(!0);try{localStorage.removeItem("firestore_cache_goal_".concat(M,"_").concat(S));const e=(0,r.H9)(r.db,"goals",M),t=await(0,r.x7)(e);if(t.exists()){const e=t.data();O(Number(e.targetAmount)||1e3),W(Number(e.progress)||0);const o=Array.isArray(e.donations)?e.donations.map(e=>{let t;return t=e.timestamp&&e.timestamp.toDate?e.timestamp.toDate().toISOString():e.timestamp&&e.timestamp.seconds?new Date(1e3*e.timestamp.seconds).toISOString():e.timestampISO?e.timestampISO:"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),(0,s.A)((0,s.A)({},e),{},{amount:Number(e.amount)||0,timestamp:t,userId:e.userId||"",userName:e.userName||"\uc54c \uc218 \uc5c6\ub294 \uc0ac\uc6a9\uc790",message:e.message||"",classCode:e.classCode||j})}):[];A(o),re("goal_".concat(M),e),alert("\ubaa9\ud45c \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc644\ub8cc!\n\ubaa9\ud45c \uc9c4\ud589\ub960: ".concat(e.progress||0,"/").concat(e.targetAmount||1e3,"\n\uae30\ubd80 \ub0b4\uc5ed: ").concat(o.length,"\uac1c"))}else alert("\ubaa9\ud45c \ubb38\uc11c\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud574\uc8fc\uc138\uc694.")}catch(e){alert("\ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(e.message))}finally{C(!1)}}else alert("\ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")},disabled:v,style:{padding:"8px 12px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",fontWeight:"500"},children:"\ud83d\udcca \ubaa9\ud45c \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68"}),(0,l.jsx)("button",{onClick:()=>{const e={userId:S,currentUserClassCode:j,currentGoalId:M,goalProgress:R,classCouponGoal:z,myContribution:F,donationsCount:k.length,donations:k,userCoupons:null===t||void 0===t?void 0:t.coupons,userCash:null===t||void 0===t?void 0:t.cash};f.vF.log("[CouponGoalPage Debug]",e),alert("\ub514\ubc84\uadf8 \uc815\ubcf4\uac00 \ucf58\uc194\uc5d0 \ucd9c\ub825\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\n\uae30\ubd80 \ub0b4\uc5ed: ".concat(k.length,"\uac1c\n\ubaa9\ud45c \uc9c4\ud589\ub960: ").concat(R,"/").concat(z))},style:{padding:"8px 12px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",fontWeight:"500"},children:"\ud83d\udd0d \ub514\ubc84\uadf8 \uc815\ubcf4 \ud655\uc778"}),(0,l.jsx)("button",{onClick:()=>{localStorage.clear(),alert("\ub85c\uceec \uce90\uc2dc\uac00 \ubaa8\ub450 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud398\uc774\uc9c0\ub97c \uc0c8\ub85c\uace0\uce68\ud574\uc8fc\uc138\uc694."),window.location.reload()},style:{padding:"8px 12px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",fontWeight:"500"},children:"\ud83d\uddd1\ufe0f \uce90\uc2dc \uc0ad\uc81c \ud6c4 \uc0c8\ub85c\uace0\uce68"})]}),(0,l.jsxs)("p",{style:{fontSize:"11px",color:"#868e96",marginTop:"8px",marginBottom:"0",lineHeight:"1.4"},children:['\u2022 \uae30\ubd80 \ub0b4\uc5ed\uc774 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc73c\uba74 "\ubaa9\ud45c \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68" \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uc138\uc694',(0,l.jsx)("br",{}),'\u2022 \ubb38\uc81c\uac00 \uc9c0\uc18d\ub418\uba74 "\uce90\uc2dc \uc0ad\uc81c \ud6c4 \uc0c8\ub85c\uace0\uce68"\uc744 \uc2dc\ub3c4\ud574\ubcf4\uc138\uc694',(0,l.jsx)("br",{}),"\u2022 \ud604\uc7ac \uc0c1\ud0dc: \uae30\ubd80 \ub0b4\uc5ed ",k.length,"\uac1c, \ubaa9\ud45c \uc9c4\ud589\ub960"," ",R,"/",z]})]})]}),J&&j&&M&&(0,l.jsx)(u.A,{showDonateModal:J,setShowDonateModal:Q,currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,onDonate:async(e,o)=>{if(!S||!j||!t)return alert("\uc0ac\uc6a9\uc790 \ub610\ub294 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc5b4 \uae30\ubd80\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."),!1;const s=parseInt(e,10);if(isNaN(s)||s<=0)return alert("\uc720\ud6a8\ud55c \ucfe0\ud3f0 \uc218\ub7c9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."),!1;y&&y({coupons:-s}),L(e=>e+s),W(e=>e+s),C(!0);try{await I({amount:s,message:o});const e="goal_".concat(M);return localStorage.removeItem("firestore_cache_".concat(e,"_").concat(S)),localStorage.removeItem("goalDonationHistory_".concat(j,"_goal")),N.current=!1,w.current&&await w.current(),alert("".concat(s," \ucfe0\ud3f0 \uae30\ubd80 \uc644\ub8cc!")),Q(!1),!0}catch(a){return f.vF.error("[CouponGoalPage] \uae30\ubd80 \uc624\ub958 (\uc0c1\uc138):",{error:a,message:a.message,code:a.code,details:a.details,stack:a.stack}),alert("\uae30\ubd80 \uc624\ub958: ".concat(a.message)),y&&y({coupons:s}),!1}finally{C(!1)}},classCode:j}),U&&(0,l.jsx)(m.A,{showSellCouponModal:U,setShowSellCouponModal:Y,currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,couponValue:H,sellAmount:q,setSellAmount:K,SellCoupon:async()=>{const e=parseInt(q,10);if(isNaN(e)||e<=0)alert("\uc720\ud6a8\ud55c \uc218\ub7c9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");else{y&&y({coupons:-e,cash:e*H}),C(!0);try{await _({amount:e}),alert("".concat(e,"\uac1c \ucfe0\ud3f0\uc744 \ud310\ub9e4\ud588\uc2b5\ub2c8\ub2e4.")),Y(!1),K(""),setTimeout(()=>{N.current=!1,w.current&&w.current()},500)}catch(t){alert("\ud310\ub9e4 \uc624\ub958: ".concat(t.message))}finally{C(!1)}}}}),X&&(0,l.jsx)(x.A,{showGiftCouponModal:X,setShowGiftCouponModal:Z,recipients:c,giftRecipient:$,setGiftRecipient:ee,giftAmount:te,setGiftAmount:oe,handleGiftCoupon:async()=>{f.vF.log("handleGiftCoupon called");const e=o.find(e=>e.id===$),t=parseInt(te,10);if(e){if(isNaN(t)||t<=0)alert("\uc62c\ubc14\ub978 \uc218\ub7c9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");else if(y&&y({coupons:-t}),window.confirm("".concat(e.name,"\ub2d8\uc5d0\uac8c \ucfe0\ud3f0 ").concat(t,"\uac1c\ub97c \uc120\ubb3c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))){C(!0);try{await D({recipientId:e.id,amount:t,message:""}),alert("\ucfe0\ud3f0 \uc120\ubb3c\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),Z(!1),ee(""),oe(""),setTimeout(()=>{N.current=!1,w.current&&w.current()},500)}catch(s){alert("\uc120\ubb3c \uc624\ub958: ".concat(s.message)),y&&y({coupons:t})}finally{C(!1)}}}else alert("\ubc1b\ub294 \uc0ac\ub78c\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694.")},currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,userId:S}),se&&j&&M&&(0,l.jsx)(p.A,{showDonationHistoryModal:se,setShowDonationHistoryModal:ae,students:h||[],classCode:j,donations:k})]})}):(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh",fontSize:"1.2em",color:"#ef4444"},children:"\ud559\uae09 \ucf54\ub4dc \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc5ec \ud559\uae09 \ucf54\ub4dc\ub97c \ud560\ub2f9\ubc1b\uc73c\uc138\uc694."}):(0,l.jsx)(d.A,{})}}}]);
//# sourceMappingURL=510.966246b6.chunk.js.map