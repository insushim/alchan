"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[438],{4438:(e,t,o)=>{o.r(t),o.d(t,{default:()=>m});var n=o(4919),s=o(5043),a=o(5016),r=o(791),i=o(579);const l=e=>{let{percentage:t,size:o=140,strokeWidth:n=12,color:s,children:a}=e;const r=(o-n)/2,l=2*r*Math.PI,c=l-t/100*l;return(0,i.jsxs)("div",{style:{position:"relative",width:o,height:o},children:[(0,i.jsxs)("svg",{width:o,height:o,style:{transform:"rotate(-90deg)"},children:[(0,i.jsx)("circle",{cx:o/2,cy:o/2,r:r,fill:"none",stroke:"rgba(255, 255, 255, 0.1)",strokeWidth:n}),(0,i.jsx)("circle",{cx:o/2,cy:o/2,r:r,fill:"none",stroke:s,strokeWidth:n,strokeDasharray:l,strokeDashoffset:c,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.5s ease"}})]}),(0,i.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:a})]})};function c(e){let{classCouponGoal:t,goalProgress:o,myContribution:n,currentCoupons:s,couponValue:a,setShowDonateModal:r,setShowSellCouponModal:c,setShowDonationHistoryModal:d,setShowGiftCouponModal:p,goalAchieved:u,resetGoalButton:x,isResettingGoal:g}=e;const f="number"===typeof t&&t>0?t:1,m=Math.min(Math.round(o/f*100),100),h=f>0?Math.min(Math.round(n/f*100),100):0,b=u?"#10b981":"#6366f1";return(0,i.jsxs)("div",{className:"class-coupon-goal",style:{backgroundColor:"rgba(20, 20, 35, 0.6)",padding:"24px",borderRadius:"20px",boxShadow:u?"0 4px 20px rgba(16, 185, 129, 0.25)":"0 4px 20px rgba(0, 255, 242, 0.15)",border:u?"2px solid #10b981":"1px solid rgba(0, 255, 242, 0.2)",position:"relative",overflow:"hidden",backdropFilter:"blur(10px)"},children:[(0,i.jsx)("div",{style:{position:"absolute",top:"-50px",right:"-50px",width:"150px",height:"150px",background:u?"radial-gradient(circle, rgba(16,185,129,0.1) 0%, transparent 70%)":"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",borderRadius:"50%"}}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,i.jsx)("span",{style:{fontSize:"28px"},children:"\ud83c\udfaf"}),(0,i.jsx)("h3",{style:{fontSize:"20px",fontWeight:"700",color:"#e8e8ff",margin:0,textShadow:"0 0 5px rgba(0, 255, 242, 0.5)"},children:"\ud559\uae09 \ucfe0\ud3f0 \ubaa9\ud45c"})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[u&&(0,i.jsx)("span",{style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",padding:"6px 14px",borderRadius:"20px",fontSize:"13px",fontWeight:"700",boxShadow:"0 2px 8px rgba(16, 185, 129, 0.4)",animation:"pulse 2s infinite"},children:"\ud83c\udf89 \ubaa9\ud45c \ub2ec\uc131!"}),x&&(0,i.jsx)("button",{onClick:x,disabled:g,style:{backgroundColor:g?"#9ca3af":"#ef4444",color:"white",border:"none",borderRadius:"12px",padding:"6px 12px",fontSize:"12px",fontWeight:"600",cursor:g?"not-allowed":"pointer",opacity:g?.7:1},children:g?"\ucd08\uae30\ud654 \uc911...":"\ucd08\uae30\ud654"})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"30px",padding:"20px 0",flexWrap:"wrap"},children:[(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsxs)(l,{percentage:m,size:150,strokeWidth:14,color:b,children:[(0,i.jsxs)("div",{style:{fontSize:"32px",fontWeight:"800",color:b},children:[m,"%"]}),(0,i.jsx)("div",{style:{fontSize:"11px",color:"#a0a0c0",fontWeight:"500"},children:"\ub2ec\uc131\ub960"})]}),(0,i.jsxs)("div",{style:{marginTop:"12px"},children:[(0,i.jsxs)("div",{style:{fontSize:"22px",fontWeight:"800",color:"#e8e8ff"},children:[(o||0).toLocaleString(),(0,i.jsxs)("span",{style:{fontSize:"14px",color:"#a0a0c0",fontWeight:"500"},children:[" / ",f.toLocaleString()]})]}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginTop:"2px"},children:"\ud559\uae09 \uc804\uccb4 \uae30\ubd80\ub7c9"})]})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsxs)(l,{percentage:h,size:120,strokeWidth:10,color:"#f59e0b",children:[(0,i.jsxs)("div",{style:{fontSize:"24px",fontWeight:"800",color:"#f59e0b"},children:[h,"%"]}),(0,i.jsx)("div",{style:{fontSize:"10px",color:"#a0a0c0",fontWeight:"500"},children:"\ub0b4 \uae30\uc5ec"})]}),(0,i.jsxs)("div",{style:{marginTop:"12px"},children:[(0,i.jsxs)("div",{style:{fontSize:"18px",fontWeight:"700",color:"#e8e8ff"},children:[(n||0).toLocaleString(),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#a0a0c0",fontWeight:"500"},children:" \ucfe0\ud3f0"})]}),(0,i.jsx)("div",{style:{fontSize:"11px",color:"#6b7280",marginTop:"2px"},children:"\ub0b4\uac00 \uae30\ubd80\ud55c \ucfe0\ud3f0"})]})]}),(0,i.jsxs)("div",{style:{background:"linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%)",borderRadius:"16px",padding:"20px",textAlign:"center",minWidth:"130px",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)"},children:[(0,i.jsx)("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"\ud83c\udfab"}),(0,i.jsx)("div",{style:{fontSize:"28px",fontWeight:"800",color:"#fbbf24",textShadow:"0 0 10px rgba(251, 191, 36, 0.3)"},children:(s||0).toLocaleString()}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#fcd34d",fontWeight:"600",marginTop:"4px"},children:"\ubcf4\uc720 \ucfe0\ud3f0"}),(0,i.jsxs)("div",{style:{fontSize:"10px",color:"#fcd34d",marginTop:"8px",padding:"4px 8px",background:"rgba(0,0,0,0.3)",borderRadius:"8px"},children:["1\ucfe0\ud3f0 = ","number"===typeof a?a.toLocaleString():"0","\uc6d0"]})]})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",marginTop:"20px"},children:[(0,i.jsxs)("button",{onClick:()=>r(!0),style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",borderRadius:"14px",padding:"14px 8px",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",boxShadow:"0 4px 12px rgba(99, 102, 241, 0.35)",transition:"transform 0.2s, box-shadow 0.2s"},children:[(0,i.jsx)("span",{style:{fontSize:"22px"},children:"\ud83d\udcb0"}),(0,i.jsx)("span",{style:{color:"#fff",fontSize:"12px",fontWeight:"700"},children:"\ucfe0\ud3f0 \uae30\ubd80"})]}),(0,i.jsxs)("button",{onClick:()=>c(!0),style:{background:"linear-gradient(135deg, #f87171 0%, #ef4444 100%)",border:"none",borderRadius:"14px",padding:"14px 8px",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.35)",transition:"transform 0.2s, box-shadow 0.2s"},children:[(0,i.jsx)("span",{style:{fontSize:"22px"},children:"\ud83d\udcb5"}),(0,i.jsx)("span",{style:{color:"#fff",fontSize:"12px",fontWeight:"700"},children:"\ucfe0\ud3f0 \ud310\ub9e4"})]}),(0,i.jsxs)("button",{onClick:()=>p(!0),style:{background:"linear-gradient(135deg, #34d399 0%, #10b981 100%)",border:"none",borderRadius:"14px",padding:"14px 8px",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.35)",transition:"transform 0.2s, box-shadow 0.2s"},children:[(0,i.jsx)("span",{style:{fontSize:"22px"},children:"\ud83c\udf81"}),(0,i.jsx)("span",{style:{color:"#fff",fontSize:"12px",fontWeight:"700"},children:"\ucfe0\ud3f0 \uc120\ubb3c"})]}),(0,i.jsxs)("button",{onClick:()=>d(!0),style:{background:"linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)",border:"1px solid #d1d5db",borderRadius:"14px",padding:"14px 8px",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"6px",transition:"transform 0.2s, box-shadow 0.2s"},children:[(0,i.jsx)("span",{style:{fontSize:"22px"},children:"\ud83d\udccb"}),(0,i.jsx)("span",{style:{color:"#a0a0c0",fontSize:"12px",fontWeight:"700"},children:"\uae30\ubd80 \ub0b4\uc5ed"})]})]}),(0,i.jsx)("style",{children:"\n        @keyframes pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(1.05); }\n        }\n        .class-coupon-goal button:hover {\n          transform: translateY(-2px);\n        }\n      "})]})}var d=o(293),p=o(5226),u=o(783),x=o(813),g=o(3057),f=o(8180);function m(){const{user:e,userDoc:t,users:o,classmates:l,allClassMembers:m,loading:h,optimisticUpdate:b}=(0,a.As)(),y=null===e||void 0===e?void 0:e.uid,S=null===t||void 0===t?void 0:t.classCode,[j,C]=(0,s.useState)(!0),w=(0,s.useRef)(!1),v=(0,s.useRef)(null),[k,I]=(0,s.useState)([]),z=(0,r.Qg)(r.Cn,"donateCoupon"),A=(0,r.Qg)(r.Cn,"sellCoupon"),D=(0,r.Qg)(r.Cn,"giftCoupon"),W=S?"".concat(S,"_goal"):null,[_,N]=(0,s.useState)(1e3),[G,M]=(0,s.useState)(1e3);(0,s.useEffect)(()=>{y&&(async()=>{try{const e=(0,r.H9)(r.db,"settings","mainSettings"),t=await(0,r.x7)(e);if(t.exists()){const e=t.data();e.couponValue&&M(Number(e.couponValue))}}catch(e){console.error("[CouponGoalPage] \ucfe0\ud3f0 \uac00\uce58 \uc124\uc815 \ub85c\ub4dc \uc2e4\ud328:",e)}})()},[y]);const[R,O]=(0,s.useState)(0),[H,T]=(0,s.useState)(0),[P,B]=(0,s.useState)(!1),[L,V]=(0,s.useState)(!1),[E,J]=(0,s.useState)(!1),[Q,F]=(0,s.useState)(!1),[U,Y]=(0,s.useState)(""),[q,K]=(0,s.useState)(!1),[X,Z]=(0,s.useState)(""),[$,ee]=(0,s.useState)(""),[te,oe]=(0,s.useState)(!1),ne=(0,s.useCallback)(e=>{try{const t=localStorage.getItem("firestore_cache_".concat(e,"_").concat(y));if(t){const{data:e,timestamp:o}=JSON.parse(t);if(Date.now()-o<3e5)return e}}catch(t){}return null},[y]),se=(0,s.useCallback)((e,t)=>{try{const o={data:t,timestamp:Date.now()};localStorage.setItem("firestore_cache_".concat(e,"_").concat(y),JSON.stringify(o))}catch(o){}},[y]),ae=(0,s.useCallback)(e=>{N(Number(e.targetAmount)||1e3),O(Number(e.progress)||0);const t=Array.isArray(e.donations)?e.donations.map(e=>{let t;return t=e.timestamp&&e.timestamp.toDate?e.timestamp.toDate().toISOString():e.timestamp&&e.timestamp.seconds?new Date(1e3*e.timestamp.seconds).toISOString():e.timestampISO?e.timestampISO:"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),(0,n.A)((0,n.A)({},e),{},{amount:Number(e.amount)||0,timestamp:t,userId:e.userId||"",userName:e.userName||"\uc54c \uc218 \uc5c6\ub294 \uc0ac\uc6a9\uc790",message:e.message||"",classCode:e.classCode||S})}):[];I(t);const o=t.filter(e=>e.userId===y).reduce((e,t)=>e+t.amount,0);T(o)},[S,y]);v.current=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(y&&S&&W){if(!w.current){w.current=!0,C(!0);try{const t="goal_".concat(W);if(!e){const e=ne(t);if(e)return ae(e),C(!1),void(w.current=!1)}const o=(0,r.H9)(r.db,"goals",W),n=await(0,r.x7)(o);if(n.exists()){const e=n.data();ae(e);const t="goal_".concat(W);se(t,e)}else console.warn("[CouponGoalPage] \ubaa9\ud45c \ubb38\uc11c\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4")}catch(t){console.error("[CouponGoalPage] \ubaa9\ud45c \ub370\uc774\ud130 \ub85c\ub4dc \uc2e4\ud328:",t)}finally{C(!1),w.current=!1}}}else C(!1)},(0,s.useEffect)(()=>{!h&&e&&S&&W?v.current&&v.current():h||e?h&&C(!0):C(!1)},[h,e,S,W]),(0,s.useEffect)(()=>{B(R>=_&&_>0)},[R,_]);return h||j?(0,i.jsx)(f.AlchanLoading,{}):e?S||h?(0,i.jsx)("div",{className:"w-full min-h-full",style:{backgroundColor:"#0a0a12"},children:(0,i.jsxs)("div",{className:"w-full px-4 md:px-6 lg:px-8 py-6",children:[(0,i.jsxs)("h2",{className:"text-2xl font-bold text-emerald-400 border-b-2 border-emerald-900 pb-3 mb-6",style:{textShadow:"0 0 10px rgba(52, 211, 153, 0.3)"},children:["\ud83c\udfaf \ucfe0\ud3f0 \ubaa9\ud45c (\ud559\uae09: ",S,")"]}),S&&W&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c,{classCouponGoal:_,goalProgress:R,myContribution:H,currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,couponValue:G,setShowDonateModal:J,setShowSellCouponModal:F,setShowDonationHistoryModal:oe,setShowGiftCouponModal:K,goalAchieved:P,resetGoalButton:null!==t&&void 0!==t&&t.isAdmin||null!==t&&void 0!==t&&t.isSuperAdmin?async()=>{if(null!==t&&void 0!==t&&t.isAdmin||null!==t&&void 0!==t&&t.isSuperAdmin)if(S&&W){if(window.confirm("\uc815\ub9d0\ub85c ".concat(S," \ud559\uae09\uc758 \ucfe0\ud3f0 \ubaa9\ud45c\uc640 \uae30\uc5ec \uae30\ub85d\uc744 \ucd08\uae30\ud654\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))){V(!0);try{const e=(0,r.wP)(r.db),t=(0,r.H9)(r.db,"goals",W),o=(0,r.P)((0,r.rJ)(r.db,"users"),(0,r._M)("classCode","==",S));(await(0,r.GG)(o)).forEach(t=>{const o=(0,r.H9)(r.db,"users",t.id);e.update(o,{myContribution:0,updatedAt:(0,r.O5)()})}),e.update(t,{progress:0,donations:[],donationCount:0,updatedAt:(0,r.O5)(),resetAt:(0,r.O5)(),resetBy:y}),await e.commit(),localStorage.removeItem("goalDonationHistory_".concat(S,"_goal")),localStorage.removeItem("firestore_cache_goal_".concat(W,"_").concat(y)),T(0),O(0),I([]),alert("\ud559\uae09(".concat(S,")\uc758 \ucfe0\ud3f0 \ubaa9\ud45c\uc640 \uae30\uc5ec \uae30\ub85d\uc774 \ucd08\uae30\ud654\ub418\uc5c8\uc2b5\ub2c8\ub2e4."))}catch(e){alert("\ubaa9\ud45c \ucd08\uae30\ud654 \uc624\ub958: ".concat(e.message))}finally{V(!1)}}}else alert("\ud559\uae09 \ucf54\ub4dc\ub098 \ubaa9\ud45c \uc815\ubcf4\uac00 \uc5c6\uc5b4 \ucd08\uae30\ud654\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");else alert("\uad00\ub9ac\uc790\ub9cc \ucd08\uae30\ud654 \uac00\ub2a5\ud569\ub2c8\ub2e4.")}:null,isResettingGoal:L}),(0,i.jsxs)("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"rgba(20, 20, 35, 0.85)",borderRadius:"8px",border:"1px solid rgba(0, 255, 242, 0.15)"},children:[(0,i.jsx)("h4",{style:{fontSize:"14px",color:"#00fff2",marginBottom:"10px",fontWeight:"600"},children:"\ud83d\udd27 \ub370\uc774\ud130 \uad00\ub9ac \ub3c4\uad6c"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[(0,i.jsx)("button",{onClick:async()=>{if(W&&S){C(!0);try{localStorage.removeItem("firestore_cache_goal_".concat(W,"_").concat(y));const e=(0,r.H9)(r.db,"goals",W),t=await(0,r.x7)(e);if(t.exists()){const e=t.data();N(Number(e.targetAmount)||1e3),O(Number(e.progress)||0);const o=Array.isArray(e.donations)?e.donations.map(e=>{let t;return t=e.timestamp&&e.timestamp.toDate?e.timestamp.toDate().toISOString():e.timestamp&&e.timestamp.seconds?new Date(1e3*e.timestamp.seconds).toISOString():e.timestampISO?e.timestampISO:"string"===typeof e.timestamp?e.timestamp:(new Date).toISOString(),(0,n.A)((0,n.A)({},e),{},{amount:Number(e.amount)||0,timestamp:t,userId:e.userId||"",userName:e.userName||"\uc54c \uc218 \uc5c6\ub294 \uc0ac\uc6a9\uc790",message:e.message||"",classCode:e.classCode||S})}):[];I(o),se("goal_".concat(W),e),alert("\ubaa9\ud45c \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc644\ub8cc!\n\ubaa9\ud45c \uc9c4\ud589\ub960: ".concat(e.progress||0,"/").concat(e.targetAmount||1e3,"\n\uae30\ubd80 \ub0b4\uc5ed: ").concat(o.length,"\uac1c"))}else alert("\ubaa9\ud45c \ubb38\uc11c\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud574\uc8fc\uc138\uc694.")}catch(e){alert("\ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(e.message))}finally{C(!1)}}else alert("\ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")},disabled:j,style:{padding:"8px 12px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",fontWeight:"500"},children:"\ud83d\udcca \ubaa9\ud45c \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68"}),(0,i.jsx)("button",{onClick:()=>{const e={userId:y,currentUserClassCode:S,currentGoalId:W,goalProgress:R,classCouponGoal:_,myContribution:H,donationsCount:k.length,donations:k,userCoupons:null===t||void 0===t?void 0:t.coupons,userCash:null===t||void 0===t?void 0:t.cash};console.log("[CouponGoalPage Debug]",e),alert("\ub514\ubc84\uadf8 \uc815\ubcf4\uac00 \ucf58\uc194\uc5d0 \ucd9c\ub825\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\n\uae30\ubd80 \ub0b4\uc5ed: ".concat(k.length,"\uac1c\n\ubaa9\ud45c \uc9c4\ud589\ub960: ").concat(R,"/").concat(_))},style:{padding:"8px 12px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",fontWeight:"500"},children:"\ud83d\udd0d \ub514\ubc84\uadf8 \uc815\ubcf4 \ud655\uc778"}),(0,i.jsx)("button",{onClick:()=>{localStorage.clear(),alert("\ub85c\uceec \uce90\uc2dc\uac00 \ubaa8\ub450 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud398\uc774\uc9c0\ub97c \uc0c8\ub85c\uace0\uce68\ud574\uc8fc\uc138\uc694."),window.location.reload()},style:{padding:"8px 12px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",fontWeight:"500"},children:"\ud83d\uddd1\ufe0f \uce90\uc2dc \uc0ad\uc81c \ud6c4 \uc0c8\ub85c\uace0\uce68"})]}),(0,i.jsxs)("p",{style:{fontSize:"11px",color:"#868e96",marginTop:"8px",marginBottom:"0",lineHeight:"1.4"},children:['\u2022 \uae30\ubd80 \ub0b4\uc5ed\uc774 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc73c\uba74 "\ubaa9\ud45c \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68" \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uc138\uc694',(0,i.jsx)("br",{}),'\u2022 \ubb38\uc81c\uac00 \uc9c0\uc18d\ub418\uba74 "\uce90\uc2dc \uc0ad\uc81c \ud6c4 \uc0c8\ub85c\uace0\uce68"\uc744 \uc2dc\ub3c4\ud574\ubcf4\uc138\uc694',(0,i.jsx)("br",{}),"\u2022 \ud604\uc7ac \uc0c1\ud0dc: \uae30\ubd80 \ub0b4\uc5ed ",k.length,"\uac1c, \ubaa9\ud45c \uc9c4\ud589\ub960"," ",R,"/",_]})]})]}),E&&S&&W&&(0,i.jsx)(p.A,{showDonateModal:E,setShowDonateModal:J,currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,onDonate:async(e,o)=>{if(!y||!S||!t)return alert("\uc0ac\uc6a9\uc790 \ub610\ub294 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc5b4 \uae30\ubd80\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."),!1;const n=parseInt(e,10);if(isNaN(n)||n<=0)return alert("\uc720\ud6a8\ud55c \ucfe0\ud3f0 \uc218\ub7c9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."),!1;b&&b({coupons:-n}),T(e=>e+n),O(e=>e+n),C(!0);try{await z({amount:n,message:o});const e="goal_".concat(W);return localStorage.removeItem("firestore_cache_".concat(e,"_").concat(y)),localStorage.removeItem("goalDonationHistory_".concat(S,"_goal")),w.current=!1,v.current&&await v.current(),alert("".concat(n," \ucfe0\ud3f0 \uae30\ubd80 \uc644\ub8cc!")),J(!1),!0}catch(s){return console.error("[CouponGoalPage] \uae30\ubd80 \uc624\ub958 (\uc0c1\uc138):",{error:s,message:s.message,code:s.code,details:s.details,stack:s.stack}),alert("\uae30\ubd80 \uc624\ub958: ".concat(s.message)),b&&b({coupons:n}),!1}finally{C(!1)}},classCode:S}),Q&&(0,i.jsx)(u.A,{showSellCouponModal:Q,setShowSellCouponModal:F,currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,couponValue:G,sellAmount:U,setSellAmount:Y,SellCoupon:async()=>{const e=parseInt(U,10);if(isNaN(e)||e<=0)alert("\uc720\ud6a8\ud55c \uc218\ub7c9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");else{b&&b({coupons:-e,cash:e*G}),C(!0);try{await A({amount:e}),alert("".concat(e,"\uac1c \ucfe0\ud3f0\uc744 \ud310\ub9e4\ud588\uc2b5\ub2c8\ub2e4.")),F(!1),Y(""),setTimeout(()=>{w.current=!1,v.current&&v.current()},500)}catch(t){alert("\ud310\ub9e4 \uc624\ub958: ".concat(t.message))}finally{C(!1)}}}}),q&&(0,i.jsx)(x.A,{showGiftCouponModal:q,setShowGiftCouponModal:K,recipients:l,giftRecipient:X,setGiftRecipient:Z,giftAmount:$,setGiftAmount:ee,handleGiftCoupon:async()=>{console.log("handleGiftCoupon called");const e=o.find(e=>e.id===X),t=parseInt($,10);if(e){if(isNaN(t)||t<=0)alert("\uc62c\ubc14\ub978 \uc218\ub7c9\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");else if(b&&b({coupons:-t}),window.confirm("".concat(e.name,"\ub2d8\uc5d0\uac8c \ucfe0\ud3f0 ").concat(t,"\uac1c\ub97c \uc120\ubb3c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))){C(!0);try{await D({recipientId:e.id,amount:t,message:""}),alert("\ucfe0\ud3f0 \uc120\ubb3c\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),K(!1),Z(""),ee(""),setTimeout(()=>{w.current=!1,v.current&&v.current()},500)}catch(n){alert("\uc120\ubb3c \uc624\ub958: ".concat(n.message)),b&&b({coupons:t})}finally{C(!1)}}}else alert("\ubc1b\ub294 \uc0ac\ub78c\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694.")},currentCoupons:Number(null===t||void 0===t?void 0:t.coupons)||0,userId:y}),te&&S&&W&&(0,i.jsx)(g.A,{showDonationHistoryModal:te,setShowDonationHistoryModal:oe,students:m||[],classCode:S,donations:k})]})}):(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh",fontSize:"1.2em",color:"#ef4444"},children:"\ud559\uae09 \ucf54\ub4dc \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc5ec \ud559\uae09 \ucf54\ub4dc\ub97c \ud560\ub2f9\ubc1b\uc73c\uc138\uc694."}):(0,i.jsx)(d.A,{})}}}]);
//# sourceMappingURL=438.ec19b75d.chunk.js.map