"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[259],{5259:(e,s,a)=>{a.r(s),a.d(s,{default:()=>o});var n=a(4919),c=a(5043),t=a(5016),l=a(3251),i=a(579);const o=function(){const{userDoc:e,allClassMembers:s,loading:a,setUserDoc:o,setAllClassMembers:r}=(0,t.As)(),[d,m]=(0,c.useState)([]),[u,h]=(0,c.useState)(""),[x,p]=(0,c.useState)("fixed"),[j,N]=(0,c.useState)("send"),[v,g]=(0,c.useState)("toMe"),[b,f]=(0,c.useState)(10),[k,y]=(0,c.useState)(""),[C,M]=(0,c.useState)(""),[S,L]=(0,c.useState)(!1),[w,A]=(0,c.useState)(!1),F=null===e||void 0===e?void 0:e.name,T=null===e||void 0===e?void 0:e.classCode,D=(0,c.useMemo)(()=>s&&0!==s.length?[...s].sort((e,s)=>{const a=e.name||e.nickname||"",n=s.name||s.nickname||"";return a.localeCompare(n,"ko")}):[],[s]);(0,c.useEffect)(()=>{m([]),L(!1)},[j,x]);const R=function(e,s){let a,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(a="percentage"===x?Math.floor(e*Number(s)/100):Number(s),n&&"send"===j){return a-Math.floor(a*b/100)}return a},U=(0,c.useMemo)(()=>{if(!u||0===d.length)return{};const e={};return d.forEach(s=>{const a=D.find(e=>e.id===s);if(a){const n=Number(a.cash||0),c="send"===j;e[s]=R(n,u,c)}}),e},[d,u,x,j,b,D]);return(0,i.jsxs)("div",{className:"money-transfer-container",children:[(0,i.jsx)("div",{className:"header",children:(0,i.jsxs)("div",{className:"admin-info",children:[(0,i.jsx)("span",{className:"admin-label",children:"\uad00\ub9ac\uc790"}),(0,i.jsx)("span",{className:"admin-name",children:F||"\ub85c\ub529 \uc911..."}),(0,i.jsxs)("span",{className:"admin-cash",children:["\ud604\uae08: ",((null===e||void 0===e?void 0:e.cash)||0).toLocaleString(),"\uc6d0"]})]})}),C&&(0,i.jsx)("div",{className:"alert alert-error",children:C}),k&&(0,i.jsx)("div",{className:"alert alert-success",children:k}),(0,i.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0===d.length||!u||isNaN(Number(u)))return void M("\uc0ac\uc6a9\uc790\ub97c \uc120\ud0dd\ud558\uace0 \uc720\ud6a8\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694.");const s=Number(u);if(s<=0)M("".concat("percentage"===x?"\ud37c\uc13c\ud2b8":"\uae08\uc561","\uc740 0\ubcf4\ub2e4 \ucee4\uc57c \ud569\ub2c8\ub2e4."));else if("percentage"===x&&(s>100||s<0))M("\ud37c\uc13c\ud2b8\ub294 0\uacfc 100 \uc0ac\uc774\uc758 \uac12\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.");else{A(!0),y(""),M("");try{const e=D.filter(e=>d.includes(e.id)),{count:a,totalProcessed:c,updatedUsers:t}=await(0,l.FG)({adminName:F,adminClassCode:T,targetUsers:e,action:j,takeMode:"take"===j?v:void 0,amountType:x,amount:s,taxRate:b});t&&t.length>0&&(r(e=>e.map(e=>{const s=t.find(s=>s.id===e.id);return s?(0,n.A)((0,n.A)({},e),{},{cash:s.newCash}):e})),o(e=>{const s=Number(e.cash||0);let a;return a="send"===j?s-c:"take"===j&&"toMe"===v?s+c:s,(0,n.A)((0,n.A)({},e),{},{cash:a})}));const i="send"===j?"\ubcf4\ub0b4\uae30":"toMe"===v?"\uac00\uc838\uc624\uae30":"\uc5c6\uc560\uae30";y("".concat(a,"\uba85\uc5d0\uac8c ").concat("percentage"===x?"".concat(s,"%"):"".concat(s.toLocaleString(),"\uc6d0")," ").concat(i," \uc644\ub8cc! (\ucd1d ").concat(c.toLocaleString(),"\uc6d0 \ucc98\ub9ac").concat("send"===j&&b>0?", \uc138\uae08 ".concat(b,"% \uc801\uc6a9"):"",")")),h(""),m([]),L(!1),setTimeout(()=>y(""),3e3)}catch(a){console.error("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd:",a),M("\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(a.message)),setTimeout(()=>M(""),5e3)}finally{A(!1)}}},className:"transfer-form",children:[(0,i.jsxs)("div",{className:"action-selector",children:[(0,i.jsxs)("button",{type:"button",className:"action-btn ".concat("send"===j?"active send":""),onClick:()=>N("send"),children:[(0,i.jsx)("span",{className:"icon",children:"\ud83d\udce4"})," \ubcf4\ub0b4\uae30"]}),(0,i.jsxs)("button",{type:"button",className:"action-btn ".concat("take"===j?"active take":""),onClick:()=>N("take"),children:[(0,i.jsx)("span",{className:"icon",children:"\ud83d\udce5"})," \uac00\uc838\uc624\uae30"]})]}),"take"===j&&(0,i.jsxs)("div",{className:"take-mode-section",children:[(0,i.jsx)("h4",{children:"\uac00\uc838\uc624\uae30 \uc635\uc158"}),(0,i.jsxs)("div",{className:"take-mode-selector",children:[(0,i.jsxs)("label",{className:"mode-option ".concat("toMe"===v?"active":""),children:[(0,i.jsx)("input",{type:"radio",name:"takeMode",value:"toMe",checked:"toMe"===v,onChange:e=>g(e.target.value)}),(0,i.jsx)("span",{className:"radio-custom"}),(0,i.jsxs)("span",{className:"mode-text",children:[(0,i.jsx)("strong",{children:"\ud83d\udcb0 \ub098\uc5d0\uac8c \uac00\uc838\uc624\uae30"}),(0,i.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \ub0b4 \uacc4\uc88c\ub85c \uac00\uc838\uc635\ub2c8\ub2e4"})]})]}),(0,i.jsxs)("label",{className:"mode-option ".concat("remove"===v?"active":""),children:[(0,i.jsx)("input",{type:"radio",name:"takeMode",value:"remove",checked:"remove"===v,onChange:e=>g(e.target.value)}),(0,i.jsx)("span",{className:"radio-custom"}),(0,i.jsxs)("span",{className:"mode-text",children:[(0,i.jsx)("strong",{children:"\ud83d\uddd1\ufe0f \ub3c8 \uc5c6\uc560\uae30"}),(0,i.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \uc601\uad6c\uc801\uc73c\ub85c \uc81c\uac70\ud569\ub2c8\ub2e4"})]})]})]})]}),(0,i.jsxs)("div",{className:"amount-section",children:[(0,i.jsxs)("div",{className:"amount-type-selector",children:[(0,i.jsxs)("label",{className:"type-option ".concat("fixed"===x?"active":""),children:[(0,i.jsx)("input",{type:"radio",name:"amountType",value:"fixed",checked:"fixed"===x,onChange:e=>p(e.target.value)}),(0,i.jsx)("span",{className:"radio-custom"})," \uace0\uc815 \uae08\uc561"]}),(0,i.jsxs)("label",{className:"type-option ".concat("percentage"===x?"active":""),children:[(0,i.jsx)("input",{type:"radio",name:"amountType",value:"percentage",checked:"percentage"===x,onChange:e=>p(e.target.value)}),(0,i.jsx)("span",{className:"radio-custom"})," \ud37c\uc13c\ud2b8 (%)"]})]}),(0,i.jsxs)("div",{className:"amount-input-group",children:[(0,i.jsx)("input",{type:"number",value:u,onChange:e=>h(e.target.value),placeholder:"fixed"===x?"\uae08\uc561 \uc785\ub825":"\ud37c\uc13c\ud2b8 \uc785\ub825",min:"1",max:"percentage"===x?"100":void 0,required:!0,className:"amount-input"}),(0,i.jsx)("span",{className:"amount-unit",children:"fixed"===x?"\uc6d0":"%"})]})]}),"send"===j&&(0,i.jsxs)("div",{className:"tax-section",children:[(0,i.jsxs)("div",{className:"tax-header",children:[(0,i.jsx)("h4",{children:"\ud83d\udcb8 \uc138\uae08 \uc124\uc815"}),(0,i.jsx)("span",{className:"tax-description",children:"\ubcf4\ub0b4\ub294 \uae08\uc561\uc5d0\uc11c \uc138\uae08\uc744 \uc81c\uc678\ud558\uace0 \uc9c0\uae09\ub429\ub2c8\ub2e4."})]}),(0,i.jsxs)("div",{className:"tax-input-group",children:[(0,i.jsx)("label",{htmlFor:"taxRate",children:"\uc138\uae08\uc728:"}),(0,i.jsx)("input",{type:"number",id:"taxRate",value:b,onChange:e=>f(Math.max(0,Math.min(100,Number(e.target.value)))),min:"0",max:"100",className:"tax-input"}),(0,i.jsx)("span",{className:"tax-unit",children:"%"})]}),u&&(0,i.jsx)("div",{className:"tax-preview",children:"fixed"===x?(0,i.jsxs)(i.Fragment,{children:["\uc2e4\uc81c \uc9c0\uae09\uc561: ",R(0,u,!0).toLocaleString(),"\uc6d0 (\uc138\uae08 ",Math.floor(Number(u)*b/100).toLocaleString(),"\uc6d0 \uc81c\uc678)"]}):"\uac01 \ud559\uc0dd \uc794\uc561\uc758 ".concat(u,"%\uc5d0\uc11c \uc138\uae08 ").concat(b,"%\uac00 \ucd94\uac00\ub85c \ucc28\uac10\ub429\ub2c8\ub2e4.")})]}),(0,i.jsxs)("div",{className:"user-selection-section",children:[(0,i.jsxs)("div",{className:"section-header",children:[(0,i.jsx)("h3",{children:"\ub300\uc0c1 \uc120\ud0dd"}),(0,i.jsxs)("label",{className:"select-all-label",children:[(0,i.jsx)("input",{type:"checkbox",checked:S,onChange:()=>{L(e=>{const s=!e;return m(s?D.map(e=>e.id):[]),s})},className:"checkbox-custom"}),(0,i.jsx)("span",{className:"checkmark"})," \uc804\uccb4 \uc120\ud0dd"]})]}),a&&0===D.length?(0,i.jsx)("div",{className:"loading",children:"\uc0ac\uc6a9\uc790 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."}):(0,i.jsx)("div",{className:"user-list",children:D.map(e=>{var s;const a=U[e.id];return(0,i.jsx)("div",{className:"user-item",children:(0,i.jsxs)("label",{className:"user-label",children:[(0,i.jsx)("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>{return s=e.id,void m(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"checkbox-custom"}),(0,i.jsx)("span",{className:"checkmark"}),(0,i.jsxs)("div",{className:"user-info",children:[(0,i.jsx)("span",{className:"user-name",children:e.name}),(0,i.jsxs)("span",{className:"user-balance",children:["\uc794\uc561: ",(null===(s=e.cash)||void 0===s?void 0:s.toLocaleString())||0,"\uc6d0"]}),void 0!==a&&(0,i.jsxs)("span",{className:"preview-amount ".concat(j),children:["send"===j?"+":"\u2212",a.toLocaleString(),"\uc6d0"]})]})]})},e.id)})})]}),(0,i.jsx)("button",{type:"submit",className:"submit-btn ".concat(j),disabled:a||w,children:w?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"spinner"})," \ucc98\ub9ac \uc911..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"icon",children:"send"===j?"\ud83d\udce4":"\ud83d\udce5"})," ","send"===j?"\ubcf4\ub0b4\uae30":"\uac00\uc838\uc624\uae30"," \uc2e4\ud589"]})})]})]})}}}]);
//# sourceMappingURL=259.39e35b52.chunk.js.map