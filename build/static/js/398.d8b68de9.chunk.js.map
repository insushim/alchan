{"version":3,"file":"static/js/398.d8b68de9.chunk.js","mappings":"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","sources":["pages/banking/stockExchangeService.js","pages/banking/StockExchange.js"],"sourcesContent":["// src/pages/banking/stockExchangeService.js\r\n// StockExchange 유틸리티, 캐시, 배치 데이터 로딩, 국고 업데이트\r\n\r\nimport { db, functions } from \"../../firebase\";\r\nimport { httpsCallable } from \"firebase/functions\";\r\nimport {\r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  increment,\r\n  serverTimestamp,\r\n  writeBatch,\r\n} from \"firebase/firestore\";\r\nimport { globalCache } from \"../../services/globalCacheService\";\r\n\r\n// === 상수 ===\r\nexport const PRODUCT_TYPES = {\r\n  STOCK: \"stock\",\r\n  ETF: \"etf\",\r\n  BOND: \"bond\"\r\n};\r\n\r\nexport const SECTORS = {\r\n  TECH: { name: \"기술\" },\r\n  FINANCE: { name: \"금융\" },\r\n  CONSUMER: { name: \"소비재\" },\r\n  HEALTHCARE: { name: \"헬스케어\" },\r\n  ENERGY: { name: \"에너지\" },\r\n  INDUSTRIAL: { name: \"산업\" },\r\n  MATERIALS: { name: \"소재\" },\r\n  REALESTATE: { name: \"부동산\" },\r\n  UTILITIES: { name: \"유틸리티\" },\r\n  COMMUNICATION: { name: \"통신\" },\r\n  ENTERTAINMENT: { name: \"엔터테인먼트\" },\r\n  INDEX: { name: \"지수\" },\r\n  GOVERNMENT: { name: \"국채\" },\r\n  CORPORATE: { name: \"회사채\" }\r\n};\r\n\r\nexport const HOLDING_LOCK_PERIOD = 60 * 60 * 1000; // 1시간\r\nexport const COMMISSION_RATE = 0.003;\r\nexport const TAX_RATE = 0.22;\r\nexport const BOND_TAX_RATE = 0.154;\r\n\r\nexport const CACHE_TTL = {\r\n  BATCH_DATA: 1000 * 60 * 30,\r\n  STOCKS: 1000 * 60 * 30,\r\n  PORTFOLIO: 1000 * 60 * 30,\r\n  MARKET_STATUS: 1000 * 60 * 120,\r\n};\r\n\r\n// === 배치 데이터 로딩 시스템 ===\r\nexport const batchDataLoader = {\r\n  pendingRequests: new Map(),\r\n\r\n  loadBatchData: async function (classCode, userId, forceRefresh = false) {\r\n    const batchKey = globalCache.generateKey('BATCH', { classCode, userId });\r\n\r\n    if (!forceRefresh) {\r\n      const cached = globalCache.get(batchKey);\r\n      if (cached) {\r\n        console.log('[batchDataLoader] Cache HIT - 캐시된 데이터 사용');\r\n        return cached;\r\n      }\r\n    } else {\r\n      console.log('[batchDataLoader] forceRefresh=true - 캐시 무시하고 서버에서 로드');\r\n      globalCache.invalidate(batchKey);\r\n    }\r\n\r\n    if (this.pendingRequests.has(batchKey)) {\r\n      return await this.pendingRequests.get(batchKey);\r\n    }\r\n\r\n    const batchPromise = this._executeBatchLoad(classCode, userId);\r\n    this.pendingRequests.set(batchKey, batchPromise);\r\n\r\n    try {\r\n      const result = await batchPromise;\r\n      globalCache.set(batchKey, result, 30 * 60 * 1000);\r\n      return result;\r\n    } finally {\r\n      this.pendingRequests.delete(batchKey);\r\n    }\r\n  },\r\n\r\n  _executeBatchLoad: async function (classCode, userId) {\r\n    const [stocks, portfolio] = await Promise.all([\r\n      this._loadStocks(classCode),\r\n      this._loadPortfolio(userId, classCode),\r\n    ]);\r\n\r\n    return {\r\n      stocks: stocks || [],\r\n      portfolio: portfolio || [],\r\n      errors: []\r\n    };\r\n  },\r\n\r\n  _loadStocks: async function (classCode) {\r\n    try {\r\n      try {\r\n        const getSnapshotFn = httpsCallable(functions, 'getStocksSnapshot');\r\n        const result = await getSnapshotFn({});\r\n        if (result.data && Array.isArray(result.data.stocks) && result.data.stocks.length > 0) {\r\n          return result.data.stocks;\r\n        }\r\n      } catch (fnError) {\r\n        console.warn('[batchDataLoader] 스냅샷 함수 호출 실패, 문서/쿼리 폴백 시도:', fnError);\r\n      }\r\n\r\n      try {\r\n        const cacheRef = doc(db, \"Settings\", \"centralStocksCache\");\r\n        const cacheDoc = await getDoc(cacheRef);\r\n        const cacheData = cacheDoc.exists() ? cacheDoc.data() : null;\r\n\r\n        if (cacheData && Array.isArray(cacheData.stocks) && cacheData.stocks.length > 0) {\r\n          return cacheData.stocks;\r\n        }\r\n      } catch (snapshotError) {\r\n        console.warn('[batchDataLoader] 스냅샷 문서 읽기 실패:', snapshotError);\r\n      }\r\n\r\n      const stocksRef = collection(db, \"CentralStocks\");\r\n      const q = query(stocksRef, where(\"isListed\", \"==\", true));\r\n      const querySnapshot = await getDocs(q);\r\n\r\n      return querySnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      }));\r\n    } catch (error) {\r\n      console.error('[batchDataLoader] Stocks load error:', error);\r\n      return [];\r\n    }\r\n  },\r\n\r\n  _loadPortfolio: async function (userId, classCode) {\r\n    try {\r\n      const portfolioRef = collection(db, \"users\", userId, \"portfolio\");\r\n      const q = query(portfolioRef, where(\"classCode\", \"==\", classCode));\r\n      const querySnapshot = await getDocs(q);\r\n\r\n      return querySnapshot.docs.map(doc => {\r\n        const data = doc.data();\r\n        return {\r\n          id: doc.id,\r\n          ...data,\r\n          lastBuyTime: data.lastBuyTime?.toDate ? data.lastBuyTime.toDate() : data.lastBuyTime,\r\n          delistedAt: data.delistedAt?.toDate ? data.delistedAt.toDate() : data.delistedAt,\r\n        };\r\n      });\r\n    } catch (error) {\r\n      console.error('[batchDataLoader] Portfolio load error:', error);\r\n      return [];\r\n    }\r\n  },\r\n};\r\n\r\n// === 시장 상태 함수 ===\r\nexport const getRealtimeMarketState = (stock) => {\r\n  if (!stock?.isRealStock) return null;\r\n  if (stock.realStockData?.marketState) return stock.realStockData.marketState;\r\n  return null;\r\n};\r\n\r\nexport const getMarketStateLabel = (stock) => {\r\n  const state = getRealtimeMarketState(stock);\r\n  if (!state) return null;\r\n  switch (state) {\r\n    case 'REGULAR': return '장중';\r\n    case 'PRE': return '장전';\r\n    case 'POST': return '장후';\r\n    default: return '장마감';\r\n  }\r\n};\r\n\r\n// === 포맷팅 함수 ===\r\nexport const formatCurrency = (amount) => {\r\n  if (typeof amount !== \"number\" || isNaN(amount)) return \"0원\";\r\n  return new Intl.NumberFormat(\"ko-KR\").format(Math.round(amount)) + \"원\";\r\n};\r\n\r\nexport const formatPercent = (percent) => {\r\n  const num = parseFloat(percent);\r\n  if (isNaN(num)) return \"0.00%\";\r\n  return (num >= 0 ? \"+\" : \"\") + num.toFixed(2) + \"%\";\r\n};\r\n\r\nexport const formatTime = (milliseconds) => {\r\n  const seconds = Math.floor(milliseconds / 1000);\r\n  const minutes = Math.floor(seconds / 60);\r\n  const remainingSeconds = seconds % 60;\r\n  return `${minutes}분 ${remainingSeconds}초`;\r\n};\r\n\r\n// === 세금/수수료 계산 ===\r\nexport const calculateStockTax = (profit, productType = PRODUCT_TYPES.STOCK) => {\r\n  if (profit <= 0) return 0;\r\n  if (productType === PRODUCT_TYPES.BOND) {\r\n    return Math.round(profit * BOND_TAX_RATE);\r\n  }\r\n  return Math.round(profit * TAX_RATE);\r\n};\r\n\r\n// === 국고 업데이트 배치 처리 ===\r\nconst treasuryUpdateQueue = new Map();\r\n\r\nexport const updateNationalTreasury = async (amount, type, classCode) => {\r\n  if (amount <= 0 || !classCode) return;\r\n  const key = `${classCode}_${type}`;\r\n  const existing = treasuryUpdateQueue.get(key) || { amount: 0, type, classCode };\r\n  existing.amount += amount;\r\n  treasuryUpdateQueue.set(key, existing);\r\n  setTimeout(() => processTreasuryQueue(), 1000);\r\n};\r\n\r\nexport const processTreasuryQueue = async () => {\r\n  if (treasuryUpdateQueue.size === 0) return;\r\n  const batch = writeBatch(db);\r\n  const updates = Array.from(treasuryUpdateQueue.values());\r\n  treasuryUpdateQueue.clear();\r\n\r\n  for (const { amount, type, classCode } of updates) {\r\n    const treasuryRef = doc(db, \"nationalTreasuries\", classCode);\r\n    const updateData = {\r\n      totalAmount: increment(amount),\r\n      lastUpdated: serverTimestamp(),\r\n    };\r\n    if (type === 'tax') {\r\n      updateData.stockTaxRevenue = increment(amount);\r\n    } else if (type === 'commission') {\r\n      updateData.stockCommissionRevenue = increment(amount);\r\n    }\r\n    batch.update(treasuryRef, updateData, { merge: true });\r\n  }\r\n\r\n  try {\r\n    await batch.commit();\r\n  } catch (error) {\r\n    updates.forEach(update => {\r\n      const key = `${update.classCode}_${update.type}`;\r\n      treasuryUpdateQueue.set(key, update);\r\n    });\r\n  }\r\n};\r\n\r\n// === 시장 지수 계산 ===\r\nexport const calculateMarketIndex = (stocks) => {\r\n  if (!stocks || stocks.length === 0) return 1000;\r\n  const listedStocks = stocks.filter(s => s && s.isListed && s.productType === PRODUCT_TYPES.STOCK);\r\n  if (listedStocks.length === 0) return 1000;\r\n\r\n  const totalMarketCap = listedStocks.reduce((sum, stock) => {\r\n    const shares = 1000;\r\n    return sum + (stock.price * shares);\r\n  }, 0);\r\n\r\n  const baseMarketCap = listedStocks.reduce((sum, stock) => {\r\n    const shares = 1000;\r\n    const basePrice = stock.initialPrice || stock.minListingPrice || stock.price;\r\n    return sum + (basePrice * shares);\r\n  }, 0);\r\n\r\n  if (baseMarketCap === 0) return 1000;\r\n  return Math.round((totalMarketCap / baseMarketCap) * 1000);\r\n};\r\n\r\n// === 보유 잠금 관련 ===\r\nexport const canSellHolding = (holding) => {\r\n  if (!holding.lastBuyTime) return true;\r\n  let lastBuyTimeMs;\r\n  if (holding.lastBuyTime instanceof Date) {\r\n    lastBuyTimeMs = holding.lastBuyTime.getTime();\r\n  } else if (holding.lastBuyTime?.toDate) {\r\n    lastBuyTimeMs = holding.lastBuyTime.toDate().getTime();\r\n  } else if (typeof holding.lastBuyTime === 'number') {\r\n    lastBuyTimeMs = holding.lastBuyTime;\r\n  } else if (typeof holding.lastBuyTime === 'string') {\r\n    lastBuyTimeMs = new Date(holding.lastBuyTime).getTime();\r\n  } else {\r\n    return true;\r\n  }\r\n  const timeSinceBuy = Date.now() - lastBuyTimeMs;\r\n  return timeSinceBuy >= HOLDING_LOCK_PERIOD;\r\n};\r\n\r\nexport const getRemainingLockTime = (holding) => {\r\n  if (!holding.lastBuyTime) return 0;\r\n  let lastBuyTimeMs;\r\n  if (holding.lastBuyTime instanceof Date) {\r\n    lastBuyTimeMs = holding.lastBuyTime.getTime();\r\n  } else if (holding.lastBuyTime?.toDate) {\r\n    lastBuyTimeMs = holding.lastBuyTime.toDate().getTime();\r\n  } else if (typeof holding.lastBuyTime === 'number') {\r\n    lastBuyTimeMs = holding.lastBuyTime;\r\n  } else if (typeof holding.lastBuyTime === 'string') {\r\n    lastBuyTimeMs = new Date(holding.lastBuyTime).getTime();\r\n  } else {\r\n    return 0;\r\n  }\r\n  const now = Date.now();\r\n  const timeSinceBuy = now - lastBuyTimeMs;\r\n  const remaining = HOLDING_LOCK_PERIOD - timeSinceBuy;\r\n  return Math.max(0, remaining);\r\n};\r\n\r\n// === UI 유틸리티 ===\r\nexport const getProductIcon = (productType) => {\r\n  switch (productType) {\r\n    case PRODUCT_TYPES.ETF: return \"\\u{1F4CA}\";\r\n    case PRODUCT_TYPES.BOND: return \"\\u{1F4DC}\";\r\n    default: return \"\\u{1F4C8}\";\r\n  }\r\n};\r\n\r\nexport const getProductBadgeClass = (productType) => {\r\n  switch (productType) {\r\n    case PRODUCT_TYPES.ETF: return \"etf\";\r\n    case PRODUCT_TYPES.BOND: return \"bond\";\r\n    default: return \"stock\";\r\n  }\r\n};\r\n\r\n// === 캐시 관련 ===\r\nexport const invalidateStockCache = (pattern) => {\r\n  if (globalCache && typeof globalCache.invalidatePattern === 'function') {\r\n    globalCache.invalidatePattern(pattern);\r\n  }\r\n};\r\n\r\nexport const clearLocalStorageBatchCache = () => {\r\n  try {\r\n    const keysToDelete = [];\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (key && key.includes('BATCH')) {\r\n        keysToDelete.push(key);\r\n      }\r\n    }\r\n    keysToDelete.forEach(key => {\r\n      localStorage.removeItem(key);\r\n    });\r\n    if (keysToDelete.length > 0) {\r\n      console.log('[캐시] localStorage BATCH 캐시 삭제:', keysToDelete.length, '개');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[캐시] localStorage 정리 오류:', error);\r\n  }\r\n};\r\n","import React, {\n  useState,\n  useEffect,\n  useCallback,\n  useMemo,\n  useRef,\n} from \"react\";\nimport \"./StockExchange.css\";\nimport { formatKoreanCurrency } from '../../utils/numberFormatter';\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { db, functions } from \"../../firebase\";\nimport { applyStockTax } from \"../../utils/taxUtils\";\n// 🔥 자동 상장/폐지: Firebase Functions에서 처리 (10분마다)\nimport { httpsCallable } from \"firebase/functions\";\nimport { usePolling, POLLING_INTERVALS } from \"../../hooks/usePolling\";\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  setDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  orderBy,\n  limit,\n  serverTimestamp,\n  increment,\n  writeBatch,\n  runTransaction,\n  where,\n  collectionGroup,\n} from \"firebase/firestore\";\n\nimport { globalCache, cacheStats } from \"../../services/globalCacheService\";\nimport { logActivity, ACTIVITY_TYPES } from \"../../utils/firestoreHelpers\";\n\n// 서비스 레이어 import\nimport {\n  batchDataLoader,\n  PRODUCT_TYPES,\n  SECTORS,\n  HOLDING_LOCK_PERIOD,\n  COMMISSION_RATE,\n  TAX_RATE,\n  BOND_TAX_RATE,\n  CACHE_TTL,\n  getRealtimeMarketState,\n  getMarketStateLabel,\n  formatCurrency,\n  formatPercent,\n  formatTime,\n  calculateStockTax,\n  updateNationalTreasury,\n  calculateMarketIndex,\n  canSellHolding,\n  getRemainingLockTime,\n  getProductIcon,\n  getProductBadgeClass,\n  invalidateStockCache as invalidateCache,\n  clearLocalStorageBatchCache,\n} from \"./stockExchangeService\";\n\n\n// === 아이콘 컴포넌트들 ===\nconst TrendingUp = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"22,7 13.5,15.5 8.5,10.5 2,17\" /><polyline points=\"16,7 22,7 22,13\" /></svg>\n);\nconst TrendingDown = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"22,17 13.5,8.5 8.5,13.5 2,7\" /><polyline points=\"16,17 22,17 22,11\" /></svg>\n);\nconst Settings = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><circle cx=\"12\" cy=\"12\" r=\"3\" /><path d=\"M12 1v6m0 6v6m11-7h-6m-6 0H1m17.5-3.5L19 10m-2 2l-2.5 2.5M6.5 6.5L9 9m-2 2l-2.5 2.5\" /></svg>\n);\nconst RefreshCw = ({ size = 16, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"23 4 23 10 17 10\"></polyline><polyline points=\"1 20 1 14 7 14\"></polyline><path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L20.49 10\"></path><path d=\"M20.49 15a9 9 0 0 1-14.85 3.36L3.51 14\"></path></svg>\n);\nconst BarChart3 = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><line x1=\"12\" y1=\"20\" x2=\"12\" y2=\"10\" /><line x1=\"18\" y1=\"20\" x2=\"18\" y2=\"4\" /><line x1=\"6\" y1=\"20\" x2=\"6\" y2=\"16\" /></svg>\n);\nconst ChevronDown = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"6 9 12 15 18 9\" /></svg>\n);\nconst ChevronUp = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"18 15 12 9 6 15\" /></svg>\n);\nconst Lock = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" /><path d=\"M7 11V7a5 5 0 0 1 10 0v4\" /></svg>\n);\n\n// === 상수 및 유틸리티 함수 → stockExchangeService.js에서 import됨 ===\n\n// === 개별 실제 주식 추가 컴포넌트 ===\nconst RealStockAdder = React.memo(({ onAddStock }) => {\n  const [showForm, setShowForm] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [formData, setFormData] = useState({ name: '', symbol: '', sector: 'TECH', productType: 'stock' });\n\n  const commonStocks = [\n    { name: '삼성전자', symbol: '005930.KS', type: '한국 주식' },\n    { name: 'SK하이닉스', symbol: '000660.KS', type: '한국 주식' },\n    { name: 'LG에너지솔루션', symbol: '373220.KS', type: '한국 주식' },\n    { name: 'NAVER', symbol: '035420.KS', type: '한국 주식' },\n    { name: '카카오', symbol: '035720.KS', type: '한국 주식' },\n    { name: '현대차', symbol: '005380.KS', type: '한국 주식' },\n    { name: 'Apple', symbol: 'AAPL', type: '미국 주식' },\n    { name: 'Microsoft', symbol: 'MSFT', type: '미국 주식' },\n    { name: 'Google', symbol: 'GOOGL', type: '미국 주식' },\n    { name: 'Tesla', symbol: 'TSLA', type: '미국 주식' },\n    { name: 'NVIDIA', symbol: 'NVDA', type: '미국 주식' },\n    { name: 'Amazon', symbol: 'AMZN', type: '미국 주식' },\n    { name: 'KODEX 200', symbol: '069500.KS', type: '한국 ETF' },\n    { name: 'KODEX 레버리지', symbol: '122630.KS', type: '한국 ETF' },\n    { name: 'TIGER 미국S&P500', symbol: '360750.KS', type: '한국 ETF' },\n    { name: 'SPY', symbol: 'SPY', type: '미국 ETF (S&P500)' },\n    { name: 'QQQ', symbol: 'QQQ', type: '미국 ETF (나스닥100)' },\n    { name: 'TLT', symbol: 'TLT', type: '채권 ETF (미국 장기국채)' },\n    { name: 'GLD', symbol: 'GLD', type: '원자재 ETF (금)' },\n  ];\n\n  const handleQuickAdd = async (stock) => {\n    if (isAdding) return;\n    setIsAdding(true);\n    try {\n      await onAddStock({ name: stock.name, symbol: stock.symbol });\n      alert(`${stock.name} 추가 완료!`);\n    } catch (error) {\n      alert('추가 실패: ' + error.message);\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  const handleCustomAdd = async () => {\n    if (!formData.name || !formData.symbol) {\n      alert('이름과 심볼을 모두 입력해주세요.');\n      return;\n    }\n    if (isAdding) return;\n    setIsAdding(true);\n    try {\n      await onAddStock(formData);\n      alert(`${formData.name} 추가 완료!`);\n      setFormData({ name: '', symbol: '', sector: 'TECH', productType: 'stock' });\n      setShowForm(false);\n    } catch (error) {\n      alert('추가 실패: ' + error.message);\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: '10px' }}>\n      <button onClick={() => setShowForm(!showForm)} className=\"btn btn-secondary\" style={{ width: '100%', marginBottom: '10px' }}>\n        {showForm ? '접기' : '➕ 개별 주식/ETF 추가'}\n      </button>\n      {showForm && (\n        <div style={{ background: 'rgba(20, 20, 35, 0.8)', padding: '12px', borderRadius: '8px', border: '1px solid rgba(255, 255, 255, 0.1)' }}>\n          <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '10px' }}>\n            📌 빠른 추가 (클릭하면 바로 추가됩니다)\n          </p>\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', marginBottom: '15px' }}>\n            {commonStocks.map(stock => (\n              <button\n                key={stock.symbol}\n                onClick={() => handleQuickAdd(stock)}\n                disabled={isAdding}\n                style={{\n                  padding: '4px 8px',\n                  fontSize: '0.75rem',\n                  background: stock.type.includes('ETF') ? 'rgba(59, 130, 246, 0.2)' : stock.type.includes('채권') ? 'rgba(245, 158, 11, 0.2)' : stock.type.includes('원자재') ? 'rgba(236, 72, 153, 0.2)' : 'rgba(16, 185, 129, 0.2)',\n                  border: stock.type.includes('ETF') ? '1px solid rgba(59, 130, 246, 0.3)' : stock.type.includes('채권') ? '1px solid rgba(245, 158, 11, 0.3)' : stock.type.includes('원자재') ? '1px solid rgba(236, 72, 153, 0.3)' : '1px solid rgba(16, 185, 129, 0.3)',\n                  color: 'white',\n                  borderRadius: '4px',\n                  cursor: 'pointer',\n                  whiteSpace: 'nowrap'\n                }}\n                title={`${stock.type} - ${stock.symbol}`}\n              >\n                {stock.name}\n              </button>\n            ))}\n          </div>\n          <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '8px' }}>\n            ✏️ 직접 입력 (Yahoo Finance 심볼 사용)\n          </p>\n          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>\n            <input\n              type=\"text\"\n              placeholder=\"이름 (예: 삼성전자)\"\n              value={formData.name}\n              onChange={e => setFormData(p => ({ ...p, name: e.target.value }))}\n              style={{ flex: 1, minWidth: '120px', padding: '8px', borderRadius: '4px', border: '1px solid rgba(255, 255, 255, 0.2)', background: 'rgba(0,0,0,0.3)', color: 'white' }}\n            />\n            <input\n              type=\"text\"\n              placeholder=\"심볼 (예: 005930.KS)\"\n              value={formData.symbol}\n              onChange={e => setFormData(p => ({ ...p, symbol: e.target.value }))}\n              style={{ flex: 1, minWidth: '120px', padding: '8px', borderRadius: '4px', border: '1px solid rgba(255, 255, 255, 0.2)', background: 'rgba(0,0,0,0.3)', color: 'white' }}\n            />\n            <button onClick={handleCustomAdd} disabled={isAdding} className=\"btn btn-success\" style={{ padding: '8px 16px' }}>\n              {isAdding ? '추가 중...' : '추가'}\n            </button>\n          </div>\n          <p style={{ fontSize: '0.75rem', color: '#9ca3af', marginTop: '8px' }}>\n            💡 한국 주식: 종목코드.KS (예: 005930.KS) | 미국 주식: 티커 (예: AAPL, TSLA)\n          </p>\n        </div>\n      )}\n    </div>\n  );\n});\n\n// === 관리자 패널 컴포넌트 ===\nconst AdminPanel = React.memo(({ stocks, classCode, onClose, onAddStock, onDeleteStock, onEditStock, onToggleManualStock, cacheStats, onManualUpdate, onCreateRealStocks, onUpdateRealStocks, onAddSingleRealStock, onDeleteSimulationStocks }) => {\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [isCreatingRealStocks, setIsCreatingRealStocks] = useState(false);\n  const [isUpdatingRealStocks, setIsUpdatingRealStocks] = useState(false);\n  const [isDeletingSimulation, setIsDeletingSimulation] = useState(false);\n  const [newStock, setNewStock] = useState({\n    name: \"\",\n    price: \"\",\n    minListingPrice: \"\",\n    isManual: false,\n    sector: \"TECH\",\n    productType: PRODUCT_TYPES.STOCK,\n    maturityYears: \"\",\n    couponRate: \"\"\n  });\n\n  const handleManualUpdate = async () => {\n    if (isUpdating) return;\n    setIsUpdating(true);\n    try {\n      await onManualUpdate();\n      alert(\"주식 가격 업데이트 완료!\");\n    } catch (error) {\n      alert(\"업데이트 실패: \" + error.message);\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleCreateRealStocks = async () => {\n    if (!window.confirm(\"실제 주식 데이터(삼성전자, 애플 등)를 생성하시겠습니까?\\n(Yahoo Finance에서 실시간 가격을 가져옵니다)\")) {\n      return;\n    }\n    if (isCreatingRealStocks) return;\n    setIsCreatingRealStocks(true);\n    try {\n      await onCreateRealStocks();\n      alert(\"실제 주식이 생성되었습니다! 15분마다 자동으로 가격이 업데이트됩니다.\");\n    } catch (error) {\n      alert(\"실제 주식 생성 실패: \" + error.message);\n    } finally {\n      setIsCreatingRealStocks(false);\n    }\n  };\n\n  const handleUpdateRealStocks = async () => {\n    if (isUpdatingRealStocks) return;\n    setIsUpdatingRealStocks(true);\n    try {\n      await onUpdateRealStocks();\n      alert(\"실제 주식 가격이 업데이트되었습니다!\");\n    } catch (error) {\n      alert(\"실제 주식 업데이트 실패: \" + error.message);\n    } finally {\n      setIsUpdatingRealStocks(false);\n    }\n  };\n\n  const handleDeleteSimulationStocks = async () => {\n    if (!window.confirm(\"⚠️ 모든 시뮬레이션 주식을 삭제하시겠습니까?\\n\\n이 작업은 되돌릴 수 없습니다.\\n(실제 주식은 유지됩니다)\")) {\n      return;\n    }\n    if (isDeletingSimulation) return;\n    setIsDeletingSimulation(true);\n    try {\n      await onDeleteSimulationStocks();\n      alert(\"시뮬레이션 주식이 삭제되었습니다!\");\n    } catch (error) {\n      alert(\"삭제 실패: \" + error.message);\n    } finally {\n      setIsDeletingSimulation(false);\n    }\n  };\n\n  const handleAddStock = async () => {\n    if (!newStock.name || !newStock.price || !newStock.minListingPrice) return alert(\"모든 필드를 입력해주세요.\");\n    const price = parseFloat(newStock.price);\n    const minPrice = parseFloat(newStock.minListingPrice);\n    if (price <= 0 || minPrice <= 0) return alert(\"가격은 0보다 커야 합니다.\");\n\n    const stockData = {\n      name: newStock.name,\n      price,\n      minListingPrice: minPrice,\n      isListed: true,\n      isManual: newStock.isManual,\n      sector: newStock.sector,\n      productType: newStock.productType,\n      buyVolume: 0,\n      sellVolume: 0,\n      recentBuyVolume: 0,\n      recentSellVolume: 0,\n      volatility: newStock.productType === PRODUCT_TYPES.BOND ? 0.005 : 0.02\n    };\n\n    if (newStock.productType === PRODUCT_TYPES.BOND) {\n      stockData.maturityYears = parseFloat(newStock.maturityYears) || 10;\n      stockData.couponRate = parseFloat(newStock.couponRate) || 3.5;\n      stockData.sector = \"GOVERNMENT\";\n    }\n\n    if (newStock.productType === PRODUCT_TYPES.ETF) {\n      stockData.sector = \"INDEX\";\n    }\n\n    await onAddStock(stockData);\n    setNewStock({ name: \"\", price: \"\", minListingPrice: \"\", isManual: false, sector: \"TECH\", productType: PRODUCT_TYPES.STOCK, maturityYears: \"\", couponRate: \"\" });\n    setShowAddForm(false);\n  };\n\n  return (\n    <div className=\"admin-panel-fullscreen\">\n      <div className=\"admin-header\">\n        <h2><Settings size={24} /> 관리자 패널 ({classCode})</h2>\n        <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n          <div style={{ fontSize: '0.85rem', color: '#666' }}>\n            캐시 통계: 적중 {cacheStats.hits}, 누락 {cacheStats.misses}, 절약 {cacheStats.savings}회\n          </div>\n          <button onClick={onClose} className=\"btn btn-danger\">닫기</button>\n        </div>\n      </div>\n      <div className=\"admin-content\">\n        <div className=\"admin-section\">\n          <h3>📊 실제 주식 관리 (Yahoo Finance)</h3>\n          <div style={{ marginBottom: '20px', padding: '15px', background: 'rgba(16, 185, 129, 0.1)', borderRadius: '8px', border: '1px solid rgba(16, 185, 129, 0.3)' }}>\n            <p style={{ marginBottom: '10px', color: '#34d399', fontSize: '0.9rem' }}>\n              🌐 실제 주식 데이터를 Yahoo Finance에서 가져옵니다.<br />\n              📈 삼성전자, SK하이닉스, 애플, 테슬라, ETF, 채권 ETF 등 지원<br />\n              ⏰ 15분마다 자동으로 가격이 업데이트됩니다. | 💱 환율: 하루 1회 자동 업데이트\n            </p>\n            <div style={{ display: 'flex', gap: '10px', marginBottom: '10px' }}>\n              <button\n                onClick={handleCreateRealStocks}\n                disabled={isCreatingRealStocks}\n                className=\"btn btn-success\"\n                style={{ flex: 1, padding: '12px', fontSize: '0.9rem', fontWeight: 'bold' }}\n              >\n                {isCreatingRealStocks ? '⏳ 생성 중...' : '🏢 기본 주식 생성'}\n              </button>\n              <button\n                onClick={handleUpdateRealStocks}\n                disabled={isUpdatingRealStocks}\n                className=\"btn btn-primary\"\n                style={{ flex: 1, padding: '12px', fontSize: '0.9rem', fontWeight: 'bold' }}\n              >\n                {isUpdatingRealStocks ? '⏳ 업데이트 중...' : '🔄 가격 즉시 업데이트'}\n              </button>\n            </div>\n            <RealStockAdder onAddStock={onAddSingleRealStock} />\n            <div style={{ marginTop: '10px', paddingTop: '10px', borderTop: '1px solid rgba(255,255,255,0.1)' }}>\n              <button\n                onClick={handleDeleteSimulationStocks}\n                disabled={isDeletingSimulation}\n                className=\"btn btn-danger\"\n                style={{ width: '100%', padding: '10px', fontSize: '0.85rem' }}\n              >\n                {isDeletingSimulation ? '⏳ 삭제 중...' : '🗑️ 시뮬레이션 주식 전체 삭제'}\n              </button>\n              <p style={{ fontSize: '0.75rem', color: '#9ca3af', marginTop: '5px', textAlign: 'center' }}>\n                ⚠️ 실제 주식(실시간)만 남기고 가상 주식을 모두 삭제합니다\n              </p>\n            </div>\n          </div>\n        </div>\n        <div className=\"admin-section\">\n          <h3><BarChart3 size={20} /> 상품 목록 관리</h3>\n          <div className=\"admin-stock-list\">\n            {stocks.map(stock => (\n              <div key={stock.id} className=\"admin-stock-item\">\n                <div className=\"admin-stock-info\">\n                  <span className=\"stock-name\">\n                    {getProductIcon(stock.productType)} {stock.name}\n                    {stock.isRealStock && <span style={{ marginLeft: '6px', background: '#10b981', color: 'white', fontSize: '0.65rem', padding: '1px 4px', borderRadius: '3px', fontWeight: 'bold' }}>실시간</span>}\n                  </span>\n                  <span className=\"stock-details\">\n                    {formatCurrency(stock.price)} | {SECTORS[stock.sector]?.name || '기타'} | {stock.isListed ? '상장' : '상장폐지'} | {stock.isManual ? '수동' : stock.isRealStock ? '실시간' : '자동'}\n                    {stock.productType === PRODUCT_TYPES.BOND && ` | 만기: ${stock.maturityYears}년 | 이자율: ${stock.couponRate}%`}\n                  </span>\n                </div>\n                <div className=\"form-actions\">\n                  <button onClick={() => onEditStock(stock.id)} className=\"btn btn-primary\">가격 수정</button>\n                  <button onClick={() => onToggleManualStock(stock.id, stock.isListed)} className={`btn ${stock.isListed ? 'btn-secondary' : 'btn-success'}`}>{stock.isListed ? '상장폐지' : '재상장'}</button>\n                  <button onClick={() => onDeleteStock(stock.id, stock.name)} className=\"btn btn-danger\">삭제</button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div className=\"admin-section\">\n          <h3>새 상품 추가</h3>\n          <button onClick={() => setShowAddForm(!showAddForm)} className=\"btn btn-primary\">{showAddForm ? '취소' : '새 상품 추가 양식 열기'}</button>\n          {showAddForm && (\n            <div className=\"add-stock-form\">\n              <div className=\"form-grid\">\n                <div className=\"form-group\">\n                  <label className=\"form-label\">상품 유형</label>\n                  <select value={newStock.productType} onChange={e => setNewStock(p => ({ ...p, productType: e.target.value }))} className=\"form-input\">\n                    <option value={PRODUCT_TYPES.STOCK}>주식</option>\n                    <option value={PRODUCT_TYPES.ETF}>ETF/지수</option>\n                    <option value={PRODUCT_TYPES.BOND}>채권</option>\n                  </select>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">상품명</label>\n                  <input type=\"text\" value={newStock.name} onChange={e => setNewStock(p => ({ ...p, name: e.target.value }))} className=\"form-input\"\n                    placeholder={newStock.productType === PRODUCT_TYPES.BOND ? \"예: 국고채 10년\" : newStock.productType === PRODUCT_TYPES.ETF ? \"예: KOSPI 200\" : \"예: 삼성전자\"} />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">초기 가격</label>\n                  <input type=\"number\" value={newStock.price} onChange={e => setNewStock(p => ({ ...p, price: e.target.value }))} className=\"form-input\" />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">최소 상장가</label>\n                  <input type=\"number\" value={newStock.minListingPrice} onChange={e => setNewStock(p => ({ ...p, minListingPrice: e.target.value }))} className=\"form-input\" />\n                </div>\n                {newStock.productType === PRODUCT_TYPES.STOCK && (\n                  <div className=\"form-group\">\n                    <label className=\"form-label\">섹터</label>\n                    <select value={newStock.sector} onChange={e => setNewStock(p => ({ ...p, sector: e.target.value }))} className=\"form-input\">\n                      {Object.entries(SECTORS).filter(([key]) => !['INDEX', 'GOVERNMENT', 'CORPORATE'].includes(key)).map(([key, value]) => (\n                        <option key={key} value={key}>{value.name}</option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                {newStock.productType === PRODUCT_TYPES.BOND && (\n                  <>\n                    <div className=\"form-group\">\n                      <label className=\"form-label\">만기 (년)</label>\n                      <input type=\"number\" value={newStock.maturityYears} onChange={e => setNewStock(p => ({ ...p, maturityYears: e.target.value }))} className=\"form-input\" placeholder=\"예: 10\" />\n                    </div>\n                    <div className=\"form-group\">\n                      <label className=\"form-label\">표면이자율 (%)</label>\n                      <input type=\"number\" step=\"0.1\" value={newStock.couponRate} onChange={e => setNewStock(p => ({ ...p, couponRate: e.target.value }))} className=\"form-input\" placeholder=\"예: 3.5\" />\n                    </div>\n                  </>\n                )}\n                <div className=\"form-group checkbox-group\">\n                  <input type=\"checkbox\" checked={newStock.isManual} onChange={e => setNewStock(p => ({ ...p, isManual: e.target.checked }))} id=\"isManualCheckbox\" className=\"checkbox-input\" />\n                  <label htmlFor=\"isManualCheckbox\">수동 관리 (자동 가격 변동 제외)</label>\n                </div>\n              </div>\n              <div className=\"form-actions\">\n                <button onClick={handleAddStock} className=\"btn btn-success\">상품 추가</button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n});\n\n// === 메인 컴포넌트 ===\nconst StockExchange = () => {\n  const { user, userDoc, isAdmin, loading: authLoading, firebaseReady, functions, optimisticUpdate, refreshUserDocument } = useAuth();\n\n  const [classCode, setClassCode] = useState(null);\n  const [stocks, setStocks] = useState([]);\n  const [portfolio, setPortfolio] = useState([]);\n  const [showAdminPanel, setShowAdminPanel] = useState(false);\n  const [buyQuantities, setBuyQuantities] = useState({});\n  const [sellQuantities, setSellQuantities] = useState({});\n  const [isTrading, setIsTrading] = useState(false);\n  const [lockTimers, setLockTimers] = useState({});\n  const [activeTab, setActiveTab] = useState(\"stocks\");\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [isFetching, setIsFetching] = useState(false);\n  const [marketOpen, setMarketOpen] = useState(false);\n\n  // 🔥 방학 모드 상태 (슈퍼관리자 전용)\n  const [vacationMode, setVacationMode] = useState(false);\n  const [vacationLoading, setVacationLoading] = useState(false);\n\n  // 성능 최적화를 위한 상태 추가\n  const [cacheStatus, setCacheStatus] = useState({ hits: 0, misses: 0, savings: 0 });\n  const [lastBatchLoad, setLastBatchLoad] = useState(null);\n\n  const lastFetchTimeRef = useRef({\n    stocks: 0,\n    portfolio: 0,\n    marketStatus: 0,\n    batchLoad: 0\n  });\n\n  // 🔥 fetching 상태를 ref로 관리 (무한 루프 방지)\n  const isFetchingRef = useRef(false);\n\n  // 시장 개장 상태를 1분마다 확인하여 marketOpen 상태를 안정적으로 업데이트 (자동 폴링 시작 버그 수정)\n  useEffect(() => {\n    const checkMarketStatus = () => {\n      const now = new Date();\n\n      // 한국 시장 시간 체크 (09:00 ~ 15:30 KST)\n      const koreaTime = new Date(now.toLocaleString(\"en-US\", { timeZone: \"Asia/Seoul\" }));\n      const kstDay = koreaTime.getDay();\n      const kstHour = koreaTime.getHours();\n      const kstMinute = koreaTime.getMinutes();\n      const kstTotalMinutes = kstHour * 60 + kstMinute;\n      const isKoreaWeekday = kstDay >= 1 && kstDay <= 5;\n      const isKoreaMarketOpen = isKoreaWeekday && kstTotalMinutes >= 9 * 60 && kstTotalMinutes < 15 * 60 + 30;\n\n      // 미국 시장 시간 체크 (09:30 ~ 16:00 EST/EDT)\n      const usTime = new Date(now.toLocaleString(\"en-US\", { timeZone: \"America/New_York\" }));\n      const usDay = usTime.getDay();\n      const usHour = usTime.getHours();\n      const usMinute = usTime.getMinutes();\n      const usTotalMinutes = usHour * 60 + usMinute;\n      const isUsWeekday = usDay >= 1 && usDay <= 5;\n      const isUsMarketOpen = isUsWeekday && usTotalMinutes >= 9 * 60 + 30 && usTotalMinutes < 16 * 60;\n\n      // 한국 또는 미국 시장 중 하나라도 열려있으면 true\n      setMarketOpen(isKoreaMarketOpen || isUsMarketOpen);\n    };\n\n    checkMarketStatus(); // 초기 로드 시 즉시 확인\n    const interval = setInterval(checkMarketStatus, 60000); // 1분마다 확인\n\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    if (userDoc?.classCode) {\n      setClassCode(userDoc.classCode);\n    }\n  }, [userDoc]);\n\n  // 🔥 매도 제한 타이머: 1초마다 업데이트 (portfolio를 ref로 참조)\n  const portfolioRef = useRef(portfolio);\n\n  useEffect(() => {\n    portfolioRef.current = portfolio;\n  }, [portfolio]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setLockTimers(prevTimers => {\n        const newTimers = {};\n        portfolioRef.current.forEach(holding => {\n          const remaining = getRemainingLockTime(holding);\n          if (remaining > 0) {\n            newTimers[holding.id] = remaining;\n          }\n        });\n        return newTimers;\n      });\n\n      // 캐시 통계 업데이트\n      setCacheStatus({\n        hits: cacheStats.hits,\n        misses: cacheStats.misses,\n        savings: cacheStats.savings\n      });\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []); // 빈 의존성 배열 - portfolioRef를 통해 최신 portfolio 참조\n\n  // 🔥 portfolio가 변경되면 즉시 타이머 재계산\n  useEffect(() => {\n    const newTimers = {};\n    portfolio.forEach(holding => {\n      const remaining = getRemainingLockTime(holding);\n      if (remaining > 0) {\n        newTimers[holding.id] = remaining;\n      }\n    });\n    setLockTimers(newTimers);\n  }, [portfolio]);\n\n  // === 최적화된 데이터 가져오기 함수 (배치 처리 사용) ===\n  const fetchAllData = useCallback(async (forceRefresh = false) => { // forceRefresh 기본값을 false로 되돌려 캐시 활성화\n    if (!user) return;\n    if (!classCode) return; // classCode가 없으면 데이터 로드하지 않음\n\n    if (isFetchingRef.current && !forceRefresh) {\n      console.log('[StockExchange] 이미 fetching 중이므로 대기');\n      return;\n    }\n\n    const now = Date.now();\n\n    // usePolling이 간격을 제어하므로, 시간 기반 캐시 체크 로직은 제거하거나 수정할 수 있지만,\n    // 수동 새로고침 시에도 동작해야 하므로 유지.\n    const timeSinceLastBatch = now - lastFetchTimeRef.current.batchLoad;\n    if (!forceRefresh && timeSinceLastBatch <= CACHE_TTL.BATCH_DATA) {\n      return;\n    }\n\n    isFetchingRef.current = true;\n    setIsFetching(true);\n\n    try {\n      // usePolling에서 호출 시 항상 최신 데이터를 가져오도록 forceRefresh를 true로 전달\n      const batchResult = await batchDataLoader.loadBatchData(classCode, user.uid, forceRefresh);\n\n      if (batchResult.errors && batchResult.errors.length > 0) {\n        console.warn('[StockExchange] 배치 로드 중 일부 오류 발생:', batchResult.errors);\n      }\n\n      setStocks(batchResult.stocks || []);\n      setPortfolio(batchResult.portfolio || []);\n\n      lastFetchTimeRef.current.batchLoad = now;\n      lastFetchTimeRef.current.stocks = now;\n      lastFetchTimeRef.current.portfolio = now;\n      lastFetchTimeRef.current.marketStatus = now;\n\n      setLastBatchLoad(new Date());\n      setLastUpdated(new Date());\n\n    } catch (error) {\n      console.error('[StockExchange] 배치 로드 실패:', error);\n      // Polling 중에는 alert을 띄우지 않는 것이 사용자 경험에 좋음\n      // alert('데이터를 불러오는 중 오류가 발생했습니다.');\n    } finally {\n      isFetchingRef.current = false;\n      setIsFetching(false);\n    }\n  }, [classCode, user, isAdmin]);\n\n  // === 데이터 자동 갱신 (Polling) ===\n  // 🔥 [최적화] 폴링 간격을 60분으로 완화 - 거래 시 forceRefresh로 즉시 갱신되므로 자동 갱신은 최소화\n  usePolling(fetchAllData, {\n    interval: 60 * 60 * 1000, // 🔥 [최적화] 60분마다 포트폴리오 갱신 (Firestore 읽기 최소화)\n    enabled: firebaseReady && !!user && !!classCode,\n    deps: [user, classCode, isAdmin]\n  });\n\n  // 🔥 [최적화] onSnapshot 리스너 제거 - 읽기 비용 절감\n  // 대신 10분마다 fetchAllData가 최신 데이터를 가져옴\n  // 사용자가 필요시 수동 새로고침 가능\n\n  // 🔥 FCM 푸시 알림 제거됨 (이유: 알림 스팸, 읽기 증가, 사용자 경험 악화)\n  // 대신 30분 캐시 + 시간당 1회 자동 폴링으로 부드러운 업데이트 제공\n\n  // === 자동 상장/폐지 관리는 Firebase Functions에서 처리 ===\n  // 10분마다 서버에서 자동으로 실행됨 (autoManageStocks 함수)\n  // 클라이언트에서는 별도 스케줄러 불필요\n\n  // === 시장 지수 계산 ===\n  // 시장 상태 시뮬레이션 비활성화\n\n  // 🔥 방학 모드 상태 조회 (슈퍼관리자 전용)\n  const fetchVacationMode = useCallback(async () => {\n    if (!userDoc?.isSuperAdmin) return;\n    try {\n      const getVacationModeStatusFn = httpsCallable(functions, 'getVacationModeStatus');\n      const result = await getVacationModeStatusFn({});\n      setVacationMode(result.data.vacationMode);\n    } catch (error) {\n      console.error('[fetchVacationMode] 조회 실패:', error);\n    }\n  }, [functions, userDoc?.isSuperAdmin]);\n\n  // 🔥 방학 모드 초기 로드\n  useEffect(() => {\n    if (userDoc?.isSuperAdmin && functions) {\n      fetchVacationMode();\n    }\n  }, [userDoc?.isSuperAdmin, functions, fetchVacationMode]);\n\n  // 🔥 방학 모드 토글 (슈퍼관리자 전용)\n  const toggleVacationMode = useCallback(async () => {\n    if (!userDoc?.isSuperAdmin) return;\n    setVacationLoading(true);\n    try {\n      const toggleVacationModeFn = httpsCallable(functions, 'toggleVacationMode');\n      const result = await toggleVacationModeFn({ enabled: !vacationMode });\n      setVacationMode(result.data.vacationMode);\n      alert(result.data.message);\n    } catch (error) {\n      console.error('[toggleVacationMode] 토글 실패:', error);\n      alert('방학 모드 설정 실패: ' + error.message);\n    } finally {\n      setVacationLoading(false);\n    }\n  }, [functions, userDoc?.isSuperAdmin, vacationMode]);\n\n  // 중앙 주식 스냅샷 문서 강제 갱신 (관리자 작업 후 읽기 최적화 유지)\n  const refreshStocksSnapshot = useCallback(async () => {\n    try {\n      const updateSnapshotFn = httpsCallable(functions, 'updateStocksSnapshot');\n      await updateSnapshotFn({});\n      console.log('[updateStocksSnapshot] 스냅샷 갱신 완료');\n    } catch (error) {\n      console.error('[updateStocksSnapshot] 스냅샷 갱신 실패:', error);\n    }\n  }, [functions]);\n\n  // === 거래 함수들 (최적화된 캐시 무효화) ===\n  const addStock = useCallback(async (stockData) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    try {\n      // 관리자 권한으로 Cloud Function 먼저 시도 (Rules 우회)\n      const addStockFn = httpsCallable(functions, 'addStockDoc');\n      await addStockFn({ stock: stockData });\n\n      await refreshStocksSnapshot();\n\n      // 캐시 무효화\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      alert(`${stockData.name} 상품이 추가되었습니다.`);\n    } catch (error) {\n      console.error('[addStock] 함수 추가 실패, Firestore 직접 시도:', error);\n      try {\n        const stockRef = doc(collection(db, \"CentralStocks\"));\n        await setDoc(stockRef, {\n          ...stockData,\n          initialPrice: stockData.price,\n          priceHistory: [stockData.price],\n          createdAt: serverTimestamp(),\n          holderCount: 0,\n          tradingVolume: 1000,\n          buyVolume: 0,\n          sellVolume: 0,\n          recentBuyVolume: 0,\n          recentSellVolume: 0,\n          volatility: stockData.volatility || 0.02\n        });\n\n        await refreshStocksSnapshot();\n\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        await fetchAllData(true);\n\n        alert(`${stockData.name} 상품이 추가되었습니다.`);\n      } catch (innerError) {\n        console.error('[addStock] Firestore 직접 추가 실패:', innerError);\n        alert(\"상품 추가 중 오류가 발생했습니다. 관리자 권한/Rules를 확인해주세요.\");\n      }\n    }\n  }, [classCode, user, fetchAllData, refreshStocksSnapshot, functions]);\n\n  const deleteStock = useCallback(async (stockId, stockName) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    if (window.confirm(`'${stockName}' 상품을 정말로 삭제하시겠습니까?`)) {\n      try {\n        await deleteDoc(doc(db, \"CentralStocks\", stockId));\n\n        await refreshStocksSnapshot();\n\n        // 캐시 무효화\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        await fetchAllData(true);\n\n        alert(`${stockName} 상품이 삭제되었습니다.`);\n      } catch (error) {\n        alert(\"상품 삭제 중 오류가 발생했습니다.\");\n      }\n    }\n  }, [classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const editStock = useCallback(async (stockId) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!stock) return;\n    const newPriceStr = prompt(`'${stock.name}'의 새로운 가격:`, stock.price.toString());\n    const newPrice = parseFloat(newPriceStr);\n    if (isNaN(newPrice) || newPrice <= 0) return alert(\"유효한 가격을 입력해주세요.\");\n    try {\n      await updateDoc(doc(db, \"CentralStocks\", stockId), {\n        price: newPrice,\n        priceHistory: [...(stock.priceHistory || []).slice(-19), newPrice]\n      });\n\n      await refreshStocksSnapshot();\n\n      // 캐시 무효화\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      alert('가격이 수정되었습니다.');\n    } catch (error) {\n      alert(\"가격 수정 중 오류가 발생했습니다.\");\n    }\n  }, [stocks, classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const toggleManualStock = useCallback(async (stockId, currentIsListed) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!stock) return;\n    const action = currentIsListed ? '상장폐지' : '재상장';\n\n    if (window.confirm(`'${stock.name}' 상품을 ${action}하시겠습니까?`)) {\n      try {\n        const updateData = currentIsListed\n          ? { isListed: false, price: 0, delistedAt: serverTimestamp() }\n          : { isListed: true, price: stock.minListingPrice, priceHistory: [stock.minListingPrice], delistedAt: null };\n\n        await updateDoc(doc(db, \"CentralStocks\", stockId), updateData);\n\n        if (currentIsListed) {\n          const batch = writeBatch(db);\n\n          const portfoliosToDelistQuery = query(\n            collectionGroup(db, 'portfolio'),\n            where('classCode', '==', classCode),\n            where('stockId', '==', stockId)\n          );\n\n          const snapshot = await getDocs(portfoliosToDelistQuery);\n\n          snapshot.forEach(doc => {\n            batch.update(doc.ref, { delistedAt: serverTimestamp() });\n          });\n\n          await batch.commit();\n        }\n\n        await refreshStocksSnapshot();\n\n        // 캐시 무효화\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        invalidateCache(`PORTFOLIO`);\n        await fetchAllData(true);\n\n        alert(`${action} 처리되었습니다.`);\n      } catch (error) {\n        alert(`${action} 처리 중 오류가 발생했습니다.`);\n      }\n    }\n  }, [stocks, classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const buyStock = useCallback(async (stockId, quantityString) => {\n    if (!marketOpen) return alert(\"주식시장이 마감되었습니다. 운영 시간: 월-금 오전 8시-오후 3시\");\n    if (isTrading || !classCode) return;\n    const quantity = parseInt(quantityString, 10);\n    if (isNaN(quantity) || quantity <= 0) return alert(\"유효한 수량을 입력해주세요.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!user || !stock || !stock.isListed) return alert(\"매수할 수 없는 상태입니다.\");\n\n    const cost = stock.price * quantity;\n    const commission = Math.round(cost * COMMISSION_RATE);\n    const taxRate = 0.01; // 기본 거래세율 1%\n    const taxAmount = Math.floor(cost * taxRate);\n    const totalCost = cost + commission + taxAmount;\n\n    console.log('[buyStock] 매수 시작:', { stockId, stockName: stock.name, quantity, totalCost });\n\n    // 🔥 즉시 UI 업데이트 (낙관적 업데이트)\n    if (optimisticUpdate) {\n      optimisticUpdate({ cash: -totalCost });\n    }\n\n    setIsTrading(true);\n    try {\n      // Cloud Function 호출\n      const buyStockFunction = httpsCallable(functions, 'buyStock');\n      const result = await buyStockFunction({ stockId, quantity });\n\n      console.log('[buyStock] 매수 성공:', result.data);\n\n      // 🔥 [수정] 서버에서 받은 정확한 잔액으로 낙관적 업데이트 보정\n      if (result.data.newBalance !== undefined && optimisticUpdate) {\n        const currentCash = userDoc?.cash || 0;\n        const cashDiff = result.data.newBalance - currentCash;\n        optimisticUpdate({ cash: cashDiff });\n        console.log('[buyStock] 현금 정확한 값으로 업데이트:', result.data.newBalance);\n      }\n\n      // 🔥 [최적화] 캐시 무효화 (통합)\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`PORTFOLIO_user_${user.uid}`);\n      clearLocalStorageBatchCache();\n\n      // 🔥 [최적화] 포트폴리오만 로컬에서 업데이트 - 전체 fetchAllData 호출 제거\n      // 서버에서 반환된 데이터로 포트폴리오 상태 직접 업데이트\n      setPortfolio(prev => {\n        const existingIndex = prev.findIndex(h => h.stockId === stockId);\n        if (existingIndex >= 0) {\n          const existing = prev[existingIndex];\n          const newQuantity = existing.quantity + quantity;\n          const newAvgPrice = ((existing.averagePrice * existing.quantity) + (stock.price * quantity)) / newQuantity;\n          return [\n            ...prev.slice(0, existingIndex),\n            { ...existing, quantity: newQuantity, averagePrice: newAvgPrice, lastBuyTime: new Date() },\n            ...prev.slice(existingIndex + 1)\n          ];\n        } else {\n          return [...prev, {\n            id: `temp_${Date.now()}`,\n            stockId,\n            stockName: stock.name,\n            quantity,\n            averagePrice: stock.price,\n            classCode,\n            lastBuyTime: new Date()\n          }];\n        }\n      });\n\n      setBuyQuantities(prev => ({ ...prev, [stockId]: \"\" }));\n\n      // 🔥 활동 로그 기록 (주식 매수)\n      logActivity(db, {\n        classCode,\n        userId: user.uid,\n        userName: userDoc?.name || user.displayName || '사용자',\n        type: ACTIVITY_TYPES.STOCK_BUY,\n        description: `${stock.name} ${quantity}주 매수 (${formatCurrency(totalCost)})`,\n        amount: -totalCost,\n        metadata: {\n          stockId,\n          stockName: stock.name,\n          quantity,\n          pricePerShare: stock.price,\n          commission,\n          taxAmount,\n          totalCost\n        }\n      });\n\n      alert(`${stock.name} ${quantity}주 매수 완료!\\n수수료: ${formatCurrency(commission)}`);\n    } catch (error) {\n      console.error('[buyStock] 매수 실패:', error);\n\n      // 실패 시 롤백 (낙관적 업데이트 취소)\n      if (optimisticUpdate) {\n        optimisticUpdate({ cash: totalCost });\n      }\n\n      alert(error.message || '매수 처리 중 오류가 발생했습니다.');\n    } finally {\n      setIsTrading(false);\n    }\n  }, [stocks, user, isTrading, classCode, marketOpen, functions, fetchAllData, invalidateCache, optimisticUpdate, refreshUserDocument]);\n\n  const sellStock = useCallback(async (holdingId, quantityString) => {\n    if (!marketOpen) return alert(\"주식시장이 마감되었습니다. 운영 시간: 월-금 오전 8시-오후 3시\");\n    if (isTrading) return;\n    const quantity = parseInt(quantityString, 10);\n    if (isNaN(quantity) || quantity <= 0) return alert(\"유효한 수량을 입력해주세요.\");\n    const holding = portfolio.find(h => h.id === holdingId);\n    if (!user || !userDoc || !holding || quantity > holding.quantity) return alert(\"매도할 수 없는 상태입니다.\");\n    if (holding.delistedAt) return alert(\"상장폐지된 상품은 매도할 수 없습니다.\");\n\n    if (!canSellHolding(holding)) {\n      const remaining = getRemainingLockTime(holding);\n      return alert(`매수 후 1시간 동안은 매도할 수 없습니다.\\n남은 시간: ${formatTime(remaining)}`);\n    }\n\n    const stock = stocks.find(s => s.id === holding.stockId);\n    if (!stock || !stock.isListed) return alert(\"현재 거래할 수 없는 상품입니다.\");\n\n    // 예상 수익 계산 (낙관적 업데이트용)\n    const sellPrice = stock.price * quantity;\n    const commission = Math.round(sellPrice * COMMISSION_RATE);\n    const profit = (stock.price - holding.averagePrice) * quantity;\n    const profitTax = profit > 0 ? Math.floor(profit * 0.22) : 0;\n    const transactionTax = Math.floor(sellPrice * 0.01);\n    const totalTax = profitTax + transactionTax;\n    const estimatedNetRevenue = sellPrice - commission - totalTax;\n\n    console.log('[sellStock] 매도 시작:', { holdingId, stockName: stock.name, quantity, estimatedNetRevenue });\n\n    // 🔥 즉시 UI 업데이트 (낙관적 업데이트)\n    if (optimisticUpdate) {\n      optimisticUpdate({ cash: estimatedNetRevenue });\n    }\n\n    setIsTrading(true);\n\n    try {\n      const sellStockFunction = httpsCallable(functions, 'sellStock');\n      const result = await sellStockFunction({ holdingId, quantity });\n\n      console.log('[sellStock] 매도 성공:', result.data);\n\n      // 🔥 [수정] 서버에서 받은 정확한 잔액으로 낙관적 업데이트 보정\n      if (result.data.newBalance !== undefined && optimisticUpdate) {\n        const currentCash = userDoc?.cash || 0;\n        const cashDiff = result.data.newBalance - currentCash;\n        optimisticUpdate({ cash: cashDiff });\n        console.log('[sellStock] 현금 정확한 값으로 업데이트:', result.data.newBalance);\n      }\n\n      // 🔥 [최적화] 캐시 무효화 (통합)\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`PORTFOLIO_user_${user.uid}`);\n      clearLocalStorageBatchCache();\n\n      // 🔥 [최적화] 포트폴리오 로컬 업데이트 - fetchAllData 호출 제거\n      setPortfolio(prev => {\n        const existingIndex = prev.findIndex(h => h.id === holdingId);\n        if (existingIndex >= 0) {\n          const existing = prev[existingIndex];\n          const newQuantity = existing.quantity - quantity;\n          if (newQuantity <= 0) {\n            // 전량 매도 시 포트폴리오에서 제거\n            return [...prev.slice(0, existingIndex), ...prev.slice(existingIndex + 1)];\n          } else {\n            return [\n              ...prev.slice(0, existingIndex),\n              { ...existing, quantity: newQuantity },\n              ...prev.slice(existingIndex + 1)\n            ];\n          }\n        }\n        return prev;\n      });\n\n      setSellQuantities(prev => ({ ...prev, [holdingId]: \"\" }));\n\n      const { stockName, sellPrice: actualSellPrice, commission: actualCommission, totalTax: actualTax, profit: actualProfit, netRevenue } = result.data;\n\n      // 🔥 활동 로그 기록 (주식 매도)\n      logActivity(db, {\n        classCode,\n        userId: user.uid,\n        userName: userDoc?.name || user.displayName || '사용자',\n        type: ACTIVITY_TYPES.STOCK_SELL,\n        description: `${stockName} ${quantity}주 매도 (순수익: ${formatCurrency(netRevenue)})`,\n        amount: netRevenue,\n        metadata: {\n          holdingId,\n          stockName,\n          quantity,\n          sellPrice: actualSellPrice,\n          commission: actualCommission,\n          tax: actualTax,\n          profit: actualProfit,\n          netRevenue\n        }\n      });\n\n      const taxInfo = actualTax > 0 ? `\\n세금: ${formatCurrency(actualTax)}` : '';\n      alert(`${stockName} ${quantity}주 매도 완료!\\n수익: ${formatCurrency(actualProfit)}${taxInfo}\\n수수료: ${formatCurrency(actualCommission)}\\n순수익: ${formatCurrency(netRevenue)}`);\n    } catch (error) {\n      console.error('[sellStock] 매도 실패:', error);\n\n      // 실패 시 롤백 (낙관적 업데이트 취소)\n      if (optimisticUpdate) {\n        optimisticUpdate({ cash: -estimatedNetRevenue });\n      }\n\n      alert(error.message || '매도 처리 중 오류가 발생했습니다.');\n    } finally {\n      setIsTrading(false);\n    }\n  }, [stocks, portfolio, user, userDoc, isTrading, classCode, marketOpen, fetchAllData, functions, optimisticUpdate, refreshUserDocument]);\n\n  const deleteHolding = useCallback(async (holdingId) => {\n    if (!user || !classCode) return;\n    if (window.confirm(\"이 상품(휴지조각)을 포트폴리오에서 삭제하시겠습니까?\")) {\n      try {\n        await deleteDoc(doc(db, \"users\", user.uid, \"portfolio\", holdingId));\n\n        // 캐시 무효화\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`PORTFOLIO_user_${user.uid}`);\n        await fetchAllData(true);\n\n        alert(\"삭제되었습니다.\");\n      } catch (error) {\n        alert(\"삭제 중 오류가 발생했습니다.\");\n      }\n    }\n  }, [user, classCode, fetchAllData]);\n\n  // 🔥 수동으로 주식 시장 업데이트 (관리자 전용)\n  const manualUpdateStockMarket = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      console.log('[manualUpdateStockMarket] 수동 업데이트 시작');\n      const manualUpdateFunction = httpsCallable(functions, 'manualUpdateStockMarket');\n      const result = await manualUpdateFunction({});\n\n      console.log('[manualUpdateStockMarket] 업데이트 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[manualUpdateStockMarket] 업데이트 실패:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // 🔥 실제 주식 생성 (관리자 전용)\n  const createRealStocks = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      console.log('[createRealStocks] 실제 주식 생성 시작');\n      const createRealStocksFunction = httpsCallable(functions, 'createRealStocks');\n      const result = await createRealStocksFunction({});\n\n      console.log('[createRealStocks] 생성 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[createRealStocks] 생성 실패:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // 🔥 실제 주식 가격 수동 업데이트 (관리자 전용)\n  const updateRealStocks = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      console.log('[updateRealStocks] 실제 주식 업데이트 시작');\n      const updateRealStocksFunction = httpsCallable(functions, 'updateRealStocks');\n      const result = await updateRealStocksFunction({});\n\n      console.log('[updateRealStocks] 업데이트 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[updateRealStocks] 업데이트 실패:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // 🔥 개별 실제 주식 추가 (관리자 전용)\n  const addSingleRealStock = useCallback(async ({ name, symbol, sector, productType }) => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      console.log('[addSingleRealStock] 개별 실제 주식 추가 시작:', name);\n      const addSingleRealStockFunction = httpsCallable(functions, 'addSingleRealStock');\n      const result = await addSingleRealStockFunction({ name, symbol, sector, productType });\n\n      console.log('[addSingleRealStock] 추가 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[addSingleRealStock] 추가 실패:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // 🔥 시뮬레이션 주식 전체 삭제 (관리자 전용)\n  const deleteSimulationStocks = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      console.log('[deleteSimulationStocks] 시뮬레이션 주식 삭제 시작');\n      const deleteSimulationStocksFunction = httpsCallable(functions, 'deleteSimulationStocks');\n      const result = await deleteSimulationStocksFunction({});\n\n      console.log('[deleteSimulationStocks] 삭제 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[deleteSimulationStocks] 삭제 실패:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // === stocks 데이터를 Map으로 변환하여 조회 성능 향상 ===\n  const stocksMap = useMemo(() => {\n    const map = new Map();\n    stocks.forEach(stock => map.set(stock.id, stock));\n    return map;\n  }, [stocks]);\n\n  // === 계산된 값들 ===\n  const portfolioStats = useMemo(() => {\n    let totalValue = 0, totalInvested = 0;\n    portfolio.forEach(holding => {\n      const investedValue = holding.averagePrice * holding.quantity;\n      totalInvested += investedValue;\n      if (!holding.delistedAt) {\n        const stock = stocksMap.get(holding.stockId);\n        if (stock && stock.isListed) totalValue += stock.price * holding.quantity;\n      }\n    });\n    const totalProfit = totalValue - totalInvested;\n    const profitPercent = totalInvested > 0 ? (totalProfit / totalInvested) * 100 : 0;\n    return { totalValue, totalInvested, totalProfit, profitPercent };\n  }, [portfolio, stocksMap]);\n\n  const categoryCounts = useMemo(() => {\n    const counts = { stocks: 0, etfs: 0, bonds: 0 };\n    stocks.forEach(s => {\n      if (!s.isListed) return;\n      if (s.productType === PRODUCT_TYPES.ETF) {\n        counts.etfs++;\n      } else if (s.productType === PRODUCT_TYPES.BOND) {\n        counts.bonds++;\n      } else {\n        counts.stocks++;\n      }\n    });\n    return counts;\n  }, [stocks]);\n\n  const filteredStocks = useMemo(() => {\n    return stocks.filter(s => {\n      if (!s.isListed) return false;\n      if (activeTab === \"stocks\") return s.productType === PRODUCT_TYPES.STOCK || !s.productType;\n      if (activeTab === \"etfs\") return s.productType === PRODUCT_TYPES.ETF;\n      if (activeTab === \"bonds\") return s.productType === PRODUCT_TYPES.BOND;\n      return false;\n    });\n  }, [stocks, activeTab]);\n\n  const [showAllStocks, setShowAllStocks] = useState(false);\n\n  const displayedStocks = useMemo(() => {\n    return showAllStocks ? filteredStocks : filteredStocks.slice(0, 20);\n  }, [filteredStocks, showAllStocks]);\n\n  // === 수동 새로고침 함수 ===\n  const handleManualRefresh = useCallback(() => {\n    if (!classCode || !user) return;\n    // 캐시 강제 삭제\n    const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n    globalCache.invalidate(batchKey);\n    fetchAllData(true);\n  }, [fetchAllData, classCode, user]);\n\n  if (authLoading || !firebaseReady) return <div className=\"loading-message\">데이터를 불러오는 중입니다...</div>;\n  if (!user || !userDoc) return <div className=\"loading-message\">로그인이 필요합니다.</div>;\n\n  // 학생 사용자가 학급에 배정되지 않은 경우 안내 메시지 표시\n  if (!isAdmin() && (!classCode || classCode === '미지정')) {\n    return (\n      <div className=\"stock-exchange-container\">\n        <header className=\"stock-header\">\n          <div className=\"stock-header-content\">\n            <div className=\"logo-title\">\n              <BarChart3 size={32} color=\"white\" /><h1>투자 거래소</h1>\n            </div>\n          </div>\n        </header>\n        <main className=\"market-section\" style={{ justifyContent: 'center', alignItems: 'center', display: 'flex' }}>\n          <div style={{ textAlign: 'center', padding: '20px', background: '#fff', borderRadius: '8px', boxShadow: '0 2px 10px rgba(0,0,0,0.1)' }}>\n            <h2>학급 미배정 안내</h2>\n            <p style={{ marginTop: '10px', fontSize: '1rem', color: '#333' }}>\n              소속된 학급이 없어 주식 시장을 이용할 수 없습니다.\n            </p>\n            <p style={{ marginTop: '5px', fontSize: '0.9rem', color: '#666' }}>\n              담당 선생님께 문의하여 학급에 등록해주세요.\n            </p>\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  if (!classCode && !authLoading) return <div className=\"loading-message\">참여 중인 클래스 정보를 불러오는 중...</div>;\n  if (showAdminPanel && isAdmin()) return <AdminPanel stocks={stocks} classCode={classCode} onClose={() => setShowAdminPanel(false)} onAddStock={addStock} onDeleteStock={deleteStock} onEditStock={editStock} onToggleManualStock={toggleManualStock} cacheStats={cacheStatus} onManualUpdate={manualUpdateStockMarket} onCreateRealStocks={createRealStocks} onUpdateRealStocks={updateRealStocks} onAddSingleRealStock={addSingleRealStock} onDeleteSimulationStocks={deleteSimulationStocks} />;\n\n  return (\n    <div className=\"stock-exchange-container\">\n      <header className=\"stock-header\">\n        <div className=\"stock-header-content\">\n          <div className=\"logo-title\">\n            <BarChart3 size={32} color=\"white\" /><h1>투자 거래소 ({classCode})</h1>\n          </div>\n          <div className={`market-status ${marketOpen ? 'open' : 'closed'}`}>\n            {marketOpen ? '● 개장' : '○ 마감'}\n          </div>\n          <div className=\"stock-header-actions\">\n            <div className=\"user-info-display\">{formatCurrency(userDoc.cash)}</div>\n            {isAdmin() && <button onClick={() => setShowAdminPanel(true)} className=\"btn btn-primary\"><Settings size={16} /> 관리</button>}\n            {/* 🔥 방학 모드 토글 버튼 (슈퍼관리자 전용) */}\n            {userDoc?.isSuperAdmin && (\n              <button\n                onClick={toggleVacationMode}\n                disabled={vacationLoading}\n                className={`btn ${vacationMode ? \"btn-warning\" : \"btn-secondary\"}`}\n                style={{ marginLeft: '8px' }}\n                title={vacationMode ? '방학 모드 ON - 스케줄러 중지됨' : '방학 모드 OFF - 스케줄러 작동 중'}\n              >\n                {vacationLoading ? '...' : vacationMode ? '🏖️ 방학모드 ON' : '📅 방학모드 OFF'}\n              </button>\n            )}\n          </div>\n        </div>\n      </header>\n      <main className=\"market-section\">\n        <section className=\"asset-summary\">\n          <div className=\"asset-cards\">\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>투자 평가액</h3><p className=\"value\">{formatCurrency(portfolioStats.totalValue)}</p></div><div className=\"asset-card-icon blue\">📊</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>총 자산</h3><p className=\"value\">{formatCurrency(userDoc.cash + portfolioStats.totalValue)}</p></div><div className=\"asset-card-icon purple\">💎</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>평가손익</h3><p className={`value ${portfolioStats.totalProfit >= 0 ? 'profit-positive' : 'profit-negative'}`}>{formatCurrency(portfolioStats.totalProfit)}</p></div><div className={`asset-card-icon ${portfolioStats.totalProfit >= 0 ? 'red' : 'blue'}`}>{portfolioStats.totalProfit >= 0 ? <TrendingUp size={24} color=\"white\" /> : <TrendingDown size={24} color=\"white\" />}</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>수익률</h3><p className={`value ${portfolioStats.profitPercent >= 0 ? 'profit-positive' : 'profit-negative'}`}>{formatPercent(portfolioStats.profitPercent)}</p></div><div className={`asset-card-icon ${portfolioStats.profitPercent >= 0 ? 'red' : 'blue'}`}>{portfolioStats.profitPercent >= 0 ? <TrendingUp size={24} color=\"white\" /> : <TrendingDown size={24} color=\"white\" />}</div></div></div>\n          </div>\n\n          {/* 성능 통계 표시 (관리자 전용) */}\n          {isAdmin() && (\n            <div style={{\n              marginTop: '10px',\n              padding: '8px 12px',\n              background: '#f0f9ff',\n              borderRadius: '6px',\n              fontSize: '0.8rem',\n              color: '#0369a1',\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center'\n            }}>\n              <div>\n                🚀 성능 최적화 상태: 캐시 적중 {cacheStatus.hits}회, 누락 {cacheStatus.misses}회\n                (절약률: {cacheStatus.hits + cacheStatus.misses > 0 ? Math.round((cacheStatus.hits / (cacheStatus.hits + cacheStatus.misses)) * 100) : 0}%)\n              </div>\n              {lastBatchLoad && (\n                <div>마지막 배치로드: {lastBatchLoad.toLocaleTimeString()}</div>\n              )}\n            </div>\n          )}\n        </section>\n\n        <section className=\"market-list-section\">\n          <div className=\"section-header\">\n            <h2 className=\"section-title\">📈 투자 시장</h2>\n            <div className=\"update-indicator\">\n              <button onClick={handleManualRefresh} disabled={isFetching} className=\"btn btn-secondary\" style={{ padding: '4px 8px', fontSize: '0.75rem' }}>\n                <RefreshCw size={12} />\n                {isFetching ? '갱신중...' : '새로고침'}\n              </button>\n              {lastUpdated && <span style={{ fontSize: '0.75rem', color: '#6b7280' }}>마지막 갱신: {lastUpdated.toLocaleTimeString()}</span>}\n            </div>\n          </div>\n\n          <div className=\"market-tabs\">\n            <button onClick={() => setActiveTab(\"stocks\")} className={`tab-button ${activeTab === \"stocks\" ? \"active\" : \"\"}`}>주식 ({categoryCounts.stocks})</button>\n            <button onClick={() => setActiveTab(\"etfs\")} className={`tab-button ${activeTab === \"etfs\" ? \"active\" : \"\"}`}>ETF/지수 ({categoryCounts.etfs})</button>\n            <button onClick={() => setActiveTab(\"bonds\")} className={`tab-button ${activeTab === \"bonds\" ? \"active\" : \"\"}`}>채권 ({categoryCounts.bonds})</button>\n          </div>\n\n          <div className=\"market-grid\">\n            {displayedStocks.map(stock => {\n              const priceHistory = stock.priceHistory || [stock.price];\n              const priceChange = priceHistory.length >= 2 ? ((priceHistory.slice(-1)[0] - priceHistory.slice(-2)[0]) / priceHistory.slice(-2)[0]) * 100 : 0;\n              const isRealStock = stock.isRealStock === true;\n              return (\n                <div key={stock.id} className={`stock-card ${priceChange > 0 ? 'price-up' : priceChange < 0 ? 'price-down' : ''} ${isRealStock ? 'real-stock' : ''}`}>\n                  <div className=\"stock-card-header\">\n                    <div className=\"stock-info\">\n                      <h3>{getProductIcon(stock.productType)} {stock.name}</h3>\n                      <div className=\"stock-badges\">\n                        {isRealStock && (\n                          <span className=\"stock-badge real\" style={{\n                            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                            color: 'white',\n                            fontWeight: 'bold',\n                            fontSize: '0.7rem',\n                            padding: '2px 6px',\n                            borderRadius: '4px',\n                            marginRight: '4px'\n                          }}>\n                            실시간\n                          </span>\n                        )}\n                        <span className={`stock-badge ${getProductBadgeClass(stock.productType)}`}>\n                          {stock.productType === PRODUCT_TYPES.BOND ? `${stock.maturityYears}년 ${stock.couponRate}%` : SECTORS[stock.sector]?.name || '기타'}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"stock-price-section\">\n                      <div className=\"stock-price\">{formatCurrency(stock.price)}</div>\n                      <div className={`stock-change ${priceChange > 0 ? 'up' : 'down'}`}>\n                        <span>{formatPercent(priceChange)}</span>\n                      </div>\n                      {isRealStock && (\n                        <div style={{ fontSize: '0.7rem', color: '#6b7280', marginTop: '2px' }}>\n                          {getMarketStateLabel(stock) || '장마감'}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"stock-actions\">\n                    <input type=\"number\" min=\"1\" value={buyQuantities[stock.id] || ''} onChange={e => setBuyQuantities(p => ({ ...p, [stock.id]: e.target.value }))} placeholder=\"수량\" className=\"quantity-input\" />\n                    <button onClick={() => buyStock(stock.id, buyQuantities[stock.id])} disabled={!buyQuantities[stock.id] || isTrading || !marketOpen} className=\"trade-button buy\">매수</button>\n                  </div>\n                  <div className=\"cost-display\">\n                    {buyQuantities[stock.id] && `예상 비용: ${formatCurrency(stock.price * parseInt(buyQuantities[stock.id]) * (1 + COMMISSION_RATE))}`}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n          {filteredStocks.length > 20 && (\n            <div className=\"load-more-container\">\n              <button onClick={() => setShowAllStocks(!showAllStocks)} className=\"load-more-button\">\n                {showAllStocks ? \"접기\" : \"더 보기\"}\n              </button>\n            </div>\n          )}\n        </section>\n        <section className=\"portfolio-section\">\n          <div className=\"section-header\">\n            <h2 className=\"section-title\">💼 내 포트폴리오</h2>\n          </div>\n          <div className=\"portfolio-cards\">\n            {portfolio.length === 0 ? <p className=\"no-transactions\">보유한 상품이 없습니다.</p> : portfolio.map(holding => {\n              const stock = stocksMap.get(holding.stockId);\n\n              // 휴지조각 주식 처리 (상장폐지로 가치 0이 된 주식)\n              if (holding.isWorthless) {\n                return (\n                  <div key={holding.id} className=\"portfolio-card delisted\">\n                    <div className=\"portfolio-card-header\">\n                      <div className=\"stock-title-section\">\n                        <h3 className=\"stock-name\">{holding.stockName}</h3>\n                        <span className=\"stock-status delisted\">🗑️ 휴지조각</span>\n                      </div>\n                      <div className=\"stock-quantity\">{holding.quantity}<span className=\"unit\">주</span></div>\n                    </div>\n                    <div className=\"portfolio-metrics-compact\">\n                      <div className=\"metrics-row\">\n                        <div className=\"metric-item\"><span className=\"metric-label\">현재 가치</span><span className=\"metric-value\" style={{ color: '#ef4444', fontWeight: 'bold' }}>0원</span></div>\n                        <div className=\"metric-item\"><span className=\"metric-label\">손실</span><span className=\"metric-value\" style={{ color: '#ef4444' }}>-100%</span></div>\n                      </div>\n                    </div>\n                    <p style={{ fontSize: '0.85rem', color: '#6b7280', marginTop: '8px' }}>상장폐지된 상품입니다. 10분 후 자동 삭제됩니다.</p>\n                    <div className=\"portfolio-card-actions\">\n                      <button onClick={() => deleteHolding(holding.id)} className=\"action-btn delete-btn\">지금 삭제</button>\n                    </div>\n                  </div>\n                );\n              }\n\n              if (!stock) return null;\n              const currentValue = stock.price * holding.quantity;\n              const investedValue = holding.averagePrice * holding.quantity;\n              const profit = currentValue - investedValue;\n              const profitPercent = investedValue > 0 ? (profit / investedValue) * 100 : 0;\n              const isLocked = !!lockTimers[holding.id];\n              const canSell = !isLocked;\n\n              return (\n                <div key={holding.id} className={`portfolio-card ${profit >= 0 ? 'profit' : 'loss'}`}>\n                  <div className=\"portfolio-card-header\">\n                    <div className=\"stock-title-section\">\n                      <h3 className=\"stock-name\">{getProductIcon(stock.productType)} {holding.stockName}</h3>\n                      {isLocked && (\n                        <span style={{\n                          fontSize: '0.75rem',\n                          padding: '2px 8px',\n                          background: '#fef3c7',\n                          color: '#92400e',\n                          borderRadius: '4px',\n                          fontWeight: 'bold',\n                          display: 'inline-flex',\n                          alignItems: 'center',\n                          gap: '4px'\n                        }}>\n                          <Lock size={12} />\n                          매도 불가\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"stock-quantity\">{holding.quantity}<span className=\"unit\">주</span></div>\n                  </div>\n                  <div className=\"portfolio-metrics-compact\">\n                    <div className=\"metrics-row\">\n                      <div className=\"metric-item\"><span className=\"metric-label\">평균 매수가</span><span className=\"metric-value\">{formatCurrency(holding.averagePrice)}</span></div>\n                      <div className=\"metric-item\"><span className=\"metric-label\">현재가</span><span className=\"metric-value current\">{formatCurrency(stock.price)}</span></div>\n                    </div>\n                  </div>\n                  <div className={`profit-summary ${profit >= 0 ? 'profit' : 'loss'}`}>\n                    <div className=\"profit-amount\">{formatCurrency(profit)}</div>\n                    <div className=\"profit-percent\">{formatPercent(profitPercent)}</div>\n                  </div>\n                  {isLocked && (\n                    <div style={{\n                      padding: '10px 12px',\n                      background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',\n                      borderRadius: '8px',\n                      display: 'flex',\n                      flexDirection: 'column',\n                      gap: '4px',\n                      marginTop: '8px',\n                      border: '1px solid #fbbf24'\n                    }}>\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '8px',\n                        fontSize: '0.9rem',\n                        color: '#92400e',\n                        fontWeight: 'bold'\n                      }}>\n                        <Lock size={16} />\n                        <span>매도 제한 시간</span>\n                      </div>\n                      <div style={{\n                        fontSize: '1.1rem',\n                        color: '#78350f',\n                        fontWeight: 'bold',\n                        textAlign: 'center',\n                        marginTop: '4px',\n                        fontFamily: 'monospace'\n                      }}>\n                        ⏱️ {formatTime(lockTimers[holding.id])} 남음\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"portfolio-card-actions\">\n                    <div className=\"trade-section\">\n                      <div className=\"trade-input-group\">\n                        <input type=\"number\" min=\"1\" max={holding.quantity} value={sellQuantities[holding.id] || ''} onChange={e => setSellQuantities(p => ({ ...p, [holding.id]: e.target.value }))} placeholder=\"매도 수량\" className=\"trade-input\" disabled={!!lockTimers[holding.id] || !marketOpen} />\n                        <button onClick={() => sellStock(holding.id, sellQuantities[holding.id])} disabled={!sellQuantities[holding.id] || isTrading || !!lockTimers[holding.id] || !marketOpen} className=\"action-btn sell-btn\">매도</button>\n                      </div>\n                      {sellQuantities[holding.id] && !lockTimers[holding.id] && (\n                        <div className=\"expected-amount\">\n                          예상 수익: {formatCurrency((stock.price * parseInt(sellQuantities[holding.id])) * (1 - COMMISSION_RATE) - calculateStockTax(Math.max(0, (stock.price - holding.averagePrice) * parseInt(sellQuantities[holding.id])), stock.productType))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </section>\n      </main>\n    </div>\n  );\n};\n\nexport default StockExchange;\n"],"names":["PRODUCT_TYPES","SECTORS","TECH","name","FINANCE","CONSUMER","HEALTHCARE","ENERGY","INDUSTRIAL","MATERIALS","REALESTATE","UTILITIES","COMMUNICATION","ENTERTAINMENT","INDEX","GOVERNMENT","CORPORATE","HOLDING_LOCK_PERIOD","COMMISSION_RATE","CACHE_TTL","batchDataLoader","pendingRequests","Map","loadBatchData","async","classCode","userId","forceRefresh","arguments","length","undefined","batchKey","globalCache","generateKey","console","log","invalidate","cached","get","this","has","batchPromise","_executeBatchLoad","set","result","delete","stocks","portfolio","Promise","all","_loadStocks","_loadPortfolio","errors","getSnapshotFn","httpsCallable","functions","data","Array","isArray","fnError","warn","cacheRef","doc","db","cacheDoc","getDoc","cacheData","exists","snapshotError","stocksRef","collection","q","query","where","getDocs","docs","map","_objectSpread","id","error","portfolioRef","_data$lastBuyTime","_data$delistedAt","lastBuyTime","toDate","delistedAt","getMarketStateLabel","stock","state","_stock$realStockData","isRealStock","realStockData","marketState","getRealtimeMarketState","formatCurrency","amount","isNaN","Intl","NumberFormat","format","Math","round","formatPercent","percent","num","parseFloat","toFixed","formatTime","milliseconds","seconds","floor","minutes","remainingSeconds","concat","calculateStockTax","profit","getRemainingLockTime","holding","_holding$lastBuyTime2","lastBuyTimeMs","Date","getTime","now","remaining","max","getProductIcon","productType","getProductBadgeClass","invalidateStockCache","pattern","invalidatePattern","clearLocalStorageBatchCache","keysToDelete","i","localStorage","key","includes","push","forEach","removeItem","TrendingUp","_ref","size","color","_jsxs","width","height","viewBox","fill","stroke","strokeWidth","children","_jsx","points","TrendingDown","_ref2","Settings","_ref3","cx","cy","r","d","RefreshCw","_ref4","strokeLinecap","strokeLinejoin","BarChart3","_ref5","x1","y1","x2","y2","Lock","_ref8","x","y","rx","ry","RealStockAdder","React","_ref9","onAddStock","showForm","setShowForm","useState","isAdding","setIsAdding","formData","setFormData","symbol","sector","style","marginTop","onClick","className","marginBottom","background","padding","borderRadius","border","fontSize","display","flexWrap","gap","type","alert","message","handleQuickAdd","disabled","cursor","whiteSpace","title","placeholder","value","onChange","e","p","target","flex","minWidth","AdminPanel","_ref0","onClose","onDeleteStock","onEditStock","onToggleManualStock","cacheStats","onManualUpdate","onCreateRealStocks","onUpdateRealStocks","onAddSingleRealStock","onDeleteSimulationStocks","showAddForm","setShowAddForm","isUpdating","setIsUpdating","isCreatingRealStocks","setIsCreatingRealStocks","isUpdatingRealStocks","setIsUpdatingRealStocks","isDeletingSimulation","setIsDeletingSimulation","newStock","setNewStock","price","minListingPrice","isManual","maturityYears","couponRate","alignItems","hits","misses","savings","window","confirm","fontWeight","paddingTop","borderTop","textAlign","_SECTORS$stock$sector","marginLeft","isListed","Object","entries","filter","_ref1","_ref10","_Fragment","step","checked","htmlFor","minPrice","stockData","buyVolume","sellVolume","recentBuyVolume","recentSellVolume","volatility","StockExchange","user","userDoc","isAdmin","loading","authLoading","firebaseReady","optimisticUpdate","refreshUserDocument","useAuth","setClassCode","setStocks","setPortfolio","showAdminPanel","setShowAdminPanel","buyQuantities","setBuyQuantities","sellQuantities","setSellQuantities","isTrading","setIsTrading","lockTimers","setLockTimers","activeTab","setActiveTab","lastUpdated","setLastUpdated","isFetching","setIsFetching","marketOpen","setMarketOpen","vacationMode","setVacationMode","vacationLoading","setVacationLoading","cacheStatus","setCacheStatus","lastBatchLoad","setLastBatchLoad","lastFetchTimeRef","useRef","marketStatus","batchLoad","isFetchingRef","useEffect","checkMarketStatus","koreaTime","toLocaleString","timeZone","kstDay","getDay","kstTotalMinutes","getHours","getMinutes","isKoreaMarketOpen","usTime","usDay","usTotalMinutes","interval","setInterval","clearInterval","current","prevTimers","newTimers","fetchAllData","useCallback","timeSinceLastBatch","batchResult","uid","usePolling","enabled","deps","fetchVacationMode","isSuperAdmin","getVacationModeStatusFn","toggleVacationMode","toggleVacationModeFn","refreshStocksSnapshot","updateSnapshotFn","addStock","addStockFn","invalidateCache","stockRef","setDoc","initialPrice","priceHistory","createdAt","serverTimestamp","holderCount","tradingVolume","innerError","deleteStock","stockId","stockName","deleteDoc","editStock","find","s","newPriceStr","prompt","toString","newPrice","updateDoc","slice","toggleManualStock","currentIsListed","action","updateData","batch","writeBatch","portfoliosToDelistQuery","collectionGroup","update","ref","commit","buyStock","quantityString","quantity","parseInt","cost","commission","taxAmount","totalCost","cash","buyStockFunction","newBalance","currentCash","cashDiff","prev","existingIndex","findIndex","h","existing","newQuantity","newAvgPrice","averagePrice","logActivity","userName","displayName","ACTIVITY_TYPES","STOCK_BUY","description","metadata","pricePerShare","sellStock","holdingId","_holding$lastBuyTime","canSellHolding","sellPrice","estimatedNetRevenue","sellStockFunction","actualSellPrice","actualCommission","totalTax","actualTax","actualProfit","netRevenue","STOCK_SELL","tax","taxInfo","deleteHolding","manualUpdateStockMarket","Error","manualUpdateFunction","createRealStocks","createRealStocksFunction","updateRealStocks","updateRealStocksFunction","addSingleRealStock","_ref11","addSingleRealStockFunction","deleteSimulationStocks","deleteSimulationStocksFunction","stocksMap","useMemo","portfolioStats","totalValue","totalInvested","investedValue","totalProfit","profitPercent","categoryCounts","counts","etfs","bonds","filteredStocks","showAllStocks","setShowAllStocks","displayedStocks","handleManualRefresh","justifyContent","toLocaleTimeString","_SECTORS$stock$sector2","priceChange","marginRight","min","isWorthless","currentValue","isLocked","flexDirection","fontFamily","boxShadow"],"sourceRoot":""}