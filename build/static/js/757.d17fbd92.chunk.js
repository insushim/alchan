"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[757],{6757:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var a=n(4919),s=n(5043),r=n(5016),c=n(577),l=n(791),i=n(9270),o=n(8180),u=n(579);const d={wK:"\u2654",wQ:"\u2655",wR:"\u2656",wB:"\u2657",wN:"\u2658",wP:"\u2659",bK:"\u265a",bQ:"\u265b",bR:"\u265c",bB:"\u265d",bN:"\u265e",bP:"\u265f"},m=[{name:"Unranked",minPoints:0},{name:"C",minPoints:800},{name:"B",minPoints:1e3},{name:"A",minPoints:1200},{name:"S",minPoints:1400},{name:"SS",minPoints:1600}],h=15,w=-10,f=e=>{const t={};return e.forEach((e,n)=>{e.forEach((e,a)=>{e&&(t["".concat(n,"-").concat(a)]=e)})}),t},p=e=>{const t=Array(8).fill(null).map(()=>Array(8).fill(null));for(const n in e){const[a,s]=n.split("-").map(Number);t[a][s]=e[n]}return t},b={P:100,N:320,B:330,R:500,Q:900,K:2e4},v=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],g=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]],y=(e,t,n,a,s,r,c)=>{if(0===t)return((e,t)=>{let n=0;for(let a=0;a<8;a++)for(let s=0;s<8;s++){const r=e[a][s];if(!r)continue;const c=r[0],l=r[1],i=b[l]||0;let o=0;"P"===l?o=v["w"===c?a:7-a][s]:"N"===l&&(o=g[a][s]);const u=i+o;c===t?n+=u:n-=u}return n})(e,r);const l=n?r:"w"===r?"b":"w",i=[];for(let o=0;o<8;o++)for(let t=0;t<8;t++){const n=e[o][t];if(n&&n[0]===l){c(e,o,t,n,!0).forEach(e=>{let[a,s]=e;i.push({from:[o,t],to:[a,s],piece:n})})}}if(0===i.length)return n?-999999:999999;if(n){let n=-1/0;for(const l of i){const i=e.map(e=>[...e]);i[l.to[0]][l.to[1]]=l.piece,i[l.from[0]][l.from[1]]=null;const o=y(i,t-1,!1,a,s,r,c);if(n=Math.max(n,o),s<=(a=Math.max(a,o)))break}return n}{let n=1/0;for(const l of i){const i=e.map(e=>[...e]);i[l.to[0]][l.to[1]]=l.piece,i[l.from[0]][l.from[1]]=null;const o=y(i,t-1,!0,a,s,r,c);if(n=Math.min(n,o),(s=Math.min(s,o))<=a)break}return n}},x=()=>{var e,t,n,b,v;const{user:g,userDoc:x,isAdmin:k}=(0,r.As)(),[j,N]=(0,s.useState)(null),[C,R]=(0,s.useState)(null),[P,S]=(0,s.useState)(!0),[E,M]=(0,s.useState)(""),[A,I]=(0,s.useState)({message:"",type:""}),[H,K]=(0,s.useState)(null),[G,Q]=(0,s.useState)([]),[T,B]=(0,s.useState)([]),[_,D]=(0,s.useState)(600),[L,U]=(0,s.useState)(600),[F,V]=(0,s.useState)(600),[W,q]=(0,s.useState)(null),[J,O]=(0,s.useState)([]),z=(0,s.useRef)(null),X=(0,s.useRef)(null),Y=(0,s.useRef)(null),Z=(0,s.useRef)(0),[$,ee]=(0,s.useState)("player"),[te,ne]=(0,s.useState)("intermediate"),[ae,se]=(0,s.useState)(!1),[re,ce]=(0,s.useState)(!1),[le,ie]=(0,s.useState)(!1),[oe,ue]=(0,s.useState)([]),[de,me]=(0,s.useState)(0),he=C&&g&&(C.aiMode?C.playerColor:C.players.white===g.uid?"w":"b"),we=C&&C.turn===he,{rank:fe,nextRank:pe,pointsForNextRank:be}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=m[0];for(let r=m.length-1;r>=0;r--)if(e>=m[r].minPoints){t=m[r];break}const n=m.findIndex(e=>e.name===t.name)+1,a=n<m.length?m[n]:null,s=a?a.minPoints-e:0;return{rank:t.name,nextRank:null===a||void 0===a?void 0:a.name,pointsForNextRank:s}}(null===x||void 0===x?void 0:x.chessRating),ve=(0,s.useRef)(j);(0,s.useEffect)(()=>{ve.current=j},[j]);const ge=(0,s.useRef)(C);(0,s.useEffect)(()=>{ge.current=C},[C]);const ye=(0,s.useRef)(g);(0,s.useEffect)(()=>{ye.current=g},[g]),(0,s.useEffect)(()=>{const e=()=>{var e;const t=ve.current,n=ge.current,a=ye.current;t&&n&&a&&(null===(e=n.players)||void 0===e?void 0:e.white)===a.uid&&(0,l.kd)((0,l.H9)(l.db,"chessGames",t))};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);const xe=(0,s.useCallback)(async e=>{if(!j)return;const t=(0,l.H9)(l.db,"chessGames",j),n="w"===e?"b":"w";await(0,l.c4)(l.db,async a=>{const s=await a.get(t);if(!s.exists()||"active"!==s.data().status)return;s.data().players["w"===n?"white":"black"],s.data().players["w"===e?"white":"black"];a.update(t,{status:"finished",winner:n,endReason:"timeout",ratingChange:{["w"===n?"white":"black"]:h,["w"===e?"white":"black"]:w}})}),X.current&&await X.current()},[j]);(0,s.useEffect)(()=>(C&&"active"===C.status&&we&&(z.current=setInterval(async()=>{(0,l.H9)(l.db,"chessGames",j);if("w"===C.turn){const e=Math.max(0,L-1);U(e),e<=0&&await xe("w")}else{const e=Math.max(0,F-1);V(e),e<=0&&await xe("b")}},1e3)),()=>clearInterval(z.current)),[C,we,L,F,j,xe]);const ke=(0,s.useCallback)(async()=>{if(g)try{const e=(0,l.P)((0,l.rJ)(l.db,"chessGames"),(0,l._M)("status","==","waiting")),t=await(0,l.GG)(e),n=[];t.forEach(e=>{const t=e.data();t.players.white!==g.uid&&n.push((0,a.A)({id:e.id},t))}),B(n)}catch(e){console.error("Error fetching rooms:",e)}},[g]);(0,s.useEffect)(()=>{if(P&&g){ke();const e=setInterval(ke,6e4);return()=>clearInterval(e)}},[P,g,ke]);const je=(0,s.useCallback)(async()=>{if(!j)return;const e=(0,l.H9)(l.db,"chessGames",j),t=await(0,l.x7)(e);if(t.exists()){const e=t.data(),n=(0,a.A)((0,a.A)({},e),{},{board:p(e.board)});R(n),S(!1),void 0!==e.whiteTime&&U(e.whiteTime),void 0!==e.blackTime&&V(e.blackTime),e.moveHistory&&O(e.moveHistory)}else I({message:"\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"}),N(null),R(null),S(!0)},[j]),{refetch:Ne}=(0,c.nm)(je,{interval:18e4,enabled:!!j});(0,s.useEffect)(()=>{X.current=Ne},[Ne]),(0,s.useEffect)(()=>{(()=>{if(!g)return;const e=(new Date).toDateString(),t="chessPlayCount_".concat(g.uid,"_").concat(e),n=parseInt(localStorage.getItem(t)||"0",10);me(n)})()},[g]),(0,s.useEffect)(()=>{if(A.message){const e=setTimeout(()=>I({message:"",type:""}),3e3);return()=>clearTimeout(e)}},[A.message]);const Ce=(0,s.useCallback)(function(e,t,n,a){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=[],c=a[0],l=a[1],i=(l,i)=>{if(l>=0&&l<8&&i>=0&&i<8){const o=e[l][i];if(!o||o[0]!==c)if(s){const s=e.map(e=>[...e]);s[l][i]=a,s[t][n]=null,Pe(s,c)||r.push([l,i])}else r.push([l,i])}};switch(l){case"P":const a="w"===c?-1:1,r="w"===c?6:1;if(t+a>=0&&t+a<8&&!e[t+a][n]&&(i(t+a,n),t!==r||e[t+2*a][n]||i(t+2*a,n)),[-1,1].forEach(s=>{if(t+a>=0&&t+a<8&&n+s>=0&&n+s<8){const r=e[t+a][n+s];r&&r[0]!==c&&i(t+a,n+s)}}),null!==C&&void 0!==C&&C.enPassant){const[e,s]=C.enPassant;t+a===e&&1===Math.abs(n-s)&&i(e,s)}break;case"N":[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(e=>{let[a,s]=e;i(t+a,n+s)});break;case"B":case"R":case"Q":({B:[[1,1],[1,-1],[-1,1],[-1,-1]],R:[[0,1],[0,-1],[1,0],[-1,0]],Q:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]]})[l].forEach(a=>{let[s,r]=a;for(let l=1;l<8;l++){const a=t+s*l,o=n+r*l;if(!(a>=0&&a<8&&o>=0&&o<8))break;if(e[a][o]){e[a][o][0]!==c&&i(a,o);break}i(a,o)}});break;case"K":if([[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(e=>{let[a,s]=e;i(t+a,n+s)}),s&&null!==C&&void 0!==C&&C.castling){const a="w"===c?7:0;t===a&&4===n&&(!C.castling[c+"K"]||e[a][5]||e[a][6]||e[a][7]!==c+"R"||Re(e,a,4,c)||Re(e,a,5,c)||Re(e,a,6,c)||i(a,6),!C.castling[c+"Q"]||e[a][3]||e[a][2]||e[a][1]||e[a][0]!==c+"R"||Re(e,a,4,c)||Re(e,a,3,c)||Re(e,a,2,c)||i(a,2))}}return r},[C]),Re=(0,s.useCallback)((e,t,n,a)=>{const s="w"===a?"b":"w";for(let r=0;r<8;r++)for(let a=0;a<8;a++){const c=e[r][a];if(c&&c[0]===s){if(Ce(e,r,a,c,!1).some(e=>{let[a,s]=e;return a===t&&s===n}))return!0}}return!1},[Ce]),Pe=(0,s.useCallback)((e,t)=>{let n=null;for(let a=0;a<8;a++){for(let s=0;s<8;s++)if(e[a][s]===t+"K"){n=[a,s];break}if(n)break}return!!n&&Re(e,n[0],n[1],t)},[Re]),Se=(0,s.useCallback)((e,t)=>{for(let n=0;n<8;n++)for(let a=0;a<8;a++){const s=e[n][a];if(s&&s[0]===t){if(Ce(e,n,a,s,!0).length>0)return null}}return Pe(e,t)?"checkmate":"stalemate"},[Ce,Pe]),Ee=async()=>{if(!g)return void I({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});if("ai"===$){const e=(new Date).toDateString(),t="chessPlayCount_".concat(g.uid,"_").concat(e);if(parseInt(localStorage.getItem(t)||"0",10)>=3)return void I({message:"\uc624\ub298\uc758 AI \ub300\uc804 \ud69f\uc218\ub97c \ubaa8\ub450 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. (3/3)",type:"error"})}const e=Math.random().toString(36).substring(2,8),t=(0,l.H9)(l.db,"chessGames",e),n="ai"===$,a=Math.random()>.5?"w":"b",s="w"===a?"b":"w",r={board:f([["bR","bN","bB","bQ","bK","bB","bN","bR"],["bP","bP","bP","bP","bP","bP","bP","bP"],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],["wP","wP","wP","wP","wP","wP","wP","wP"],["wR","wN","wB","wQ","wK","wB","wN","wR"]]),players:n?"w"===a?{white:g.uid,black:"AI"}:{white:"AI",black:g.uid}:{white:g.uid,black:null},playerNames:n?"w"===a?{white:x.name,black:"AI (".concat("beginner"===te?"\ucd08\uae09":"intermediate"===te?"\uc911\uae09":"\uace0\uae09",")")}:{white:"AI (".concat("beginner"===te?"\ucd08\uae09":"intermediate"===te?"\uc911\uae09":"\uace0\uae09",")"),black:x.name}:{white:x.name,black:null},playerRanks:n?"w"===a?{white:fe,black:"AI"}:{white:"AI",black:fe}:{white:fe,black:"Unranked"},playerRatings:n?"w"===a?{white:x.chessRating||0,black:0}:{white:0,black:x.chessRating||0}:{white:x.chessRating||0,black:null},turn:"w",status:n?"active":"waiting",winner:null,timeControl:_,whiteTime:_,blackTime:_,castling:{wK:!0,wQ:!0,bK:!0,bQ:!0},enPassant:null,moveHistory:[],createdAt:(0,l.O5)(),ratingChange:null,aiMode:n,aiDifficulty:n?te:null,aiColor:n?s:null,playerColor:n?a:null};try{await(0,l.BN)(t,r),N(e),I({message:n?"AI \ub300\uc804 \uc2dc\uc791!":"\uccb4\uc2a4 \ubc29 \uc0dd\uc131 \uc644\ub8cc! \ucf54\ub4dc: ".concat(e),type:"success"}),X.current&&await X.current()}catch(c){console.error("Error creating room:",c),I({message:"\ubc29 \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}},Me=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||E.trim();if(!e)return void I({message:"\ucc38\uac00\ud560 \ubc29 \ucf54\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694.",type:"error"});if(!g)return void I({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});const t=(0,l.H9)(l.db,"chessGames",e);try{await(0,l.c4)(l.db,async e=>{const n=await e.get(t);if(!n.exists())throw new Error("\ubc29\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const a=n.data();if(a.players.black)throw new Error("\ubc29\uc774 \uac00\ub4dd \ucc3c\uc2b5\ub2c8\ub2e4.");if(a.players.white===g.uid)throw new Error("\uc790\uc2e0\uc774 \ub9cc\ub4e0 \ubc29\uc5d0\ub294 \ucc38\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");e.update(t,{"players.black":g.uid,"playerNames.black":x.name,"playerRanks.black":fe,"playerRatings.black":x.chessRating||0,status:"active"})}),N(e),X.current&&await X.current()}catch(n){console.error("Error joining room: ",n),I({message:"\ucc38\uac00 \uc2e4\ud328: ".concat(n.message),type:"error"})}},Ae=async(e,t)=>{if(!H||!C)return;const{row:n,col:a,piece:s}=H;"P"!==s[1]||0!==e&&7!==e?await He(n,a,e,t,s):q({toRow:e,toCol:t,fromRow:n,fromCol:a})},Ie=(0,s.useCallback)(async()=>{var e;if(C&&j&&(null===(e=C.players)||void 0===e?void 0:e.white)===(null===g||void 0===g?void 0:g.uid))try{await(0,l.kd)((0,l.H9)(l.db,"chessGames",j))}catch(t){console.error("Error deleting room:",t)}N(null),R(null),S(!0),K(null),Q([])},[C,j,g]),He=(0,s.useCallback)(async function(e,t,n,s,r){let c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!j||re)return;ce(!0);const i=(0,l.H9)(l.db,"chessGames",j);try{const o=await(0,l.c4)(l.db,async l=>{const o=await l.get(i);if(!o.exists())throw new Error("\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const u=o.data();if("active"!==u.status)return{status:u.status,winner:u.winner,aiMode:u.aiMode,moveMade:!1};const d=r[0];if(u.turn!==d)throw new Error("\uc0c1\ub300\ubc29\uc758 \ud134\uc785\ub2c8\ub2e4.");let m=p(u.board).map(e=>[...e]);m[e][t]=null,m[n][s]=c?d+c:r;const b=(0,a.A)({},u.castling);let v=null;if("wK"===r&&(b.wK=!1,b.wQ=!1),"bK"===r&&(b.bK=!1,b.bQ=!1),"wR"===r&&7===e&&0===t&&(b.wQ=!1),"wR"===r&&7===e&&7===t&&(b.wK=!1),"bR"===r&&0===e&&0===t&&(b.bQ=!1),"bR"===r&&0===e&&7===t&&(b.bK=!1),"K"===r[1]&&2===Math.abs(t-s)&&(6===s?(m[e][5]=m[e][7],m[e][7]=null):(m[e][3]=m[e][0],m[e][0]=null)),"P"===r[1]&&u.enPassant){const[t,a]=u.enPassant;n===t&&s===a&&(m[e][s]=null)}"P"===r[1]&&2===Math.abs(e-n)&&(v=[(e+n)/2,t]);const g="abcdefgh",y="".concat("P"!==r[1]?r[1]:"").concat(g[t]).concat(8-e," -> ").concat(g[s]).concat(8-n),x=[...u.moveHistory,y],k="w"===d?"b":"w";let j=u.status,N=null,C=null,R=null;const P=Se(m,k);P&&(j="finished",C=P,N="checkmate"===P?d:"draw"),"finished"===j&&"draw"!==N&&(R={["w"===N?"white":"black"]:h,["w"===N?"black":"white"]:w});const S={board:f(m),turn:k,castling:b,enPassant:v,moveHistory:x,status:j,winner:N,endReason:C,ratingChange:R};return l.update(i,S),{status:j,winner:N,aiMode:u.aiMode,moveMade:!0}});if(o.moveMade&&"finished"===o.status&&o.aiMode){const e=o.winner===he,t="draw"===o.winner;if(e||t&&Math.random()<.5){const e=(()=>{const e=e=>{const t=e.reduce((e,t)=>e+t.weight,0);let n=Math.random()*t;for(const a of e)if(n-=a.weight,n<=0)return a.amount;return e[e.length-1].amount};return[{type:"cash",amount:e([{amount:5e4,weight:5},{amount:3e4,weight:10},{amount:2e4,weight:15},{amount:1e4,weight:20},{amount:5e3,weight:18},{amount:3e3,weight:12},{amount:1e3,weight:10},{amount:500,weight:7},{amount:100,weight:3}])},{type:"coupon",amount:e([{amount:20,weight:10},{amount:10,weight:20},{amount:5,weight:20},{amount:3,weight:20},{amount:1,weight:30}])}]})();ue(e),ie(!0)}else{const e=(new Date).toDateString(),n="chessPlayCount_".concat(g.uid,"_").concat(e),a=de+1;localStorage.setItem(n,a.toString()),me(a),t&&I({message:"\ubb34\uc2b9\ubd80! \uc544\uc27d\uc9c0\ub9cc \ubcf4\uc0c1\uc740 \ub2e4\uc74c \uae30\ud68c\uc5d0!",type:"info"}),setTimeout(()=>Ie(),2e3)}}K(null),Q([]),X.current&&await X.current()}catch(o){console.error("Error making move: ",o),I({message:"\uc774\ub3d9 \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(o.message),type:"error"}),X.current&&await X.current()}finally{ce(!1)}},[j,re,he,de,g,Se,ue,ie,me,I,Ie,K,Q]);(0,s.useEffect)(()=>()=>{Y.current&&(clearTimeout(Y.current),Y.current=null)},[]),(0,s.useEffect)(()=>{(async()=>{var e;if(!C||!j||"active"!==C.status)return;if(!C.aiMode)return;if(ae||re)return;const t=C.aiColor;if(C.turn!==t)return;const n=(null===(e=C.moveHistory)||void 0===e?void 0:e.length)||0;if(n===Z.current&&n>0)return;se(!0),Z.current=n+1;const a=500+1e3*Math.random();Y.current=setTimeout(async()=>{try{const e=(0,l.H9)(l.db,"chessGames",j),n=await(0,l.x7)(e);if(!n.exists())return void se(!1);const a=n.data();if("active"!==a.status||a.turn!==t)return void se(!1);const s=((e,t,n,a)=>{const s=[];for(let i=0;i<8;i++)for(let n=0;n<8;n++){const r=e[i][n];r&&r[0]===t&&a(e,i,n,r,!0).forEach(e=>{let[t,a]=e;s.push({from:[i,n],to:[t,a],piece:r})})}if(0===s.length)return null;if("beginner"===n)return s[Math.floor(Math.random()*s.length)];const r="intermediate"===n?2:3;let c=null,l=-1/0;for(const i of s){const n=e.map(e=>[...e]);n[i.to[0]][i.to[1]]=i.piece,n[i.from[0]][i.from[1]]=null;const s=y(n,r-1,!1,-1/0,1/0,t,a);s>l&&(l=s,c=i)}return c})(p(a.board),t,te,Ce);if(s){const{from:e,to:t,piece:n}=s;await He(e[0],e[1],t[0],t[1],n)}}catch(e){console.error("AI move error:",e),se(!1)}se(!1),Y.current=null},a)})()},[null===C||void 0===C?void 0:C.turn,null===C||void 0===C?void 0:C.status,null===C||void 0===C||null===(e=C.moveHistory)||void 0===e?void 0:e.length,j,te,He,Ce,re]);const Ke=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))};if(P){return(0,u.jsx)("div",{className:"chess-container",children:(0,u.jsxs)("div",{className:"room-creation",children:[(0,u.jsx)("h2",{children:"\u265a \uccb4\uc2a4 \uac8c\uc784 \u2654"}),(0,u.jsx)("p",{children:"\uc804\ub7b5\uc801 \uc0ac\uace0\ub825\uc744 \uae30\ub974\ub294 \ucd5c\uace0\uc758 \ub450\ub1cc \uac8c\uc784!"}),(0,u.jsxs)("div",{className:"user-rank-info",children:[(0,u.jsxs)("p",{children:["\ub0b4 \ub4f1\uae09: ",(0,u.jsx)("strong",{children:fe})," (",(null===x||void 0===x?void 0:x.chessRating)||0,"\uc810)"]}),pe&&(0,u.jsxs)("p",{className:"next-rank-guide",children:["\ub2e4\uc74c \ub4f1\uae09 (",pe,")\uae4c\uc9c0 ",(0,u.jsxs)("strong",{children:[be,"\uc810"]})," \ub0a8\uc558\uc2b5\ub2c8\ub2e4."]})]}),(0,u.jsxs)("div",{className:"game-mode-selector",children:[(0,u.jsx)("h3",{children:"\uac8c\uc784 \ubaa8\ub4dc \uc120\ud0dd"}),(0,u.jsxs)("div",{className:"mode-options",children:[(0,u.jsx)("button",{className:"player"===$?"selected":"",onClick:()=>ee("player"),children:"\ud83d\udc65 \ud50c\ub808\uc774\uc5b4 \ub300\uc804"}),(0,u.jsxs)("button",{className:"ai"===$?"selected":"",onClick:()=>ee("ai"),children:["\ud83e\udd16 AI \ub300\uc804 (",de,"/3)"]})]})]}),"ai"===$&&(0,u.jsxs)("div",{className:"ai-difficulty-selector",children:[(0,u.jsx)("h3",{children:"AI \ub09c\uc774\ub3c4"}),(0,u.jsxs)("div",{className:"difficulty-options",children:[(0,u.jsx)("button",{className:"beginner"===te?"selected":"",onClick:()=>ne("beginner"),children:"\ud83d\ude0a \ucd08\uae09"}),(0,u.jsx)("button",{className:"intermediate"===te?"selected":"",onClick:()=>ne("intermediate"),children:"\ud83e\udd14 \uc911\uae09"}),(0,u.jsx)("button",{className:"advanced"===te?"selected":"",onClick:()=>ne("advanced"),children:"\ud83d\udd25 \uace0\uae09"})]})]}),A.message&&(0,u.jsx)("div",{className:"feedback ".concat(A.type),children:A.message}),(0,u.jsxs)("div",{className:"time-control-selector",children:[(0,u.jsx)("h3",{children:"\uc2dc\uac04 \uc81c\ud55c \uc120\ud0dd"}),(0,u.jsx)("div",{className:"time-options",children:[180,300,600,900].map(e=>(0,u.jsxs)("button",{className:_===e?"selected":"",onClick:()=>D(e),children:[e/60,"\ubd84"]},e))})]}),(0,u.jsxs)("div",{className:"room-actions",children:[(0,u.jsx)("button",{onClick:Ee,className:"create-room-btn",children:"ai"===$?"\ud83e\udd16 AI \ub300\uc804 \uc2dc\uc791":"\uc0c8\ub85c\uc6b4 \ubc29 \ub9cc\ub4e4\uae30"}),"player"===$&&(0,u.jsxs)("div",{className:"join-room",children:[(0,u.jsx)("input",{type:"text",value:E,onChange:e=>M(e.target.value),placeholder:"\ubc29 \ucf54\ub4dc \uc785\ub825",maxLength:"6"}),(0,u.jsx)("button",{onClick:()=>Me(),children:"\ucf54\ub4dc\ub85c \ucc38\uac00"})]})]}),T.length>0&&(0,u.jsxs)("div",{className:"available-rooms",children:[(0,u.jsx)("h3",{children:"\ud83d\udccb \ub300\uae30 \uc911\uc778 \ubc29 \ubaa9\ub85d"}),(0,u.jsx)("div",{className:"rooms-list",children:T.map(e=>{var t,n;return(0,u.jsxs)("div",{className:"room-item",children:[(0,u.jsxs)("div",{className:"room-info",children:[(0,u.jsxs)("span",{className:"room-host",children:["\ud638\uc2a4\ud2b8: ",e.playerNames.white," (",(null===(t=e.playerRanks)||void 0===t?void 0:t.white)||"Unranked",", ",(null===(n=e.playerRatings)||void 0===n?void 0:n.white)||0,"\uc810)"]}),(0,u.jsxs)("span",{className:"room-time",children:["\u23f1 ",Ke(e.timeControl)]}),(0,u.jsxs)("span",{className:"room-code",children:["\ucf54\ub4dc: ",e.id]})]}),(0,u.jsxs)("div",{className:"room-item-buttons",children:[(0,u.jsx)("button",{onClick:()=>Me(e.id),className:"join-btn",children:"\ucc38\uac00"}),(null===k||void 0===k?void 0:k())&&(0,u.jsx)("button",{onClick:()=>(async e=>{if(null!==k&&void 0!==k&&k())try{await(0,l.kd)((0,l.H9)(l.db,"chessGames",e)),I({message:"\ubc29 ".concat(e,"\uac00 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),type:"success"}),ke()}catch(t){console.error("Error deleting room by admin:",t),I({message:"\ubc29 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}else I({message:"\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"})})(e.id),className:"delete-btn",children:"\uc0ad\uc81c"})]})]},e.id)})})]}),(0,u.jsxs)("div",{className:"chess-rules",children:[(0,u.jsx)("h3",{children:"\uccb4\uc2a4 \uae30\ubcf8 \uaddc\uce59"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"\ubc31(White)\uc774 \uba3c\uc800 \uc2dc\uc791\ud569\ub2c8\ub2e4."}),(0,u.jsx)("li",{children:"\uc0c1\ub300\ubc29\uc758 \ud0b9\uc744 \uccb4\ud06c\uba54\uc774\ud2b8\ud558\uba74 \uc2b9\ub9ac\ud569\ub2c8\ub2e4."}),(0,u.jsxs)("li",{children:["\ud50c\ub808\uc774\uc5b4 \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,u.jsx)("strong",{children:"\uc810\uc218(+15)"}),"\uc640 \ucfe0\ud3f0 3\uac1c, \ud328\ubc30 \uc2dc ",(0,u.jsx)("strong",{children:"\uc810\uc218(-10)"})]}),(0,u.jsxs)("li",{children:["AI \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,u.jsx)("strong",{children:"\uce74\ub4dc \ubcf4\uc0c1"})," \uc120\ud0dd (\ud604\uae08 \ub610\ub294 \ucfe0\ud3f0), \ud558\ub8e8 3\ud68c \uc81c\ud55c"]})]})]})]})})}if(!C)return(0,u.jsx)(o.AlchanLoading,{});const Ge=C.players.white,Qe=C.players.black;return(0,u.jsxs)("div",{className:"chess-container",style:{backgroundColor:"#0a0a12",minHeight:"100%",width:"100%"},children:[(0,u.jsxs)("div",{className:"game-info",children:[(0,u.jsxs)("div",{className:"player black ".concat("b"===C.turn?"active":""," ").concat((null===g||void 0===g?void 0:g.uid)===Qe?"my-player":"opponent-player"),children:[(0,u.jsxs)("span",{className:"player-name",children:["\u265b ",C.playerNames.black||"\ub300\uae30\uc911...",(0,u.jsxs)("span",{className:"player-rank",children:["[",(null===(t=C.playerRanks)||void 0===t?void 0:t.black)||"Unranked","] (",(null===(n=C.playerRatings)||void 0===n?void 0:n.black)||0,"\uc810)"]})]}),(0,u.jsx)("span",{className:"player-time",children:Ke(F)})]}),(0,u.jsx)("div",{className:"game-status",children:"finished"===C.status?"draw"===C.winner?(0,u.jsx)("span",{children:"\ubb34\uc2b9\ubd80!"}):C.winner===he?(0,u.jsxs)("span",{className:"winner",children:["\ud83c\udf89 \uc2b9\ub9ac! (",C.ratingChange["w"===he?"white":"black"]>0?"+":"",C.ratingChange["w"===he?"white":"black"],"\uc810) \ucfe0\ud3f0 3\uac1c \ud68d\ub4dd!"]}):(0,u.jsxs)("span",{className:"loser",children:["\ud328\ubc30! (",C.ratingChange["w"===he?"white":"black"],"\uc810)"]}):"waiting"===C.status?(0,u.jsxs)("span",{children:["\uc0c1\ub300\ubc29\uc744 \uae30\ub2e4\ub9ac\ub294 \uc911... (\ucf54\ub4dc: ",j,")"]}):(0,u.jsx)("span",{children:we?"\ub2f9\uc2e0\uc758 \ucc28\ub840":"\uc0c1\ub300\ubc29 \ucc28\ub840"})}),(0,u.jsxs)("div",{className:"player white ".concat("w"===C.turn?"active":""," ").concat((null===g||void 0===g?void 0:g.uid)===Ge?"my-player":"opponent-player"),children:[(0,u.jsxs)("span",{className:"player-name",children:["\u2655 ",C.playerNames.white,(0,u.jsxs)("span",{className:"player-rank",children:["[",(null===(b=C.playerRanks)||void 0===b?void 0:b.white)||"Unranked","] (",(null===(v=C.playerRatings)||void 0===v?void 0:v.white)||0,"\uc810)"]})]}),(0,u.jsx)("span",{className:"player-time",children:Ke(L)})]})]}),(0,u.jsxs)("div",{className:"board-container",children:[(0,u.jsx)("div",{className:"chess-board ".concat("b"===he?"flipped":""),children:C.board.map((e,t)=>e.map((e,n)=>{const a=(null===H||void 0===H?void 0:H.row)===t&&(null===H||void 0===H?void 0:H.col)===n,s=G.some(e=>{let[a,s]=e;return a===t&&s===n}),r=(t+n)%2===0,c=e&&"K"===e[1]&&Pe(C.board,e[0]);return(0,u.jsxs)("div",{className:"square ".concat(r?"light":"dark"," \n                                               ").concat(a?"selected":""," \n                                               ").concat(s?"possible":"","\n                                               ").concat(c?"check":""),onClick:()=>((e,t)=>{if(!we||"active"!==C.status||re)return;const n=C.board[e][t];if(H&&G.some(n=>{let[a,s]=n;return a===e&&s===t}))Ae(e,t);else if(n&&n[0]===he){K({row:e,col:t,piece:n});const a=Ce(C.board,e,t,n);Q(a)}else K(null),Q([])})(t,n),children:[e&&(0,u.jsx)("div",{className:"piece ".concat("w"===e[0]?"white-piece":"black-piece"),children:d[e]}),s&&!e&&(0,u.jsx)("div",{className:"move-dot"}),s&&e&&(0,u.jsx)("div",{className:"capture-hint"})]},"".concat(t,"-").concat(n))}))}),W&&(0,u.jsx)("div",{className:"promotion-modal",children:(0,u.jsxs)("div",{className:"promotion-content",children:[(0,u.jsx)("h3",{children:"\ud504\ub85c\ubaa8\uc158 \uc120\ud0dd"}),(0,u.jsx)("div",{className:"promotion-pieces",children:["Q","R","B","N"].map(e=>(0,u.jsx)("button",{onClick:()=>(async e=>{if(!W)return;const{fromRow:t,fromCol:n,toRow:a,toCol:s}=W,r=C.board[t][n];await He(t,n,a,s,r,e),q(null)})(e),className:"promotion-piece",children:d[he+e]},e))})]})}),ae&&(0,u.jsx)("div",{className:"ai-thinking",children:(0,u.jsxs)("div",{className:"thinking-content",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"AI\uac00 \uc218\ub97c \uace0\ubbfc\ud558\ub294 \uc911..."})]})}),le&&2===oe.length&&(0,u.jsx)("div",{className:"reward-modal",children:(0,u.jsxs)("div",{className:"reward-content",children:[(0,u.jsx)("h3",{children:"\ud83c\udf89 \uc2b9\ub9ac \ubcf4\uc0c1!"}),(0,u.jsx)("p",{children:"\ud558\ub098\uc758 \uce74\ub4dc\ub97c \uc120\ud0dd\ud558\uc138\uc694"}),(0,u.jsx)("div",{className:"reward-cards",children:oe.map((e,t)=>(0,u.jsxs)("div",{className:"reward-card",onClick:()=>(async e=>{if(g&&j)try{const t=(0,l.H9)(l.db,"users",g.uid),n=(new Date).toDateString(),a="chessPlayCount_".concat(g.uid,"_").concat(n);await(0,l.c4)(l.db,async n=>{if(!(await n.get(t)).exists())return;const a={};"cash"===e.type?a.balance=(0,l.GV)(e.amount):"coupon"===e.type&&(a.couponBalance=(0,l.GV)(e.amount)),n.update(t,a)});const s=de+1;localStorage.setItem(a,s.toString()),me(s),ie(!1),I({message:"cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0\uc744 \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c\ub97c \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"),type:"success"}),(0,i.Mx)(l.db,{classCode:null===x||void 0===x?void 0:x.classCode,userId:g.uid,userName:(null===x||void 0===x?void 0:x.name)||"\uc0ac\uc6a9\uc790",type:i.gI.GAME_WIN,description:"\uccb4\uc2a4 AI(".concat(te,") \uc2b9\ub9ac - ").concat("cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c")," \ud68d\ub4dd"),amount:"cash"===e.type?e.amount:0,couponAmount:"coupon"===e.type?e.amount:0,metadata:{gameType:"chess",opponent:"AI",difficulty:te,rewardType:e.type,rewardAmount:e.amount}}),setTimeout(()=>{Ie()},2e3)}catch(t){console.error("Error applying reward:",t),I({message:"\ubcf4\uc0c1 \uc9c0\uae09\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}})(e),children:[(0,u.jsx)("div",{className:"card-icon",children:"cash"===e.type?"\ud83d\udcb5":"\ud83c\udfab"}),(0,u.jsx)("div",{className:"card-title",children:"cash"===e.type?"\ud604\uae08":"\ucfe0\ud3f0"}),(0,u.jsx)("div",{className:"card-amount",children:"cash"===e.type?"".concat(e.amount.toLocaleString(),"\uc6d0"):"".concat(e.amount,"\uac1c")})]},t))})]})})]}),A.message&&(0,u.jsx)("div",{className:"feedback ".concat(A.type),children:A.message}),(0,u.jsx)("div",{className:"game-controls",children:(0,u.jsx)("button",{onClick:Ie,className:"leave-button",children:"\uac8c\uc784 \ub098\uac00\uae30"})}),J.length>0&&(0,u.jsxs)("div",{className:"move-history",children:[(0,u.jsx)("h4",{children:"\uc774\ub3d9 \uae30\ub85d"}),(0,u.jsx)("div",{className:"moves-list",children:J.map((e,t)=>(0,u.jsxs)("span",{className:"move",children:[t%2===0?"".concat(Math.floor(t/2)+1,". "):"",e]},t))})]})]})}}}]);
//# sourceMappingURL=757.d17fbd92.chunk.js.map