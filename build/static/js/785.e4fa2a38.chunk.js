"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[785],{5785(e,t,a){a.r(t),a.d(t,{default:()=>h});var n=a(2555),s=a(5043),l=a(5016),i=a(2864),r=a(2395),d=a(4891),c=a(5452),o=a(5472),m=a(579);const u={totalProperties:30,basePrice:5e7,rentPercentage:1,layoutColumns:6,lastRentCollection:null},h=()=>{var e,t;const{userDoc:a,loading:h,isAdmin:p,refreshUserDocument:v,optimisticUpdate:x,allClassMembers:f}=(0,l.As)(),b=null===a||void 0===a?void 0:a.classCode,[g,N]=(0,s.useState)([]),[j,y]=(0,s.useState)(u),[w,P]=(0,s.useState)([]),[I,A]=(0,s.useState)(!0),[C,k]=(0,s.useState)(!0),[S,E]=(0,s.useState)(!0),[R,F]=(0,s.useState)(!1),[O,D]=(0,s.useState)(!1),[q,H]=(0,s.useState)(null),[G,_]=(0,s.useState)(null),[M,B]=(0,s.useState)((0,n.A)({},u));(0,s.useEffect)(()=>{if(!b)return y(u),B((0,n.A)({},u)),void A(!1);let e=!0;A(!0);const t=(0,i.H9)(i.db,"classes",b,"realEstateSettings","settingsDoc"),a=async()=>{if(e)try{const l=await(0,i.x7)(t);if(!e)return;if(l.exists()){var a;const e=l.data();null!==(a=e.lastRentCollection)&&void 0!==a&&a.toDate&&(e.lastRentCollection=e.lastRentCollection.toDate()),y(e),B({totalProperties:e.totalProperties.toString(),basePrice:e.basePrice.toString(),rentPercentage:e.rentPercentage.toString(),layoutColumns:e.layoutColumns.toString()})}else if(e&&(y(u),B((0,n.A)({},u))),p&&p())try{await(0,i.BN)(t,(0,n.A)((0,n.A)({},u),{},{createdAt:(0,i.O5)(),classCode:b,updatedAt:(0,i.O5)()}))}catch(s){c.vF.warn("[RealEstate] \uae30\ubcf8 \uc124\uc815 \uc0dd\uc131 \uc2e4\ud328 (\uad00\ub9ac\uc790\ub9cc \uac00\ub2a5):",s.message)}e&&A(!1)}catch(s){c.vF.warn("[RealEstate] Settings \uc77d\uae30 \uc2e4\ud328 (\uae30\ubcf8\uac12 \uc0ac\uc6a9):",s.message),e&&(y(u),B((0,n.A)({},u)),A(!1))}};a();const s=setInterval(a,9e5);return()=>{e=!1,clearInterval(s)}},[b]);const J=s.useCallback(async()=>{if(b)try{const e=(0,i.rJ)(i.db,"classes",b,"realEstateProperties"),t=(0,i.P)(e,(0,o.orderBy)("id")),a=(await(0,i.GG)(t)).docs.map(e=>{var t;return(0,n.A)((0,n.A)({firestoreDocId:e.id},e.data()),{},{lastRentPayment:null!==(t=e.data().lastRentPayment)&&void 0!==t&&t.toDate?e.data().lastRentPayment.toDate():null})});a.sort((e,t)=>parseInt(e.id)-parseInt(t.id)),N(a),c.vF.log("[RealEstate] Properties refreshed:",a.length)}catch(e){c.vF.error("[RealEstate] Error refreshing properties:",e)}},[b]);(0,s.useEffect)(()=>{if(!b)return N([]),void k(!1);let e=!0;k(!0);const t=(0,i.rJ)(i.db,"classes",b,"realEstateProperties"),a=(0,i.P)(t,(0,o.orderBy)("id")),s=async()=>{if(e)try{const t=await(0,i.GG)(a);if(!e)return;const s=t.docs.map(e=>{var t;return(0,n.A)((0,n.A)({firestoreDocId:e.id},e.data()),{},{lastRentPayment:null!==(t=e.data().lastRentPayment)&&void 0!==t&&t.toDate?e.data().lastRentPayment.toDate():null})});s.sort((e,t)=>parseInt(e.id)-parseInt(t.id)),e&&(N(s),k(!1))}catch(t){c.vF.error("[RealEstate] Error fetching properties:",t),e&&(N([]),k(!1))}};s();const l=setInterval(s,9e5);return()=>{e=!1,clearInterval(l)}},[b]),(0,s.useEffect)(()=>{if(!b)return P([]),void E(!1);if(f&&f.length>0)P(f),E(!1);else{E(!0);const e=(0,i.P)((0,i.rJ)(i.db,"users"),(0,i._M)("classCode","==",b));(0,i.GG)(e).then(e=>{P(e.docs.map(e=>(0,n.A)({id:e.id},e.data())))}).catch(e=>{c.vF.error("[RealEstate] Error fetching users by classCode:",e),P([])}).finally(()=>E(!1))}},[b,f]);const W=async e=>{if(!a||!b)return void alert("\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud558\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");const t=g.find(t=>t.id===e);if(!t)return void alert("\ubd80\ub3d9\uc0b0 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const s=t.salePrice||t.price;c.vF.log("[RealEstate] \ubd80\ub3d9\uc0b0 \uad6c\ub9e4 \uc2dc\uc791:",{propertyId:e,purchasePrice:s}),x&&x({cash:-s});(0,n.A)({},t);const l=[...g];N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{owner:a.id,ownerName:a.name,forSale:!1,salePrice:null,tenant:a.name,tenantId:a.id,tenantName:a.name}):(0,n.A)((0,n.A)({},t),{},{tenant:t.tenantId===a.id?null:t.tenant,tenantId:t.tenantId===a.id?null:t.tenantId,tenantName:t.tenantId===a.id?null:t.tenantName}))),D(!0);try{const t=(0,r.Qg)(i.Cn,"purchaseRealEstate"),a=await t({propertyId:e});c.vF.log("[RealEstate] \uad6c\ub9e4 \uc131\uacf5:",a.data),await J(),v&&v(),_(null),H(null),alert("\ubd80\ub3d9\uc0b0 #".concat(e,"\ub97c \uc131\uacf5\uc801\uc73c\ub85c \uad6c\ub9e4\ud588\uc2b5\ub2c8\ub2e4."))}catch(d){c.vF.error("[RealEstate] \uad6c\ub9e4 \uc2e4\ud328:",d),x&&x({cash:s}),N(l),alert(d.message||"\ubd80\ub3d9\uc0b0 \uad6c\ub9e4 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}finally{D(!1)}},Z=async e=>{const t=g.find(t=>t.id===e);if(!t||!a||t.owner!==a.id||!b)return void alert("\uc18c\uc720\ud55c \ubd80\ub3d9\uc0b0\ub9cc \ud310\ub9e4\ud560 \uc218 \uc788\uac70\ub098 \uc815\ubcf4\uac00 \ubd80\uc871\ud569\ub2c8\ub2e4.");const s=prompt("\ud310\ub9e4 \uac00\uaca9\uc744 \uc785\ub825\ud558\uc138\uc694 (\uc22b\uc790\ub9cc):");if(!s)return;const l=parseInt(s);if(isNaN(l)||l<=0)return void alert("\uc720\ud6a8\ud55c \ud310\ub9e4 \uac00\uaca9\uc744 \uc785\ub825\ud558\uc138\uc694.");const r=(0,n.A)({},t);N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{forSale:!0,salePrice:l}):t)),D(!0);const d=(0,i.H9)(i.db,"classes",b,"realEstateProperties",e);try{await(0,i.mZ)(d,{forSale:!0,salePrice:l,updatedAt:(0,i.O5)()}),await J(),_(null),H(null),alert("\ud310\ub9e4 \uc124\uc815\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(o){c.vF.error("\ud310\ub9e4 \uc124\uc815 \uc624\ub958:",o),N(t=>t.map(t=>t.id===e?r:t)),alert("\ud310\ub9e4 \uc124\uc815 \uc911 \uc624\ub958 \ubc1c\uc0dd: "+o.message)}finally{D(!1)}},z=async e=>{if(!p())return void alert("\uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");const t=prompt("\ud310\ub9e4 \uac00\uaca9\uc744 \uc785\ub825\ud558\uc138\uc694 (\uc22b\uc790\ub9cc):");if(!t)return;const a=parseInt(t);if(isNaN(a)||a<=0)return void alert("\uc720\ud6a8\ud55c \ud310\ub9e4 \uac00\uaca9\uc744 \uc785\ub825\ud558\uc138\uc694.");const s=g.find(t=>t.id===e),l=s?(0,n.A)({},s):null;N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{forSale:!0,salePrice:a}):t)),D(!0);const r=(0,i.H9)(i.db,"classes",b,"realEstateProperties",e);try{await(0,i.mZ)(r,{forSale:!0,salePrice:a,updatedAt:(0,i.O5)()}),await J(),_(null),H(null),alert("\uc815\ubd80 \uc18c\uc720 \ubd80\ub3d9\uc0b0 \ud310\ub9e4 \uc124\uc815\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(d){c.vF.error("\uc815\ubd80 \uc18c\uc720 \ubd80\ub3d9\uc0b0 \ud310\ub9e4 \uc124\uc815 \uc624\ub958:",d),l&&N(t=>t.map(t=>t.id===e?l:t)),alert("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd: "+d.message)}finally{D(!1)}},V=async e=>{if(!p())return void alert("\uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");const t=g.find(t=>t.id===e),a=t?(0,n.A)({},t):null;N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{forSale:!1,salePrice:null}):t)),D(!0);const s=(0,i.H9)(i.db,"classes",b,"realEstateProperties",e);try{await(0,i.mZ)(s,{forSale:!1,salePrice:0,updatedAt:(0,i.O5)()}),await J(),_(null),H(null),alert("\uc815\ubd80 \uc18c\uc720 \ubd80\ub3d9\uc0b0 \ud310\ub9e4\uac00 \ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(l){c.vF.error("\uc815\ubd80 \uc18c\uc720 \ubd80\ub3d9\uc0b0 \ud310\ub9e4 \ucde8\uc18c \uc624\ub958:",l),a&&N(t=>t.map(t=>t.id===e?a:t)),alert("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd: "+l.message)}finally{D(!1)}},L=async e=>{if(!b)return;const t=g.find(t=>t.id===e),a=t?(0,n.A)({},t):null;N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{forSale:!1,salePrice:null}):t)),D(!0);const s=(0,i.H9)(i.db,"classes",b,"realEstateProperties",e);try{await(0,i.mZ)(s,{forSale:!1,salePrice:0,updatedAt:(0,i.O5)()}),await J(),_(null),H(null),alert("\ud310\ub9e4\uac00 \ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(l){c.vF.error("\ud310\ub9e4 \ucde8\uc18c \uc624\ub958:",l),a&&N(t=>t.map(t=>t.id===e?a:t)),alert("\ud310\ub9e4 \ucde8\uc18c \uc911 \uc624\ub958 \ubc1c\uc0dd: "+l.message)}finally{D(!1)}},U=async e=>{if(!a||!b)return;const t=g.find(t=>t.id===e);if(!t)return void alert("\ubd80\ub3d9\uc0b0 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const s=g.some(t=>t.tenantId===a.id&&t.id!==e),l=t.tenantId===a.id,r=[...g];l?N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{tenant:null,tenantId:null,tenantName:null}):t)):(x&&x({cash:-t.rent}),N(t=>t.map(t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{tenant:a.name,tenantId:a.id,tenantName:a.name}):(0,n.A)((0,n.A)({},t),{},{tenant:t.tenantId===a.id?null:t.tenant,tenantId:t.tenantId===a.id?null:t.tenantId,tenantName:t.tenantId===a.id?null:t.tenantName})))),D(!0);const o=(0,i.H9)(i.db,"classes",b,"realEstateProperties",e),m=(0,i.H9)(i.db,"users",a.id);try{var u,h;let e=null;await(0,i.c4)(i.db,async t=>{const n=await t.get(o);if(!n.exists())throw new Error("\ubd80\ub3d9\uc0b0 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const l=n.data(),r=await t.get(m);if(!r.exists())throw new Error("\uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const d=r.data();if(l.tenantId===a.id)return t.update(o,{tenant:null,tenantId:null,tenantName:null,lastRentPayment:null,updatedAt:(0,i.O5)()}),void(e={type:"vacate"});if(l.tenantId)throw new Error("\uc774\ubbf8 \ub2e4\ub978 \uc0ac\ub78c\uc774 \uc785\uc8fc\ud574 \uc788\uc2b5\ub2c8\ub2e4.");if(s)throw new Error("\uc774\ubbf8 \ub2e4\ub978 \ubd80\ub3d9\uc0b0\uc5d0 \uc785\uc8fc\ud574 \uc788\uc2b5\ub2c8\ub2e4. \uba3c\uc800 \ud1f4\uac70\ud574\uc57c \ud569\ub2c8\ub2e4.");if(d.cash<l.rent)throw new Error("\uccab \uc6d4\uc138\ub97c \ub0bc \ud604\uae08\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4.");if(t.update(m,{cash:(0,i.GV)(-l.rent),updatedAt:(0,i.O5)()}),"government"!==l.owner){const e=(0,i.H9)(i.db,"users",l.owner);l.owner!==a.id&&t.update(e,{cash:(0,i.GV)(l.rent),updatedAt:(0,i.O5)()})}t.update(o,{tenant:a.name,tenantId:a.id,tenantName:a.name,lastRentPayment:(0,i.O5)(),updatedAt:(0,i.O5)()}),e={type:"moveIn",rent:l.rent}}),"vacate"===(null===(u=e)||void 0===u?void 0:u.type)?alert("\uc131\uacf5\uc801\uc73c\ub85c \ud1f4\uac70\ud588\uc2b5\ub2c8\ub2e4."):"moveIn"===(null===(h=e)||void 0===h?void 0:h.type)&&(alert("\uc131\uacf5\uc801\uc73c\ub85c \uc785\uc8fc\ud588\uc2b5\ub2c8\ub2e4. \uccab \uc6d4\uc138\uac00 \uc9c0\ubd88\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),null!==a&&void 0!==a&&a.id&&(d.Eb.invalidate("user_".concat(a.id)),c.vF.log("[RealEstate] \uc785\uc8fc \uc644\ub8cc - \uc720\uc800 \uce90\uc2dc \ubb34\ud6a8\ud654:",a.id))),await J(),v&&v(),_(null),H(null)}catch(p){c.vF.error("\uc785\uc8fc/\ud1f4\uac70 \ucc98\ub9ac \uc624\ub958:",p),N(r),!l&&x&&x({cash:t.rent}),alert("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(p.message))}finally{D(!1)}};if(h||I||C||S)return(0,m.jsx)("div",{className:"loading-message",children:"\ub370\uc774\ud130\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."});const Y=new Set(g.map(e=>e.tenantId).filter(Boolean)),Q=w.filter(e=>!Y.has(e.id)&&!e.isAdmin);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"real-estate-exchange",children:[O&&(0,m.jsx)("div",{className:"loading-overlay",children:"\ucc98\ub9ac \uc911..."}),(0,m.jsx)("div",{className:"exchange-header",children:(0,m.jsx)("div",{className:"header-content",children:(0,m.jsxs)("h1",{children:["\ud83c\udfe2 \ubd80\ub3d9\uc0b0 \uac70\ub798\uc18c (\ud559\uae09: ",b||"\uc815\ubcf4 \uc5c6\uc74c",")"]})})}),(0,m.jsx)("div",{className:"stats-container",children:(0,m.jsxs)("div",{className:"stats-bar",children:[(0,m.jsxs)("div",{className:"stat-item",children:[(0,m.jsx)("div",{className:"stat-icon",children:"\ud83c\udfd8\ufe0f"}),(0,m.jsxs)("div",{className:"stat-content",children:[(0,m.jsx)("div",{className:"stat-value",children:j.totalProperties}),(0,m.jsx)("div",{className:"stat-label",children:"\uc804\uccb4 \ubd80\ub3d9\uc0b0"})]})]}),(0,m.jsxs)("div",{className:"stat-item",children:[(0,m.jsx)("div",{className:"stat-icon",children:"\ud83d\udc65"}),(0,m.jsxs)("div",{className:"stat-content",children:[(0,m.jsx)("div",{className:"stat-value",children:g.filter(e=>"government"!==e.owner).length}),(0,m.jsx)("div",{className:"stat-label",children:"\uac1c\uc778 \uc18c\uc720"})]})]}),(0,m.jsxs)("div",{className:"stat-item",children:[(0,m.jsx)("div",{className:"stat-icon",children:"\ud83c\udfe0"}),(0,m.jsxs)("div",{className:"stat-content",children:[(0,m.jsx)("div",{className:"stat-value",children:g.filter(e=>e.tenantId).length}),(0,m.jsx)("div",{className:"stat-label",children:"\uc784\ub300 \uc911"})]})]}),(0,m.jsxs)("div",{className:"stat-item",children:[(0,m.jsx)("div",{className:"stat-icon",children:"\ud83d\udcb0"}),(0,m.jsxs)("div",{className:"stat-content",children:[(0,m.jsx)("div",{className:"stat-value",children:g.filter(e=>e.forSale).length}),(0,m.jsx)("div",{className:"stat-label",children:"\ud310\ub9e4 \uc911"})]})]})]})}),(0,m.jsxs)("div",{className:"exchange-content",children:[(()=>{const e=g.slice(0,j.totalProperties);return(0,m.jsxs)("div",{className:"property-layout",children:[(0,m.jsxs)("h3",{children:["\ud83c\udfe2 \ubd80\ub3d9\uc0b0 \ubc30\uce58\ub3c4 (\ud559\uae09: ",b||"\uc815\ubcf4 \uc5c6\uc74c",")"]}),(0,m.jsx)("div",{className:"layout-grid",style:{gridTemplateColumns:"repeat(".concat(j.layoutColumns,", 1fr)")},children:Array.from({length:j.totalProperties},(t,n)=>{const s=(n+1).toString(),l=e.find(e=>e.id===s);let i="layout-cell empty",r="#".concat(s);if(l){const e=null===w||void 0===w?void 0:w.find(e=>e.id===l.owner),t=l.ownerName||("government"===l.owner?"\uc815\ubd80":(null===e||void 0===e?void 0:e.name)||"\uc18c\uc720\uc8fc \ubd88\uba85"),n=null===w||void 0===w?void 0:w.find(e=>e.id===l.tenantId),d=l.tenantName||(null===n||void 0===n?void 0:n.name);r="#".concat(s," - ").concat(t),l.tenantId&&(r+=" (\uc784\ucc28\uc778: ".concat(d||"\uc138\uc785\uc790 \ubd88\uba85",")")),l.tenantId===(null===a||void 0===a?void 0:a.id)?(i="layout-cell rented-by-me",r="#".concat(s," - ").concat(t," (\ub0b4\uac00 \uc784\ucc28\uc911)")):i=l.forSale?"layout-cell for-sale":l.owner===(null===a||void 0===a?void 0:a.id)?"layout-cell owned":"government"===l.owner?"layout-cell government":"layout-cell occupied"}return(0,m.jsx)("div",{className:i,onClick:()=>l&&_(l),title:r,children:s},s)})}),(0,m.jsxs)("div",{className:"layout-legend",children:[(0,m.jsxs)("div",{className:"legend-item",children:[(0,m.jsx)("div",{className:"legend-color government"}),(0,m.jsx)("span",{children:"\uc815\ubd80 \uc18c\uc720"})]}),(0,m.jsxs)("div",{className:"legend-item",children:[(0,m.jsx)("div",{className:"legend-color owned"}),(0,m.jsx)("span",{children:"\ub0b4 \uc18c\uc720"})]}),(0,m.jsxs)("div",{className:"legend-item",children:[(0,m.jsx)("div",{className:"legend-color rented-by-me-legend"}),(0,m.jsx)("span",{children:"\ub0b4\uac00 \uc784\ucc28\uc911"})]}),(0,m.jsxs)("div",{className:"legend-item",children:[(0,m.jsx)("div",{className:"legend-color for-sale"}),(0,m.jsx)("span",{children:"\ud310\ub9e4\uc911"})]}),(0,m.jsxs)("div",{className:"legend-item",children:[(0,m.jsx)("div",{className:"legend-color occupied"}),(0,m.jsx)("span",{children:"\ud0c0\uc778 \uc18c\uc720"})]})]})]})})(),p()&&(0,m.jsxs)("div",{className:"admin-controls",children:[(0,m.jsx)("button",{className:"admin-btn settings",onClick:()=>F(!0),style:{textDecoration:"none"},children:"\u2699\ufe0f \uad00\ub9ac\uc790 \uc124\uc815"}),(0,m.jsx)("button",{className:"admin-btn collect",onClick:async()=>{if(!b||!a||!p())return void alert("\uc6d4\uc138 \uc9d5\uc218 \uad8c\ud55c\uc774 \uc5c6\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");if(!window.confirm("\ud559\uae09 [".concat(b,"]\uc758 \ubaa8\ub4e0 \uc138\uc785\uc790\ub85c\ubd80\ud130 \uc6d4\uc138\ub97c \uac15\uc81c \uc9d5\uc218\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c? (\uc794\uc561 \ubd80\uc871 \uc2dc \uac00\uc9c4 \ud604\uae08\uc744 \ubaa8\ub450 \uc9d5\uc218)")))return;D(!0);let e=0,t=0,n=[];const s=(0,i.O5)(),l=(0,i.rJ)(i.db,"classes",b,"realEstateProperties"),r=(0,i.P)(l,(0,i._M)("tenantId","!=",null));try{const a=await(0,i.GG)(r);if(a.empty)return alert("\uc6d4\uc138\ub97c \uc9d5\uc218\ud560 \uc138\uc785\uc790\uac00 \uc788\ub294 \ubd80\ub3d9\uc0b0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."),void D(!1);for(const r of a.docs){const a=r.data();if(a.tenantId&&a.rent>0)try{const t=await(0,i.c4)(i.db,async e=>{const t=(0,i.H9)(i.db,"users",a.tenantId),n=await e.get(t);if(!n.exists())return c.vF.warn("\uc138\uc785\uc790 ID ".concat(a.tenantId,"\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uacc4\uc57d\uc744 \uc790\ub3d9\uc73c\ub85c \ud574\uc9c0\ud569\ub2c8\ub2e4.")),e.update(r.ref,{tenantId:null,tenant:null,tenantName:null,lastRentPayment:null,updatedAt:s}),{status:"tenant_not_found",propertyId:a.id,tenantId:a.tenantId};const l=n.data(),d=a.rent;let o=null;if("government"!==a.owner&&a.owner!==a.tenantId){const t=(0,i.H9)(i.db,"users",a.owner);o=await e.get(t)}if(l.cash<d){const n=l.cash;return e.update(t,{cash:0,updatedAt:s}),n>0&&o&&o.exists()&&e.update(o.ref,{cash:(0,i.GV)(n),updatedAt:s}),e.update(r.ref,{lastRentPayment:s,updatedAt:s}),{status:"unpaid",name:l.name||"ID: ".concat(a.tenantId)}}return e.update(t,{cash:(0,i.GV)(-d),updatedAt:s}),o&&o.exists()&&e.update(o.ref,{cash:(0,i.GV)(d),updatedAt:s}),e.update(r.ref,{lastRentPayment:s,updatedAt:s}),{status:"success"}});"unpaid"===t.status?n.push(t.name):"tenant_not_found"===t.status?c.vF.log("\ubd80\ub3d9\uc0b0 ID ".concat(t.propertyId,"\uc758 \uacc4\uc57d\uc774 \ud574\uc9c0\ub418\uc5c8\uc2b5\ub2c8\ub2e4 (\uc138\uc785\uc790 ").concat(t.tenantId," \ubbf8\uc874\uc7ac)")):e++}catch(d){c.vF.error("\ubd80\ub3d9\uc0b0 ID ".concat(a.id," \uc6d4\uc138 \uc9d5\uc218 \ud2b8\ub79c\uc7ad\uc158 \uc2e4\ud328:"),d),t++}}const l=(0,i.H9)(i.db,"classes",b,"realEstateSettings","settingsDoc");await(0,i.mZ)(l,{lastRentCollection:s,updatedAt:s});let o="\uc6d4\uc138 \uc9d5\uc218 \uc644\ub8cc: \uc131\uacf5 ".concat(e,"\uac74, \uc2e4\ud328 ").concat(t,"\uac74, \ubbf8\ub0a9(\uc794\uc561\ubd80\uc871) ").concat(n.length,"\uac74.");n.length>0&&(o+="\n\n[\ubbf8\ub0a9 \ud559\uc0dd \uba85\ub2e8]\n".concat(n.join(", "))),alert(o),v&&v()}catch(o){c.vF.error("\uc6d4\uc138 \uc9d5\uc218 \uc911 \uc804\uccb4 \uc624\ub958:",o),alert("\uc6d4\uc138 \uc9d5\uc218 \uc911 \uc2ec\uac01\ud55c \uc624\ub958 \ubc1c\uc0dd: "+o.message)}finally{D(!1)}},disabled:O,children:"\ud83d\udcb8 \uc6d4\uc138 \uc9d5\uc218"}),(0,m.jsx)("button",{className:"admin-btn settings",onClick:async()=>{if(!b||!a||!p())return void alert("\uad8c\ud55c\uc774 \uc5c6\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");const e=j.rentPercentage||1;if(c.vF.log("[FixRent] \ud604\uc7ac \uc6d4\uc138 \ube44\uc728: ".concat(e,"%")),window.confirm("\uc6d4\uc138\uac00 0\uc6d0\uc778 \ubd80\ub3d9\uc0b0\uc744 \ubaa8\ub450 \uc218\uc815\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n\n\ud604\uc7ac \uc124\uc815:\n- \uc6d4\uc138 \ube44\uc728: ".concat(e,"%\n- \uae30\ubcf8 \ubd80\ub3d9\uc0b0 \uac00\uaca9: ").concat((j.basePrice/1e4).toFixed(0),"\ub9cc\uc6d0\n\n\uac01 \ubd80\ub3d9\uc0b0\uc758 \uac00\uaca9 \xd7 ").concat(e,"%\ub85c \uc6d4\uc138\uac00 \uc124\uc815\ub429\ub2c8\ub2e4."))){D(!0);try{const t=(0,i.rJ)(i.db,"classes",b,"realEstateProperties"),a=await(0,i.GG)(t),n=(0,i.wP)(i.db);let s=0;a.forEach(t=>{const a=t.data();if(!a.rent||0===a.rent){const l=a.price||j.basePrice,r=Math.round(l*(e/100));n.update(t.ref,{rent:r,updatedAt:(0,i.O5)()}),s++,c.vF.log("[FixRent] \ubd80\ub3d9\uc0b0 #".concat(a.id,": \uac00\uaca9 ").concat((l/1e4).toFixed(0),"\ub9cc\uc6d0 \xd7 ").concat(e,"% = \uc6d4\uc138 ").concat((r/1e4).toFixed(1),"\ub9cc\uc6d0"))}}),s>0?(await n.commit(),await J(),alert("\uc6d4\uc138 \uc218\uc815 \uc644\ub8cc!\n\n".concat(s,"\uac1c \ubd80\ub3d9\uc0b0\uc758 \uc6d4\uc138\ub97c \uc218\uc815\ud588\uc2b5\ub2c8\ub2e4.\n(\uc6d4\uc138 \ube44\uc728: ").concat(e,"%)"))):alert("\uc6d4\uc138\uac00 0\uc6d0\uc778 \ubd80\ub3d9\uc0b0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.")}catch(t){c.vF.error("[FixRent] \uc624\ub958:",t),alert("\uc6d4\uc138 \uc218\uc815 \uc911 \uc624\ub958 \ubc1c\uc0dd: "+t.message)}finally{D(!1)}}},disabled:O,children:"\ud83d\udd27 \uc6d4\uc138 0\uc6d0 \uc218\uc815"})]}),(0,m.jsxs)("div",{className:"properties-section",children:[(0,m.jsx)("h2",{children:"\ud83d\udcca \ubd80\ub3d9\uc0b0 \ubaa9\ub85d"}),(()=>{const e=g.slice(0,j.totalProperties);if(0===e.length&&!C)return(0,m.jsx)("div",{className:"loading-message",children:"\ubd80\ub3d9\uc0b0 \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uac00 \ucd08\uae30\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."});const t=g.some(e=>e.tenantId===(null===a||void 0===a?void 0:a.id));return(0,m.jsx)("div",{className:"property-grid",children:e.map(e=>{const n=a&&e.owner===a.id,s=a&&e.tenantId===a.id,l="government"===e.owner,i=null===w||void 0===w?void 0:w.find(t=>t.id===e.owner),r="government"===e.owner?"\uc815\ubd80":e.ownerName||(null===i||void 0===i?void 0:i.name)||"\uc18c\uc720\uc8fc \ubd88\uba85",d=null===w||void 0===w?void 0:w.find(t=>t.id===e.tenantId),c=e.tenantName||(null===d||void 0===d?void 0:d.name);let o,u="property-card";return"government"===e.owner?u+=" government":n?u+=" owned":e.forSale?u+=" for-sale":u+=" other-owned",o=s?(0,m.jsx)("button",{className:"btn-action btn-rent",onClick:t=>{t.stopPropagation(),U(e.id)},disabled:O,children:"\ud1f4\uac70"}):e.tenantId?(0,m.jsx)("button",{className:"btn-action btn-rent",disabled:!0,children:"\uc785\uc8fc\ubd88\uac00"}):t?(0,m.jsx)("button",{className:"btn-action btn-rent",disabled:!0,title:"\ub2e4\ub978 \uacf3\uc5d0 \uc785\uc8fc\ud574 \uc788\uc2b5\ub2c8\ub2e4.",children:"\uc785\uc8fc"}):(0,m.jsx)("button",{className:"btn-action btn-rent",onClick:t=>{t.stopPropagation(),U(e.id)},disabled:O||!a||a.cash<e.rent,children:"\uc785\uc8fc"}),(0,m.jsxs)("div",{className:u,onClick:()=>H(e),children:[(0,m.jsxs)("div",{className:"property-header",children:[(0,m.jsxs)("h4",{children:["#",e.id]}),(0,m.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[e.forSale&&(0,m.jsx)("span",{className:"sale-badge",children:"\ud310\ub9e4\uc911"}),e.tenantId&&(0,m.jsx)("span",{className:"rent-badge",children:"\uc784\ub300\uc911"})]})]}),(0,m.jsxs)("div",{className:"property-info",children:[(0,m.jsxs)("div",{className:"info-row",children:[(0,m.jsx)("span",{className:"label",children:"\uc18c\uc720\uc790"}),(0,m.jsx)("span",{className:"value",children:r})]}),(0,m.jsxs)("div",{className:"info-row",children:[(0,m.jsx)("span",{className:"label",children:"\uac00\uaca9"}),(0,m.jsxs)("span",{className:"value",children:[(e.price/1e4).toFixed(0),"\ub9cc\uc6d0"]})]}),(0,m.jsxs)("div",{className:"info-row",children:[(0,m.jsx)("span",{className:"label",children:"\uc6d4\uc138"}),(0,m.jsxs)("span",{className:"value",children:[(e.rent/1e4).toFixed(0),"\ub9cc\uc6d0"]})]}),c&&(0,m.jsxs)("div",{className:"info-row",children:[(0,m.jsx)("span",{className:"label",children:"\uc138\uc785\uc790"}),(0,m.jsx)("span",{className:"value",children:c})]}),e.forSale&&(0,m.jsxs)("div",{className:"info-row sale-price",children:[(0,m.jsx)("span",{className:"label",children:"\ud310\ub9e4\uac00"}),(0,m.jsxs)("span",{className:"value",children:[(e.salePrice/1e4).toFixed(0),"\ub9cc\uc6d0"]})]})]}),(0,m.jsxs)("div",{className:"property-actions",children:[(l||e.forSale)&&!n&&(0,m.jsx)("button",{className:"btn-action btn-purchase",onClick:t=>{t.stopPropagation(),W(e.id)},disabled:O||!a||a.cash<(e.forSale?e.salePrice:e.price),children:"\uad6c\ub9e4"}),o,n&&!e.forSale&&(0,m.jsx)("button",{className:"btn-action btn-sell",onClick:t=>{t.stopPropagation(),Z(e.id)},disabled:O,children:"\ud310\ub9e4\uc124\uc815"}),n&&e.forSale&&(0,m.jsx)("button",{className:"btn-action btn-cancel",onClick:t=>{t.stopPropagation(),L(e.id)},disabled:O,children:"\ud310\ub9e4\ucde8\uc18c"}),p()&&l&&!e.forSale&&(0,m.jsx)("button",{className:"btn-action btn-sell",onClick:t=>{t.stopPropagation(),z(e.id)},disabled:O,children:"(\uad00\ub9ac\uc790)\ud310\ub9e4"}),p()&&l&&e.forSale&&(0,m.jsx)("button",{className:"btn-action btn-cancel",onClick:t=>{t.stopPropagation(),V(e.id)},disabled:O,children:"(\uad00\ub9ac\uc790)\ucde8\uc18c"})]})]},e.id)})})})()]})]}),(()=>{if(!G||!a)return null;const e=G,t=e.owner===a.id,n=e.tenantId===a.id,s=g.some(t=>t.tenantId===a.id&&t.id!==e.id),l="government"===e.owner,i=null===w||void 0===w?void 0:w.find(t=>t.id===e.owner),r="government"===e.owner?"\uc815\ubd80":e.ownerName||(null===i||void 0===i?void 0:i.name)||"\uc18c\uc720\uc8fc \ubd88\uba85",d=null===w||void 0===w?void 0:w.find(t=>t.id===e.tenantId),c=e.tenantName||(null===d||void 0===d?void 0:d.name);let o;return o=n?(0,m.jsx)("button",{className:"quick-action-btn btn-rent",onClick:()=>U(e.id),disabled:O,children:"\ud1f4\uac70\ud558\uae30"}):e.tenantId?(0,m.jsx)("button",{className:"quick-action-btn btn-rent",disabled:!0,children:"\uc785\uc8fc\ubd88\uac00"}):s?(0,m.jsx)("button",{className:"quick-action-btn btn-rent",disabled:!0,title:"\ub2e4\ub978 \uacf3\uc5d0 \uc785\uc8fc\ud574 \uc788\uc2b5\ub2c8\ub2e4. \uba3c\uc800 \ud1f4\uac70\ud558\uc138\uc694.",children:"\uc785\uc8fc\ud558\uae30"}):(0,m.jsx)("button",{className:"quick-action-btn btn-rent",onClick:()=>U(e.id),disabled:O||a.cash<e.rent,children:"\uc785\uc8fc\ud558\uae30"}),(0,m.jsx)("div",{className:"modal-overlay",onClick:()=>_(null),children:(0,m.jsxs)("div",{className:"quick-action-modal",onClick:e=>e.stopPropagation(),children:[(0,m.jsxs)("div",{className:"quick-modal-header",children:[(0,m.jsxs)("h3",{children:["\u26a1 \ube60\ub978 \uc561\uc158 #",e.id]}),(0,m.jsx)("button",{className:"close-btn",onClick:()=>_(null),children:"\u2715"})]}),(0,m.jsxs)("div",{className:"quick-modal-content",children:[(0,m.jsxs)("div",{className:"quick-property-info",children:[(0,m.jsxs)("div",{className:"quick-info-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\uc18c\uc720\uc790"}),(0,m.jsx)("span",{className:"detail-value",children:r})]}),(0,m.jsxs)("div",{className:"quick-info-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\ubd80\ub3d9\uc0b0 \uac00\uaca9"}),(0,m.jsxs)("span",{className:"detail-value",children:[(e.price/1e4).toFixed(0),"\ub9cc\uc6d0"]})]}),(0,m.jsxs)("div",{className:"quick-info-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\uc6d4\uc138"}),(0,m.jsxs)("span",{className:"detail-value",children:[(e.rent/1e4).toFixed(0),"\ub9cc\uc6d0"]})]}),c&&(0,m.jsxs)("div",{className:"quick-info-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\uc138\uc785\uc790"}),(0,m.jsx)("span",{className:"detail-value",children:c})]}),e.forSale&&(0,m.jsxs)("div",{className:"quick-info-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\ud310\ub9e4\uac00\uaca9"}),(0,m.jsxs)("span",{className:"detail-value",style:{color:"#ef4444",fontWeight:"bold"},children:[(e.salePrice/1e4).toFixed(0),"\ub9cc\uc6d0"]})]})]}),(0,m.jsxs)("div",{className:"quick-actions",children:[(l||e.forSale)&&!t&&(0,m.jsx)("button",{className:"quick-action-btn btn-purchase",onClick:()=>W(e.id),disabled:O||a.cash<(e.forSale?e.salePrice:e.price),children:"\uad6c\ub9e4\ud558\uae30"}),o,t&&!e.forSale&&(0,m.jsx)("button",{className:"quick-action-btn btn-sell",onClick:()=>Z(e.id),disabled:O,children:"\ud310\ub9e4\ud558\uae30"}),t&&e.forSale&&(0,m.jsx)("button",{className:"quick-action-btn btn-cancel",onClick:()=>L(e.id),disabled:O,children:"\ud310\ub9e4\ucde8\uc18c"}),p()&&l&&!e.forSale&&(0,m.jsx)("button",{className:"quick-action-btn btn-sell",onClick:()=>z(e.id),disabled:O,children:"(\uad00\ub9ac\uc790) \ud310\ub9e4\uc124\uc815"}),p()&&l&&e.forSale&&(0,m.jsx)("button",{className:"quick-action-btn btn-cancel",onClick:()=>V(e.id),disabled:O,children:"(\uad00\ub9ac\uc790) \ud310\ub9e4\ucde8\uc18c"})]})]})]})})})(),q&&(0,m.jsx)("div",{className:"modal-overlay",onClick:()=>H(null),children:(0,m.jsxs)("div",{className:"property-modal",onClick:e=>e.stopPropagation(),children:[(0,m.jsxs)("div",{className:"modal-header",children:[(0,m.jsxs)("h3",{children:["\u2139\ufe0f \ubd80\ub3d9\uc0b0 #",q.id," \uc0c1\uc138\uc815\ubcf4"]}),(0,m.jsx)("button",{className:"close-btn",onClick:()=>H(null),children:"\u2715"})]}),(0,m.jsx)("div",{className:"modal-content",children:(0,m.jsxs)("div",{className:"property-details",children:[(0,m.jsxs)("div",{className:"detail-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\uc18c\uc720\uc790"}),(0,m.jsx)("span",{className:"detail-value",children:"government"===q.owner?"\uc815\ubd80":q.ownerName||(null===w||void 0===w||null===(e=w.find(e=>e.id===q.owner))||void 0===e?void 0:e.name)||"\uc18c\uc720\uc8fc \ubd88\uba85"})]}),(0,m.jsxs)("div",{className:"detail-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\ubd80\ub3d9\uc0b0 \uac00\uaca9"}),(0,m.jsxs)("span",{className:"detail-value",children:[q.price.toLocaleString(),"\uc6d0"]})]}),(0,m.jsxs)("div",{className:"detail-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\uc6d4\uc138"}),(0,m.jsxs)("span",{className:"detail-value",children:[q.rent.toLocaleString(),"\uc6d0"]})]}),q.tenantId&&(0,m.jsxs)("div",{className:"detail-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\uc138\uc785\uc790"}),(0,m.jsx)("span",{className:"detail-value",children:q.tenantName||(null===w||void 0===w||null===(t=w.find(e=>e.id===q.tenantId))||void 0===t?void 0:t.name)||"\uc138\uc785\uc790 \ubd88\uba85"})]}),q.forSale&&(0,m.jsxs)("div",{className:"detail-row sale-highlight",children:[(0,m.jsx)("span",{className:"detail-label",children:"\ud310\ub9e4\uac00\uaca9"}),(0,m.jsxs)("span",{className:"detail-value",children:[q.salePrice.toLocaleString(),"\uc6d0"]})]}),q.lastRentPayment&&(0,m.jsxs)("div",{className:"detail-row",children:[(0,m.jsx)("span",{className:"detail-label",children:"\ucd5c\uadfc \uc6d4\uc138 \ub0a9\ubd80\uc77c"}),(0,m.jsx)("span",{className:"detail-value",children:q.lastRentPayment instanceof Date?q.lastRentPayment.toLocaleDateString():"\uc815\ubcf4 \uc5c6\uc74c"})]})]})})]})})]}),R&&p()&&(0,m.jsx)("div",{className:"modal-overlay",onClick:()=>F(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:999999,padding:"2rem 1rem",overflowY:"auto"},children:(0,m.jsxs)("div",{className:"admin-panel",onClick:e=>e.stopPropagation(),style:{backgroundColor:"white",borderRadius:"16px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",width:"100%",maxWidth:"600px",maxHeight:"90vh",display:"flex",flexDirection:"column",position:"relative",zIndex:1e6},children:[(0,m.jsxs)("div",{className:"panel-header",children:[(0,m.jsxs)("h3",{children:["\u2699\ufe0f \uad00\ub9ac\uc790 \uc124\uc815 (\ud559\uae09: ",b,")"]}),(0,m.jsx)("button",{className:"close-btn",onClick:()=>F(!1),children:"\u2715"})]}),(0,m.jsxs)("div",{className:"panel-content",children:[(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{children:"\ud65c\uc131\ud654\ud560 \ubd80\ub3d9\uc0b0 \uac1c\uc218 (\ubcc0\uacbd \ud6c4 '\ubd80\ub3d9\uc0b0 \ucd08\uae30\ud654' \ud544\uc694)"}),(0,m.jsx)("input",{type:"number",min:"1",max:"100",value:M.totalProperties,onChange:e=>B(t=>(0,n.A)((0,n.A)({},t),{},{totalProperties:e.target.value}))})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{children:"\ubc30\uce58\ub3c4 \ud55c \uc904\ub2f9 \uce78 \uc218"}),(0,m.jsx)("select",{value:M.layoutColumns,onChange:e=>B(t=>(0,n.A)((0,n.A)({},t),{},{layoutColumns:e.target.value})),children:[4,5,6,7,8,10].map(e=>(0,m.jsxs)("option",{value:e.toString(),children:[e,"\uce78"]},e))})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{children:"\uae30\ubcf8 \ubd80\ub3d9\uc0b0 \uac00\uaca9 (\uc6d0) (\ubcc0\uacbd \ud6c4 '\ubd80\ub3d9\uc0b0 \ucd08\uae30\ud654' \ud544\uc694)"}),(0,m.jsx)("input",{type:"number",min:"1000000",step:"1000000",value:M.basePrice,onChange:e=>B(t=>(0,n.A)((0,n.A)({},t),{},{basePrice:e.target.value}))})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{children:"\uc6d4\uc138 \ube44\uc728 (%) (\ubcc0\uacbd \ud6c4 '\ubd80\ub3d9\uc0b0 \ucd08\uae30\ud654' \ud544\uc694)"}),(0,m.jsx)("input",{type:"number",min:"0",max:"20",step:"0.1",value:M.rentPercentage,onChange:e=>B(t=>(0,n.A)((0,n.A)({},t),{},{rentPercentage:e.target.value}))})]}),(0,m.jsxs)("div",{className:"non-tenant-list",children:[(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,m.jsxs)("h4",{style:{margin:0},children:["\u26a0\ufe0f \ubbf8\uc785\uc8fc \ud559\uc0dd (",Q.length,"\uba85)"]}),Q.length>0&&(0,m.jsx)("button",{onClick:async()=>{if(!b||!a||!p())return void alert("\uad8c\ud55c\uc774 \uc5c6\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");const e=new Set(g.map(e=>e.tenantId).filter(Boolean)),t=w.filter(t=>!e.has(t.id)&&!t.isAdmin);if(0===t.length)return void alert("\ubaa8\ub4e0 \ud559\uc0dd\uc774 \uc774\ubbf8 \uc785\uc8fc\ud574 \uc788\uc2b5\ub2c8\ub2e4.");const s=g.filter(e=>!e.tenantId);if(s.length<t.length)alert("\ube48 \ubd80\ub3d9\uc0b0\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4.\n\ubbf8\uc785\uc8fc \ud559\uc0dd: ".concat(t.length,"\uba85\n\ube48 \ubd80\ub3d9\uc0b0: ").concat(s.length,"\uac1c"));else if(window.confirm("".concat(t.length,"\uba85\uc758 \ud559\uc0dd\uc744 \uc790\ub3d9\uc73c\ub85c \ube48 \ubd80\ub3d9\uc0b0\uc5d0 \ubc30\uc815\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))){D(!0);try{const e=(0,i.wP)(i.db),a=[];for(let n=0;n<t.length;n++){const l=t[n],r=s[n],c=(0,i.H9)(i.db,"classes",b,"realEstateProperties",r.id);e.update(c,{tenant:l.name,tenantId:l.id,tenantName:l.name,lastRentPayment:(0,i.O5)(),updatedAt:(0,i.O5)()}),a.push({propertyId:r.id,userId:l.id,userName:l.name}),d.Eb.invalidate("user_".concat(l.id))}await e.commit(),N(e=>e.map(e=>{const t=a.find(t=>t.propertyId===e.id);return t?(0,n.A)((0,n.A)({},e),{},{tenant:t.userName,tenantId:t.userId,tenantName:t.userName}):e})),c.vF.log("[RealEstate] \ubc30\uce58 \uc790\ub3d9 \ubc30\uc815 \uc644\ub8cc: ".concat(a.length,"\uba85")),alert("\uc790\ub3d9 \ubc30\uc815 \uc644\ub8cc!\n\n\uc131\uacf5: ".concat(a.length,"\uba85")),await J()}catch(l){c.vF.error("[RealEstate] \uc790\ub3d9 \ubc30\uc815 \uc804\uccb4 \uc624\ub958:",l),alert("\uc790\ub3d9 \ubc30\uc815 \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(l.message))}finally{D(!1)}}},disabled:O,style:{padding:"8px 16px",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:O?"not-allowed":"pointer",fontSize:"13px",fontWeight:"700",opacity:O?.6:1,transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:e=>!O&&(e.target.style.backgroundColor="#059669"),onMouseOut:e=>!O&&(e.target.style.backgroundColor="#10b981"),children:"\ud83c\udfd8\ufe0f \ubaa8\ub450 \uc790\ub3d9 \ubc30\uc815"})]}),Q.length>0?(0,m.jsx)("ul",{style:{listStyle:"none",padding:0,maxHeight:"300px",overflowY:"auto"},children:Q.map(e=>(0,m.jsxs)("li",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",marginBottom:"6px",backgroundColor:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[(0,m.jsx)("span",{style:{fontWeight:"500"},children:e.name}),(0,m.jsx)("button",{onClick:()=>(async(e,t)=>{if(!b||!a||!p())return void alert("\uad8c\ud55c\uc774 \uc5c6\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");const s=g.filter(e=>!e.tenantId);if(0===s.length)return void alert("\ubc30\uc815\ud560 \uc218 \uc788\ub294 \ube48 \ubd80\ub3d9\uc0b0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");const l=s[0];if(!window.confirm("'".concat(t,"' \ud559\uc0dd\uc744 \ubd80\ub3d9\uc0b0 #").concat(l.id,"\uc5d0 \uac15\uc81c\ub85c \uc785\uc8fc\uc2dc\ud0a4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n\n\uc6d4\uc138: ").concat((l.rent/1e4).toFixed(0),"\ub9cc\uc6d0\n\uc18c\uc720\uc790: ").concat("government"===l.owner?"\uc815\ubd80":l.ownerName)))return;D(!0);const r=[...g];N(a=>a.map(a=>a.id===l.id?(0,n.A)((0,n.A)({},a),{},{tenant:t,tenantId:e,tenantName:t}):(0,n.A)((0,n.A)({},a),{},{tenant:a.tenantId===e?null:a.tenant,tenantId:a.tenantId===e?null:a.tenantId,tenantName:a.tenantId===e?null:a.tenantName})));try{const a=(0,i.H9)(i.db,"classes",b,"realEstateProperties",l.id),n=(0,i.H9)(i.db,"users",e);await(0,i.c4)(i.db,async s=>{const l=await s.get(a);if(!l.exists())throw new Error("\ubd80\ub3d9\uc0b0 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const r=l.data(),d=await s.get(n);if(!d.exists())throw new Error("\uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");if(d.data(),r.tenantId)throw new Error("\uc774\ubbf8 \ub2e4\ub978 \uc0ac\ub78c\uc774 \uc785\uc8fc\ud574 \uc788\uc2b5\ub2c8\ub2e4.");s.update(a,{tenant:t,tenantId:e,tenantName:t,lastRentPayment:(0,i.O5)(),updatedAt:(0,i.O5)()})}),c.vF.log("[RealEstate] \uad00\ub9ac\uc790 \uac15\uc81c \uc785\uc8fc \uc644\ub8cc: ".concat(t," -> \ubd80\ub3d9\uc0b0 #").concat(l.id)),alert("'".concat(t,"' \ud559\uc0dd\uc774 \ubd80\ub3d9\uc0b0 #").concat(l.id,"\uc5d0 \uc785\uc8fc\ud588\uc2b5\ub2c8\ub2e4.")),await J(),e&&(d.Eb.invalidate("user_".concat(e)),c.vF.log("[RealEstate] \uac15\uc81c \uc785\uc8fc - \uc720\uc800 \uce90\uc2dc \ubb34\ud6a8\ud654:",e))}catch(o){c.vF.error("[RealEstate] \uac15\uc81c \uc785\uc8fc \uc624\ub958:",o),N(r),alert("\uac15\uc81c \uc785\uc8fc \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(o.message))}finally{D(!1)}})(e.id,e.name),disabled:O,style:{padding:"6px 12px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:O?"not-allowed":"pointer",fontSize:"13px",fontWeight:"600",opacity:O?.6:1,transition:"all 0.2s"},onMouseOver:e=>!O&&(e.target.style.backgroundColor="#2563eb"),onMouseOut:e=>!O&&(e.target.style.backgroundColor="#3b82f6"),children:"\ud83c\udfe0 \uc790\ub9ac \ubc30\uc815"})]},e.id))}):(0,m.jsx)("p",{style:{color:"#059669",fontWeight:"600",textAlign:"center",padding:"20px"},children:"\u2705 \ubaa8\ub4e0 \ud559\uc0dd\uc774 \uc785\uc8fc\ud588\uc2b5\ub2c8\ub2e4!"})]})]}),(0,m.jsxs)("div",{className:"panel-actions",children:[(0,m.jsx)("button",{className:"btn-primary",onClick:async()=>{if(!b||!p())return void alert("\uc124\uc815 \uc800\uc7a5 \uad8c\ud55c\uc774 \uc5c6\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");const e=parseInt(M.totalProperties),t=parseInt(M.basePrice),a=parseFloat(M.rentPercentage),n=parseInt(M.layoutColumns);if(isNaN(e)||isNaN(t)||isNaN(a)||isNaN(n)||e<=0||t<=0||a<0||n<=0)return void alert("\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uac12\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uac00\uaca9, \ubd80\ub3d9\uc0b0 \uac1c\uc218, \uce78 \uc218\ub294 0\ubcf4\ub2e4 \ucee4\uc57c\ud569\ub2c8\ub2e4.");D(!0);const s={totalProperties:e,basePrice:t,rentPercentage:a,layoutColumns:n,updatedAt:(0,i.O5)()};try{const e=(0,i.H9)(i.db,"classes",b,"realEstateSettings","settingsDoc");await(0,i.mZ)(e,s),alert("\uc124\uc815\uc774 \uc131\uacf5\uc801\uc73c\ub85c \uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ubcc0\uacbd\ub41c \ucd1d \ubd80\ub3d9\uc0b0 \uac1c\uc218 \ub4f1\uc740 '\ubd80\ub3d9\uc0b0 \ucd08\uae30\ud654'\ub97c \ud1b5\ud574 \ubc18\uc601\ud574\uc57c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),F(!1)}catch(l){c.vF.error("\uc124\uc815 \uc800\uc7a5 \uc624\ub958:",l),alert("\uc124\uc815 \uc800\uc7a5 \uc911 \uc624\ub958 \ubc1c\uc0dd: "+l.message)}finally{D(!1)}},disabled:O,children:"\ud83d\udcbe \uc124\uc815 \uc800\uc7a5"}),(0,m.jsx)("button",{className:"btn-danger",onClick:async()=>{if(b&&a&&p()){if(window.confirm("\uc815\ub9d0\ub85c \ud559\uae09 [".concat(b,"]\uc758 \ubaa8\ub4e0 \ubd80\ub3d9\uc0b0\uc744 \uc815\ubd80 \uc18c\uc720 \ucd08\uae30\uac12\uc73c\ub85c \ub418\ub3cc\ub9ac\uc2dc\uaca0\uc2b5\ub2c8\uae4c? \uc774 \uc791\uc5c5\uc740 \ub418\ub3cc\ub9b4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."))){D(!0);try{const e=j,t=e.basePrice,a=Math.round(t*(e.rentPercentage/100)),n=(0,i.wP)(i.db),s=(0,i.rJ)(i.db,"classes",b,"realEstateProperties");(await(0,i.GG)(s)).forEach(e=>n.delete(e.ref));for(let l=1;l<=e.totalProperties;l++){const e=l.toString(),r=(0,i.H9)(s,e);n.set(r,{id:e,price:t,owner:"government",ownerName:"\uc815\ubd80",rent:a,tenant:null,tenantId:null,tenantName:null,forSale:!1,salePrice:0,lastRentPayment:null,createdAt:(0,i.O5)(),updatedAt:(0,i.O5)(),classCode:b})}await n.commit(),alert("\ubd80\ub3d9\uc0b0\uc774 \uc131\uacf5\uc801\uc73c\ub85c \ucd08\uae30\ud654\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),F(!1)}catch(e){c.vF.error("[RealEstate] Error initializing properties:",e),alert("\ubd80\ub3d9\uc0b0 \ucd08\uae30\ud654 \uc911 \uc624\ub958 \ubc1c\uc0dd: "+e.message)}finally{D(!1)}}}else alert("\ucd08\uae30\ud654 \uad8c\ud55c\uc774 \uc5c6\uac70\ub098 \ud559\uae09 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")},disabled:O,children:"\ud83d\udd04 \ubd80\ub3d9\uc0b0 \ucd08\uae30\ud654"})]})]})})]})}}}]);
//# sourceMappingURL=785.e4fa2a38.chunk.js.map