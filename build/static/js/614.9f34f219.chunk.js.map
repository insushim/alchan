{"version":3,"file":"static/js/614.9f34f219.chunk.js","mappings":"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","sources":["components/LoginWarning.js","components/modals/TransferModal.js","pages/my-assets/MyAssets.js"],"sourcesContent":["// src/LoginWarning.js\r\nimport React from \"react\";\r\n\r\nconst LoginWarning = () => {\r\n  return (\r\n    <div className=\"login-warning\">\r\n      <h3>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>\r\n      <p>ì•„ì´í…œì„ êµ¬ë§¤í•˜ê±°ë‚˜ ì‚¬ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginWarning;\r\n","// src/TransferModal.js\r\n// ğŸ”¥ ì„±ëŠ¥ ìµœì í™”: React.memo ì ìš©\r\nimport React, { memo, useMemo } from \"react\";\r\n\r\nconst TransferModal = memo(function TransferModal({\r\n  showTransferModal,\r\n  setShowTransferModal,\r\n  recipients = [],\r\n  transferRecipient,\r\n  setTransferRecipient,\r\n  transferAmount,\r\n  setTransferAmount,\r\n  handleTransfer,\r\n  userId,\r\n  userCash = 0,\r\n}) {\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    handleTransfer();\r\n  };\r\n\r\n  // ìœ íš¨í•œ ìˆ˜ì‹ ì ëª©ë¡ í•„í„°ë§ (ë³¸ì¸ ì œì™¸) ë° ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬\r\n  const validRecipients = recipients\r\n    .filter(r => r && r.id && r.id !== userId)\r\n    .sort((a, b) => {\r\n      const nameA = a.name || a.nickname || `ì‚¬ìš©ì ${a.id.substring(0, 6)}`;\r\n      const nameB = b.name || b.nickname || `ì‚¬ìš©ì ${b.id.substring(0, 6)}`;\r\n      return nameA.localeCompare(nameB, 'ko');\r\n    });\r\n\r\n  return (\r\n    <div className={`${showTransferModal ? 'flex' : 'hidden'} fixed inset-0 bg-black/50 items-center justify-center z-[1000] p-5`} onClick={() => setShowTransferModal(false)}>\r\n      <div className=\"bg-white rounded-xl p-8 max-w-[450px] w-full shadow-lg relative\" onClick={(e) => e.stopPropagation()}>\r\n        <button\r\n          onClick={() => setShowTransferModal(false)}\r\n          className=\"absolute top-4 right-4 bg-transparent border-0 text-2xl cursor-pointer text-gray-500 p-0 w-8 h-8 flex items-center justify-center\"\r\n          aria-label=\"ë‹«ê¸°\"\r\n        >\r\n          Ã—\r\n        </button>\r\n\r\n        <h2 className=\"text-xl font-semibold mb-6 text-gray-800\">\r\n          ğŸ’¸ ì†¡ê¸ˆí•˜ê¸°\r\n        </h2>\r\n\r\n        <div className=\"bg-gray-100 rounded-lg p-3 mb-5\">\r\n          <p className=\"text-sm text-gray-600 m-0\">\r\n            í˜„ì¬ ë³´ìœ  í˜„ê¸ˆ: <strong className=\"text-gray-800\">\r\n              {userCash.toLocaleString()}ì›\r\n            </strong>\r\n          </p>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"mb-5\">\r\n            <label className=\"block mb-2 text-sm font-medium text-gray-700\">\r\n              ë°›ëŠ” ì‚¬ëŒ\r\n            </label>\r\n            <select\r\n              value={transferRecipient}\r\n              onChange={(e) => setTransferRecipient(e.target.value)}\r\n              className=\"w-full px-3 py-2.5 border border-gray-300 rounded-md text-sm outline-none transition-colors cursor-pointer bg-white\"\r\n              required\r\n            >\r\n              <option value=\"\">ë°›ëŠ” ë¶„ì„ ì„ íƒí•˜ì„¸ìš”</option>\r\n              {validRecipients.length > 0 ? (\r\n                validRecipients.map((recipient) => (\r\n                  <option key={recipient.id} value={recipient.id}>\r\n                    {recipient.name || recipient.nickname || `ì‚¬ìš©ì ${recipient.id.substring(0, 6)}`}\r\n                  </option>\r\n                ))\r\n              ) : (\r\n                <option value=\"\" disabled>\r\n                  ì†¡ê¸ˆ ê°€ëŠ¥í•œ í•™ê¸‰ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤\r\n                </option>\r\n              )}\r\n            </select>\r\n            {validRecipients.length === 0 && (\r\n              <p className=\"mt-2 text-xs text-red-500\">\r\n                âš ï¸ ê°™ì€ í•™ê¸‰ì˜ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì—†ê±°ë‚˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"mb-6\">\r\n            <label className=\"block mb-2 text-sm font-medium text-gray-700\">\r\n              ì†¡ê¸ˆ ê¸ˆì•¡\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              value={transferAmount}\r\n              onChange={(e) => setTransferAmount(e.target.value)}\r\n              placeholder=\"ì†¡ê¸ˆí•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\r\n              className=\"w-full px-3 py-2.5 border border-gray-300 rounded-md text-sm outline-none transition-colors\"\r\n              min=\"1\"\r\n              max={userCash}\r\n              required\r\n            />\r\n            {transferAmount && parseInt(transferAmount) > userCash && (\r\n              <p className=\"mt-2 text-xs text-red-500\">\r\n                ë³´ìœ  í˜„ê¸ˆë³´ë‹¤ ë§ì€ ê¸ˆì•¡ì€ ì†¡ê¸ˆí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"flex justify-end pt-2.5 border-t border-gray-200\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowTransferModal(false)}\r\n              className=\"px-5 py-2.5 rounded-md border-0 text-sm font-medium cursor-pointer transition-all duration-200 bg-gray-200 text-gray-700 mr-2.5 hover:bg-gray-300\"\r\n            >\r\n              ì·¨ì†Œ\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"px-5 py-2.5 rounded-md border-0 text-sm font-medium cursor-pointer transition-all duration-200 bg-indigo-600 text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50\"\r\n              disabled={!transferRecipient || !transferAmount || parseInt(transferAmount) > userCash || validRecipients.length === 0}\r\n            >\r\n              ì†¡ê¸ˆ\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default TransferModal;","// src/pages/my-assets/MyAssets.js - Firestore ì§ì ‘ ì¡°íšŒ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •ëœ ìµœì¢… ë²„ì „\r\nimport React, { useState, useEffect, useCallback, useRef, useMemo } from \"react\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport {\r\n  db,\r\n  doc,\r\n  getDoc,\r\n  setDoc,\r\n  serverTimestamp,\r\n  increment,\r\n  writeBatch,\r\n  arrayUnion,\r\n  getDocs,\r\n  collection,\r\n  query,\r\n  where,\r\n  functions,\r\n  httpsCallable,\r\n} from \"../../firebase\";\r\nimport { limit, runTransaction } from \"firebase/firestore\";\r\nimport { formatKoreanCurrency } from '../../utils/numberFormatter';\r\nimport { logActivity, ACTIVITY_TYPES, safeTimestampToDate, getCachedFirestoreData, setCachedFirestoreData } from '../../utils/firestoreHelpers';\r\nimport LoginWarning from \"../../components/LoginWarning\";\r\nimport TransferModal from \"../../components/modals/TransferModal\";\r\nimport { AlchanLoading } from \"../../components/AlchanLayout\";\r\nimport { DailyRewardBanner } from \"../../components/DailyReward\";\r\n\r\nimport { logger } from \"../../utils/logger\";\r\nexport default function MyAssets() {\r\n  const {\r\n    user,\r\n    userDoc,\r\n    users, // ì „ì²´ ì‚¬ìš©ì ëª©ë¡ (ì†¡ê¸ˆ ëŒ€ìƒ ì°¾ê¸° ë“±ì—ì„œ í•„ìš”)\r\n    classmates, // 'ë‚˜'ë¥¼ ì œì™¸í•œ í•™ê¸‰ ì¹œêµ¬ ëª©ë¡ (ì†¡ê¸ˆ, ì„ ë¬¼ ëª¨ë‹¬ìš©)\r\n    allClassMembers, // ğŸ”¥ [ì¶”ê°€] 'ë‚˜'ë¥¼ í¬í•¨í•œ í•™ê¸‰ ì „ì²´ êµ¬ì„±ì› ëª©ë¡ (ê¸°ë¶€ ë‚´ì—­ ëª¨ë‹¬ìš©)\r\n    loading: authLoading,\r\n    updateUser: updateUserInAuth,\r\n    addCashToUserById,\r\n    deductCash,\r\n    optimisticUpdate,\r\n  } = useAuth();\r\n\r\n  const userId = user?.uid;\r\n  const userName =\r\n    userDoc?.name || userDoc?.nickname || user?.displayName || \"ì‚¬ìš©ì\";\r\n  const currentUserClassCode = userDoc?.classCode;\r\n\r\n  // ğŸ”¥ [ìµœì í™” 1] ìƒíƒœ ë° ë ˆí¼ëŸ°ìŠ¤\r\n  const [assetsLoading, setAssetsLoading] = useState(true);\r\n  const loadingRef = useRef(false); // ë¡œë”© ì¤‘ë³µ ë°©ì§€ìš© í”Œë˜ê·¸\r\n  const dataFetchRef = useRef({}); // ë°ì´í„° í˜ì¹˜ ì‹œê°„ ì¶”ì ìš©\r\n  const [parkingBalance, setParkingBalance] = useState(0);\r\n  const [deposits, setDeposits] = useState([]); // ì˜ˆê¸ˆ ìƒí’ˆ ëª©ë¡\r\n  const [savings, setSavings] = useState([]); // ì ê¸ˆ ìƒí’ˆ ëª©ë¡\r\n  const [loans, setLoans] = useState([]);\r\n  const [realEstateAssets, setRealEstateAssets] = useState([]);\r\n  const [totalNetAssets, setTotalNetAssets] = useState(0);\r\n  const [goalDonations, setGoalDonations] = useState([]);\r\n  const [transactionHistory, setTransactionHistory] = useState([]);\r\n  const [forceReload, setForceReload] = useState(0); // ìºì‹œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ìƒíƒœ ë³€ìˆ˜\r\n\r\n  // ğŸ”¥ [ìµœì í™” 2] Firebase Functions í˜¸ì¶œ í•¨ìˆ˜ë“¤ (ê¸°ë¶€ ì œì™¸) - ë©”ëª¨ì´ì œì´ì…˜\r\n  const getUserAssetsDataFunction = useMemo(() => httpsCallable(functions, 'getUserAssetsData'), []);\r\n  const sellCouponFunction = useMemo(() => httpsCallable(functions, 'sellCoupon'), []);\r\n  const giftCouponFunction = useMemo(() => httpsCallable(functions, 'giftCoupon'), []);\r\n\r\n  // ğŸ”¥ [ìµœì í™” 4] ìºì‹œ ìœ íš¨ ì‹œê°„ ì„¤ì •\r\n  const CACHE_DURATION = 60 * 60 * 1000; // ğŸ”¥ [ìµœì í™”] 1ì‹œê°„ (Firestore ì½ê¸° ìµœì†Œí™”)\r\n\r\n  const currentGoalId = currentUserClassCode\r\n    ? `${currentUserClassCode}_goal`\r\n    : null;\r\n\r\n  const [classCouponGoal, setClassCouponGoal] = useState(1000);\r\n  const [couponValue, setCouponValue] = useState(1000);\r\n\r\n  // ğŸ”¥ [ë²„ê·¸ ìˆ˜ì •] Firestoreì—ì„œ ì¿ í° ê°€ì¹˜ ì„¤ì • ë¡œë“œ\r\n  useEffect(() => {\r\n    const loadCouponValueFromSettings = async () => {\r\n      try {\r\n        const settingsRef = doc(db, \"settings\", \"mainSettings\");\r\n        const settingsSnap = await getDoc(settingsRef);\r\n        if (settingsSnap.exists()) {\r\n          const settingsData = settingsSnap.data();\r\n          if (settingsData.couponValue) {\r\n            setCouponValue(Number(settingsData.couponValue));\r\n          }\r\n        }\r\n      } catch (error) {\r\n        logger.error(\"[MyAssets] ì¿ í° ê°€ì¹˜ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:\", error);\r\n      }\r\n    };\r\n\r\n    if (userId) {\r\n      loadCouponValueFromSettings();\r\n    }\r\n  }, [userId]);\r\n\r\n  const [goalProgress, setGoalProgress] = useState(0);\r\n  const [myContribution, setMyContribution] = useState(0);\r\n  const [goalAchieved, setGoalAchieved] = useState(false);\r\n  const [isResettingGoal, setIsResettingGoal] = useState(false);\r\n\r\n  const [showDonateModal, setShowDonateModal] = useState(false);\r\n  const [showSellCouponModal, setShowSellCouponModal] = useState(false);\r\n  const [sellAmount, setSellAmount] = useState(\"\");\r\n  const [showGiftCouponModal, setShowGiftCouponModal] = useState(false);\r\n  const [giftRecipient, setGiftRecipient] = useState(\"\");\r\n  const [giftAmount, setGiftAmount] = useState(\"\");\r\n  const [showDonationHistoryModal, setShowDonationHistoryModal] =\r\n    useState(false);\r\n  const [showTransferModal, setShowTransferModal] = useState(false);\r\n  const [transferRecipient, setTransferRecipient] = useState(\"\");\r\n  const [transferAmount, setTransferAmount] = useState(\"\");\r\n  const [showAllTransactions, setShowAllTransactions] = useState(false); // ê±°ë˜ ë‚´ì—­ í¼ì¹˜ê¸°/ì ‘ê¸° ìƒíƒœ\r\n\r\n  // ğŸ”¥ [ìµœì í™” 5] ìºì‹œ ìœ íš¨ì„± í™•ì¸ í•¨ìˆ˜\r\n  const isCacheValid = (cacheKey) => {\r\n    const cachedTime = dataFetchRef.current[cacheKey];\r\n    return cachedTime && (Date.now() - cachedTime) < CACHE_DURATION;\r\n  };\r\n\r\n  // ğŸ”¥ [ìˆ˜ì • 2] ì•ˆì „í•œ íŠ¸ëœì­ì…˜ ê¸°ë¡ í•¨ìˆ˜ - ë¡œì»¬ì—ì„œë§Œ ì²˜ë¦¬í•˜ê³  ë‚˜ì¤‘ì— ë°°ì¹˜ë¡œ ë™ê¸°í™”\r\n  const addTransaction = async (userId, amount, description) => {\r\n    try {\r\n      // ë¨¼ì € ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥\r\n      const localKey = `pending_transactions_${userId}`;\r\n      const existing = localStorage.getItem(localKey);\r\n      const pendingTransactions = existing ? JSON.parse(existing) : [];\r\n\r\n      // ğŸ”¥ ì¼ê´€ëœ timestamp í˜•ì‹ ì‚¬ìš© - Date ê°ì²´ ìƒì„±\r\n      const now = new Date();\r\n      const newTransaction = {\r\n        id: `local_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`,\r\n        amount: Number(amount) || 0, // ìˆ«ìë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜\r\n        description: String(description) || \"ê±°ë˜ ë‚´ì—­\", // ë¬¸ìì—´ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜\r\n        timestamp: now, // Date ê°ì²´ë¡œ ì§ì ‘ ì €ì¥\r\n        timestampISO: now.toISOString(), // ISO ë¬¸ìì—´ë„ ë³´ê´€\r\n        synced: false,\r\n      };\r\n\r\n      pendingTransactions.push(newTransaction);\r\n      localStorage.setItem(localKey, JSON.stringify(pendingTransactions, (key, value) => {\r\n        // Date ê°ì²´ë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™”í•  ë•Œ ISO ë¬¸ìì—´ë¡œ ë³€í™˜\r\n        if (key === 'timestamp' && value instanceof Date) {\r\n          return value.toISOString();\r\n        }\r\n        return value;\r\n      }));\r\n\r\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\r\n      setTransactionHistory(prev => [newTransaction, ...prev.slice(0, 4)]);\r\n\r\n\r\n      // ğŸ”¥ [ìˆ˜ì • 3] ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¹„ë™ê¸° ë™ê¸°í™” (ì‹¤íŒ¨í•´ë„ ë©”ì¸ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ)\r\n      setTimeout(async () => {\r\n        try {\r\n          await syncPendingTransactions(userId);\r\n        } catch (error) {\r\n          logger.warn('[MyAssets] syncPendingTransactions failed:', error);\r\n        }\r\n      }, 1000);\r\n\r\n    } catch (error) {\r\n      logger.warn('[MyAssets] addTransaction failed:', error);\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ìˆ˜ì • 4] ë³´ë¥˜ ì¤‘ì¸ íŠ¸ëœì­ì…˜ ë™ê¸°í™” í•¨ìˆ˜\r\n  const syncPendingTransactions = async (userId) => {\r\n    const localKey = `pending_transactions_${userId}`;\r\n    const pendingStr = localStorage.getItem(localKey);\r\n\r\n    if (!pendingStr) return;\r\n\r\n    try {\r\n      const pendingTransactions = JSON.parse(pendingStr, (key, value) => {\r\n        // JSONì—ì„œ Date ê°ì²´ë¡œ ë³µì›\r\n        if (key === 'timestamp' && typeof value === 'string') {\r\n          return new Date(value);\r\n        }\r\n        return value;\r\n      });\r\n\r\n      const unsyncedTransactions = pendingTransactions.filter(tx => !tx.synced);\r\n\r\n      if (unsyncedTransactions.length === 0) return;\r\n\r\n      const batch = writeBatch(db);\r\n      const userTransactionsRef = collection(db, \"users\", userId, \"transactions\");\r\n\r\n      unsyncedTransactions.forEach(tx => {\r\n        const docRef = doc(userTransactionsRef);\r\n        batch.set(docRef, {\r\n          amount: tx.amount,\r\n          description: tx.description,\r\n          timestamp: serverTimestamp(), // Firestoreì—ëŠ” serverTimestamp ì‚¬ìš©\r\n          localTimestamp: tx.timestampISO || tx.timestamp, // ë¡œì»¬ íƒ€ì„ìŠ¤íƒ¬í”„ë„ ë³´ì¡´\r\n          syncedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      // ë™ê¸°í™” ì™„ë£Œ í‘œì‹œ\r\n      const updatedTransactions = pendingTransactions.map(tx =>\r\n        unsyncedTransactions.find(utx => utx.id === tx.id)\r\n          ? { ...tx, synced: true }\r\n          : tx\r\n      );\r\n\r\n      localStorage.setItem(localKey, JSON.stringify(updatedTransactions, (key, value) => {\r\n        if (key === 'timestamp' && value instanceof Date) {\r\n          return value.toISOString();\r\n        }\r\n        return value;\r\n      }));\r\n\r\n    } catch (error) {\r\n      logger.warn('[MyAssets] syncPendingTransactions failed:', error);\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] ë°ì´í„° ë®ì–´ì“°ê¸° ë°©ì§€ë¥¼ ìœ„í•´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œ ì•ˆì „í•œ ëª©í‘œ ìƒì„± í•¨ìˆ˜\r\n  const createDefaultGoalForClass = useCallback(async (classCode, goalId) => {\r\n    try {\r\n      const goalDocRef = doc(db, \"goals\", goalId);\r\n      const defaultGoalData = {\r\n        classCode: classCode,\r\n        targetAmount: 1000,\r\n        progress: 0,\r\n        donations: [],\r\n        donationCount: 0,\r\n        title: `${classCode} í•™ê¸‰ ëª©í‘œ`,\r\n        description: `${classCode} í•™ê¸‰ì˜ ì¿ í° ëª©í‘œì…ë‹ˆë‹¤.`,\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n        createdBy: userId,\r\n      };\r\n\r\n      // íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œê°€ ì—†ì„ ë•Œë§Œ ì•ˆì „í•˜ê²Œ ìƒì„± (ë®ì–´ì“°ê¸° ë°©ì§€)\r\n      await runTransaction(db, async (transaction) => {\r\n        const goalDoc = await transaction.get(goalDocRef);\r\n        if (!goalDoc.exists()) {\r\n          transaction.set(goalDocRef, defaultGoalData);\r\n          setCachedFirestoreData(`goal_${goalId}`, userId, defaultGoalData);\r\n        } else {\r\n          const existingData = goalDoc.data();\r\n          setCachedFirestoreData(`goal_${goalId}`, userId, existingData);\r\n        }\r\n      });\r\n\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [userId]);\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ëª©í‘œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ - ìºì‹œ ì¶”ê°€ ë° ìµœì í™”\r\n  const loadGoalData = useCallback(async () => {\r\n    if (!currentGoalId || !currentUserClassCode) {\r\n      return;\r\n    }\r\n\r\n    // ğŸ”¥ ìºì‹œ ë¨¼ì € í™•ì¸\r\n    const cacheKey = `goal_${currentGoalId}`;\r\n    const cachedData = getCachedFirestoreData(cacheKey, userId, CACHE_DURATION);\r\n\r\n    if (cachedData) {\r\n      setClassCouponGoal(Number(cachedData.targetAmount) || 1000);\r\n      setGoalProgress(Number(cachedData.progress) || 0);\r\n\r\n      const donations = Array.isArray(cachedData.donations) ? cachedData.donations : [];\r\n      setGoalDonations(donations);\r\n\r\n      const myDonations = donations.filter(d => d.userId === userId);\r\n      const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n      setMyContribution(myTotal);\r\n\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n      const goalDocSnap = await getDoc(goalDocRef);\r\n\r\n      if (goalDocSnap.exists()) {\r\n        const goalData = goalDocSnap.data();\r\n\r\n        // ëª©í‘œ ì •ë³´ ì—…ë°ì´íŠ¸\r\n        setClassCouponGoal(Number(goalData.targetAmount) || 1000);\r\n        setGoalProgress(Number(goalData.progress) || 0);\r\n\r\n        // ê¸°ë¶€ ë‚´ì—­ ì²˜ë¦¬\r\n        const donations = Array.isArray(goalData.donations)\r\n          ? goalData.donations.map((donation) => {\r\n            let processedTimestamp;\r\n            if (donation.timestamp && donation.timestamp.toDate) {\r\n              processedTimestamp = donation.timestamp.toDate().toISOString();\r\n            } else if (donation.timestamp && donation.timestamp.seconds) {\r\n              processedTimestamp = new Date(donation.timestamp.seconds * 1000).toISOString();\r\n            } else if (donation.timestampISO) {\r\n              processedTimestamp = donation.timestampISO;\r\n            } else if (typeof donation.timestamp === 'string') {\r\n              processedTimestamp = donation.timestamp;\r\n            } else {\r\n              processedTimestamp = new Date().toISOString();\r\n            }\r\n\r\n            return {\r\n              ...donation,\r\n              amount: Number(donation.amount) || 0,\r\n              timestamp: processedTimestamp,\r\n              userId: donation.userId || '',\r\n              userName: donation.userName || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì',\r\n              message: donation.message || '',\r\n              classCode: donation.classCode || currentUserClassCode,\r\n            };\r\n          })\r\n          : [];\r\n\r\n        setGoalDonations(donations);\r\n\r\n        // ë‚´ ê¸°ì—¬ ê³„ì‚°\r\n        const myDonations = donations.filter(d => d.userId === userId);\r\n        const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n        setMyContribution(myTotal);\r\n\r\n        // ğŸ”¥ ìºì‹œì— ì €ì¥\r\n        setCachedFirestoreData(cacheKey, userId, goalData);\r\n      } else {\r\n        // ëª©í‘œ ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ìƒì„±\r\n        logger.log('[MyAssets] ëª©í‘œ ë¬¸ì„œê°€ ì—†ì–´ ê¸°ë³¸ê°’ ìƒì„±');\r\n        await createDefaultGoalForClass(currentUserClassCode, currentGoalId);\r\n      }\r\n    } catch (error) {\r\n      logger.error('[MyAssets] ëª©í‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentGoalId, currentUserClassCode, userId, createDefaultGoalForClass]);\r\n\r\n  const loadMyAssetsData = useCallback(async () => {\r\n    if (!userId || !db) {\r\n      setAssetsLoading(false);\r\n      return;\r\n    }\r\n\r\n    // ì´ë¯¸ ë¡œë”© ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€\r\n    if (loadingRef.current) {\r\n      return;\r\n    }\r\n\r\n    loadingRef.current = true;\r\n\r\n    // ğŸ”¥ [ìµœì í™”] ìºì‹œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ (ë¡œë”© ìŠ¤í”¼ë„ˆ ì—†ì´)\r\n    const cachedAssets = getCachedFirestoreData('myAssets', userId, CACHE_DURATION);\r\n    if (cachedAssets) {\r\n      setParkingBalance(cachedAssets.parkingBalance || 0);\r\n      setDeposits(cachedAssets.deposits || []);\r\n      setSavings(cachedAssets.savings || []);\r\n      setLoans(cachedAssets.loans || []);\r\n      setRealEstateAssets(cachedAssets.realEstateAssets || []);\r\n      setTransactionHistory(cachedAssets.transactionHistory || []);\r\n      setAssetsLoading(false); // ìºì‹œë¡œ ì¦‰ì‹œ ë¡œë”© í•´ì œ\r\n    } else {\r\n      setAssetsLoading(true);\r\n    }\r\n\r\n    try {\r\n      // ğŸ”¥ [ìµœì í™”] ëª¨ë“  ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì˜ Promise.allë¡œ ë³‘ë ¬ ì‹¤í–‰\r\n      const realEstateRef1 = query(collection(db, \"classes\", currentUserClassCode, \"realEstateProperties\"), where(\"owner\", \"==\", userId), limit(50));\r\n      const realEstateRef2 = query(collection(db, \"ClassStock\", currentUserClassCode, \"students\", userId, \"realestates\"), limit(50));\r\n      const realEstateRef3 = query(collection(db, \"realEstate\"), where(\"ownerId\", \"==\", userId), limit(50));\r\n      const parkingRef1 = doc(db, \"users\", userId, \"financials\", \"parkingAccount\");\r\n      const parkingRef2 = collection(db, \"ClassStock\", currentUserClassCode, \"students\", userId, \"parkingAccounts\");\r\n      const productsRef = query(collection(db, \"users\", userId, \"products\"), limit(50));\r\n      const activityLogsRef = query(\r\n        collection(db, \"activity_logs\"),\r\n        where(\"classCode\", \"==\", currentUserClassCode),\r\n        where(\"userId\", \"==\", userId),\r\n        limit(50)\r\n      );\r\n      const transactionsRef = query(\r\n        collection(db, \"users\", userId, \"transactions\"),\r\n        limit(50)\r\n      );\r\n\r\n      const [snap1, snap2, snap3, parkingSnap1, parkingSnap2, productsSnap, activityLogsSnap, transactionsSnap] = await Promise.all([\r\n        getDocs(realEstateRef1),\r\n        getDocs(realEstateRef2),\r\n        getDocs(realEstateRef3),\r\n        getDoc(parkingRef1),\r\n        getDocs(parkingRef2),\r\n        getDocs(productsRef),\r\n        getDocs(activityLogsRef).catch(() => ({ docs: [] })),\r\n        getDocs(transactionsRef).catch(() => ({ docs: [] })),\r\n      ]);\r\n\r\n      // ë¶€ë™ì‚° ì²˜ë¦¬\r\n      const allRealEstateAssets = [];\r\n      snap1.forEach(doc => allRealEstateAssets.push({ id: doc.id, ...doc.data() }));\r\n      snap2.forEach(doc => allRealEstateAssets.push({ id: doc.id, ...doc.data() }));\r\n      snap3.forEach(doc => allRealEstateAssets.push({ id: doc.id, ...doc.data() }));\r\n\r\n      // íŒŒí‚¹í†µì¥ ì²˜ë¦¬\r\n      let totalParkingBalance = 0;\r\n      if (parkingSnap1.exists()) {\r\n        totalParkingBalance += parkingSnap1.data().balance || 0;\r\n      }\r\n      parkingSnap2.forEach(doc => {\r\n        totalParkingBalance += doc.data().balance || 0;\r\n      });\r\n      setParkingBalance(totalParkingBalance);\r\n\r\n      // ìƒí’ˆ(ì˜ˆê¸ˆ/ì ê¸ˆ/ëŒ€ì¶œ) ì²˜ë¦¬\r\n      const depositsData = [];\r\n      const savingsData = [];\r\n      const loansData = [];\r\n      productsSnap.forEach(docSnap => {\r\n        const product = {\r\n          id: docSnap.id,\r\n          ...docSnap.data(),\r\n          maturityDate: docSnap.data().maturityDate?.toDate ? docSnap.data().maturityDate.toDate() : docSnap.data().maturityDate\r\n        };\r\n        if (product.type === 'deposit') depositsData.push(product);\r\n        else if (product.type === 'savings') savingsData.push(product);\r\n        else if (product.type === 'loan') loansData.push(product);\r\n      });\r\n      setDeposits(depositsData);\r\n      setSavings(savingsData);\r\n      setLoans(loansData);\r\n      setRealEstateAssets(allRealEstateAssets);\r\n\r\n      // ê±°ë˜ ë‚´ì—­ ì²˜ë¦¬\r\n      const activityData = (activityLogsSnap.docs || [])\r\n        .map(doc => {\r\n          const data = doc.data();\r\n          const desc = data.description || data.type || 'ê±°ë˜ ë‚´ì—­';\r\n          return {\r\n            id: doc.id,\r\n            amount: data.amount || 0,\r\n            description: desc === 'undefined' ? 'ê±°ë˜ ë‚´ì—­' : desc,\r\n            timestamp: data.timestamp,\r\n            type: data.type,\r\n            couponAmount: data.couponAmount || 0,\r\n            source: 'activity_logs'\r\n          };\r\n        })\r\n        .filter(tx => tx.amount !== 0 || tx.couponAmount !== 0);\r\n\r\n      const transactionsData = (transactionsSnap.docs || [])\r\n        .map(doc => {\r\n          const data = doc.data();\r\n          const desc = data.description || 'ê±°ë˜ ë‚´ì—­';\r\n          return {\r\n            id: doc.id,\r\n            amount: data.amount || 0,\r\n            description: (!desc || desc === 'undefined') ? 'ê±°ë˜ ë‚´ì—­' : desc,\r\n            timestamp: data.timestamp || data.createdAt,\r\n            type: data.type || 'transaction',\r\n            source: 'transactions'\r\n          };\r\n        })\r\n        .filter(tx => tx.amount !== 0);\r\n\r\n      const allTransactions = [...activityData, ...transactionsData];\r\n      allTransactions.sort((a, b) => {\r\n        const dateA = a.timestamp?.toDate ? a.timestamp.toDate() : new Date(a.timestamp?.seconds * 1000 || 0);\r\n        const dateB = b.timestamp?.toDate ? b.timestamp.toDate() : new Date(b.timestamp?.seconds * 1000 || 0);\r\n        return dateB - dateA;\r\n      });\r\n      const recentTransactions = allTransactions.slice(0, 20);\r\n      setTransactionHistory(recentTransactions);\r\n\r\n      // ğŸ”¥ [ìµœì í™”] ê²°ê³¼ë¥¼ localStorageì— ìºì‹œ (ë‹¤ìŒ ë¡œë“œì‹œ ì¦‰ì‹œ í‘œì‹œ)\r\n      setCachedFirestoreData('myAssets', userId, {\r\n        parkingBalance: totalParkingBalance,\r\n        deposits: depositsData,\r\n        savings: savingsData,\r\n        loans: loansData,\r\n        realEstateAssets: allRealEstateAssets,\r\n        transactionHistory: recentTransactions.map(tx => ({\r\n          ...tx,\r\n          timestamp: tx.timestamp?.toDate ? tx.timestamp.toDate().toISOString() : tx.timestamp?.seconds ? new Date(tx.timestamp.seconds * 1000).toISOString() : null,\r\n        })),\r\n      });\r\n\r\n    } catch (fallbackError) {\r\n      logger.error('[MyAssets] ğŸš¨ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì§ì ‘ ì¡°íšŒ ì‹¤íŒ¨:', fallbackError);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n      loadingRef.current = false;\r\n    }\r\n  }, [userId, currentUserClassCode, CACHE_DURATION]); // loadGoalData ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!authLoading && user) {\r\n      loadMyAssetsData();\r\n    } else if (!authLoading && !user) {\r\n      setAssetsLoading(false);\r\n      setParkingBalance(0);\r\n      setLoans([]);\r\n      setRealEstateAssets([]);\r\n      setTotalNetAssets(0);\r\n      setMyContribution(0);\r\n      setClassCouponGoal(1000);\r\n      setGoalProgress(0);\r\n      setCouponValue(1000);\r\n      setGoalDonations([]);\r\n      setTransactionHistory([]);\r\n    } else if (authLoading) {\r\n      setAssetsLoading(true);\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [authLoading, user]); // loadMyAssetsData ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€\r\n\r\n  useEffect(() => {\r\n    const cashValue = Number(userDoc?.cash) || 0;\r\n    const couponMonetaryValue = (Number(userDoc?.coupons) || 0) * Number(couponValue);\r\n    const realEstateValue = realEstateAssets.reduce(\r\n      (sum, asset) => sum + (Number(asset.price) || 0),\r\n      0\r\n    );\r\n    // ì˜ˆê¸ˆ ì´ì•¡ (balance ê¸°ì¤€)\r\n    const depositsTotal = deposits.reduce(\r\n      (sum, deposit) => sum + (Number(deposit.balance) || 0),\r\n      0\r\n    );\r\n    // ì ê¸ˆ ì´ì•¡ (balance ê¸°ì¤€)\r\n    const savingsTotal = savings.reduce(\r\n      (sum, saving) => sum + (Number(saving.balance) || 0),\r\n      0\r\n    );\r\n    // ëŒ€ì¶œ ì´ì•¡ (balance ê¸°ì¤€ - remainingPrincipalì´ ì—†ìœ¼ë©´ balance ì‚¬ìš©)\r\n    const loanTotal = loans.reduce(\r\n      (sum, loan) => sum + (Number(loan.remainingPrincipal) || Number(loan.balance) || 0),\r\n      0\r\n    );\r\n    const calculatedTotalAssets =\r\n      cashValue +\r\n      couponMonetaryValue +\r\n      Number(parkingBalance) +\r\n      depositsTotal +\r\n      savingsTotal +\r\n      realEstateValue -\r\n      loanTotal;\r\n\r\n    setTotalNetAssets(calculatedTotalAssets);\r\n  }, [\r\n    userDoc?.cash,\r\n    userDoc?.coupons,\r\n    couponValue,\r\n    parkingBalance,\r\n    deposits,\r\n    savings,\r\n    realEstateAssets,\r\n    loans,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    setGoalAchieved(goalProgress >= classCouponGoal && classCouponGoal > 0);\r\n  }, [goalProgress, classCouponGoal]);\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ëª©í‘œ ë°ì´í„° í´ë§ ì œê±° - ìºì‹œë¡œ ì¶©ë¶„í•¨\r\n  // ì´ˆê¸° ë¡œë“œë§Œ ìˆ˜í–‰í•˜ê³  í´ë§ì€ í•˜ì§€ ì•ŠìŒ (ë¶ˆí•„ìš”í•œ Firestore ì¡°íšŒ ë°©ì§€)\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!user || !currentGoalId) {\r\n      return;\r\n    }\r\n\r\n    loadGoalData();\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [user, currentGoalId]); // loadGoalData ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ê¸°ë¶€ ì²˜ë¦¬ í•¨ìˆ˜ - ìºì‹œ ë¬´íš¨í™” ê°œì„ \r\n  const handleDonateCoupon = async (amount, memo) => {\r\n    if (!userId || !currentUserClassCode) {\r\n      alert(\"ì‚¬ìš©ì ë˜ëŠ” í•™ê¸‰ ì •ë³´ê°€ ì—†ì–´ ê¸°ë¶€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return false;\r\n    }\r\n\r\n    const donationAmount = parseInt(amount, 10);\r\n    if (isNaN(donationAmount) || donationAmount <= 0) {\r\n      alert(\"ìœ íš¨í•œ ì¿ í° ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return false;\r\n    }\r\n\r\n    // ì¿ í° ë³´ìœ ëŸ‰ í™•ì¸\r\n    const currentCoupons = Number(userDoc?.coupons) || 0;\r\n    if (currentCoupons < donationAmount) {\r\n      alert(`ì¿ í°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${currentCoupons}ê°œ, í•„ìš”: ${donationAmount}ê°œ)`);\r\n      return false;\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n\r\n    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\r\n    const previousProgress = goalProgress;\r\n    const previousMyContribution = myContribution;\r\n    const previousDonations = goalDonations;\r\n\r\n    const newDonation = {\r\n      userId: userId,\r\n      userName: userName,\r\n      amount: donationAmount,\r\n      timestamp: new Date().toISOString(),\r\n      timestampISO: new Date().toISOString(),\r\n      message: memo || '',\r\n      classCode: currentUserClassCode,\r\n    };\r\n\r\n    setGoalProgress(prev => prev + donationAmount);\r\n    setMyContribution(prev => prev + donationAmount);\r\n    setGoalDonations(prev => [...prev, newDonation]);\r\n\r\n    // ğŸ”¥ ì¿ í° ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({ coupons: -donationAmount });\r\n    }\r\n\r\n    try {\r\n      // 1. ì‚¬ìš©ì ì¿ í° ì°¨ê° (AuthContext ì‚¬ìš©)\r\n      const couponDeducted = await updateUserInAuth({\r\n        coupons: increment(-donationAmount)\r\n      });\r\n\r\n      if (!couponDeducted) {\r\n        throw new Error(\"ì¿ í° ì°¨ê°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\r\n      }\r\n\r\n      // 2. Firestore íŠ¸ëœì­ì…˜ìœ¼ë¡œ ëª©í‘œ ì—…ë°ì´íŠ¸\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n\r\n      await runTransaction(db, async (transaction) => {\r\n        const goalDoc = await transaction.get(goalDocRef);\r\n\r\n        if (!goalDoc.exists()) {\r\n          throw new Error(\"ëª©í‘œ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n        }\r\n\r\n        const firestoreDonation = {\r\n          userId: userId,\r\n          userName: userName,\r\n          amount: donationAmount,\r\n          timestamp: serverTimestamp(),\r\n          timestampISO: new Date().toISOString(),\r\n          message: memo || '',\r\n          classCode: currentUserClassCode,\r\n        };\r\n\r\n        // progress ì¦ê°€ ë° donations ë°°ì—´ì— ì¶”ê°€\r\n        transaction.update(goalDocRef, {\r\n          progress: increment(donationAmount),\r\n          donations: arrayUnion(firestoreDonation),\r\n          updatedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      // 3. donations ì»¬ë ‰ì…˜ì—ë„ ê¸°ë¡ (ì„ íƒì‚¬í•­, íˆìŠ¤í† ë¦¬ ì¶”ì ìš©)\r\n      const donationRecordRef = doc(collection(db, \"donations\"));\r\n      await setDoc(donationRecordRef, {\r\n        userId: userId,\r\n        userName: userName,\r\n        amount: donationAmount,\r\n        timestamp: serverTimestamp(),\r\n        timestampISO: new Date().toISOString(),\r\n        message: memo || '',\r\n        classCode: currentUserClassCode,\r\n        goalId: currentGoalId,\r\n      });\r\n\r\n      // 4. íŠ¸ëœì­ì…˜ ê¸°ë¡\r\n      await addTransaction(userId, -donationAmount * couponValue, `í•™ê¸‰ ëª©í‘œì— ${donationAmount}ì¿ í° ê¸°ë¶€`);\r\n\r\n      // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° ê¸°ë¶€)\r\n      logActivity(db, {\r\n        classCode: currentUserClassCode,\r\n        userId: userId,\r\n        userName: userName,\r\n        type: ACTIVITY_TYPES.COUPON_DONATE,\r\n        description: `í•™ê¸‰ ëª©í‘œì— ì¿ í° ${donationAmount}ê°œ ê¸°ë¶€`,\r\n        couponAmount: -donationAmount,\r\n        metadata: {\r\n          goalId: currentGoalId,\r\n          goalProgress: goalProgress + donationAmount,\r\n          message: memo || ''\r\n        }\r\n      });\r\n\r\n      // ğŸ”¥ 5. ìºì‹œ ë¬´íš¨í™” (ëª¨ë“  ê´€ë ¨ ìºì‹œ ì‚­ì œ)\r\n      const cacheKey = `goal_${currentGoalId}`;\r\n      localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n\r\n      alert(`${donationAmount}ê°œ ì¿ í° ê¸°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);\r\n      setShowDonateModal(false);\r\n\r\n      // ğŸ”¥ 6. ìµœì‹  ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ìºì‹œê°€ ì‚­ì œë˜ì—ˆìœ¼ë¯€ë¡œ Firestoreì—ì„œ ê°€ì ¸ì˜´)\r\n      setTimeout(() => {\r\n        loadGoalData();\r\n      }, 500);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('[MyAssets] ê¸°ë¶€ ì˜¤ë¥˜:', error);\r\n      alert(`ê¸°ë¶€ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n      // ì—ëŸ¬ ë°œìƒ ì‹œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ë¡¤ë°±\r\n      setGoalProgress(previousProgress);\r\n      setMyContribution(previousMyContribution);\r\n      setGoalDonations(previousDonations);\r\n\r\n      // ì¿ í°ë„ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: donationAmount });\r\n      }\r\n\r\n      return false;\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ê¸°ë¶€ ë‚´ì—­ ë³µêµ¬ë¥¼ ìœ„í•œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜\r\n  const forceRefreshGoalData = async () => {\r\n    if (!currentGoalId || !currentUserClassCode) {\r\n      alert(\"í•™ê¸‰ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n\r\n    try {\r\n      // ëª¨ë“  ê´€ë ¨ ìºì‹œ ì‚­ì œ\r\n      const cacheKey = `goal_${currentGoalId}`;\r\n      localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n      localStorage.removeItem(`firestore_cache_settings_${userId}`);\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n\r\n      logger.log('[MyAssets] ìºì‹œ ì‚­ì œ ì™„ë£Œ, Firestoreì—ì„œ ìµœì‹  ë°ì´í„° ë¡œë“œ ì¤‘...');\r\n\r\n      // ğŸ”¥ Firestoreì—ì„œ ì§ì ‘ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n      const goalDocSnap = await getDoc(goalDocRef);\r\n\r\n      if (goalDocSnap.exists()) {\r\n        const latestGoalData = goalDocSnap.data();\r\n\r\n        setClassCouponGoal(Number(latestGoalData.targetAmount) || 1000);\r\n        setGoalProgress(Number(latestGoalData.progress) || 0);\r\n\r\n        const freshDonations = Array.isArray(latestGoalData.donations)\r\n          ? latestGoalData.donations.map((donation) => {\r\n            let processedTimestamp;\r\n            if (donation.timestamp && donation.timestamp.toDate) {\r\n              processedTimestamp = donation.timestamp.toDate().toISOString();\r\n            } else if (donation.timestamp && donation.timestamp.seconds) {\r\n              processedTimestamp = new Date(donation.timestamp.seconds * 1000).toISOString();\r\n            } else if (donation.timestampISO) {\r\n              processedTimestamp = donation.timestampISO;\r\n            } else if (typeof donation.timestamp === 'string') {\r\n              processedTimestamp = donation.timestamp;\r\n            } else {\r\n              processedTimestamp = new Date().toISOString();\r\n            }\r\n\r\n            return {\r\n              ...donation,\r\n              amount: Number(donation.amount) || 0,\r\n              timestamp: processedTimestamp,\r\n              userId: donation.userId || '',\r\n              userName: donation.userName || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì',\r\n              message: donation.message || '',\r\n              classCode: donation.classCode || currentUserClassCode,\r\n            };\r\n          })\r\n          : [];\r\n\r\n        setGoalDonations(freshDonations);\r\n\r\n        // ë‚´ ê¸°ì—¬ë„ ì¬ê³„ì‚°\r\n        const myDonations = freshDonations.filter(d => d.userId === userId);\r\n        const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n        setMyContribution(myTotal);\r\n\r\n        // ìºì‹œì— ì €ì¥\r\n        setCachedFirestoreData(cacheKey, userId, latestGoalData);\r\n\r\n        alert(`ëª©í‘œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ!\\nëª©í‘œ ì§„í–‰ë¥ : ${latestGoalData.progress || 0}/${latestGoalData.targetAmount || 1000}\\nê¸°ë¶€ ë‚´ì—­: ${freshDonations.length}ê°œ\\në‚´ ê¸°ì—¬ë„: ${myTotal}ê°œ`);\r\n      } else {\r\n        alert(\"ëª©í‘œ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.\");\r\n      }\r\n    } catch (error) {\r\n      logger.error('[MyAssets] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);\r\n      alert(`ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ì¶”ê°€] ê°œë°œììš© ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜\r\n  const showDebugInfo = () => {\r\n    const debugInfo = {\r\n      userId,\r\n      currentUserClassCode,\r\n      currentGoalId,\r\n      goalProgress,\r\n      classCouponGoal,\r\n      myContribution,\r\n      donationsCount: goalDonations.length,\r\n      donations: goalDonations,\r\n      userCoupons: userDoc?.coupons,\r\n      userCash: userDoc?.cash,\r\n    };\r\n\r\n    alert(`ë””ë²„ê·¸ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.\\nê¸°ë¶€ ë‚´ì—­: ${goalDonations.length}ê°œ\\nëª©í‘œ ì§„í–‰ë¥ : ${goalProgress}/${classCouponGoal}`);\r\n  };\r\n\r\n  // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] 'resetCouponGoal' í•¨ìˆ˜ì— async í‚¤ì›Œë“œ ì¶”ê°€\r\n  const resetCouponGoal = async () => {\r\n    if (!userDoc?.isAdmin && !userDoc?.isSuperAdmin) {\r\n      alert(\"ê´€ë¦¬ìë§Œ ì´ˆê¸°í™” ê°€ëŠ¥í•©ë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n    if (!currentUserClassCode || !currentGoalId) {\r\n      alert(\"í•™ê¸‰ ì½”ë“œë‚˜ ëª©í‘œ ì •ë³´ê°€ ì—†ì–´ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n    if (\r\n      !window.confirm(\r\n        `ì •ë§ë¡œ ${currentUserClassCode} í•™ê¸‰ì˜ ì¿ í° ëª©í‘œì™€ ê¸°ì—¬ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\r\n      )\r\n    )\r\n      return;\r\n\r\n    setIsResettingGoal(true);\r\n    try {\r\n      const batch = writeBatch(db);\r\n      const goalRef = doc(db, \"goals\", currentGoalId);\r\n\r\n      // ğŸ”¥ [ìµœì í™”] ì‚¬ìš©ì ì¡°íšŒì— limit ì¶”ê°€\r\n      const usersQuery = query(\r\n        collection(db, \"users\"),\r\n        where(\"classCode\", \"==\", currentUserClassCode),\r\n        limit(100)\r\n      );\r\n      const usersSnapshot = await getDocs(usersQuery);\r\n\r\n      usersSnapshot.forEach((userDocument) => {\r\n        const userRef = doc(db, \"users\", userDocument.id);\r\n        batch.update(userRef, {\r\n          myContribution: 0,\r\n          updatedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      batch.update(goalRef, {\r\n        progress: 0,\r\n        donations: [],\r\n        donationCount: 0,\r\n        updatedAt: serverTimestamp(),\r\n        resetAt: serverTimestamp(),\r\n        resetBy: userId,\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      // ğŸ”¥ [ìµœì í™” 23] ì´ˆê¸°í™” í›„ ê´€ë ¨ ìºì‹œ ëª¨ë‘ ì‚­ì œ\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n      localStorage.removeItem(`firestore_cache_goal_${currentGoalId}_${userId}`);\r\n\r\n      setMyContribution(0);\r\n      setGoalProgress(0);\r\n      setGoalDonations([]);\r\n\r\n      alert(`í•™ê¸‰(${currentUserClassCode})ì˜ ì¿ í° ëª©í‘œì™€ ê¸°ì—¬ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);\r\n    } catch (error) {\r\n      alert(`ëª©í‘œ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`);\r\n    } finally {\r\n      setIsResettingGoal(false);\r\n    }\r\n  };\r\n\r\n  const handleSellCoupon = async () => {\r\n    const amount = parseInt(sellAmount, 10);\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert(\"ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    // ğŸ”¥ ì¿ í° ì°¨ê° ë° í˜„ê¸ˆ ì¦ê°€ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n    const cashGained = amount * couponValue;\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({ coupons: -amount, cash: cashGained });\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n    try {\r\n      await sellCouponFunction({ amount });\r\n\r\n      // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° íŒë§¤)\r\n      logActivity(db, {\r\n        classCode: currentUserClassCode,\r\n        userId: userId,\r\n        userName: userName,\r\n        type: ACTIVITY_TYPES.COUPON_USE,\r\n        description: `ì¿ í° ${amount}ê°œ íŒë§¤ (${cashGained.toLocaleString()}ì›)`,\r\n        amount: cashGained,\r\n        couponAmount: -amount,\r\n        metadata: {\r\n          couponsSold: amount,\r\n          cashReceived: cashGained,\r\n          couponValue: couponValue\r\n        }\r\n      });\r\n\r\n      alert(`${amount}ê°œ ì¿ í°ì„ íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);\r\n      setShowSellCouponModal(false);\r\n      setSellAmount(\"\");\r\n      // ğŸ”¥ [ìµœì í™”] Firebase Functionì´ ìë™ìœ¼ë¡œ userDocë¥¼ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ\r\n      // AuthContextì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UIë¥¼ ê°±ì‹ í•¨ (loadMyAssetsData ì œê±°)\r\n    } catch (error) {\r\n      alert(`íŒë§¤ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: amount, cash: -cashGained });\r\n      }\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGiftCoupon = async () => {\r\n    const recipientUser = users.find((u) => u.id === giftRecipient);\r\n    const amount = parseInt(giftAmount, 10);\r\n\r\n    if (!recipientUser) {\r\n      alert(\"ë°›ëŠ” ì‚¬ëŒì„ ì„ íƒí•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert(\"ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    if (window.confirm(`${recipientUser.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œë¥¼ ì„ ë¬¼í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\r\n      // ğŸ”¥ ì¿ í° ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: -amount });\r\n      }\r\n\r\n      setAssetsLoading(true);\r\n      try {\r\n        await giftCouponFunction({ recipientId: recipientUser.id, amount, message: \"\" });\r\n\r\n        // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° ì„ ë¬¼ ë°œì†¡)\r\n        logActivity(db, {\r\n          classCode: currentUserClassCode,\r\n          userId: userId,\r\n          userName: userName,\r\n          type: ACTIVITY_TYPES.COUPON_GIFT_SEND,\r\n          description: `${recipientUser.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œ ì„ ë¬¼`,\r\n          couponAmount: -amount,\r\n          metadata: {\r\n            recipientId: recipientUser.id,\r\n            recipientName: recipientUser.name\r\n          }\r\n        });\r\n\r\n        // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° ì„ ë¬¼ ìˆ˜ì‹ ) - ë°›ëŠ” ì‚¬ëŒë„ ê¸°ë¡\r\n        logActivity(db, {\r\n          classCode: currentUserClassCode,\r\n          userId: recipientUser.id,\r\n          userName: recipientUser.name,\r\n          type: ACTIVITY_TYPES.COUPON_GIFT_RECEIVE,\r\n          description: `${userName}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ${amount}ê°œ ìˆ˜ì‹ `,\r\n          couponAmount: amount,\r\n          metadata: {\r\n            senderId: userId,\r\n            senderName: userName\r\n          }\r\n        });\r\n\r\n        alert(\"ì¿ í° ì„ ë¬¼ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\");\r\n        setShowGiftCouponModal(false);\r\n        setGiftRecipient(\"\");\r\n        setGiftAmount(\"\");\r\n        // ğŸ”¥ [ìµœì í™”] Firebase Functionì´ ìë™ìœ¼ë¡œ userDocë¥¼ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ\r\n        // AuthContextì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UIë¥¼ ê°±ì‹ í•¨ (loadMyAssetsData ì œê±°)\r\n      } catch (error) {\r\n        alert(`ì„ ë¬¼ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n        // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n        if (optimisticUpdate) {\r\n          optimisticUpdate({ coupons: amount });\r\n        }\r\n      } finally {\r\n        setAssetsLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTransferMoney = async () => {\r\n    setAssetsLoading(true);\r\n    try {\r\n      if (\r\n        !userDoc ||\r\n        !userId ||\r\n        !db ||\r\n        !users ||\r\n        !deductCash ||\r\n        !addCashToUserById\r\n      ) {\r\n        alert(\"í•„ìˆ˜ ì •ë³´ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\r\n        return;\r\n      }\r\n\r\n      const amount = parseInt(transferAmount, 10);\r\n      if (isNaN(amount) || amount <= 0) {\r\n        alert(\"ì˜¬ë°”ë¥¸ ì†¡ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n        return;\r\n      }\r\n\r\n      if ((Number(userDoc.cash) || 0) < amount) {\r\n        alert(\"ë³´ìœ  í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\");\r\n        return;\r\n      }\r\n\r\n      const recipientUser = users.find((u) => u.id === transferRecipient);\r\n      if (!recipientUser) {\r\n        alert(\"ì†¡ê¸ˆ ëŒ€ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\r\n        return;\r\n      }\r\n\r\n      if (recipientUser.id === userId) {\r\n        alert(\"ìê¸° ìì‹ ì—ê²ŒëŠ” ì†¡ê¸ˆí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n        return;\r\n      }\r\n\r\n      const recipientName = recipientUser.name || recipientUser.nickname || \"ì‚¬ìš©ì\";\r\n\r\n      // ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ í™•ì¸ ì°½ì„ ì œê±°í•©ë‹ˆë‹¤.\r\n      const deductSuccess = await deductCash(amount, `${recipientName}ë‹˜ì—ê²Œ ì†¡ê¸ˆ`);\r\n      if (deductSuccess) {\r\n        const addSuccess = await addCashToUserById(recipientUser.id, amount, `${userName}ë‹˜ìœ¼ë¡œë¶€í„° ì…ê¸ˆ`);\r\n        if (addSuccess) {\r\n          // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì†¡ê¸ˆ ë°œì†¡)\r\n          logActivity(db, {\r\n            classCode: currentUserClassCode,\r\n            userId: userId,\r\n            userName: userName,\r\n            type: ACTIVITY_TYPES.TRANSFER_SEND,\r\n            description: `${recipientName}ë‹˜ì—ê²Œ ${amount.toLocaleString()}ì› ì†¡ê¸ˆ`,\r\n            amount: -amount,\r\n            metadata: {\r\n              recipientId: recipientUser.id,\r\n              recipientName: recipientName\r\n            }\r\n          });\r\n\r\n          // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì†¡ê¸ˆ ìˆ˜ì‹ ) - ë°›ëŠ” ì‚¬ëŒë„ ê¸°ë¡\r\n          logActivity(db, {\r\n            classCode: currentUserClassCode,\r\n            userId: recipientUser.id,\r\n            userName: recipientName,\r\n            type: ACTIVITY_TYPES.TRANSFER_RECEIVE,\r\n            description: `${userName}ë‹˜ìœ¼ë¡œë¶€í„° ${amount.toLocaleString()}ì› ì…ê¸ˆ`,\r\n            amount: amount,\r\n            metadata: {\r\n              senderId: userId,\r\n              senderName: userName\r\n            }\r\n          });\r\n\r\n          alert(\"ì†¡ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\");\r\n          setShowTransferModal(false);\r\n          setTransferRecipient(\"\");\r\n          setTransferAmount(\"\");\r\n        } else {\r\n          alert(\"ë°›ëŠ” ì‚¬ëŒì—ê²Œ í˜„ê¸ˆì„ ì „ë‹¬í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì†¡ê¸ˆì´ ì·¨ì†Œë©ë‹ˆë‹¤.\");\r\n          // ì†¡ê¸ˆ ì‹¤íŒ¨ ì‹œ ì°¨ê°í–ˆë˜ ê¸ˆì•¡ì„ ë‹¤ì‹œ ë³µì›í•©ë‹ˆë‹¤.\r\n          await addCashToUserById(userId, amount, \"ì†¡ê¸ˆ ì‹¤íŒ¨ë¡œ ì¸í•œ ë³µì›\");\r\n        }\r\n      } else {\r\n        alert(\"ê³„ì¢Œì—ì„œ í˜„ê¸ˆì„ ì¸ì¶œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\r\n      }\r\n    } catch (error) {\r\n      logger.error(\"!!! ì†¡ê¸ˆ ì²˜ë¦¬ ì¤‘ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ ë°œìƒ !!!\", error);\r\n      alert(`ì†¡ê¸ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);\r\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ cash: parseInt(transferAmount, 10) || 0 });\r\n      }\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleForceRefresh = () => {\r\n    // ìºì‹œ ì‚­ì œ\r\n    const cacheKey = `myAssets_${userId}`;\r\n    localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n\r\n    logger.log('[MyAssets] ğŸ”„ ìºì‹œ ì‚­ì œ ë° ê°•ì œ ìƒˆë¡œê³ ì¹¨');\r\n\r\n    // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ\r\n    loadMyAssetsData();\r\n  };\r\n\r\n  const renderTitle = () => (\r\n    <div className=\"flex justify-between items-center mb-5\">\r\n      <h2 className=\"text-2xl font-bold text-cyber-cyan border-b-2 border-cyber-cyan/20 pb-2.5 m-0 drop-shadow-[0_0_10px_rgba(0,255,242,0.3)]\">\r\n        ë‚˜ì˜ ìì‚° í˜„í™© ğŸ’³\r\n      </h2>\r\n      <button\r\n        onClick={handleForceRefresh}\r\n        disabled={assetsLoading}\r\n        className={`px-4 py-2 bg-cyber-cyan/10 text-cyber-cyan border border-cyber-cyan/30 rounded-lg text-sm font-semibold transition-all duration-200 ${\r\n          assetsLoading ? 'cursor-not-allowed opacity-60' : 'cursor-pointer hover:bg-cyber-cyan/20'\r\n        }`}\r\n      >\r\n        ğŸ”„ ìƒˆë¡œê³ ì¹¨\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  const renderAssetSummary = () => {\r\n    const displayCash = Number(userDoc?.cash) || 0;\r\n    const displayCoupons = Number(userDoc?.coupons) || 0;\r\n\r\n    // ê±°ë˜ ë‚´ì—­ í‘œì‹œ ê°œìˆ˜ ê²°ì •\r\n    const displayedTransactions = showAllTransactions\r\n      ? transactionHistory\r\n      : transactionHistory.slice(0, 5);\r\n\r\n    return (\r\n      <div className=\"p-0 bg-transparent mb-6\">\r\n        {/* ë³´ìœ  í˜„ê¸ˆ - ë©”ì¸ ê°•ì¡° ì¹´ë“œ */}\r\n        <div className=\"bg-gradient-to-br from-[#667eea] to-[#764ba2] rounded-[20px] p-[30px] mb-5 shadow-[0_10px_30px_rgba(102,126,234,0.3)] border-none\">\r\n          <div className=\"mb-2.5\">\r\n            <span className=\"text-white/90 text-base font-medium\">\r\n              ğŸ’° ë³´ìœ  í˜„ê¸ˆ\r\n            </span>\r\n          </div>\r\n          <div className=\"text-[42px] font-extrabold text-white tracking-tight mb-4 text-right\">\r\n            {displayCash.toLocaleString()} <span className=\"text-[28px] font-semibold\">ì›</span>\r\n          </div>\r\n          <div className=\"flex justify-end\">\r\n            <button\r\n              onClick={() => setShowTransferModal(true)}\r\n              className=\"px-7 py-3.5 bg-white/95 text-[#667eea] border-none rounded-xl text-base font-bold cursor-pointer shadow-[0_4px_15px_rgba(0,0,0,0.1)] transition-all duration-300 hover:-translate-y-0.5 hover:shadow-[0_6px_20px_rgba(0,0,0,0.15)]\"\r\n              disabled={assetsLoading || authLoading}\r\n            >\r\n              ğŸ’¸ ì†¡ê¸ˆí•˜ê¸°\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ìµœê·¼ ì…ì¶œê¸ˆ ë‚´ì—­ - ë³´ìœ  í˜„ê¸ˆ ë°”ë¡œ ë°‘ì— ë°°ì¹˜ */}\r\n        <div className=\"mb-5\">\r\n          <h4 className=\"text-[15px] text-[#e8e8ff] font-bold mb-3\">\r\n            ğŸ’³ ìµœê·¼ ì…ì¶œê¸ˆ ë‚´ì—­\r\n          </h4>\r\n          {transactionHistory.length > 0 ? (\r\n            <div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                {displayedTransactions.map((tx) => {\r\n                  let displayDate = \"ë‚ ì§œ ì—†ìŒ\";\r\n                  try {\r\n                    const validDate = safeTimestampToDate(tx.timestamp);\r\n                    displayDate = validDate.toLocaleDateString(\"ko-KR\", {\r\n                      month: \"2-digit\",\r\n                      day: \"2-digit\",\r\n                    });\r\n                  } catch (dateError) {\r\n                    displayDate = \"ì˜¤ëŠ˜\";\r\n                  }\r\n\r\n                  const txAmount = Number(tx.amount) || 0;\r\n                  const rawDesc = tx.description;\r\n                  const txDescription = (!rawDesc || rawDesc === 'undefined' || rawDesc === 'null') ? \"ê±°ë˜ ë‚´ì—­\" : String(rawDesc);\r\n\r\n                  return (\r\n                    <div\r\n                      key={tx.id || Math.random()}\r\n                      className={`flex justify-between items-center text-sm text-[#a0a0c0] px-4 py-3.5 rounded-[10px] ${\r\n                        txAmount > 0\r\n                          ? 'bg-emerald-600/10 border border-emerald-600/30'\r\n                          : 'bg-red-600/10 border border-red-600/30'\r\n                      }`}\r\n                    >\r\n                      <span className=\"flex-1 whitespace-nowrap overflow-hidden text-ellipsis mr-2.5 font-medium text-[#e8e8ff]\">\r\n                        {displayDate} â€¢ {txDescription}\r\n                      </span>\r\n                      <span className={`font-bold text-[15px] min-w-[110px] text-right ${\r\n                        txAmount > 0 ? 'text-emerald-400' : 'text-red-400'\r\n                      }`}>\r\n                        {txAmount > 0 ? \"+\" : \"\"}\r\n                        {txAmount.toLocaleString()}ì›\r\n                      </span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n              {transactionHistory.length > 5 && (\r\n                <button\r\n                  onClick={() => setShowAllTransactions(!showAllTransactions)}\r\n                  className=\"w-full mt-3 p-3 bg-white/5 text-[#a0a0c0] border border-white/10 rounded-[10px] text-sm font-semibold cursor-pointer transition-all duration-200 hover:bg-white/10\"\r\n                >\r\n                  {showAllTransactions ? \"â–² ì ‘ê¸°\" : `â–¼ ${transactionHistory.length - 5}ê°œ ë” ë³´ê¸°`}\r\n                </button>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-[13px] text-gray-500 text-center p-5 bg-white/[0.03] rounded-[10px] border border-dashed border-white/10\">\r\n              ìµœê·¼ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* ì´ ìˆœìì‚° - ë‘ ë²ˆì§¸ ê°•ì¡° ì¹´ë“œ */}\r\n        <div className=\"bg-gradient-to-br from-[#f093fb] to-[#f5576c] rounded-[20px] py-6 px-[30px] mb-5 shadow-[0_10px_30px_rgba(240,147,251,0.3)] border-none\">\r\n          <div className=\"mb-2\">\r\n            <span className=\"text-white/90 text-base font-medium\">\r\n              ğŸ“Š ì´ ìˆœìì‚°\r\n            </span>\r\n          </div>\r\n          <div className=\"text-[38px] font-extrabold text-white tracking-tight text-right\">\r\n            {Number(totalNetAssets).toLocaleString()} <span className=\"text-2xl font-semibold\">ì›</span>\r\n          </div>\r\n          <p className=\"mt-2 text-xs text-white/80\">\r\n            í˜„ê¸ˆ + ì¿ í°ê°€ì¹˜ + íŒŒí‚¹í†µì¥ + ì˜ˆê¸ˆ + ì ê¸ˆ + ë¶€ë™ì‚° - ëŒ€ì¶œ\r\n          </p>\r\n        </div>\r\n\r\n        {/* íŒŒí‚¹í†µì¥ */}\r\n        <div className=\"mb-5\">\r\n          <h4 className=\"text-[15px] text-[#e8e8ff] font-bold mb-3\">\r\n            ğŸ…¿ï¸ íŒŒí‚¹í†µì¥\r\n          </h4>\r\n          <div className=\"bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-[14px] p-5 border-none shadow-[0_4px_15px_rgba(6,182,212,0.2)]\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-white/90 font-medium text-sm\">\r\n                ì”ì•¡\r\n              </span>\r\n              <span className=\"font-extrabold text-[26px] text-white tracking-tight text-right block\">\r\n                {Number(parkingBalance).toLocaleString()}<span className=\"text-lg font-semibold\">ì›</span>\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <p className=\"mt-2.5 text-xs text-gray-400 text-center\">\r\n            íŒŒí‚¹í†µì¥ ë©”ë‰´ì—ì„œ ì…ì¶œê¸ˆ ë° ìƒí’ˆ ê°€ì… ê°€ëŠ¥\r\n          </p>\r\n        </div>\r\n\r\n        {/* ê¸°íƒ€ ìì‚° ì •ë³´ - ê¹”ë”í•œ ì¹´ë“œ */}\r\n        <div className=\"p-6 bg-[rgba(20,20,35,0.4)] rounded-2xl border border-cyber-cyan/10 shadow-[0_4px_12px_rgba(0,0,0,0.2)]\">\r\n          {/* ë³´ìœ  ì¿ í° */}\r\n          <div className=\"mb-5\">\r\n            <h4 className=\"text-[15px] text-gray-700 font-bold mb-3\">\r\n              ğŸŸï¸ ë³´ìœ  ì¿ í°\r\n            </h4>\r\n            <div className=\"bg-gradient-to-br from-amber-400 to-amber-500 rounded-[14px] p-5 border-none shadow-[0_4px_15px_rgba(251,191,36,0.2)]\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <div className=\"w-full\">\r\n                  <div className=\"text-[26px] font-extrabold text-white tracking-tight text-right\">\r\n                    {displayCoupons.toLocaleString()} <span className=\"text-lg font-semibold\">ê°œ</span>\r\n                  </div>\r\n                  <div className=\"text-xs text-white/85 font-medium mt-1 text-right\">\r\n                    1ì¿ í° = {Number(couponValue).toLocaleString()}ì›\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (authLoading || assetsLoading) {\r\n    return <AlchanLoading />;\r\n  }\r\n  if (!user) {\r\n    return <LoginWarning />;\r\n  }\r\n  if (!userDoc && !authLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-[80vh] text-[1.2em] text-red-500\">\r\n        ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ì—ë„ ì´ ë©”ì‹œì§€ê°€ ë³´ì´ë©´ ì•±ì„ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì¬ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.\r\n      </div>\r\n    );\r\n  }\r\n  if (!currentUserClassCode && !authLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-[80vh] text-[1.2em] text-red-500\">\r\n        í•™ê¸‰ ì½”ë“œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì—¬ í•™ê¸‰ ì½”ë“œë¥¼ í• ë‹¹ë°›ìœ¼ì„¸ìš”.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full min-h-full bg-cyber-dark\">\r\n      <div className=\"w-full px-4 md:px-6 lg:px-8 py-6\">\r\n        {renderTitle()}\r\n\r\n        {/* ì¼ì¼ ì¶œì„ ë³´ìƒ ë°°ë„ˆ */}\r\n        <DailyRewardBanner\r\n          userId={userId}\r\n          onClaim={async (reward) => {\r\n            try {\r\n              // ì‹¤ì œ í˜„ê¸ˆ ì§€ê¸‰\r\n              const userRef = doc(db, \"users\", userId);\r\n              await setDoc(userRef, {\r\n                cash: increment(reward),\r\n                updatedAt: serverTimestamp(),\r\n              }, { merge: true });\r\n\r\n              // í™œë™ ë¡œê·¸ ê¸°ë¡\r\n              await logActivity(db, {\r\n                userId,\r\n                userName,\r\n                classCode: currentUserClassCode,\r\n                type: \"ì¼ì¼ ì¶œì„ ë³´ìƒ\",\r\n                description: `ì¼ì¼ ì¶œì„ ë³´ìƒìœ¼ë¡œ ${reward.toLocaleString()}ì› íšë“`,\r\n                amount: reward,\r\n                metadata: { rewardType: \"daily_streak\" }\r\n              });\r\n\r\n              // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸\r\n              if (optimisticUpdate) {\r\n                optimisticUpdate({ cash: (userDoc?.cash || 0) + reward });\r\n              }\r\n\r\n              logger.log(`Daily reward claimed and added: ${reward}`);\r\n            } catch (error) {\r\n              logger.error(\"ì¼ì¼ ë³´ìƒ ì§€ê¸‰ ì˜¤ë¥˜:\", error);\r\n              alert(\"ë³´ìƒ ì§€ê¸‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\r\n            }\r\n          }}\r\n        />\r\n\r\n        {renderAssetSummary()}\r\n        {showTransferModal && (\r\n          <TransferModal\r\n            showTransferModal={showTransferModal}\r\n            setShowTransferModal={setShowTransferModal}\r\n            recipients={classmates}\r\n            transferRecipient={transferRecipient}\r\n            setTransferRecipient={setTransferRecipient}\r\n            transferAmount={transferAmount}\r\n            setTransferAmount={setTransferAmount}\r\n            handleTransfer={handleTransferMoney}\r\n            userId={userId}\r\n            userCash={Number(userDoc?.cash) || 0}\r\n          />\r\n        )}\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":["LoginWarning","_jsxs","className","children","_jsx","memo","_ref","showTransferModal","setShowTransferModal","recipients","transferRecipient","setTransferRecipient","transferAmount","setTransferAmount","handleTransfer","userId","userCash","validRecipients","filter","r","id","sort","a","b","nameA","name","nickname","concat","substring","nameB","localeCompare","onClick","e","stopPropagation","toLocaleString","onSubmit","preventDefault","value","onChange","target","required","length","map","recipient","disabled","type","placeholder","min","max","parseInt","MyAssets","user","userDoc","users","classmates","allClassMembers","loading","authLoading","updateUser","updateUserInAuth","addCashToUserById","deductCash","optimisticUpdate","useAuth","uid","userName","displayName","currentUserClassCode","classCode","assetsLoading","setAssetsLoading","useState","loadingRef","useRef","parkingBalance","setParkingBalance","deposits","setDeposits","savings","setSavings","loans","setLoans","realEstateAssets","setRealEstateAssets","totalNetAssets","setTotalNetAssets","goalDonations","setGoalDonations","transactionHistory","setTransactionHistory","forceReload","setForceReload","CACHE_DURATION","useMemo","httpsCallable","functions","currentGoalId","classCouponGoal","setClassCouponGoal","couponValue","setCouponValue","useEffect","async","settingsRef","doc","db","settingsSnap","getDoc","exists","settingsData","data","Number","error","logger","loadCouponValueFromSettings","goalProgress","setGoalProgress","myContribution","setMyContribution","goalAchieved","setGoalAchieved","isResettingGoal","setIsResettingGoal","showDonateModal","setShowDonateModal","showSellCouponModal","setShowSellCouponModal","sellAmount","setSellAmount","showGiftCouponModal","setShowGiftCouponModal","giftRecipient","setGiftRecipient","giftAmount","setGiftAmount","showDonationHistoryModal","setShowDonationHistoryModal","showAllTransactions","setShowAllTransactions","createDefaultGoalForClass","useCallback","goalId","goalDocRef","defaultGoalData","targetAmount","progress","donations","donationCount","title","description","createdAt","serverTimestamp","updatedAt","createdBy","runTransaction","goalDoc","transaction","get","existingData","setCachedFirestoreData","set","loadGoalData","cacheKey","cachedData","getCachedFirestoreData","Array","isArray","myTotal","d","reduce","sum","amount","goalDocSnap","goalData","donation","processedTimestamp","timestamp","toDate","toISOString","seconds","Date","timestampISO","_objectSpread","message","log","loadMyAssetsData","current","cachedAssets","realEstateRef1","query","collection","where","limit","realEstateRef2","realEstateRef3","parkingRef1","parkingRef2","productsRef","activityLogsRef","transactionsRef","snap1","snap2","snap3","parkingSnap1","parkingSnap2","productsSnap","activityLogsSnap","transactionsSnap","Promise","all","getDocs","catch","docs","allRealEstateAssets","forEach","push","totalParkingBalance","balance","depositsData","savingsData","loansData","docSnap","_docSnap$data$maturit","product","maturityDate","activityData","desc","couponAmount","source","tx","transactionsData","allTransactions","_a$timestamp","_a$timestamp2","_b$timestamp","_b$timestamp2","dateA","recentTransactions","slice","_tx$timestamp","_tx$timestamp2","fallbackError","cashValue","cash","couponMonetaryValue","coupons","realEstateValue","asset","price","depositsTotal","deposit","savingsTotal","saving","loanTotal","loan","remainingPrincipal","calculatedTotalAssets","handleForceRefresh","localStorage","removeItem","AlchanLoading","DailyRewardBanner","onClaim","userRef","setDoc","increment","reward","merge","logActivity","metadata","rewardType","alert","renderAssetSummary","displayCash","displayCoupons","displayedTransactions","displayDate","safeTimestampToDate","toLocaleDateString","month","day","dateError","txAmount","rawDesc","txDescription","String","Math","random","TransferModal","isNaN","recipientUser","find","u","recipientName","ACTIVITY_TYPES","TRANSFER_SEND","recipientId","TRANSFER_RECEIVE","senderId","senderName"],"ignoreList":[],"sourceRoot":""}