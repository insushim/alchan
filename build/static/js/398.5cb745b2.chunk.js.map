{"version":3,"file":"static/js/398.5cb745b2.chunk.js","mappings":"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","sources":["pages/banking/stockExchangeService.js","pages/banking/StockExchange.js"],"sourcesContent":["// src/pages/banking/stockExchangeService.js\r\n// StockExchange 유틸리티, 캐시, 배치 데이터 로딩, 국고 업데이트\r\n\r\nimport { db, functions } from \"../../firebase\";\r\nimport { httpsCallable } from \"firebase/functions\";\r\nimport {\r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  increment,\r\n  serverTimestamp,\r\n  writeBatch,\r\n} from \"firebase/firestore\";\r\nimport { globalCache } from \"../../services/globalCacheService\";\r\n\r\nimport { logger } from \"../../utils/logger\";\n// === 상수 ===\r\nexport const PRODUCT_TYPES = {\r\n  STOCK: \"stock\",\r\n  ETF: \"etf\",\r\n  BOND: \"bond\"\r\n};\r\n\r\nexport const SECTORS = {\r\n  TECH: { name: \"기술\" },\r\n  FINANCE: { name: \"금융\" },\r\n  CONSUMER: { name: \"소비재\" },\r\n  HEALTHCARE: { name: \"헬스케어\" },\r\n  ENERGY: { name: \"에너지\" },\r\n  INDUSTRIAL: { name: \"산업\" },\r\n  MATERIALS: { name: \"소재\" },\r\n  REALESTATE: { name: \"부동산\" },\r\n  UTILITIES: { name: \"유틸리티\" },\r\n  COMMUNICATION: { name: \"통신\" },\r\n  ENTERTAINMENT: { name: \"엔터테인먼트\" },\r\n  INDEX: { name: \"지수\" },\r\n  GOVERNMENT: { name: \"국채\" },\r\n  CORPORATE: { name: \"회사채\" }\r\n};\r\n\r\nexport const HOLDING_LOCK_PERIOD = 60 * 60 * 1000; // 1시간\r\nexport const COMMISSION_RATE = 0.003;\r\nexport const TAX_RATE = 0.22;\r\nexport const BOND_TAX_RATE = 0.154;\r\n\r\nexport const CACHE_TTL = {\r\n  BATCH_DATA: 1000 * 60 * 30,\r\n  STOCKS: 1000 * 60 * 30,\r\n  PORTFOLIO: 1000 * 60 * 30,\r\n  MARKET_STATUS: 1000 * 60 * 120,\r\n};\r\n\r\n// === 배치 데이터 로딩 시스템 ===\r\nexport const batchDataLoader = {\r\n  pendingRequests: new Map(),\r\n\r\n  loadBatchData: async function (classCode, userId, forceRefresh = false) {\r\n    const batchKey = globalCache.generateKey('BATCH', { classCode, userId });\r\n\r\n    if (!forceRefresh) {\r\n      const cached = globalCache.get(batchKey);\r\n      if (cached) {\r\n        logger.log('[batchDataLoader] Cache HIT - 캐시된 데이터 사용');\r\n        return cached;\r\n      }\r\n    } else {\r\n      logger.log('[batchDataLoader] forceRefresh=true - 캐시 무시하고 서버에서 로드');\r\n      globalCache.invalidate(batchKey);\r\n    }\r\n\r\n    if (this.pendingRequests.has(batchKey)) {\r\n      return await this.pendingRequests.get(batchKey);\r\n    }\r\n\r\n    const batchPromise = this._executeBatchLoad(classCode, userId);\r\n    this.pendingRequests.set(batchKey, batchPromise);\r\n\r\n    try {\r\n      const result = await batchPromise;\r\n      globalCache.set(batchKey, result, 30 * 60 * 1000);\r\n      return result;\r\n    } finally {\r\n      this.pendingRequests.delete(batchKey);\r\n    }\r\n  },\r\n\r\n  _executeBatchLoad: async function (classCode, userId) {\r\n    const [stocks, portfolio] = await Promise.all([\r\n      this._loadStocks(classCode),\r\n      this._loadPortfolio(userId, classCode),\r\n    ]);\r\n\r\n    return {\r\n      stocks: stocks || [],\r\n      portfolio: portfolio || [],\r\n      errors: []\r\n    };\r\n  },\r\n\r\n  _loadStocks: async function (classCode) {\r\n    try {\r\n      try {\r\n        const getSnapshotFn = httpsCallable(functions, 'getStocksSnapshot');\r\n        const result = await getSnapshotFn({});\r\n        if (result.data && Array.isArray(result.data.stocks) && result.data.stocks.length > 0) {\r\n          return result.data.stocks;\r\n        }\r\n      } catch (fnError) {\r\n        logger.warn('[batchDataLoader] 스냅샷 함수 호출 실패, 문서/쿼리 폴백 시도:', fnError);\r\n      }\r\n\r\n      try {\r\n        const cacheRef = doc(db, \"Settings\", \"centralStocksCache\");\r\n        const cacheDoc = await getDoc(cacheRef);\r\n        const cacheData = cacheDoc.exists() ? cacheDoc.data() : null;\r\n\r\n        if (cacheData && Array.isArray(cacheData.stocks) && cacheData.stocks.length > 0) {\r\n          return cacheData.stocks;\r\n        }\r\n      } catch (snapshotError) {\r\n        logger.warn('[batchDataLoader] 스냅샷 문서 읽기 실패:', snapshotError);\r\n      }\r\n\r\n      const stocksRef = collection(db, \"CentralStocks\");\r\n      const q = query(stocksRef, where(\"isListed\", \"==\", true));\r\n      const querySnapshot = await getDocs(q);\r\n\r\n      return querySnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      }));\r\n    } catch (error) {\r\n      logger.error('[batchDataLoader] Stocks load error:', error);\r\n      return [];\r\n    }\r\n  },\r\n\r\n  _loadPortfolio: async function (userId, classCode) {\r\n    try {\r\n      const portfolioRef = collection(db, \"users\", userId, \"portfolio\");\r\n      const q = query(portfolioRef, where(\"classCode\", \"==\", classCode));\r\n      const querySnapshot = await getDocs(q);\r\n\r\n      return querySnapshot.docs.map(doc => {\r\n        const data = doc.data();\r\n        return {\r\n          id: doc.id,\r\n          ...data,\r\n          lastBuyTime: data.lastBuyTime?.toDate ? data.lastBuyTime.toDate() : data.lastBuyTime,\r\n          delistedAt: data.delistedAt?.toDate ? data.delistedAt.toDate() : data.delistedAt,\r\n        };\r\n      });\r\n    } catch (error) {\r\n      logger.error('[batchDataLoader] Portfolio load error:', error);\r\n      return [];\r\n    }\r\n  },\r\n};\r\n\r\n// === 시장 상태 함수 ===\r\nexport const getRealtimeMarketState = (stock) => {\r\n  if (!stock?.isRealStock) return null;\r\n  if (stock.realStockData?.marketState) return stock.realStockData.marketState;\r\n  return null;\r\n};\r\n\r\nexport const getMarketStateLabel = (stock) => {\r\n  const state = getRealtimeMarketState(stock);\r\n  if (!state) return null;\r\n  switch (state) {\r\n    case 'REGULAR': return '장중';\r\n    case 'PRE': return '장전';\r\n    case 'POST': return '장후';\r\n    default: return '장마감';\r\n  }\r\n};\r\n\r\n// === 포맷팅 함수 ===\r\nexport const formatCurrency = (amount) => {\r\n  if (typeof amount !== \"number\" || isNaN(amount)) return \"0원\";\r\n  return new Intl.NumberFormat(\"ko-KR\").format(Math.round(amount)) + \"원\";\r\n};\r\n\r\nexport const formatPercent = (percent) => {\r\n  const num = parseFloat(percent);\r\n  if (isNaN(num)) return \"0.00%\";\r\n  return (num >= 0 ? \"+\" : \"\") + num.toFixed(2) + \"%\";\r\n};\r\n\r\nexport const formatTime = (milliseconds) => {\r\n  const seconds = Math.floor(milliseconds / 1000);\r\n  const minutes = Math.floor(seconds / 60);\r\n  const remainingSeconds = seconds % 60;\r\n  return `${minutes}분 ${remainingSeconds}초`;\r\n};\r\n\r\n// === 세금/수수료 계산 ===\r\nexport const calculateStockTax = (profit, productType = PRODUCT_TYPES.STOCK) => {\r\n  if (profit <= 0) return 0;\r\n  if (productType === PRODUCT_TYPES.BOND) {\r\n    return Math.round(profit * BOND_TAX_RATE);\r\n  }\r\n  return Math.round(profit * TAX_RATE);\r\n};\r\n\r\n// === 국고 업데이트 배치 처리 ===\r\nconst treasuryUpdateQueue = new Map();\r\n\r\nexport const updateNationalTreasury = async (amount, type, classCode) => {\r\n  if (amount <= 0 || !classCode) return;\r\n  const key = `${classCode}_${type}`;\r\n  const existing = treasuryUpdateQueue.get(key) || { amount: 0, type, classCode };\r\n  existing.amount += amount;\r\n  treasuryUpdateQueue.set(key, existing);\r\n  setTimeout(() => processTreasuryQueue(), 1000);\r\n};\r\n\r\nexport const processTreasuryQueue = async () => {\r\n  if (treasuryUpdateQueue.size === 0) return;\r\n  const batch = writeBatch(db);\r\n  const updates = Array.from(treasuryUpdateQueue.values());\r\n  treasuryUpdateQueue.clear();\r\n\r\n  for (const { amount, type, classCode } of updates) {\r\n    const treasuryRef = doc(db, \"nationalTreasuries\", classCode);\r\n    const updateData = {\r\n      totalAmount: increment(amount),\r\n      lastUpdated: serverTimestamp(),\r\n    };\r\n    if (type === 'tax') {\r\n      updateData.stockTaxRevenue = increment(amount);\r\n    } else if (type === 'commission') {\r\n      updateData.stockCommissionRevenue = increment(amount);\r\n    }\r\n    batch.update(treasuryRef, updateData, { merge: true });\r\n  }\r\n\r\n  try {\r\n    await batch.commit();\r\n  } catch (error) {\r\n    updates.forEach(update => {\r\n      const key = `${update.classCode}_${update.type}`;\r\n      treasuryUpdateQueue.set(key, update);\r\n    });\r\n  }\r\n};\r\n\r\n// === 시장 지수 계산 ===\r\nexport const calculateMarketIndex = (stocks) => {\r\n  if (!stocks || stocks.length === 0) return 1000;\r\n  const listedStocks = stocks.filter(s => s && s.isListed && s.productType === PRODUCT_TYPES.STOCK);\r\n  if (listedStocks.length === 0) return 1000;\r\n\r\n  const totalMarketCap = listedStocks.reduce((sum, stock) => {\r\n    const shares = 1000;\r\n    return sum + (stock.price * shares);\r\n  }, 0);\r\n\r\n  const baseMarketCap = listedStocks.reduce((sum, stock) => {\r\n    const shares = 1000;\r\n    const basePrice = stock.initialPrice || stock.minListingPrice || stock.price;\r\n    return sum + (basePrice * shares);\r\n  }, 0);\r\n\r\n  if (baseMarketCap === 0) return 1000;\r\n  return Math.round((totalMarketCap / baseMarketCap) * 1000);\r\n};\r\n\r\n// === 보유 잠금 관련 ===\r\nexport const canSellHolding = (holding) => {\r\n  if (!holding.lastBuyTime) return true;\r\n  let lastBuyTimeMs;\r\n  if (holding.lastBuyTime instanceof Date) {\r\n    lastBuyTimeMs = holding.lastBuyTime.getTime();\r\n  } else if (holding.lastBuyTime?.toDate) {\r\n    lastBuyTimeMs = holding.lastBuyTime.toDate().getTime();\r\n  } else if (typeof holding.lastBuyTime === 'number') {\r\n    lastBuyTimeMs = holding.lastBuyTime;\r\n  } else if (typeof holding.lastBuyTime === 'string') {\r\n    lastBuyTimeMs = new Date(holding.lastBuyTime).getTime();\r\n  } else {\r\n    return true;\r\n  }\r\n  const timeSinceBuy = Date.now() - lastBuyTimeMs;\r\n  return timeSinceBuy >= HOLDING_LOCK_PERIOD;\r\n};\r\n\r\nexport const getRemainingLockTime = (holding) => {\r\n  if (!holding.lastBuyTime) return 0;\r\n  let lastBuyTimeMs;\r\n  if (holding.lastBuyTime instanceof Date) {\r\n    lastBuyTimeMs = holding.lastBuyTime.getTime();\r\n  } else if (holding.lastBuyTime?.toDate) {\r\n    lastBuyTimeMs = holding.lastBuyTime.toDate().getTime();\r\n  } else if (typeof holding.lastBuyTime === 'number') {\r\n    lastBuyTimeMs = holding.lastBuyTime;\r\n  } else if (typeof holding.lastBuyTime === 'string') {\r\n    lastBuyTimeMs = new Date(holding.lastBuyTime).getTime();\r\n  } else {\r\n    return 0;\r\n  }\r\n  const now = Date.now();\r\n  const timeSinceBuy = now - lastBuyTimeMs;\r\n  const remaining = HOLDING_LOCK_PERIOD - timeSinceBuy;\r\n  return Math.max(0, remaining);\r\n};\r\n\r\n// === UI 유틸리티 ===\r\nexport const getProductIcon = (productType) => {\r\n  switch (productType) {\r\n    case PRODUCT_TYPES.ETF: return \"\\u{1F4CA}\";\r\n    case PRODUCT_TYPES.BOND: return \"\\u{1F4DC}\";\r\n    default: return \"\\u{1F4C8}\";\r\n  }\r\n};\r\n\r\nexport const getProductBadgeClass = (productType) => {\r\n  switch (productType) {\r\n    case PRODUCT_TYPES.ETF: return \"etf\";\r\n    case PRODUCT_TYPES.BOND: return \"bond\";\r\n    default: return \"stock\";\r\n  }\r\n};\r\n\r\n// === 캐시 관련 ===\r\nexport const invalidateStockCache = (pattern) => {\r\n  if (globalCache && typeof globalCache.invalidatePattern === 'function') {\r\n    globalCache.invalidatePattern(pattern);\r\n  }\r\n};\r\n\r\nexport const clearLocalStorageBatchCache = () => {\r\n  try {\r\n    const keysToDelete = [];\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (key && key.includes('BATCH')) {\r\n        keysToDelete.push(key);\r\n      }\r\n    }\r\n    keysToDelete.forEach(key => {\r\n      localStorage.removeItem(key);\r\n    });\r\n    if (keysToDelete.length > 0) {\r\n      logger.log('[캐시] localStorage BATCH 캐시 삭제:', keysToDelete.length, '개');\r\n    }\r\n  } catch (error) {\r\n    logger.warn('[캐시] localStorage 정리 오류:', error);\r\n  }\r\n};\r\n","import React, {\n  useState,\n  useEffect,\n  useCallback,\n  useMemo,\n  useRef,\n} from \"react\";\nimport \"./StockExchange.css\";\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { db, functions } from \"../../firebase\";\n// 🔥 자동 상장/폐지: Firebase Functions에서 처리 (10분마다)\nimport { httpsCallable } from \"firebase/functions\";\nimport { usePolling } from \"../../hooks/usePolling\";\nimport {\n  collection,\n  doc,\n  getDocs,\n  setDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  serverTimestamp,\n  writeBatch,\n  where,\n  collectionGroup,\n} from \"firebase/firestore\";\n\nimport { globalCache } from \"../../services/globalCacheService\";\nimport { logActivity, ACTIVITY_TYPES } from \"../../utils/firestoreHelpers\";\n\nimport { logger } from \"../../utils/logger\";\n// 서비스 레이어 import\nimport {\n  batchDataLoader,\n  PRODUCT_TYPES,\n  SECTORS,\n  COMMISSION_RATE,\n  CACHE_TTL,\n  getMarketStateLabel,\n  formatCurrency,\n  formatPercent,\n  formatTime,\n  calculateStockTax,\n  canSellHolding,\n  getRemainingLockTime,\n  getProductIcon,\n  getProductBadgeClass,\n  invalidateStockCache as invalidateCache,\n  clearLocalStorageBatchCache,\n} from \"./stockExchangeService\";\n\n\n// === 아이콘 컴포넌트들 ===\nconst TrendingUp = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"22,7 13.5,15.5 8.5,10.5 2,17\" /><polyline points=\"16,7 22,7 22,13\" /></svg>\n);\nconst TrendingDown = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"22,17 13.5,8.5 8.5,13.5 2,7\" /><polyline points=\"16,17 22,17 22,11\" /></svg>\n);\nconst Settings = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><circle cx=\"12\" cy=\"12\" r=\"3\" /><path d=\"M12 1v6m0 6v6m11-7h-6m-6 0H1m17.5-3.5L19 10m-2 2l-2.5 2.5M6.5 6.5L9 9m-2 2l-2.5 2.5\" /></svg>\n);\nconst RefreshCw = ({ size = 16, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"23 4 23 10 17 10\"></polyline><polyline points=\"1 20 1 14 7 14\"></polyline><path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L20.49 10\"></path><path d=\"M20.49 15a9 9 0 0 1-14.85 3.36L3.51 14\"></path></svg>\n);\nconst BarChart3 = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><line x1=\"12\" y1=\"20\" x2=\"12\" y2=\"10\" /><line x1=\"18\" y1=\"20\" x2=\"18\" y2=\"4\" /><line x1=\"6\" y1=\"20\" x2=\"6\" y2=\"16\" /></svg>\n);\nconst ChevronDown = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"6 9 12 15 18 9\" /></svg>\n);\nconst ChevronUp = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"18 15 12 9 6 15\" /></svg>\n);\nconst Lock = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" /><path d=\"M7 11V7a5 5 0 0 1 10 0v4\" /></svg>\n);\n\n// === 상수 및 유틸리티 함수 → stockExchangeService.js에서 import됨 ===\n\n// === 개별 실제 주식 추가 컴포넌트 ===\nconst RealStockAdder = React.memo(({ onAddStock }) => {\n  const [showForm, setShowForm] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [formData, setFormData] = useState({ name: '', symbol: '', sector: 'TECH', productType: 'stock' });\n\n  const commonStocks = [\n    { name: '삼성전자', symbol: '005930.KS', type: '한국 주식' },\n    { name: 'SK하이닉스', symbol: '000660.KS', type: '한국 주식' },\n    { name: 'LG에너지솔루션', symbol: '373220.KS', type: '한국 주식' },\n    { name: 'NAVER', symbol: '035420.KS', type: '한국 주식' },\n    { name: '카카오', symbol: '035720.KS', type: '한국 주식' },\n    { name: '현대차', symbol: '005380.KS', type: '한국 주식' },\n    { name: 'Apple', symbol: 'AAPL', type: '미국 주식' },\n    { name: 'Microsoft', symbol: 'MSFT', type: '미국 주식' },\n    { name: 'Google', symbol: 'GOOGL', type: '미국 주식' },\n    { name: 'Tesla', symbol: 'TSLA', type: '미국 주식' },\n    { name: 'NVIDIA', symbol: 'NVDA', type: '미국 주식' },\n    { name: 'Amazon', symbol: 'AMZN', type: '미국 주식' },\n    { name: 'KODEX 200', symbol: '069500.KS', type: '한국 ETF' },\n    { name: 'KODEX 레버리지', symbol: '122630.KS', type: '한국 ETF' },\n    { name: 'TIGER 미국S&P500', symbol: '360750.KS', type: '한국 ETF' },\n    { name: 'SPY', symbol: 'SPY', type: '미국 ETF (S&P500)' },\n    { name: 'QQQ', symbol: 'QQQ', type: '미국 ETF (나스닥100)' },\n    { name: 'TLT', symbol: 'TLT', type: '채권 ETF (미국 장기국채)' },\n    { name: 'GLD', symbol: 'GLD', type: '원자재 ETF (금)' },\n  ];\n\n  const handleQuickAdd = async (stock) => {\n    if (isAdding) return;\n    setIsAdding(true);\n    try {\n      await onAddStock({ name: stock.name, symbol: stock.symbol });\n      alert(`${stock.name} 추가 완료!`);\n    } catch (error) {\n      alert('추가 실패: ' + error.message);\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  const handleCustomAdd = async () => {\n    if (!formData.name || !formData.symbol) {\n      alert('이름과 심볼을 모두 입력해주세요.');\n      return;\n    }\n    if (isAdding) return;\n    setIsAdding(true);\n    try {\n      await onAddStock(formData);\n      alert(`${formData.name} 추가 완료!`);\n      setFormData({ name: '', symbol: '', sector: 'TECH', productType: 'stock' });\n      setShowForm(false);\n    } catch (error) {\n      alert('추가 실패: ' + error.message);\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  return (\n    <div className=\"mt-2.5\">\n      <button onClick={() => setShowForm(!showForm)} className=\"btn btn-secondary w-full mb-2.5\">\n        {showForm ? '접기' : '➕ 개별 주식/ETF 추가'}\n      </button>\n      {showForm && (\n        <div className=\"bg-[rgba(20,20,35,0.8)] p-3 rounded-lg border border-white/10\">\n          <p className=\"text-[0.85rem] text-slate-400 mb-2.5\">\n            📌 빠른 추가 (클릭하면 바로 추가됩니다)\n          </p>\n          <div className=\"flex flex-wrap gap-1.5 mb-4\">\n            {commonStocks.map(stock => (\n              <button\n                key={stock.symbol}\n                onClick={() => handleQuickAdd(stock)}\n                disabled={isAdding}\n                className={`px-2 py-1 text-xs text-white rounded cursor-pointer whitespace-nowrap ${\n                  stock.type.includes('ETF') ? 'bg-blue-500/20 border border-blue-500/30'\n                  : stock.type.includes('채권') ? 'bg-amber-500/20 border border-amber-500/30'\n                  : stock.type.includes('원자재') ? 'bg-pink-500/20 border border-pink-500/30'\n                  : 'bg-emerald-500/20 border border-emerald-500/30'\n                }`}\n                title={`${stock.type} - ${stock.symbol}`}\n              >\n                {stock.name}\n              </button>\n            ))}\n          </div>\n          <p className=\"text-[0.85rem] text-slate-400 mb-2\">\n            ✏️ 직접 입력 (Yahoo Finance 심볼 사용)\n          </p>\n          <div className=\"flex gap-2 flex-wrap\">\n            <input\n              type=\"text\"\n              placeholder=\"이름 (예: 삼성전자)\"\n              value={formData.name}\n              onChange={e => setFormData(p => ({ ...p, name: e.target.value }))}\n              className=\"flex-1 min-w-[120px] p-2 rounded border border-white/20 bg-black/30 text-white\"\n            />\n            <input\n              type=\"text\"\n              placeholder=\"심볼 (예: 005930.KS)\"\n              value={formData.symbol}\n              onChange={e => setFormData(p => ({ ...p, symbol: e.target.value }))}\n              className=\"flex-1 min-w-[120px] p-2 rounded border border-white/20 bg-black/30 text-white\"\n            />\n            <button onClick={handleCustomAdd} disabled={isAdding} className=\"btn btn-success px-4 py-2\">\n              {isAdding ? '추가 중...' : '추가'}\n            </button>\n          </div>\n          <p className=\"text-xs text-gray-400 mt-2\">\n            💡 한국 주식: 종목코드.KS (예: 005930.KS) | 미국 주식: 티커 (예: AAPL, TSLA)\n          </p>\n        </div>\n      )}\n    </div>\n  );\n});\n\n// === 관리자 패널 컴포넌트 ===\nconst AdminPanel = React.memo(({ stocks, classCode, onClose, onAddStock, onDeleteStock, onEditStock, onToggleManualStock, cacheStats, onManualUpdate, onCreateRealStocks, onUpdateRealStocks, onAddSingleRealStock, onDeleteSimulationStocks }) => {\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [isCreatingRealStocks, setIsCreatingRealStocks] = useState(false);\n  const [isUpdatingRealStocks, setIsUpdatingRealStocks] = useState(false);\n  const [isDeletingSimulation, setIsDeletingSimulation] = useState(false);\n  const [newStock, setNewStock] = useState({\n    name: \"\",\n    price: \"\",\n    minListingPrice: \"\",\n    isManual: false,\n    sector: \"TECH\",\n    productType: PRODUCT_TYPES.STOCK,\n    maturityYears: \"\",\n    couponRate: \"\"\n  });\n\n  const handleManualUpdate = async () => {\n    if (isUpdating) return;\n    setIsUpdating(true);\n    try {\n      await onManualUpdate();\n      alert(\"주식 가격 업데이트 완료!\");\n    } catch (error) {\n      alert(\"업데이트 실패: \" + error.message);\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleCreateRealStocks = async () => {\n    if (!window.confirm(\"실제 주식 데이터(삼성전자, 애플 등)를 생성하시겠습니까?\\n(Yahoo Finance에서 실시간 가격을 가져옵니다)\")) {\n      return;\n    }\n    if (isCreatingRealStocks) return;\n    setIsCreatingRealStocks(true);\n    try {\n      await onCreateRealStocks();\n      alert(\"실제 주식이 생성되었습니다! 15분마다 자동으로 가격이 업데이트됩니다.\");\n    } catch (error) {\n      alert(\"실제 주식 생성 실패: \" + error.message);\n    } finally {\n      setIsCreatingRealStocks(false);\n    }\n  };\n\n  const handleUpdateRealStocks = async () => {\n    if (isUpdatingRealStocks) return;\n    setIsUpdatingRealStocks(true);\n    try {\n      await onUpdateRealStocks();\n      alert(\"실제 주식 가격이 업데이트되었습니다!\");\n    } catch (error) {\n      alert(\"실제 주식 업데이트 실패: \" + error.message);\n    } finally {\n      setIsUpdatingRealStocks(false);\n    }\n  };\n\n  const handleDeleteSimulationStocks = async () => {\n    if (!window.confirm(\"⚠️ 모든 시뮬레이션 주식을 삭제하시겠습니까?\\n\\n이 작업은 되돌릴 수 없습니다.\\n(실제 주식은 유지됩니다)\")) {\n      return;\n    }\n    if (isDeletingSimulation) return;\n    setIsDeletingSimulation(true);\n    try {\n      await onDeleteSimulationStocks();\n      alert(\"시뮬레이션 주식이 삭제되었습니다!\");\n    } catch (error) {\n      alert(\"삭제 실패: \" + error.message);\n    } finally {\n      setIsDeletingSimulation(false);\n    }\n  };\n\n  const handleAddStock = async () => {\n    if (!newStock.name || !newStock.price || !newStock.minListingPrice) return alert(\"모든 필드를 입력해주세요.\");\n    const price = parseFloat(newStock.price);\n    const minPrice = parseFloat(newStock.minListingPrice);\n    if (price <= 0 || minPrice <= 0) return alert(\"가격은 0보다 커야 합니다.\");\n\n    const stockData = {\n      name: newStock.name,\n      price,\n      minListingPrice: minPrice,\n      isListed: true,\n      isManual: newStock.isManual,\n      sector: newStock.sector,\n      productType: newStock.productType,\n      buyVolume: 0,\n      sellVolume: 0,\n      recentBuyVolume: 0,\n      recentSellVolume: 0,\n      volatility: newStock.productType === PRODUCT_TYPES.BOND ? 0.005 : 0.02\n    };\n\n    if (newStock.productType === PRODUCT_TYPES.BOND) {\n      stockData.maturityYears = parseFloat(newStock.maturityYears) || 10;\n      stockData.couponRate = parseFloat(newStock.couponRate) || 3.5;\n      stockData.sector = \"GOVERNMENT\";\n    }\n\n    if (newStock.productType === PRODUCT_TYPES.ETF) {\n      stockData.sector = \"INDEX\";\n    }\n\n    await onAddStock(stockData);\n    setNewStock({ name: \"\", price: \"\", minListingPrice: \"\", isManual: false, sector: \"TECH\", productType: PRODUCT_TYPES.STOCK, maturityYears: \"\", couponRate: \"\" });\n    setShowAddForm(false);\n  };\n\n  return (\n    <div className=\"admin-panel-fullscreen\">\n      <div className=\"admin-header\">\n        <h2><Settings size={24} /> 관리자 패널 ({classCode})</h2>\n        <div className=\"flex gap-2.5 items-center\">\n          <div className=\"text-[0.85rem] text-gray-500\">\n            캐시 통계: 적중 {cacheStats.hits}, 누락 {cacheStats.misses}, 절약 {cacheStats.savings}회\n          </div>\n          <button onClick={onClose} className=\"btn btn-danger\">닫기</button>\n        </div>\n      </div>\n      <div className=\"admin-content\">\n        <div className=\"admin-section\">\n          <h3>📊 실제 주식 관리 (Yahoo Finance)</h3>\n          <div className=\"mb-5 p-4 bg-emerald-500/10 rounded-lg border border-emerald-500/30\">\n            <p className=\"mb-2.5 text-emerald-400 text-[0.9rem]\">\n              🌐 실제 주식 데이터를 Yahoo Finance에서 가져옵니다.<br />\n              📈 삼성전자, SK하이닉스, 애플, 테슬라, ETF, 채권 ETF 등 지원<br />\n              ⏰ 15분마다 자동으로 가격이 업데이트됩니다. | 💱 환율: 하루 1회 자동 업데이트\n            </p>\n            <div className=\"flex gap-2.5 mb-2.5\">\n              <button\n                onClick={handleCreateRealStocks}\n                disabled={isCreatingRealStocks}\n                className=\"btn btn-success flex-1 p-3 text-[0.9rem] font-bold\"\n              >\n                {isCreatingRealStocks ? '⏳ 생성 중...' : '🏢 기본 주식 생성'}\n              </button>\n              <button\n                onClick={handleUpdateRealStocks}\n                disabled={isUpdatingRealStocks}\n                className=\"btn btn-primary flex-1 p-3 text-[0.9rem] font-bold\"\n              >\n                {isUpdatingRealStocks ? '⏳ 업데이트 중...' : '🔄 가격 즉시 업데이트'}\n              </button>\n            </div>\n            <RealStockAdder onAddStock={onAddSingleRealStock} />\n            <div className=\"mt-2.5 pt-2.5 border-t border-white/10\">\n              <button\n                onClick={handleDeleteSimulationStocks}\n                disabled={isDeletingSimulation}\n                className=\"btn btn-danger w-full p-2.5 text-[0.85rem]\"\n              >\n                {isDeletingSimulation ? '⏳ 삭제 중...' : '🗑️ 시뮬레이션 주식 전체 삭제'}\n              </button>\n              <p className=\"text-xs text-gray-400 mt-1 text-center\">\n                ⚠️ 실제 주식(실시간)만 남기고 가상 주식을 모두 삭제합니다\n              </p>\n            </div>\n          </div>\n        </div>\n        <div className=\"admin-section\">\n          <h3><BarChart3 size={20} /> 상품 목록 관리</h3>\n          <div className=\"admin-stock-list\">\n            {stocks.map(stock => (\n              <div key={stock.id} className=\"admin-stock-item\">\n                <div className=\"admin-stock-info\">\n                  <span className=\"stock-name\">\n                    {getProductIcon(stock.productType)} {stock.name}\n                    {stock.isRealStock && <span className=\"ml-1.5 bg-emerald-500 text-white text-[0.65rem] px-1 py-px rounded-sm font-bold\">실시간</span>}\n                  </span>\n                  <span className=\"stock-details\">\n                    {formatCurrency(stock.price)} | {SECTORS[stock.sector]?.name || '기타'} | {stock.isListed ? '상장' : '상장폐지'} | {stock.isManual ? '수동' : stock.isRealStock ? '실시간' : '자동'}\n                    {stock.productType === PRODUCT_TYPES.BOND && ` | 만기: ${stock.maturityYears}년 | 이자율: ${stock.couponRate}%`}\n                  </span>\n                </div>\n                <div className=\"form-actions\">\n                  <button onClick={() => onEditStock(stock.id)} className=\"btn btn-primary\">가격 수정</button>\n                  <button onClick={() => onToggleManualStock(stock.id, stock.isListed)} className={`btn ${stock.isListed ? 'btn-secondary' : 'btn-success'}`}>{stock.isListed ? '상장폐지' : '재상장'}</button>\n                  <button onClick={() => onDeleteStock(stock.id, stock.name)} className=\"btn btn-danger\">삭제</button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div className=\"admin-section\">\n          <h3>새 상품 추가</h3>\n          <button onClick={() => setShowAddForm(!showAddForm)} className=\"btn btn-primary\">{showAddForm ? '취소' : '새 상품 추가 양식 열기'}</button>\n          {showAddForm && (\n            <div className=\"add-stock-form\">\n              <div className=\"form-grid\">\n                <div className=\"form-group\">\n                  <label className=\"form-label\">상품 유형</label>\n                  <select value={newStock.productType} onChange={e => setNewStock(p => ({ ...p, productType: e.target.value }))} className=\"form-input\">\n                    <option value={PRODUCT_TYPES.STOCK}>주식</option>\n                    <option value={PRODUCT_TYPES.ETF}>ETF/지수</option>\n                    <option value={PRODUCT_TYPES.BOND}>채권</option>\n                  </select>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">상품명</label>\n                  <input type=\"text\" value={newStock.name} onChange={e => setNewStock(p => ({ ...p, name: e.target.value }))} className=\"form-input\"\n                    placeholder={newStock.productType === PRODUCT_TYPES.BOND ? \"예: 국고채 10년\" : newStock.productType === PRODUCT_TYPES.ETF ? \"예: KOSPI 200\" : \"예: 삼성전자\"} />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">초기 가격</label>\n                  <input type=\"number\" value={newStock.price} onChange={e => setNewStock(p => ({ ...p, price: e.target.value }))} className=\"form-input\" />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">최소 상장가</label>\n                  <input type=\"number\" value={newStock.minListingPrice} onChange={e => setNewStock(p => ({ ...p, minListingPrice: e.target.value }))} className=\"form-input\" />\n                </div>\n                {newStock.productType === PRODUCT_TYPES.STOCK && (\n                  <div className=\"form-group\">\n                    <label className=\"form-label\">섹터</label>\n                    <select value={newStock.sector} onChange={e => setNewStock(p => ({ ...p, sector: e.target.value }))} className=\"form-input\">\n                      {Object.entries(SECTORS).filter(([key]) => !['INDEX', 'GOVERNMENT', 'CORPORATE'].includes(key)).map(([key, value]) => (\n                        <option key={key} value={key}>{value.name}</option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                {newStock.productType === PRODUCT_TYPES.BOND && (\n                  <>\n                    <div className=\"form-group\">\n                      <label className=\"form-label\">만기 (년)</label>\n                      <input type=\"number\" value={newStock.maturityYears} onChange={e => setNewStock(p => ({ ...p, maturityYears: e.target.value }))} className=\"form-input\" placeholder=\"예: 10\" />\n                    </div>\n                    <div className=\"form-group\">\n                      <label className=\"form-label\">표면이자율 (%)</label>\n                      <input type=\"number\" step=\"0.1\" value={newStock.couponRate} onChange={e => setNewStock(p => ({ ...p, couponRate: e.target.value }))} className=\"form-input\" placeholder=\"예: 3.5\" />\n                    </div>\n                  </>\n                )}\n                <div className=\"form-group checkbox-group\">\n                  <input type=\"checkbox\" checked={newStock.isManual} onChange={e => setNewStock(p => ({ ...p, isManual: e.target.checked }))} id=\"isManualCheckbox\" className=\"checkbox-input\" />\n                  <label htmlFor=\"isManualCheckbox\">수동 관리 (자동 가격 변동 제외)</label>\n                </div>\n              </div>\n              <div className=\"form-actions\">\n                <button onClick={handleAddStock} className=\"btn btn-success\">상품 추가</button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n});\n\n// === 메인 컴포넌트 ===\nconst StockExchange = () => {\n  const { user, userDoc, isAdmin, loading: authLoading, firebaseReady, functions, optimisticUpdate, refreshUserDocument } = useAuth();\n\n  // 🔥 [최적화] httpsCallable 메모이제이션 (매 렌더마다 재생성 방지)\n  const callables = useMemo(() => ({\n    getVacationModeStatus: httpsCallable(functions, 'getVacationModeStatus'),\n    toggleVacationMode: httpsCallable(functions, 'toggleVacationMode'),\n    updateStocksSnapshot: httpsCallable(functions, 'updateStocksSnapshot'),\n    addStockDoc: httpsCallable(functions, 'addStockDoc'),\n    buyStock: httpsCallable(functions, 'buyStock'),\n    sellStock: httpsCallable(functions, 'sellStock'),\n    manualUpdateStockMarket: httpsCallable(functions, 'manualUpdateStockMarket'),\n    createRealStocks: httpsCallable(functions, 'createRealStocks'),\n    updateRealStocks: httpsCallable(functions, 'updateRealStocks'),\n    addSingleRealStock: httpsCallable(functions, 'addSingleRealStock'),\n    deleteSimulationStocks: httpsCallable(functions, 'deleteSimulationStocks'),\n  }), [functions]);\n\n  const [classCode, setClassCode] = useState(null);\n  const [stocks, setStocks] = useState([]);\n  const [portfolio, setPortfolio] = useState([]);\n  const [showAdminPanel, setShowAdminPanel] = useState(false);\n  const [buyQuantities, setBuyQuantities] = useState({});\n  const [sellQuantities, setSellQuantities] = useState({});\n  const [isTrading, setIsTrading] = useState(false);\n  const [lockTimers, setLockTimers] = useState({});\n  const [activeTab, setActiveTab] = useState(\"stocks\");\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [isFetching, setIsFetching] = useState(false);\n  const [marketOpen, setMarketOpen] = useState(false);\n\n  // 🔥 방학 모드 상태 (슈퍼관리자 전용)\n  const [vacationMode, setVacationMode] = useState(false);\n  const [vacationLoading, setVacationLoading] = useState(false);\n\n  // 성능 최적화를 위한 상태 추가\n  const [cacheStatus, setCacheStatus] = useState({ hits: 0, misses: 0, savings: 0 });\n  const [lastBatchLoad, setLastBatchLoad] = useState(null);\n\n  const lastFetchTimeRef = useRef({\n    stocks: 0,\n    portfolio: 0,\n    marketStatus: 0,\n    batchLoad: 0\n  });\n\n  // 🔥 fetching 상태를 ref로 관리 (무한 루프 방지)\n  const isFetchingRef = useRef(false);\n\n  // 시장 개장 상태를 1분마다 확인하여 marketOpen 상태를 안정적으로 업데이트 (자동 폴링 시작 버그 수정)\n  useEffect(() => {\n    const checkMarketStatus = () => {\n      const now = new Date();\n\n      // 한국 시장 시간 체크 (09:00 ~ 15:30 KST)\n      const koreaTime = new Date(now.toLocaleString(\"en-US\", { timeZone: \"Asia/Seoul\" }));\n      const kstDay = koreaTime.getDay();\n      const kstHour = koreaTime.getHours();\n      const kstMinute = koreaTime.getMinutes();\n      const kstTotalMinutes = kstHour * 60 + kstMinute;\n      const isKoreaWeekday = kstDay >= 1 && kstDay <= 5;\n      const isKoreaMarketOpen = isKoreaWeekday && kstTotalMinutes >= 9 * 60 && kstTotalMinutes < 15 * 60 + 30;\n\n      // 미국 시장 시간 체크 (09:30 ~ 16:00 EST/EDT)\n      const usTime = new Date(now.toLocaleString(\"en-US\", { timeZone: \"America/New_York\" }));\n      const usDay = usTime.getDay();\n      const usHour = usTime.getHours();\n      const usMinute = usTime.getMinutes();\n      const usTotalMinutes = usHour * 60 + usMinute;\n      const isUsWeekday = usDay >= 1 && usDay <= 5;\n      const isUsMarketOpen = isUsWeekday && usTotalMinutes >= 9 * 60 + 30 && usTotalMinutes < 16 * 60;\n\n      // 한국 또는 미국 시장 중 하나라도 열려있으면 true\n      setMarketOpen(isKoreaMarketOpen || isUsMarketOpen);\n    };\n\n    checkMarketStatus(); // 초기 로드 시 즉시 확인\n    const interval = setInterval(checkMarketStatus, 60000); // 1분마다 확인\n\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    if (userDoc?.classCode) {\n      setClassCode(userDoc.classCode);\n    }\n  }, [userDoc]);\n\n  // 🔥 매도 제한 타이머: 1초마다 업데이트 (portfolio를 ref로 참조)\n  const portfolioRef = useRef(portfolio);\n\n  useEffect(() => {\n    portfolioRef.current = portfolio;\n  }, [portfolio]);\n\n  useEffect(() => {\n    // 포트폴리오가 없으면 타이머 불필요\n    if (!portfolioRef.current || portfolioRef.current.length === 0) return;\n\n    const interval = setInterval(() => {\n      const hasLocks = portfolioRef.current.some(h => getRemainingLockTime(h) > 0);\n      if (!hasLocks) return; // 잠금된 보유 주식이 없으면 상태 업데이트 스킵\n\n      setLockTimers(prevTimers => {\n        const newTimers = {};\n        portfolioRef.current.forEach(holding => {\n          const remaining = getRemainingLockTime(holding);\n          if (remaining > 0) {\n            newTimers[holding.id] = remaining;\n          }\n        });\n        return newTimers;\n      });\n    }, 1000);\n    return () => clearInterval(interval);\n  }, [portfolio.length]); // portfolio 변경 시 타이머 재설정\n\n  // 🔥 portfolio가 변경되면 즉시 타이머 재계산\n  useEffect(() => {\n    const newTimers = {};\n    portfolio.forEach(holding => {\n      const remaining = getRemainingLockTime(holding);\n      if (remaining > 0) {\n        newTimers[holding.id] = remaining;\n      }\n    });\n    setLockTimers(newTimers);\n  }, [portfolio]);\n\n  // === 최적화된 데이터 가져오기 함수 (배치 처리 사용) ===\n  const fetchAllData = useCallback(async (forceRefresh = false) => { // forceRefresh 기본값을 false로 되돌려 캐시 활성화\n    if (!user) return;\n    if (!classCode) return; // classCode가 없으면 데이터 로드하지 않음\n\n    if (isFetchingRef.current && !forceRefresh) {\n      logger.log('[StockExchange] 이미 fetching 중이므로 대기');\n      return;\n    }\n\n    const now = Date.now();\n\n    // usePolling이 간격을 제어하므로, 시간 기반 캐시 체크 로직은 제거하거나 수정할 수 있지만,\n    // 수동 새로고침 시에도 동작해야 하므로 유지.\n    const timeSinceLastBatch = now - lastFetchTimeRef.current.batchLoad;\n    if (!forceRefresh && timeSinceLastBatch <= CACHE_TTL.BATCH_DATA) {\n      return;\n    }\n\n    isFetchingRef.current = true;\n    setIsFetching(true);\n\n    try {\n      // usePolling에서 호출 시 항상 최신 데이터를 가져오도록 forceRefresh를 true로 전달\n      const batchResult = await batchDataLoader.loadBatchData(classCode, user.uid, forceRefresh);\n\n      if (batchResult.errors && batchResult.errors.length > 0) {\n        logger.warn('[StockExchange] 배치 로드 중 일부 오류 발생:', batchResult.errors);\n      }\n\n      setStocks(batchResult.stocks || []);\n      setPortfolio(batchResult.portfolio || []);\n\n      lastFetchTimeRef.current.batchLoad = now;\n      lastFetchTimeRef.current.stocks = now;\n      lastFetchTimeRef.current.portfolio = now;\n      lastFetchTimeRef.current.marketStatus = now;\n\n      setLastBatchLoad(new Date());\n      setLastUpdated(new Date());\n\n    } catch (error) {\n      logger.error('[StockExchange] 배치 로드 실패:', error);\n      // Polling 중에는 alert을 띄우지 않는 것이 사용자 경험에 좋음\n      // alert('데이터를 불러오는 중 오류가 발생했습니다.');\n    } finally {\n      isFetchingRef.current = false;\n      setIsFetching(false);\n    }\n  }, [classCode, user]); // isAdmin은 함수이므로 의존성 불필요\n\n  // === 데이터 자동 갱신 (Polling) ===\n  // 🔥 [최적화] 폴링 간격을 60분으로 완화 - 거래 시 forceRefresh로 즉시 갱신되므로 자동 갱신은 최소화\n  usePolling(fetchAllData, {\n    interval: 60 * 60 * 1000, // 🔥 [최적화] 60분마다 포트폴리오 갱신 (Firestore 읽기 최소화)\n    enabled: firebaseReady && !!user && !!classCode,\n    deps: [user, classCode, isAdmin]\n  });\n\n  // 🔥 [최적화] onSnapshot 리스너 제거 - 읽기 비용 절감\n  // 대신 10분마다 fetchAllData가 최신 데이터를 가져옴\n  // 사용자가 필요시 수동 새로고침 가능\n\n  // 🔥 FCM 푸시 알림 제거됨 (이유: 알림 스팸, 읽기 증가, 사용자 경험 악화)\n  // 대신 30분 캐시 + 시간당 1회 자동 폴링으로 부드러운 업데이트 제공\n\n  // === 자동 상장/폐지 관리는 Firebase Functions에서 처리 ===\n  // 10분마다 서버에서 자동으로 실행됨 (autoManageStocks 함수)\n  // 클라이언트에서는 별도 스케줄러 불필요\n\n  // === 시장 지수 계산 ===\n  // 시장 상태 시뮬레이션 비활성화\n\n  // 🔥 방학 모드 상태 조회 (슈퍼관리자 전용)\n  const fetchVacationMode = useCallback(async () => {\n    if (!userDoc?.isSuperAdmin) return;\n    try {\n      const getVacationModeStatusFn = callables.getVacationModeStatus;\n      const result = await getVacationModeStatusFn({});\n      setVacationMode(result.data.vacationMode);\n    } catch (error) {\n      logger.error('[fetchVacationMode] 조회 실패:', error);\n    }\n  }, [callables, userDoc?.isSuperAdmin]);\n\n  // 🔥 방학 모드 초기 로드\n  useEffect(() => {\n    if (userDoc?.isSuperAdmin && functions) {\n      fetchVacationMode();\n    }\n  }, [userDoc?.isSuperAdmin, functions, fetchVacationMode]);\n\n  // 🔥 방학 모드 토글 (슈퍼관리자 전용)\n  const toggleVacationMode = useCallback(async () => {\n    if (!userDoc?.isSuperAdmin) return;\n    setVacationLoading(true);\n    try {\n      const toggleVacationModeFn = callables.toggleVacationMode;\n      const result = await toggleVacationModeFn({ enabled: !vacationMode });\n      setVacationMode(result.data.vacationMode);\n      alert(result.data.message);\n    } catch (error) {\n      logger.error('[toggleVacationMode] 토글 실패:', error);\n      alert('방학 모드 설정 실패: ' + error.message);\n    } finally {\n      setVacationLoading(false);\n    }\n  }, [callables, userDoc?.isSuperAdmin, vacationMode]);\n\n  // 중앙 주식 스냅샷 문서 강제 갱신 (관리자 작업 후 읽기 최적화 유지)\n  const refreshStocksSnapshot = useCallback(async () => {\n    try {\n      const updateSnapshotFn = callables.updateStocksSnapshot;\n      await updateSnapshotFn({});\n      logger.log('[updateStocksSnapshot] 스냅샷 갱신 완료');\n    } catch (error) {\n      logger.error('[updateStocksSnapshot] 스냅샷 갱신 실패:', error);\n    }\n  }, [callables]);\n\n  // === 거래 함수들 (최적화된 캐시 무효화) ===\n  const addStock = useCallback(async (stockData) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    try {\n      // 관리자 권한으로 Cloud Function 먼저 시도 (Rules 우회)\n      const addStockFn = callables.addStockDoc;\n      await addStockFn({ stock: stockData });\n\n      await refreshStocksSnapshot();\n\n      // 캐시 무효화\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      alert(`${stockData.name} 상품이 추가되었습니다.`);\n    } catch (error) {\n      logger.error('[addStock] 함수 추가 실패, Firestore 직접 시도:', error);\n      try {\n        const stockRef = doc(collection(db, \"CentralStocks\"));\n        await setDoc(stockRef, {\n          ...stockData,\n          initialPrice: stockData.price,\n          priceHistory: [stockData.price],\n          createdAt: serverTimestamp(),\n          holderCount: 0,\n          tradingVolume: 1000,\n          buyVolume: 0,\n          sellVolume: 0,\n          recentBuyVolume: 0,\n          recentSellVolume: 0,\n          volatility: stockData.volatility || 0.02\n        });\n\n        await refreshStocksSnapshot();\n\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        await fetchAllData(true);\n\n        alert(`${stockData.name} 상품이 추가되었습니다.`);\n      } catch (innerError) {\n        logger.error('[addStock] Firestore 직접 추가 실패:', innerError);\n        alert(\"상품 추가 중 오류가 발생했습니다. 관리자 권한/Rules를 확인해주세요.\");\n      }\n    }\n  }, [classCode, user, fetchAllData, refreshStocksSnapshot, callables]);\n\n  const deleteStock = useCallback(async (stockId, stockName) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    if (window.confirm(`'${stockName}' 상품을 정말로 삭제하시겠습니까?`)) {\n      try {\n        await deleteDoc(doc(db, \"CentralStocks\", stockId));\n\n        await refreshStocksSnapshot();\n\n        // 캐시 무효화\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        await fetchAllData(true);\n\n        alert(`${stockName} 상품이 삭제되었습니다.`);\n      } catch (error) {\n        alert(\"상품 삭제 중 오류가 발생했습니다.\");\n      }\n    }\n  }, [classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const editStock = useCallback(async (stockId) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!stock) return;\n    const newPriceStr = prompt(`'${stock.name}'의 새로운 가격:`, stock.price.toString());\n    const newPrice = parseFloat(newPriceStr);\n    if (isNaN(newPrice) || newPrice <= 0) return alert(\"유효한 가격을 입력해주세요.\");\n    try {\n      await updateDoc(doc(db, \"CentralStocks\", stockId), {\n        price: newPrice,\n        priceHistory: [...(stock.priceHistory || []).slice(-19), newPrice]\n      });\n\n      await refreshStocksSnapshot();\n\n      // 캐시 무효화\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      alert('가격이 수정되었습니다.');\n    } catch (error) {\n      alert(\"가격 수정 중 오류가 발생했습니다.\");\n    }\n  }, [stocks, classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const toggleManualStock = useCallback(async (stockId, currentIsListed) => {\n    if (!classCode || !user) return alert(\"클래스 정보가 없습니다.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!stock) return;\n    const action = currentIsListed ? '상장폐지' : '재상장';\n\n    if (window.confirm(`'${stock.name}' 상품을 ${action}하시겠습니까?`)) {\n      try {\n        const updateData = currentIsListed\n          ? { isListed: false, price: 0, delistedAt: serverTimestamp() }\n          : { isListed: true, price: stock.minListingPrice, priceHistory: [stock.minListingPrice], delistedAt: null };\n\n        await updateDoc(doc(db, \"CentralStocks\", stockId), updateData);\n\n        if (currentIsListed) {\n          const batch = writeBatch(db);\n\n          const portfoliosToDelistQuery = query(\n            collectionGroup(db, 'portfolio'),\n            where('classCode', '==', classCode),\n            where('stockId', '==', stockId)\n          );\n\n          const snapshot = await getDocs(portfoliosToDelistQuery);\n\n          snapshot.forEach(doc => {\n            batch.update(doc.ref, { delistedAt: serverTimestamp() });\n          });\n\n          await batch.commit();\n        }\n\n        await refreshStocksSnapshot();\n\n        // 캐시 무효화\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        invalidateCache(`PORTFOLIO`);\n        await fetchAllData(true);\n\n        alert(`${action} 처리되었습니다.`);\n      } catch (error) {\n        alert(`${action} 처리 중 오류가 발생했습니다.`);\n      }\n    }\n  }, [stocks, classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const buyStock = useCallback(async (stockId, quantityString) => {\n    if (!marketOpen) return alert(\"주식시장이 마감되었습니다. 운영 시간: 월-금 오전 8시-오후 3시\");\n    if (isTrading || !classCode) return;\n    const quantity = parseInt(quantityString, 10);\n    if (isNaN(quantity) || quantity <= 0) return alert(\"유효한 수량을 입력해주세요.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!user || !stock || !stock.isListed) return alert(\"매수할 수 없는 상태입니다.\");\n\n    const cost = stock.price * quantity;\n    const commission = Math.round(cost * COMMISSION_RATE);\n    const taxRate = 0.01; // 기본 거래세율 1%\n    const taxAmount = Math.floor(cost * taxRate);\n    const totalCost = cost + commission + taxAmount;\n\n    logger.log('[buyStock] 매수 시작:', { stockId, stockName: stock.name, quantity, totalCost });\n\n    // 🔥 즉시 UI 업데이트 (낙관적 업데이트)\n    if (optimisticUpdate) {\n      optimisticUpdate({ cash: -totalCost });\n    }\n\n    setIsTrading(true);\n    try {\n      // Cloud Function 호출\n      const buyStockFunction = callables.buyStock;\n      const result = await buyStockFunction({ stockId, quantity });\n\n      logger.log('[buyStock] 매수 성공:', result.data);\n\n      // 🔥 [수정] 서버에서 받은 정확한 잔액으로 낙관적 업데이트 보정\n      if (result.data.newBalance !== undefined && optimisticUpdate) {\n        const currentCash = userDoc?.cash || 0;\n        const cashDiff = result.data.newBalance - currentCash;\n        optimisticUpdate({ cash: cashDiff });\n        logger.log('[buyStock] 현금 정확한 값으로 업데이트:', result.data.newBalance);\n      }\n\n      // 🔥 [최적화] 캐시 무효화 (통합)\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`PORTFOLIO_user_${user.uid}`);\n      clearLocalStorageBatchCache();\n\n      // 🔥 [최적화] 포트폴리오만 로컬에서 업데이트 - 전체 fetchAllData 호출 제거\n      // 서버에서 반환된 데이터로 포트폴리오 상태 직접 업데이트\n      setPortfolio(prev => {\n        const existingIndex = prev.findIndex(h => h.stockId === stockId);\n        if (existingIndex >= 0) {\n          const existing = prev[existingIndex];\n          const newQuantity = existing.quantity + quantity;\n          const newAvgPrice = ((existing.averagePrice * existing.quantity) + (stock.price * quantity)) / newQuantity;\n          return [\n            ...prev.slice(0, existingIndex),\n            { ...existing, quantity: newQuantity, averagePrice: newAvgPrice, lastBuyTime: new Date() },\n            ...prev.slice(existingIndex + 1)\n          ];\n        } else {\n          return [...prev, {\n            id: `temp_${Date.now()}`,\n            stockId,\n            stockName: stock.name,\n            quantity,\n            averagePrice: stock.price,\n            classCode,\n            lastBuyTime: new Date()\n          }];\n        }\n      });\n\n      setBuyQuantities(prev => ({ ...prev, [stockId]: \"\" }));\n\n      // 🔥 활동 로그 기록 (주식 매수)\n      logActivity(db, {\n        classCode,\n        userId: user.uid,\n        userName: userDoc?.name || user.displayName || '사용자',\n        type: ACTIVITY_TYPES.STOCK_BUY,\n        description: `${stock.name} ${quantity}주 매수 (${formatCurrency(totalCost)})`,\n        amount: -totalCost,\n        metadata: {\n          stockId,\n          stockName: stock.name,\n          quantity,\n          pricePerShare: stock.price,\n          commission,\n          taxAmount,\n          totalCost\n        }\n      });\n\n      alert(`${stock.name} ${quantity}주 매수 완료!\\n수수료: ${formatCurrency(commission)}`);\n    } catch (error) {\n      logger.error('[buyStock] 매수 실패:', error);\n\n      // 실패 시 롤백 (낙관적 업데이트 취소)\n      if (optimisticUpdate) {\n        optimisticUpdate({ cash: totalCost });\n      }\n\n      alert(error.message || '매수 처리 중 오류가 발생했습니다.');\n    } finally {\n      setIsTrading(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [stocks, user, userDoc?.cash, userDoc?.name, isTrading, classCode, marketOpen, functions, optimisticUpdate]); // fetchAllData, invalidateCache, refreshUserDocument는 외부 스코프 함수로 제외\n\n  const sellStock = useCallback(async (holdingId, quantityString) => {\n    if (!marketOpen) return alert(\"주식시장이 마감되었습니다. 운영 시간: 월-금 오전 8시-오후 3시\");\n    if (isTrading) return;\n    const quantity = parseInt(quantityString, 10);\n    if (isNaN(quantity) || quantity <= 0) return alert(\"유효한 수량을 입력해주세요.\");\n    const holding = portfolio.find(h => h.id === holdingId);\n    if (!user || !userDoc || !holding || quantity > holding.quantity) return alert(\"매도할 수 없는 상태입니다.\");\n    if (holding.delistedAt) return alert(\"상장폐지된 상품은 매도할 수 없습니다.\");\n\n    if (!canSellHolding(holding)) {\n      const remaining = getRemainingLockTime(holding);\n      return alert(`매수 후 1시간 동안은 매도할 수 없습니다.\\n남은 시간: ${formatTime(remaining)}`);\n    }\n\n    const stock = stocks.find(s => s.id === holding.stockId);\n    if (!stock || !stock.isListed) return alert(\"현재 거래할 수 없는 상품입니다.\");\n\n    // 예상 수익 계산 (낙관적 업데이트용)\n    const sellPrice = stock.price * quantity;\n    const commission = Math.round(sellPrice * COMMISSION_RATE);\n    const profit = (stock.price - holding.averagePrice) * quantity;\n    const profitTax = profit > 0 ? Math.floor(profit * 0.22) : 0;\n    const transactionTax = Math.floor(sellPrice * 0.01);\n    const totalTax = profitTax + transactionTax;\n    const estimatedNetRevenue = sellPrice - commission - totalTax;\n\n    logger.log('[sellStock] 매도 시작:', { holdingId, stockName: stock.name, quantity, estimatedNetRevenue });\n\n    // 🔥 즉시 UI 업데이트 (낙관적 업데이트)\n    if (optimisticUpdate) {\n      optimisticUpdate({ cash: estimatedNetRevenue });\n    }\n\n    setIsTrading(true);\n\n    try {\n      const sellStockFunction = callables.sellStock;\n      const result = await sellStockFunction({ holdingId, quantity });\n\n      logger.log('[sellStock] 매도 성공:', result.data);\n\n      // 🔥 [수정] 서버에서 받은 정확한 잔액으로 낙관적 업데이트 보정\n      if (result.data.newBalance !== undefined && optimisticUpdate) {\n        const currentCash = userDoc?.cash || 0;\n        const cashDiff = result.data.newBalance - currentCash;\n        optimisticUpdate({ cash: cashDiff });\n        logger.log('[sellStock] 현금 정확한 값으로 업데이트:', result.data.newBalance);\n      }\n\n      // 🔥 [최적화] 캐시 무효화 (통합)\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`PORTFOLIO_user_${user.uid}`);\n      clearLocalStorageBatchCache();\n\n      // 🔥 [최적화] 포트폴리오 로컬 업데이트 - fetchAllData 호출 제거\n      setPortfolio(prev => {\n        const existingIndex = prev.findIndex(h => h.id === holdingId);\n        if (existingIndex >= 0) {\n          const existing = prev[existingIndex];\n          const newQuantity = existing.quantity - quantity;\n          if (newQuantity <= 0) {\n            // 전량 매도 시 포트폴리오에서 제거\n            return [...prev.slice(0, existingIndex), ...prev.slice(existingIndex + 1)];\n          } else {\n            return [\n              ...prev.slice(0, existingIndex),\n              { ...existing, quantity: newQuantity },\n              ...prev.slice(existingIndex + 1)\n            ];\n          }\n        }\n        return prev;\n      });\n\n      setSellQuantities(prev => ({ ...prev, [holdingId]: \"\" }));\n\n      const { stockName, sellPrice: actualSellPrice, commission: actualCommission, totalTax: actualTax, profit: actualProfit, netRevenue } = result.data;\n\n      // 🔥 활동 로그 기록 (주식 매도)\n      logActivity(db, {\n        classCode,\n        userId: user.uid,\n        userName: userDoc?.name || user.displayName || '사용자',\n        type: ACTIVITY_TYPES.STOCK_SELL,\n        description: `${stockName} ${quantity}주 매도 (순수익: ${formatCurrency(netRevenue)})`,\n        amount: netRevenue,\n        metadata: {\n          holdingId,\n          stockName,\n          quantity,\n          sellPrice: actualSellPrice,\n          commission: actualCommission,\n          tax: actualTax,\n          profit: actualProfit,\n          netRevenue\n        }\n      });\n\n      const taxInfo = actualTax > 0 ? `\\n세금: ${formatCurrency(actualTax)}` : '';\n      alert(`${stockName} ${quantity}주 매도 완료!\\n수익: ${formatCurrency(actualProfit)}${taxInfo}\\n수수료: ${formatCurrency(actualCommission)}\\n순수익: ${formatCurrency(netRevenue)}`);\n    } catch (error) {\n      logger.error('[sellStock] 매도 실패:', error);\n\n      // 실패 시 롤백 (낙관적 업데이트 취소)\n      if (optimisticUpdate) {\n        optimisticUpdate({ cash: -estimatedNetRevenue });\n      }\n\n      alert(error.message || '매도 처리 중 오류가 발생했습니다.');\n    } finally {\n      setIsTrading(false);\n    }\n  }, [stocks, portfolio, user, userDoc, isTrading, classCode, marketOpen, callables, optimisticUpdate]); // fetchAllData와 refreshUserDocument 제거 - 불필요한 리렌더링 방지\n\n  const deleteHolding = useCallback(async (holdingId) => {\n    if (!user || !classCode) return;\n    if (window.confirm(\"이 상품(휴지조각)을 포트폴리오에서 삭제하시겠습니까?\")) {\n      try {\n        await deleteDoc(doc(db, \"users\", user.uid, \"portfolio\", holdingId));\n\n        // 캐시 무효화\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`PORTFOLIO_user_${user.uid}`);\n        await fetchAllData(true);\n\n        alert(\"삭제되었습니다.\");\n      } catch (error) {\n        alert(\"삭제 중 오류가 발생했습니다.\");\n      }\n    }\n  }, [user, classCode, fetchAllData]);\n\n  // 🔥 수동으로 주식 시장 업데이트 (관리자 전용)\n  const manualUpdateStockMarket = useCallback(async () => {\n    if (!classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      logger.log('[manualUpdateStockMarket] 수동 업데이트 시작');\n      const manualUpdateFunction = callables.manualUpdateStockMarket;\n      const result = await manualUpdateFunction({});\n\n      logger.log('[manualUpdateStockMarket] 업데이트 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      logger.error('[manualUpdateStockMarket] 업데이트 실패:', error);\n      throw error;\n    }\n  }, [callables, classCode, user, fetchAllData]);\n\n  // 🔥 실제 주식 생성 (관리자 전용)\n  const createRealStocks = useCallback(async () => {\n    if (!classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      logger.log('[createRealStocks] 실제 주식 생성 시작');\n      const createRealStocksFunction = callables.createRealStocks;\n      const result = await createRealStocksFunction({});\n\n      logger.log('[createRealStocks] 생성 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      logger.error('[createRealStocks] 생성 실패:', error);\n      throw error;\n    }\n  }, [callables, classCode, user, fetchAllData]);\n\n  // 🔥 실제 주식 가격 수동 업데이트 (관리자 전용)\n  const updateRealStocks = useCallback(async () => {\n    if (!classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      logger.log('[updateRealStocks] 실제 주식 업데이트 시작');\n      const updateRealStocksFunction = callables.updateRealStocks;\n      const result = await updateRealStocksFunction({});\n\n      logger.log('[updateRealStocks] 업데이트 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      logger.error('[updateRealStocks] 업데이트 실패:', error);\n      throw error;\n    }\n  }, [callables, classCode, user, fetchAllData]);\n\n  // 🔥 개별 실제 주식 추가 (관리자 전용)\n  const addSingleRealStock = useCallback(async ({ name, symbol, sector, productType }) => {\n    if (!classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      logger.log('[addSingleRealStock] 개별 실제 주식 추가 시작:', name);\n      const addSingleRealStockFunction = callables.addSingleRealStock;\n      const result = await addSingleRealStockFunction({ name, symbol, sector, productType });\n\n      logger.log('[addSingleRealStock] 추가 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      logger.error('[addSingleRealStock] 추가 실패:', error);\n      throw error;\n    }\n  }, [callables, classCode, user, fetchAllData]);\n\n  // 🔥 시뮬레이션 주식 전체 삭제 (관리자 전용)\n  const deleteSimulationStocks = useCallback(async () => {\n    if (!classCode || !user) {\n      throw new Error(\"Firebase Functions가 초기화되지 않았습니다.\");\n    }\n\n    try {\n      logger.log('[deleteSimulationStocks] 시뮬레이션 주식 삭제 시작');\n      const deleteSimulationStocksFunction = callables.deleteSimulationStocks;\n      const result = await deleteSimulationStocksFunction({});\n\n      logger.log('[deleteSimulationStocks] 삭제 성공:', result.data);\n\n      // 캐시 무효화 및 데이터 새로고침\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      logger.error('[deleteSimulationStocks] 삭제 실패:', error);\n      throw error;\n    }\n  }, [callables, classCode, user, fetchAllData]);\n\n  // === stocks 데이터를 Map으로 변환하여 조회 성능 향상 ===\n  const stocksMap = useMemo(() => {\n    const map = new Map();\n    stocks.forEach(stock => map.set(stock.id, stock));\n    return map;\n  }, [stocks]);\n\n  // === 계산된 값들 ===\n  const portfolioStats = useMemo(() => {\n    let totalValue = 0, totalInvested = 0;\n    portfolio.forEach(holding => {\n      const investedValue = holding.averagePrice * holding.quantity;\n      totalInvested += investedValue;\n      if (!holding.delistedAt) {\n        const stock = stocksMap.get(holding.stockId);\n        if (stock && stock.isListed) totalValue += stock.price * holding.quantity;\n      }\n    });\n    const totalProfit = totalValue - totalInvested;\n    const profitPercent = totalInvested > 0 ? (totalProfit / totalInvested) * 100 : 0;\n    return { totalValue, totalInvested, totalProfit, profitPercent };\n  }, [portfolio, stocksMap]);\n\n  const categoryCounts = useMemo(() => {\n    const counts = { stocks: 0, etfs: 0, bonds: 0 };\n    stocks.forEach(s => {\n      if (!s.isListed) return;\n      if (s.productType === PRODUCT_TYPES.ETF) {\n        counts.etfs++;\n      } else if (s.productType === PRODUCT_TYPES.BOND) {\n        counts.bonds++;\n      } else {\n        counts.stocks++;\n      }\n    });\n    return counts;\n  }, [stocks]);\n\n  const filteredStocks = useMemo(() => {\n    return stocks.filter(s => {\n      if (!s.isListed) return false;\n      if (activeTab === \"stocks\") return s.productType === PRODUCT_TYPES.STOCK || !s.productType;\n      if (activeTab === \"etfs\") return s.productType === PRODUCT_TYPES.ETF;\n      if (activeTab === \"bonds\") return s.productType === PRODUCT_TYPES.BOND;\n      return false;\n    });\n  }, [stocks, activeTab]);\n\n  const [showAllStocks, setShowAllStocks] = useState(false);\n\n  const displayedStocks = useMemo(() => {\n    return showAllStocks ? filteredStocks : filteredStocks.slice(0, 20);\n  }, [filteredStocks, showAllStocks]);\n\n  // === 수동 새로고침 함수 ===\n  const handleManualRefresh = useCallback(() => {\n    if (!classCode || !user) return;\n    // 캐시 강제 삭제\n    const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n    globalCache.invalidate(batchKey);\n    fetchAllData(true);\n  }, [fetchAllData, classCode, user]);\n\n  if (authLoading || !firebaseReady) return <div className=\"loading-message\">데이터를 불러오는 중입니다...</div>;\n  if (!user || !userDoc) return <div className=\"loading-message\">로그인이 필요합니다.</div>;\n\n  // 학생 사용자가 학급에 배정되지 않은 경우 안내 메시지 표시\n  if (!isAdmin() && (!classCode || classCode === '미지정')) {\n    return (\n      <div className=\"stock-exchange-container\">\n        <header className=\"stock-header\">\n          <div className=\"stock-header-content\">\n            <div className=\"logo-title\">\n              <BarChart3 size={32} color=\"white\" /><h1>투자 거래소</h1>\n            </div>\n          </div>\n        </header>\n        <main className=\"market-section flex justify-center items-center\">\n          <div className=\"text-center p-5 bg-white rounded-lg shadow-[0_2px_10px_rgba(0,0,0,0.1)]\">\n            <h2>학급 미배정 안내</h2>\n            <p className=\"mt-2.5 text-base text-gray-700\">\n              소속된 학급이 없어 주식 시장을 이용할 수 없습니다.\n            </p>\n            <p className=\"mt-1 text-[0.9rem] text-gray-500\">\n              담당 선생님께 문의하여 학급에 등록해주세요.\n            </p>\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  if (!classCode && !authLoading) return <div className=\"loading-message\">참여 중인 클래스 정보를 불러오는 중...</div>;\n  if (showAdminPanel && isAdmin()) return <AdminPanel stocks={stocks} classCode={classCode} onClose={() => setShowAdminPanel(false)} onAddStock={addStock} onDeleteStock={deleteStock} onEditStock={editStock} onToggleManualStock={toggleManualStock} cacheStats={cacheStatus} onManualUpdate={manualUpdateStockMarket} onCreateRealStocks={createRealStocks} onUpdateRealStocks={updateRealStocks} onAddSingleRealStock={addSingleRealStock} onDeleteSimulationStocks={deleteSimulationStocks} />;\n\n  return (\n    <div className=\"stock-exchange-container\">\n      <header className=\"stock-header\">\n        <div className=\"stock-header-content\">\n          <div className=\"logo-title\">\n            <BarChart3 size={32} color=\"white\" /><h1>투자 거래소 ({classCode})</h1>\n          </div>\n          <div className={`market-status ${marketOpen ? 'open' : 'closed'}`}>\n            {marketOpen ? '● 개장' : '○ 마감'}\n          </div>\n          <div className=\"stock-header-actions\">\n            <div className=\"user-info-display\">{formatCurrency(userDoc.cash)}</div>\n            {isAdmin() && <button onClick={() => setShowAdminPanel(true)} className=\"btn btn-primary\"><Settings size={16} /> 관리</button>}\n            {/* 🔥 방학 모드 토글 버튼 (슈퍼관리자 전용) */}\n            {userDoc?.isSuperAdmin && (\n              <button\n                onClick={toggleVacationMode}\n                disabled={vacationLoading}\n                className={`btn ml-2 ${vacationMode ? \"btn-warning\" : \"btn-secondary\"}`}\n                title={vacationMode ? '방학 모드 ON - 스케줄러 중지됨' : '방학 모드 OFF - 스케줄러 작동 중'}\n              >\n                {vacationLoading ? '...' : vacationMode ? '🏖️ 방학모드 ON' : '📅 방학모드 OFF'}\n              </button>\n            )}\n          </div>\n        </div>\n      </header>\n      <main className=\"market-section\">\n        <section className=\"asset-summary\">\n          <div className=\"asset-cards\">\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>투자 평가액</h3><p className=\"value\">{formatCurrency(portfolioStats.totalValue)}</p></div><div className=\"asset-card-icon blue\">📊</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>총 자산</h3><p className=\"value\">{formatCurrency(userDoc.cash + portfolioStats.totalValue)}</p></div><div className=\"asset-card-icon purple\">💎</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>평가손익</h3><p className={`value ${portfolioStats.totalProfit >= 0 ? 'profit-positive' : 'profit-negative'}`}>{formatCurrency(portfolioStats.totalProfit)}</p></div><div className={`asset-card-icon ${portfolioStats.totalProfit >= 0 ? 'red' : 'blue'}`}>{portfolioStats.totalProfit >= 0 ? <TrendingUp size={24} color=\"white\" /> : <TrendingDown size={24} color=\"white\" />}</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>수익률</h3><p className={`value ${portfolioStats.profitPercent >= 0 ? 'profit-positive' : 'profit-negative'}`}>{formatPercent(portfolioStats.profitPercent)}</p></div><div className={`asset-card-icon ${portfolioStats.profitPercent >= 0 ? 'red' : 'blue'}`}>{portfolioStats.profitPercent >= 0 ? <TrendingUp size={24} color=\"white\" /> : <TrendingDown size={24} color=\"white\" />}</div></div></div>\n          </div>\n\n          {/* 성능 통계 표시 (관리자 전용) */}\n          {isAdmin() && (\n            <div className=\"mt-2.5 px-3 py-2 bg-sky-50 rounded-md text-[0.8rem] text-sky-700 flex justify-between items-center\">\n              <div>\n                🚀 성능 최적화 상태: 캐시 적중 {cacheStatus.hits}회, 누락 {cacheStatus.misses}회\n                (절약률: {cacheStatus.hits + cacheStatus.misses > 0 ? Math.round((cacheStatus.hits / (cacheStatus.hits + cacheStatus.misses)) * 100) : 0}%)\n              </div>\n              {lastBatchLoad && (\n                <div>마지막 배치로드: {lastBatchLoad.toLocaleTimeString()}</div>\n              )}\n            </div>\n          )}\n        </section>\n\n        <section className=\"market-list-section\">\n          <div className=\"section-header\">\n            <h2 className=\"section-title\">📈 투자 시장</h2>\n            <div className=\"update-indicator\">\n              <button onClick={handleManualRefresh} disabled={isFetching} className=\"btn btn-secondary px-2 py-1 text-xs\">\n                <RefreshCw size={12} />\n                {isFetching ? '갱신중...' : '새로고침'}\n              </button>\n              {lastUpdated && <span className=\"text-xs text-gray-500\">마지막 갱신: {lastUpdated.toLocaleTimeString()}</span>}\n            </div>\n          </div>\n\n          <div className=\"market-tabs\">\n            <button onClick={() => setActiveTab(\"stocks\")} className={`tab-button ${activeTab === \"stocks\" ? \"active\" : \"\"}`}>주식 ({categoryCounts.stocks})</button>\n            <button onClick={() => setActiveTab(\"etfs\")} className={`tab-button ${activeTab === \"etfs\" ? \"active\" : \"\"}`}>ETF/지수 ({categoryCounts.etfs})</button>\n            <button onClick={() => setActiveTab(\"bonds\")} className={`tab-button ${activeTab === \"bonds\" ? \"active\" : \"\"}`}>채권 ({categoryCounts.bonds})</button>\n          </div>\n\n          <div className=\"market-grid\">\n            {displayedStocks.map(stock => {\n              const priceHistory = stock.priceHistory || [stock.price];\n              const priceChange = priceHistory.length >= 2 ? ((priceHistory.slice(-1)[0] - priceHistory.slice(-2)[0]) / priceHistory.slice(-2)[0]) * 100 : 0;\n              const isRealStock = stock.isRealStock === true;\n              return (\n                <div key={stock.id} className={`stock-card ${priceChange > 0 ? 'price-up' : priceChange < 0 ? 'price-down' : ''} ${isRealStock ? 'real-stock' : ''}`}>\n                  <div className=\"stock-card-header\">\n                    <div className=\"stock-info\">\n                      <h3>{getProductIcon(stock.productType)} {stock.name}</h3>\n                      <div className=\"stock-badges\">\n                        {isRealStock && (\n                          <span className=\"stock-badge real bg-gradient-to-br from-emerald-500 to-emerald-600 text-white font-bold text-[0.7rem] px-1.5 py-0.5 rounded mr-1\">\n                            실시간\n                          </span>\n                        )}\n                        <span className={`stock-badge ${getProductBadgeClass(stock.productType)}`}>\n                          {stock.productType === PRODUCT_TYPES.BOND ? `${stock.maturityYears}년 ${stock.couponRate}%` : SECTORS[stock.sector]?.name || '기타'}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"stock-price-section\">\n                      <div className=\"stock-price\">{formatCurrency(stock.price)}</div>\n                      <div className={`stock-change ${priceChange > 0 ? 'up' : 'down'}`}>\n                        <span>{formatPercent(priceChange)}</span>\n                      </div>\n                      {isRealStock && (\n                        <div className=\"text-[0.7rem] text-gray-500 mt-0.5\">\n                          {getMarketStateLabel(stock) || '장마감'}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"stock-actions\">\n                    <input type=\"number\" min=\"1\" value={buyQuantities[stock.id] || ''} onChange={e => setBuyQuantities(p => ({ ...p, [stock.id]: e.target.value }))} placeholder=\"수량\" className=\"quantity-input\" />\n                    <button onClick={() => buyStock(stock.id, buyQuantities[stock.id])} disabled={!buyQuantities[stock.id] || isTrading || !marketOpen} className=\"trade-button buy\">매수</button>\n                  </div>\n                  <div className=\"cost-display\">\n                    {buyQuantities[stock.id] && `예상 비용: ${formatCurrency(stock.price * parseInt(buyQuantities[stock.id]) * (1 + COMMISSION_RATE))}`}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n          {filteredStocks.length > 20 && (\n            <div className=\"load-more-container\">\n              <button onClick={() => setShowAllStocks(!showAllStocks)} className=\"load-more-button\">\n                {showAllStocks ? \"접기\" : \"더 보기\"}\n              </button>\n            </div>\n          )}\n        </section>\n        <section className=\"portfolio-section\">\n          <div className=\"section-header\">\n            <h2 className=\"section-title\">💼 내 포트폴리오</h2>\n          </div>\n          <div className=\"portfolio-cards\">\n            {portfolio.length === 0 ? <p className=\"no-transactions\">보유한 상품이 없습니다.</p> : portfolio.map(holding => {\n              const stock = stocksMap.get(holding.stockId);\n\n              // 휴지조각 주식 처리 (상장폐지로 가치 0이 된 주식)\n              if (holding.isWorthless) {\n                return (\n                  <div key={holding.id} className=\"portfolio-card delisted\">\n                    <div className=\"portfolio-card-header\">\n                      <div className=\"stock-title-section\">\n                        <h3 className=\"stock-name\">{holding.stockName}</h3>\n                        <span className=\"stock-status delisted\">🗑️ 휴지조각</span>\n                      </div>\n                      <div className=\"stock-quantity\">{holding.quantity}<span className=\"unit\">주</span></div>\n                    </div>\n                    <div className=\"portfolio-metrics-compact\">\n                      <div className=\"metrics-row\">\n                        <div className=\"metric-item\"><span className=\"metric-label\">현재 가치</span><span className=\"metric-value text-red-500 font-bold\">0원</span></div>\n                        <div className=\"metric-item\"><span className=\"metric-label\">손실</span><span className=\"metric-value text-red-500\">-100%</span></div>\n                      </div>\n                    </div>\n                    <p className=\"text-[0.85rem] text-gray-500 mt-2\">상장폐지된 상품입니다. 10분 후 자동 삭제됩니다.</p>\n                    <div className=\"portfolio-card-actions\">\n                      <button onClick={() => deleteHolding(holding.id)} className=\"action-btn delete-btn\">지금 삭제</button>\n                    </div>\n                  </div>\n                );\n              }\n\n              if (!stock) return null;\n              const currentValue = stock.price * holding.quantity;\n              const investedValue = holding.averagePrice * holding.quantity;\n              const profit = currentValue - investedValue;\n              const profitPercent = investedValue > 0 ? (profit / investedValue) * 100 : 0;\n              const isLocked = !!lockTimers[holding.id];\n              const canSell = !isLocked;\n\n              return (\n                <div key={holding.id} className={`portfolio-card ${profit >= 0 ? 'profit' : 'loss'}`}>\n                  <div className=\"portfolio-card-header\">\n                    <div className=\"stock-title-section\">\n                      <h3 className=\"stock-name\">{getProductIcon(stock.productType)} {holding.stockName}</h3>\n                      {isLocked && (\n                        <span className=\"text-xs px-2 py-0.5 bg-amber-100 text-amber-800 rounded font-bold inline-flex items-center gap-1\">\n                          <Lock size={12} />\n                          매도 불가\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"stock-quantity\">{holding.quantity}<span className=\"unit\">주</span></div>\n                  </div>\n                  <div className=\"portfolio-metrics-compact\">\n                    <div className=\"metrics-row\">\n                      <div className=\"metric-item\"><span className=\"metric-label\">평균 매수가</span><span className=\"metric-value\">{formatCurrency(holding.averagePrice)}</span></div>\n                      <div className=\"metric-item\"><span className=\"metric-label\">현재가</span><span className=\"metric-value current\">{formatCurrency(stock.price)}</span></div>\n                    </div>\n                  </div>\n                  <div className={`profit-summary ${profit >= 0 ? 'profit' : 'loss'}`}>\n                    <div className=\"profit-amount\">{formatCurrency(profit)}</div>\n                    <div className=\"profit-percent\">{formatPercent(profitPercent)}</div>\n                  </div>\n                  {isLocked && (\n                    <div className=\"px-3 py-2.5 bg-gradient-to-br from-amber-100 to-amber-200 rounded-lg flex flex-col gap-1 mt-2 border border-amber-400\">\n                      <div className=\"flex items-center gap-2 text-[0.9rem] text-amber-800 font-bold\">\n                        <Lock size={16} />\n                        <span>매도 제한 시간</span>\n                      </div>\n                      <div className=\"text-[1.1rem] text-amber-900 font-bold text-center mt-1 font-mono\">\n                        ⏱️ {formatTime(lockTimers[holding.id])} 남음\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"portfolio-card-actions\">\n                    <div className=\"trade-section\">\n                      <div className=\"trade-input-group\">\n                        <input type=\"number\" min=\"1\" max={holding.quantity} value={sellQuantities[holding.id] || ''} onChange={e => setSellQuantities(p => ({ ...p, [holding.id]: e.target.value }))} placeholder=\"매도 수량\" className=\"trade-input\" disabled={!!lockTimers[holding.id] || !marketOpen} />\n                        <button onClick={() => sellStock(holding.id, sellQuantities[holding.id])} disabled={!sellQuantities[holding.id] || isTrading || !!lockTimers[holding.id] || !marketOpen} className=\"action-btn sell-btn\">매도</button>\n                      </div>\n                      {sellQuantities[holding.id] && !lockTimers[holding.id] && (\n                        <div className=\"expected-amount\">\n                          예상 수익: {formatCurrency((stock.price * parseInt(sellQuantities[holding.id])) * (1 - COMMISSION_RATE) - calculateStockTax(Math.max(0, (stock.price - holding.averagePrice) * parseInt(sellQuantities[holding.id])), stock.productType))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </section>\n      </main>\n    </div>\n  );\n};\n\nexport default StockExchange;\n"],"names":["PRODUCT_TYPES","SECTORS","TECH","name","FINANCE","CONSUMER","HEALTHCARE","ENERGY","INDUSTRIAL","MATERIALS","REALESTATE","UTILITIES","COMMUNICATION","ENTERTAINMENT","INDEX","GOVERNMENT","CORPORATE","HOLDING_LOCK_PERIOD","COMMISSION_RATE","CACHE_TTL","batchDataLoader","pendingRequests","Map","loadBatchData","async","classCode","userId","forceRefresh","arguments","length","undefined","batchKey","globalCache","generateKey","logger","log","invalidate","cached","get","this","has","batchPromise","_executeBatchLoad","set","result","delete","stocks","portfolio","Promise","all","_loadStocks","_loadPortfolio","errors","getSnapshotFn","httpsCallable","functions","data","Array","isArray","fnError","warn","cacheRef","doc","db","cacheDoc","getDoc","cacheData","exists","snapshotError","stocksRef","collection","q","query","where","getDocs","docs","map","_objectSpread","id","error","portfolioRef","_data$lastBuyTime","_data$delistedAt","lastBuyTime","toDate","delistedAt","getMarketStateLabel","stock","state","_stock$realStockData","isRealStock","realStockData","marketState","getRealtimeMarketState","formatCurrency","amount","isNaN","Intl","NumberFormat","format","Math","round","formatPercent","percent","num","parseFloat","toFixed","formatTime","milliseconds","seconds","floor","minutes","remainingSeconds","concat","calculateStockTax","profit","getRemainingLockTime","holding","_holding$lastBuyTime2","lastBuyTimeMs","Date","getTime","now","remaining","max","getProductIcon","productType","getProductBadgeClass","invalidateStockCache","pattern","invalidatePattern","clearLocalStorageBatchCache","keysToDelete","i","localStorage","key","includes","push","forEach","removeItem","TrendingUp","_ref","size","color","_jsxs","width","height","viewBox","fill","stroke","strokeWidth","children","_jsx","points","TrendingDown","_ref2","Settings","_ref3","cx","cy","r","d","RefreshCw","_ref4","strokeLinecap","strokeLinejoin","BarChart3","_ref5","x1","y1","x2","y2","Lock","_ref8","x","y","rx","ry","RealStockAdder","React","_ref9","onAddStock","showForm","setShowForm","useState","isAdding","setIsAdding","formData","setFormData","symbol","sector","className","onClick","type","alert","message","handleQuickAdd","disabled","title","placeholder","value","onChange","e","p","target","AdminPanel","_ref0","onClose","onDeleteStock","onEditStock","onToggleManualStock","cacheStats","onManualUpdate","onCreateRealStocks","onUpdateRealStocks","onAddSingleRealStock","onDeleteSimulationStocks","showAddForm","setShowAddForm","isUpdating","setIsUpdating","isCreatingRealStocks","setIsCreatingRealStocks","isUpdatingRealStocks","setIsUpdatingRealStocks","isDeletingSimulation","setIsDeletingSimulation","newStock","setNewStock","price","minListingPrice","isManual","maturityYears","couponRate","hits","misses","savings","window","confirm","_SECTORS$stock$sector","isListed","Object","entries","filter","_ref1","_ref10","_Fragment","step","checked","htmlFor","minPrice","stockData","buyVolume","sellVolume","recentBuyVolume","recentSellVolume","volatility","StockExchange","user","userDoc","isAdmin","loading","authLoading","firebaseReady","optimisticUpdate","refreshUserDocument","useAuth","callables","useMemo","getVacationModeStatus","toggleVacationMode","updateStocksSnapshot","addStockDoc","buyStock","sellStock","manualUpdateStockMarket","createRealStocks","updateRealStocks","addSingleRealStock","deleteSimulationStocks","setClassCode","setStocks","setPortfolio","showAdminPanel","setShowAdminPanel","buyQuantities","setBuyQuantities","sellQuantities","setSellQuantities","isTrading","setIsTrading","lockTimers","setLockTimers","activeTab","setActiveTab","lastUpdated","setLastUpdated","isFetching","setIsFetching","marketOpen","setMarketOpen","vacationMode","setVacationMode","vacationLoading","setVacationLoading","cacheStatus","setCacheStatus","lastBatchLoad","setLastBatchLoad","lastFetchTimeRef","useRef","marketStatus","batchLoad","isFetchingRef","useEffect","checkMarketStatus","koreaTime","toLocaleString","timeZone","kstDay","getDay","kstTotalMinutes","getHours","getMinutes","isKoreaMarketOpen","usTime","usDay","usTotalMinutes","interval","setInterval","clearInterval","current","some","h","prevTimers","newTimers","fetchAllData","useCallback","timeSinceLastBatch","batchResult","uid","usePolling","enabled","deps","fetchVacationMode","isSuperAdmin","getVacationModeStatusFn","toggleVacationModeFn","refreshStocksSnapshot","updateSnapshotFn","addStock","addStockFn","invalidateCache","stockRef","setDoc","initialPrice","priceHistory","createdAt","serverTimestamp","holderCount","tradingVolume","innerError","deleteStock","stockId","stockName","deleteDoc","editStock","find","s","newPriceStr","prompt","toString","newPrice","updateDoc","slice","toggleManualStock","currentIsListed","action","updateData","batch","writeBatch","portfoliosToDelistQuery","collectionGroup","update","ref","commit","quantityString","quantity","parseInt","cost","commission","taxAmount","totalCost","cash","buyStockFunction","newBalance","currentCash","cashDiff","prev","existingIndex","findIndex","existing","newQuantity","newAvgPrice","averagePrice","logActivity","userName","displayName","ACTIVITY_TYPES","STOCK_BUY","description","metadata","pricePerShare","holdingId","_holding$lastBuyTime","canSellHolding","sellPrice","estimatedNetRevenue","sellStockFunction","actualSellPrice","actualCommission","totalTax","actualTax","actualProfit","netRevenue","STOCK_SELL","tax","taxInfo","deleteHolding","Error","manualUpdateFunction","createRealStocksFunction","updateRealStocksFunction","_ref11","addSingleRealStockFunction","deleteSimulationStocksFunction","stocksMap","portfolioStats","totalValue","totalInvested","investedValue","totalProfit","profitPercent","categoryCounts","counts","etfs","bonds","filteredStocks","showAllStocks","setShowAllStocks","displayedStocks","handleManualRefresh","toLocaleTimeString","_SECTORS$stock$sector2","priceChange","min","isWorthless","currentValue","isLocked"],"ignoreList":[],"sourceRoot":""}