/*! For license information please see 1117.e7dbd410.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[1117],{1117(e,t,s){s.r(t),s.d(t,{default:()=>w});var r=s(2555),a=s(5043),l=s(5016),i=s(8719),n=s(359),o=s(2864),c=s(603),d=s(7118),m=s(1360),x=s(5088);const u=(0,s(7784).A)("trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);var p=s(3242),h=s(5711),b=s(2382),g=s(7819),v=s(9855),f=s(614),N=s(8343),j=s(5452),y=s(579);function w(){const{user:e,userDoc:t,isAdmin:s,optimisticUpdate:w}=(0,l.As)(),{items:A}=(0,i.wB)()||{items:[]},{currencyUnit:k}=(null===n.H2||void 0===n.H2?void 0:(0,n.H2)())||{currencyUnit:"\uc54c\ucc2c"},I=null===t||void 0===t?void 0:t.classCode,[C,P]=(0,a.useState)([]),[D,M]=(0,a.useState)(!0),[F,S]=(0,a.useState)(!1),[H,R]=(0,a.useState)(null),[E,q]=(0,a.useState)(""),[z,T]=(0,a.useState)(null),[U,V]=(0,a.useState)("active"),[_,G]=(0,a.useState)({itemName:"",itemIcon:"\ud83c\udf81",itemDescription:"",targetPrice:"",useStoreItem:!1,selectedItemId:""}),J=(0,a.useCallback)(async()=>{if(I)try{const e=(0,o.P)((0,o.rJ)(o.db,"groupPurchases"),(0,o._M)("classCode","==",I),(0,o.My)("createdAt","desc")),t=(await(0,o.GG)(e)).docs.map(e=>(0,r.A)({id:e.id},e.data()));P(t)}catch(e){j.vF.error("\ud568\uaed8\uad6c\ub9e4 \ub85c\ub4dc \uc2e4\ud328:",e)}finally{M(!1)}},[I]);(0,a.useEffect)(()=>{J()},[J]);const L=C.filter(e=>"active"===U?"active"===e.status:"completed"!==U||"completed"===e.status);return D?(0,y.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,y.jsx)("div",{className:"w-8 h-8 border-2 border-cyber-cyan border-t-transparent rounded-full animate-spin"})}):(0,y.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6 space-y-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center gap-3",children:[(0,y.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500/20 to-indigo-500/20 border border-purple-500/30 flex items-center justify-center",children:(0,y.jsx)(d.A,{className:"w-5 h-5 text-purple-400"})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{className:"text-xl font-bold text-white font-jua",children:"\ud568\uaed8\uad6c\ub9e4"}),(0,y.jsx)("p",{className:"text-xs text-gray-400",children:"\uce5c\uad6c\ub4e4\uacfc \ubaa8\uae08\ud558\uace0, \ucd5c\ub2e4 \uae30\uc5ec\uc790\uac00 \uc544\uc774\ud15c\uc744 \ud68d\ub4dd\ud574\uc694!"})]})]}),(0,y.jsxs)("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white text-sm font-bold transition-all hover:scale-105 shadow-lg shadow-purple-500/20",children:[(0,y.jsx)(m.A,{className:"w-4 h-4"}),"\uc0c8 \ud568\uaed8\uad6c\ub9e4"]})]}),(0,y.jsx)("div",{className:"flex gap-2",children:[{key:"active",label:"\uc9c4\ud589\uc911",icon:x.A},{key:"completed",label:"\uc644\ub8cc",icon:u},{key:"all",label:"\uc804\uccb4",icon:d.A}].map(e=>{let{key:t,label:s,icon:r}=e;return(0,y.jsxs)("button",{onClick:()=>V(t),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium transition-all ".concat(U===t?"bg-purple-500/20 text-purple-300 border border-purple-500/30":"bg-white/5 text-gray-400 border border-transparent hover:bg-white/10"),children:[(0,y.jsx)(r,{className:"w-3.5 h-3.5"}),s]},t)})}),0===L.length?(0,y.jsxs)("div",{className:"text-center py-16",children:[(0,y.jsx)("div",{className:"text-5xl mb-4 opacity-50",children:"\ud83e\udd1d"}),(0,y.jsx)("p",{className:"text-gray-400 text-lg font-medium",children:"active"===U?"\uc9c4\ud589 \uc911\uc778 \ud568\uaed8\uad6c\ub9e4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"completed"===U?"\uc644\ub8cc\ub41c \ud568\uaed8\uad6c\ub9e4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"\ud568\uaed8\uad6c\ub9e4 \ub0b4\uc5ed\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"}),(0,y.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"\uc0c8 \ud568\uaed8\uad6c\ub9e4\ub97c \uc2dc\uc791\ud574\ubcf4\uc138\uc694!"})]}):(0,y.jsx)("div",{className:"space-y-3",children:L.map(t=>{var r,a,l;const i=(n=t,Math.min(100,Math.round(n.currentAmount/n.targetPrice*100)));var n;const c=(t=>{var s;const r=null===(s=t.contributors)||void 0===s?void 0:s.find(t=>t.userId===(null===e||void 0===e?void 0:e.uid));return(null===r||void 0===r?void 0:r.amount)||0})(t),d="completed"===t.status,m=z===t.id,x=s()||t.initiatorId===(null===e||void 0===e?void 0:e.uid),f=t.targetPrice-t.currentAmount;return(0,y.jsxs)("div",{className:"rounded-2xl border transition-all ".concat(d?"bg-gradient-to-r from-emerald-900/20 to-teal-900/20 border-emerald-500/20":"bg-[rgba(20,20,35,0.6)] border-[rgba(0,255,242,0.1)] hover:border-purple-500/30"),children:[(0,y.jsx)("div",{className:"p-4",children:(0,y.jsxs)("div",{className:"flex items-start gap-3",children:[(0,y.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0 ".concat(d?"bg-emerald-500/20":"bg-purple-500/10 border border-purple-500/20"),children:t.itemIcon}),(0,y.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,y.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,y.jsx)("h3",{className:"text-base font-bold text-white truncate",children:t.itemName}),d&&(0,y.jsxs)("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 text-xs font-bold",children:[(0,y.jsx)(u,{className:"w-3 h-3"}),"\ub2ec\uc131"]}),d&&t.winnerName&&(0,y.jsxs)("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500/20 text-amber-300 text-xs font-bold",children:["\ud83c\udfc6 ",t.winnerName]})]}),t.itemDescription&&(0,y.jsx)("p",{className:"text-xs text-gray-400 mb-2 line-clamp-1",children:t.itemDescription}),(0,y.jsxs)("div",{className:"relative h-3 bg-white/5 rounded-full overflow-hidden mb-2",children:[(0,y.jsx)("div",{className:"absolute inset-y-0 left-0 rounded-full transition-all duration-500 ".concat(d?"bg-gradient-to-r from-emerald-500 to-teal-400":"bg-gradient-to-r from-purple-500 to-indigo-500"),style:{width:"".concat(i,"%")}}),(0,y.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,y.jsxs)("span",{className:"text-[10px] font-bold text-white drop-shadow-md",children:[i,"%"]})})]}),(0,y.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,y.jsxs)("span",{className:"text-gray-400",children:[(0,N.FR)(t.currentAmount),k," /"," ",(0,N.FR)(t.targetPrice),k]}),(0,y.jsxs)("span",{className:"text-gray-500",children:["\ucc38\uc5ec ",(null===(r=t.contributors)||void 0===r?void 0:r.length)||0,"\uba85"]})]}),c>0&&(0,y.jsxs)("div",{className:"mt-1.5 text-xs text-purple-300",children:["\ub0b4 \uae30\uc5ec: ",(0,N.FR)(c),k]})]}),(0,y.jsxs)("div",{className:"flex flex-col gap-1.5 flex-shrink-0",children:[!d&&(0,y.jsxs)("button",{onClick:()=>{R(t),q("")},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg bg-purple-600/80 hover:bg-purple-500 text-white text-xs font-bold transition-all",children:[(0,y.jsx)(p.A,{className:"w-3.5 h-3.5"}),"\ucc38\uc5ec"]}),(0,y.jsxs)("button",{onClick:()=>T(m?null:t.id),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 text-xs transition-all",children:[m?(0,y.jsx)(h.A,{className:"w-3.5 h-3.5"}):(0,y.jsx)(b.A,{className:"w-3.5 h-3.5"}),"\uc0c1\uc138"]})]})]})}),m&&(0,y.jsxs)("div",{className:"px-4 pb-4 border-t border-white/5 pt-3 space-y-3",children:[(0,y.jsxs)("div",{className:"text-xs text-gray-500",children:["\uc2dc\uc791: ",t.initiatorName," \xb7"," ",null!==(a=t.createdAt)&&void 0!==a&&a.toDate?t.createdAt.toDate().toLocaleDateString("ko-KR"):""]}),d&&t.winnerName&&(0,y.jsxs)("div",{className:"flex items-center gap-2 bg-amber-500/10 border border-amber-500/20 rounded-lg px-3 py-2.5",children:[(0,y.jsx)("span",{className:"text-lg",children:"\ud83c\udfc6"}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("p",{className:"text-sm font-bold text-amber-300",children:["\uc544\uc774\ud15c \ud68d\ub4dd: ",t.winnerName]}),(0,y.jsx)("p",{className:"text-xs text-amber-400/70",children:"\ucd5c\ub2e4 \uae30\uc5ec\uc790\uc5d0\uac8c \uc544\uc774\ud15c\uc774 \uc9c0\uae09\ub418\uc5c8\uc2b5\ub2c8\ub2e4"})]})]}),(null===(l=t.contributors)||void 0===l?void 0:l.length)>0&&(0,y.jsxs)("div",{children:[(0,y.jsxs)("p",{className:"text-xs font-bold text-gray-300 mb-2",children:["\ucc38\uc5ec\uc790 (",t.contributors.length,"\uba85)"]}),(0,y.jsx)("div",{className:"space-y-1.5",children:[...t.contributors].sort((e,t)=>{var s,r,a,l;if(t.amount!==e.amount)return t.amount-e.amount;const i=e.firstContributedAt||e.contributedAt,n=t.firstContributedAt||t.contributedAt;return((null===i||void 0===i||null===(s=i.toMillis)||void 0===s?void 0:s.call(i))||(null===i||void 0===i||null===(r=i.getTime)||void 0===r?void 0:r.call(i))||0)-((null===n||void 0===n||null===(a=n.toMillis)||void 0===a?void 0:a.call(n))||(null===n||void 0===n||null===(l=n.getTime)||void 0===l?void 0:l.call(n))||0)}).map((e,s)=>{const r=t.winnerId===e.userId;return(0,y.jsxs)("div",{className:"flex items-center justify-between rounded-lg px-3 py-2 ".concat(r?"bg-amber-500/10 border border-amber-500/20":"bg-white/5"),children:[(0,y.jsxs)("div",{className:"flex items-center gap-2",children:[(0,y.jsx)("span",{className:"text-xs font-bold text-gray-300",children:0===s?"\ud83e\udd47":1===s?"\ud83e\udd48":2===s?"\ud83e\udd49":"".concat(s+1,".")}),(0,y.jsx)("span",{className:"text-sm ".concat(r?"text-amber-300 font-bold":"text-white"),children:e.userName})]}),(0,y.jsxs)("span",{className:"text-sm font-bold ".concat(r?"text-amber-300":"text-purple-300"),children:[(0,N.FR)(e.amount),k]})]},s)})})]}),!d&&f>0&&(0,y.jsxs)("div",{className:"flex items-center gap-2 bg-amber-500/10 border border-amber-500/20 rounded-lg px-3 py-2",children:[(0,y.jsx)(g.A,{className:"w-4 h-4 text-amber-400 flex-shrink-0"}),(0,y.jsxs)("span",{className:"text-xs text-amber-300",children:["\ubaa9\ud45c\uae4c\uc9c0"," ",(0,y.jsxs)("strong",{children:[(0,N.FR)(f),k]})," ","\ub354 \ud544\uc694\ud569\ub2c8\ub2e4"]})]}),x&&(0,y.jsxs)("button",{onClick:()=>(async e=>{if(window.confirm("\uc815\ub9d0 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c? \ubaa8\uae08\ub41c \uae08\uc561\uc740 \ucc38\uc5ec\uc790\uc5d0\uac8c \ud658\ubd88\ub429\ub2c8\ub2e4."))try{var t;if((null===(t=e.contributors)||void 0===t?void 0:t.length)>0&&e.currentAmount>0)for(const t of e.contributors){const e=(0,o.H9)(o.db,"users",t.userId);await(0,o.c4)(o.db,async s=>{const r=await s.get(e);r.exists()&&s.update(e,{cash:(r.data().cash||0)+t.amount})})}await(0,o.kd)((0,o.H9)(o.db,"groupPurchases",e.id)),J()}catch(s){j.vF.error("\ud568\uaed8\uad6c\ub9e4 \uc0ad\uc81c \uc2e4\ud328:",s),alert("\uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.")}})(t),className:"flex items-center gap-1.5 px-3 py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 text-xs font-medium transition-all",children:[(0,y.jsx)(v.A,{className:"w-3.5 h-3.5"}),"\uc0ad\uc81c (\ud658\ubd88 \ucc98\ub9ac)"]})]})]},t.id)})}),F&&(0,y.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",onClick:()=>S(!1),children:(0,y.jsxs)("div",{className:"w-full max-w-md bg-[#12121f] border border-purple-500/30 rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,y.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 bg-gradient-to-r from-purple-600/20 to-indigo-600/20 border-b border-purple-500/20",children:[(0,y.jsxs)("h2",{className:"text-lg font-bold text-white font-jua flex items-center gap-2",children:[(0,y.jsx)(m.A,{className:"w-5 h-5 text-purple-400"}),"\uc0c8 \ud568\uaed8\uad6c\ub9e4"]}),(0,y.jsx)("button",{onClick:()=>S(!1),className:"p-1 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:(0,y.jsx)(f.A,{className:"w-5 h-5"})})]}),(0,y.jsxs)("div",{className:"p-5 space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-xs font-bold text-gray-400 mb-1.5",children:"\uc544\uc774\ud15c \uc120\ud0dd *"}),(0,y.jsxs)("select",{value:_.selectedItemId,onChange:e=>(e=>{const t=null===A||void 0===A?void 0:A.find(t=>t.id===e);t&&G(s=>(0,r.A)((0,r.A)({},s),{},{selectedItemId:e,itemName:t.name,itemIcon:t.icon||"\ud83c\udf81",itemDescription:t.description||"",targetPrice:String(t.price||"")}))})(e.target.value),className:"w-full px-3 py-2.5 rounded-xl bg-[#1a1a2e] border border-white/10 text-white text-sm focus:border-purple-500/50 focus:outline-none [&>option]:bg-[#1a1a2e] [&>option]:text-white",children:[(0,y.jsx)("option",{value:"",children:"-- \uc544\uc774\ud15c\uc744 \uc120\ud0dd\ud558\uc138\uc694 --"}),(A||[]).filter(e=>!1!==e.available).map(e=>(0,y.jsxs)("option",{value:e.id,children:[e.icon||"\ud83c\udf81"," ",e.name," -"," ",(0,N.FR)(e.price),k]},e.id))]})]}),_.selectedItemId&&(0,y.jsxs)("div",{className:"flex items-center gap-3 bg-purple-500/10 border border-purple-500/20 rounded-xl p-3",children:[(0,y.jsx)("span",{className:"text-2xl",children:_.itemIcon}),(0,y.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,y.jsx)("p",{className:"text-sm font-bold text-white",children:_.itemName}),_.itemDescription&&(0,y.jsx)("p",{className:"text-xs text-gray-400 truncate",children:_.itemDescription}),(0,y.jsxs)("p",{className:"text-xs text-purple-300 font-bold mt-0.5",children:["\ubaa9\ud45c: ",(0,N.FR)(_.targetPrice),k]})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-xs font-bold text-gray-400 mb-1.5",children:"\ubaa9\ud45c \uae08\uc561 (\uc218\uc815 \uac00\ub2a5)"}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("input",{type:"number",value:_.targetPrice,onChange:e=>G(t=>(0,r.A)((0,r.A)({},t),{},{targetPrice:e.target.value})),className:"w-full px-3 py-2.5 pr-14 rounded-xl bg-white/5 border border-white/10 text-white text-sm focus:border-purple-500/50 focus:outline-none",placeholder:"0",min:"1"}),(0,y.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-gray-500",children:k})]})]}),(0,y.jsx)("button",{onClick:async()=>{const s=parseInt(_.targetPrice);if(_.itemName.trim()&&s&&!(s<=0))try{await(0,o.gS)((0,o.rJ)(o.db,"groupPurchases"),{classCode:I,itemName:_.itemName.trim(),itemIcon:_.itemIcon||"\ud83c\udf81",itemDescription:_.itemDescription.trim(),selectedItemId:_.selectedItemId||null,targetPrice:s,currentAmount:0,initiatorId:e.uid,initiatorName:(null===t||void 0===t?void 0:t.name)||"\uc54c \uc218 \uc5c6\uc74c",contributors:[],status:"active",createdAt:(0,o.O5)(),completedAt:null,winnerId:null,winnerName:null}),S(!1),G({itemName:"",itemIcon:"\ud83c\udf81",itemDescription:"",targetPrice:"",useStoreItem:!1,selectedItemId:""}),J()}catch(r){j.vF.error("\ud568\uaed8\uad6c\ub9e4 \uc0dd\uc131 \uc2e4\ud328:",r),alert("\uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.")}},disabled:!_.selectedItemId||!_.targetPrice||parseInt(_.targetPrice)<=0,className:"w-full py-3 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed text-white font-bold text-sm transition-all",children:"\ud568\uaed8\uad6c\ub9e4 \uc2dc\uc791\ud558\uae30"})]})]})}),H&&(0,y.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",onClick:()=>R(null),children:(0,y.jsxs)("div",{className:"w-full max-w-sm bg-[#12121f] border border-purple-500/30 rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,y.jsx)("div",{className:"px-5 py-4 bg-gradient-to-r from-purple-600/20 to-indigo-600/20 border-b border-purple-500/20",children:(0,y.jsxs)("h2",{className:"text-lg font-bold text-white font-jua flex items-center gap-2",children:[(0,y.jsx)(p.A,{className:"w-5 h-5 text-purple-400"}),"\ubaa8\uae08 \ucc38\uc5ec"]})}),(0,y.jsxs)("div",{className:"p-5 space-y-4",children:[(0,y.jsxs)("div",{className:"flex items-center gap-3 bg-white/5 rounded-xl p-3",children:[(0,y.jsx)("span",{className:"text-2xl",children:H.itemIcon}),(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm font-bold text-white",children:H.itemName}),(0,y.jsxs)("p",{className:"text-xs text-gray-400",children:["\ub0a8\uc740 \uae08\uc561:"," ",(0,N.FR)(H.targetPrice-H.currentAmount),k]})]})]}),(0,y.jsxs)("div",{className:"text-xs text-gray-400",children:["\ub0b4 \uc794\uc561:"," ",(0,y.jsxs)("span",{className:"text-white font-bold",children:[(0,N.FR)((null===t||void 0===t?void 0:t.cash)||0),k]})]}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("input",{type:"number",value:E,onChange:e=>q(e.target.value),className:"w-full px-3 py-3 pr-14 rounded-xl bg-white/5 border border-white/10 text-white text-lg font-bold focus:border-purple-500/50 focus:outline-none text-center",placeholder:"0",min:"1",max:Math.min((null===t||void 0===t?void 0:t.cash)||0,H.targetPrice-H.currentAmount),autoFocus:!0}),(0,y.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-gray-500",children:k})]}),(0,y.jsx)("div",{className:"flex gap-2",children:[100,500,1e3,5e3].map(e=>(0,y.jsx)("button",{onClick:()=>q(String(e)),className:"flex-1 py-1.5 rounded-lg bg-white/5 hover:bg-purple-500/20 text-gray-300 text-xs font-medium transition-all",children:(0,N.FR)(e)},e))}),(0,y.jsx)("button",{onClick:()=>{const e=Math.min((null===t||void 0===t?void 0:t.cash)||0,H.targetPrice-H.currentAmount);q(String(e))},className:"w-full py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 text-xs font-medium transition-all",children:"\ub0a8\uc740 \uae08\uc561 \uc804\ubd80 \ucc38\uc5ec"}),(0,y.jsxs)("div",{className:"flex gap-2",children:[(0,y.jsx)("button",{onClick:()=>R(null),className:"flex-1 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-400 font-bold text-sm transition-all",children:"\ucde8\uc18c"}),(0,y.jsx)("button",{onClick:async()=>{const s=parseInt(E);if(!s||s<=0||!H)return;const r=H,a=r.targetPrice-r.currentAmount,l=Math.min(s,a);if(((null===t||void 0===t?void 0:t.cash)||0)<l)return void alert("\uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4.");const i=l;w&&w({cash:-i});try{const s=(0,o.H9)(o.db,"groupPurchases",r.id),a=(0,o.H9)(o.db,"users",e.uid),i=await(0,o.c4)(o.db,async r=>{const i=await r.get(s),n=await r.get(a);if(!i.exists()||!n.exists())throw new Error("\ubb38\uc11c\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const o=i.data(),c=n.data();if("active"!==o.status)throw new Error("\uc774\ubbf8 \uc644\ub8cc\ub41c \ucea0\ud398\uc778\uc785\ub2c8\ub2e4.");const d=o.targetPrice-o.currentAmount,m=Math.min(l,d);if(c.cash<m)throw new Error("\uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4.");const x=[...o.contributors||[]],u=x.findIndex(t=>t.userId===e.uid);if(u>=0)x[u].amount+=m,x[u].lastContributedAt=new Date,x[u].firstContributedAt||(x[u].firstContributedAt=x[u].contributedAt||new Date);else{const s=new Date;x.push({userId:e.uid,userName:(null===t||void 0===t?void 0:t.name)||"\uc54c \uc218 \uc5c6\uc74c",amount:m,contributedAt:s,firstContributedAt:s,lastContributedAt:s})}const p=o.currentAmount+m,h=p>=o.targetPrice;let b=null,g=null;if(h){const e=e=>{var t,s;const r=e.firstContributedAt||e.contributedAt;return(null===r||void 0===r||null===(t=r.toMillis)||void 0===t?void 0:t.call(r))||(null===r||void 0===r||null===(s=r.getTime)||void 0===s?void 0:s.call(r))||0},t=[...x].sort((t,s)=>s.amount!==t.amount?s.amount-t.amount:e(t)-e(s))[0];b=(null===t||void 0===t?void 0:t.userId)||null,g=(null===t||void 0===t?void 0:t.userName)||null}return r.update(s,{currentAmount:p,contributors:x,status:h?"completed":"active",completedAt:h?new Date:null,winnerId:b,winnerName:g}),r.update(a,{cash:c.cash-m}),{isCompleted:h,winnerId:b,winnerName:g,cData:o}});if(null!==i&&void 0!==i&&i.isCompleted&&i.winnerId){var n,d;let e=null===(n=i.cData)||void 0===n?void 0:n.selectedItemId;if(!e&&null!==(d=i.cData)&&void 0!==d&&d.itemName&&(null===A||void 0===A?void 0:A.length)>0){const t=A.find(e=>e.name===i.cData.itemName);t&&(e=t.id)}if(e)try{await(0,c.Yo)(i.winnerId,e,1,{name:i.cData.itemName,icon:i.cData.itemIcon||"\ud83c\udf81"}),alert("\ud83c\udf89 \ubaa9\ud45c \ub2ec\uc131! ".concat(i.winnerName,"\ub2d8\uc774 \ucd5c\ub2e4 \uae30\uc5ec\uc790\ub85c '").concat(i.cData.itemName,"'\uc744(\ub97c) \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"))}catch(m){j.vF.error("\uc544\uc774\ud15c \uc9c0\uae09 \uc2e4\ud328:",m),alert("\ubaa9\ud45c\ub294 \ub2ec\uc131\ud588\uc9c0\ub9cc \uc544\uc774\ud15c \uc9c0\uae09 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694.")}else alert("\ud83c\udf89 \ubaa9\ud45c \ub2ec\uc131! \ucd5c\ub2e4 \uae30\uc5ec\uc790: ".concat(i.winnerName,"\ub2d8\n(\uc0c1\uc810\uc5d0\uc11c \uc544\uc774\ud15c\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc5b4 \uc218\ub3d9 \uc9c0\uae09\uc774 \ud544\uc694\ud569\ub2c8\ub2e4)"))}R(null),q(""),J()}catch(x){w&&w({cash:i}),j.vF.error("\ubaa8\uae08 \ucc38\uc5ec \uc2e4\ud328:",x),alert(x.message||"\ucc38\uc5ec\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.")}},disabled:!E||parseInt(E)<=0||parseInt(E)>((null===t||void 0===t?void 0:t.cash)||0),className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed text-white font-bold text-sm transition-all",children:"\ucc38\uc5ec\ud558\uae30"})]})]})]})})]})}},3242(e,t,s){s.d(t,{A:()=>r});const r=(0,s(7784).A)("hand-coins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]])},5088(e,t,s){s.d(t,{A:()=>r});const r=(0,s(7784).A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5711(e,t,s){s.d(t,{A:()=>r});const r=(0,s(7784).A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},7819(e,t,s){s.d(t,{A:()=>r});const r=(0,s(7784).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])}}]);
//# sourceMappingURL=1117.e7dbd410.chunk.js.map