"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[909],{3909(e,a,s){s.r(a),s.d(a,{default:()=>r});var t=s(2555),n=s(5043),c=s(5016),o=s(5010),i=(s(7262),s(5452));var l=s(579);const r=function(){const{userDoc:e,allClassMembers:a,loading:s,setUserDoc:r,setAllClassMembers:d}=(0,c.As)(),[m,u]=(0,n.useState)([]),[h,x]=(0,n.useState)(""),[p,N]=(0,n.useState)("fixed"),[j,g]=(0,n.useState)("send"),[v,b]=(0,n.useState)("toMe"),[f,k]=(0,n.useState)(10),[y,S]=(0,n.useState)(""),[C,M]=(0,n.useState)(""),[A,L]=(0,n.useState)(!1),[w,T]=(0,n.useState)(!1),_=null===e||void 0===e?void 0:e.name,F=null===e||void 0===e?void 0:e.classCode,R=(0,n.useMemo)(()=>a&&0!==a.length?[...a].sort((e,a)=>{const s=e.name||e.nickname||"",t=a.name||a.nickname||"";return s.localeCompare(t,"ko")}):[],[a]);(0,n.useEffect)(()=>{u([]),L(!1)},[j,p]);const D=function(e,a){let s,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(s="percentage"===p?Math.floor(e*Number(a)/100):Number(a),t&&"send"===j){return s-Math.floor(s*f/100)}return s},E=(0,n.useMemo)(()=>{if(!h||0===m.length)return{};const e={};return m.forEach(a=>{const s=R.find(e=>e.id===a);if(s){const t=Number(s.cash||0),n="send"===j;e[a]=D(t,h,n)}}),e},[m,h,p,j,f,R]);return(0,l.jsxs)("div",{className:"money-transfer-container",children:[(0,l.jsx)("div",{className:"header",children:(0,l.jsxs)("div",{className:"admin-info",children:[(0,l.jsx)("span",{className:"admin-label",children:"\uad00\ub9ac\uc790"}),(0,l.jsx)("span",{className:"admin-name",children:_||"\ub85c\ub529 \uc911..."}),(0,l.jsxs)("span",{className:"admin-cash",children:["\ud604\uae08: ",((null===e||void 0===e?void 0:e.cash)||0).toLocaleString(),"\uc6d0"]})]})}),C&&(0,l.jsx)("div",{className:"alert alert-error",children:C}),y&&(0,l.jsx)("div",{className:"alert alert-success",children:y}),(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0===m.length||!h||isNaN(Number(h)))return void M("\uc0ac\uc6a9\uc790\ub97c \uc120\ud0dd\ud558\uace0 \uc720\ud6a8\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694.");const a=Number(h);if(a<=0)M("".concat("percentage"===p?"\ud37c\uc13c\ud2b8":"\uae08\uc561","\uc740 0\ubcf4\ub2e4 \ucee4\uc57c \ud569\ub2c8\ub2e4."));else if("percentage"===p&&(a>100||a<0))M("\ud37c\uc13c\ud2b8\ub294 0\uacfc 100 \uc0ac\uc774\uc758 \uac12\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.");else{T(!0),S(""),M("");try{const e=R.filter(e=>m.includes(e.id)),{count:s,totalProcessed:n,updatedUsers:c}=await(async e=>{let{adminName:a,adminClassCode:s,targetUsers:t,action:n,takeMode:c,amountType:l,amount:r,taxRate:d}=e;i.vF.log("[database.js] adminCashAction \uc2dc\uc791:",{adminName:a,action:n,takeMode:c,amountType:l,amount:r,taxRate:d,targetUsersCount:t.length});const m=(0,o.wP)(o.db);let u=0,h=0;const x=[];for(const j of t)try{const e=Number(j.cash||0);let t;if(t="percentage"===l?Math.floor(e*r/100):Number(r),t<=0){i.vF.log("[database.js] ".concat(j.name,": \ucc98\ub9ac\ud560 \uae08\uc561\uc774 0\uc6d0\uc774\ubbc0\ub85c \uc2a4\ud0b5"));continue}let p,N=t,g=0;"send"===n&&d>0&&(g=Math.floor(t*d/100),N=t-g),p="send"===n?e+N:e-t,x.push({id:j.id,newCash:p}),i.vF.log("[database.js] ".concat(j.name," \ucc98\ub9ac:"),{"\ud604\uc7ac\uc794\uc561":e,"\uae30\ubcf8\uae08\uc561":t,"\uc138\uae08":g,"\ucd5c\uc885\uae08\uc561":N,"\uc0c8\uc794\uc561":p});const v=(0,o.H9)(o.db,"users",j.id);m.update(v,{cash:p,updatedAt:(0,o.O5)()}),u+=t,h++;const b=(0,o.H9)((0,o.rJ)(o.db,"activity_logs"));let f,k;"send"===n?(f="ADMIN_CASH_SEND","percentage"===l?(k="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(j.name,"\ub2d8\uc5d0\uac8c ").concat(r,"% (").concat(N.toLocaleString(),"\uc6d0)\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),g>0&&(k+=" (\uc6d0\uae08 ".concat(t.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(g.toLocaleString(),"\uc6d0 \uc81c\uc678)"))):(k="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(j.name,"\ub2d8\uc5d0\uac8c ").concat(N.toLocaleString(),"\uc6d0\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),g>0&&(k+=" (\uc6d0\uae08 ".concat(t.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(g.toLocaleString(),"\uc6d0 \uc81c\uc678)")))):"take"===n&&("remove"===c?(f="ADMIN_CASH_REMOVE",k="percentage"===l?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(j.name,"\ub2d8\uc758 ").concat(r,"% (").concat(t.toLocaleString(),"\uc6d0)\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(j.name,"\ub2d8\uc758 ").concat(t.toLocaleString(),"\uc6d0\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4.")):(f="ADMIN_CASH_TAKE",k="percentage"===l?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(j.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(r,"% (").concat(t.toLocaleString(),"\uc6d0)\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(j.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(t.toLocaleString(),"\uc6d0\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4.")));const y={userId:j.id,userName:j.name,timestamp:(0,o.O5)(),type:f,description:k,classCode:s,metadata:{adminName:a,action:n,amountType:l,inputValue:r,taxRate:"send"===n?d:0,baseAmount:t,taxAmount:g,finalAmount:N,previousCash:e,newCash:p}};m.set(b,y);const S=(0,o.H9)((0,o.rJ)(o.db,"transactions")),C={userId:j.id,amount:"send"===n?N:-t,type:"send"===n?"income":"expense",category:"admin",description:"send"===n?"\uad00\ub9ac\uc790 \uc9c0\uae09":"\uad00\ub9ac\uc790 \ud68c\uc218",timestamp:(0,o.O5)(),metadata:{adminName:a,amountType:l,taxRate:"send"===n?d:0}};m.set(S,C)}catch(p){console.error("[database.js] \uc0ac\uc6a9\uc790 ".concat(j.name," \ucc98\ub9ac \uc911 \uc624\ub958:"),p)}try{return await m.commit(),i.vF.log("[database.js] adminCashAction \uc644\ub8cc: ".concat(h,"\uba85 \ucc98\ub9ac, \ucd1d ").concat(u.toLocaleString(),"\uc6d0")),{count:h,totalProcessed:u,updatedUsers:x}}catch(N){throw console.error("[database.js] batch commit \uc624\ub958:",N),N}})({adminName:_,adminClassCode:F,targetUsers:e,action:j,takeMode:"take"===j?v:void 0,amountType:p,amount:a,taxRate:f});c&&c.length>0&&(d(e=>e.map(e=>{const a=c.find(a=>a.id===e.id);return a?(0,t.A)((0,t.A)({},e),{},{cash:a.newCash}):e})),r(e=>{const a=Number(e.cash||0);let s;return s="send"===j?a-n:"take"===j&&"toMe"===v?a+n:a,(0,t.A)((0,t.A)({},e),{},{cash:s})}));const l="send"===j?"\ubcf4\ub0b4\uae30":"toMe"===v?"\uac00\uc838\uc624\uae30":"\uc5c6\uc560\uae30";S("".concat(s,"\uba85\uc5d0\uac8c ").concat("percentage"===p?"".concat(a,"%"):"".concat(a.toLocaleString(),"\uc6d0")," ").concat(l," \uc644\ub8cc! (\ucd1d ").concat(n.toLocaleString(),"\uc6d0 \ucc98\ub9ac").concat("send"===j&&f>0?", \uc138\uae08 ".concat(f,"% \uc801\uc6a9"):"",")")),x(""),u([]),L(!1),setTimeout(()=>S(""),3e3)}catch(s){console.error("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd:",s),M("\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(s.message)),setTimeout(()=>M(""),5e3)}finally{T(!1)}}},className:"transfer-form",children:[(0,l.jsxs)("div",{className:"action-selector",children:[(0,l.jsxs)("button",{type:"button",className:"action-btn ".concat("send"===j?"active send":""),onClick:()=>g("send"),children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\udce4"})," \ubcf4\ub0b4\uae30"]}),(0,l.jsxs)("button",{type:"button",className:"action-btn ".concat("take"===j?"active take":""),onClick:()=>g("take"),children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\udce5"})," \uac00\uc838\uc624\uae30"]})]}),"take"===j&&(0,l.jsxs)("div",{className:"take-mode-section",children:[(0,l.jsx)("h4",{children:"\uac00\uc838\uc624\uae30 \uc635\uc158"}),(0,l.jsxs)("div",{className:"take-mode-selector",children:[(0,l.jsxs)("label",{className:"mode-option ".concat("toMe"===v?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"takeMode",value:"toMe",checked:"toMe"===v,onChange:e=>b(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"}),(0,l.jsxs)("span",{className:"mode-text",children:[(0,l.jsx)("strong",{children:"\ud83d\udcb0 \ub098\uc5d0\uac8c \uac00\uc838\uc624\uae30"}),(0,l.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \ub0b4 \uacc4\uc88c\ub85c \uac00\uc838\uc635\ub2c8\ub2e4"})]})]}),(0,l.jsxs)("label",{className:"mode-option ".concat("remove"===v?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"takeMode",value:"remove",checked:"remove"===v,onChange:e=>b(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"}),(0,l.jsxs)("span",{className:"mode-text",children:[(0,l.jsx)("strong",{children:"\ud83d\uddd1\ufe0f \ub3c8 \uc5c6\uc560\uae30"}),(0,l.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \uc601\uad6c\uc801\uc73c\ub85c \uc81c\uac70\ud569\ub2c8\ub2e4"})]})]})]})]}),(0,l.jsxs)("div",{className:"amount-section",children:[(0,l.jsxs)("div",{className:"amount-type-selector",children:[(0,l.jsxs)("label",{className:"type-option ".concat("fixed"===p?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"amountType",value:"fixed",checked:"fixed"===p,onChange:e=>N(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"})," \uace0\uc815 \uae08\uc561"]}),(0,l.jsxs)("label",{className:"type-option ".concat("percentage"===p?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"amountType",value:"percentage",checked:"percentage"===p,onChange:e=>N(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"})," \ud37c\uc13c\ud2b8 (%)"]})]}),(0,l.jsxs)("div",{className:"amount-input-group",children:[(0,l.jsx)("input",{type:"number",value:h,onChange:e=>x(e.target.value),placeholder:"fixed"===p?"\uae08\uc561 \uc785\ub825":"\ud37c\uc13c\ud2b8 \uc785\ub825",min:"1",max:"percentage"===p?"100":void 0,required:!0,className:"amount-input"}),(0,l.jsx)("span",{className:"amount-unit",children:"fixed"===p?"\uc6d0":"%"})]})]}),"send"===j&&(0,l.jsxs)("div",{className:"tax-section",children:[(0,l.jsxs)("div",{className:"tax-header",children:[(0,l.jsx)("h4",{children:"\ud83d\udcb8 \uc138\uae08 \uc124\uc815"}),(0,l.jsx)("span",{className:"tax-description",children:"\ubcf4\ub0b4\ub294 \uae08\uc561\uc5d0\uc11c \uc138\uae08\uc744 \uc81c\uc678\ud558\uace0 \uc9c0\uae09\ub429\ub2c8\ub2e4."})]}),(0,l.jsxs)("div",{className:"tax-input-group",children:[(0,l.jsx)("label",{htmlFor:"taxRate",children:"\uc138\uae08\uc728:"}),(0,l.jsx)("input",{type:"number",id:"taxRate",value:f,onChange:e=>k(Math.max(0,Math.min(100,Number(e.target.value)))),min:"0",max:"100",className:"tax-input"}),(0,l.jsx)("span",{className:"tax-unit",children:"%"})]}),h&&(0,l.jsx)("div",{className:"tax-preview",children:"fixed"===p?(0,l.jsxs)(l.Fragment,{children:["\uc2e4\uc81c \uc9c0\uae09\uc561: ",D(0,h,!0).toLocaleString(),"\uc6d0 (\uc138\uae08 ",Math.floor(Number(h)*f/100).toLocaleString(),"\uc6d0 \uc81c\uc678)"]}):"\uac01 \ud559\uc0dd \uc794\uc561\uc758 ".concat(h,"%\uc5d0\uc11c \uc138\uae08 ").concat(f,"%\uac00 \ucd94\uac00\ub85c \ucc28\uac10\ub429\ub2c8\ub2e4.")})]}),(0,l.jsxs)("div",{className:"user-selection-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("h3",{children:"\ub300\uc0c1 \uc120\ud0dd"}),(0,l.jsxs)("label",{className:"select-all-label",children:[(0,l.jsx)("input",{type:"checkbox",checked:A,onChange:()=>{L(e=>{const a=!e;return u(a?R.map(e=>e.id):[]),a})},className:"checkbox-custom"}),(0,l.jsx)("span",{className:"checkmark"})," \uc804\uccb4 \uc120\ud0dd"]})]}),s&&0===R.length?(0,l.jsx)("div",{className:"loading",children:"\uc0ac\uc6a9\uc790 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."}):(0,l.jsx)("div",{className:"user-list",children:R.map(e=>{var a;const s=E[e.id];return(0,l.jsx)("div",{className:"user-item",children:(0,l.jsxs)("label",{className:"user-label",children:[(0,l.jsx)("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>{return a=e.id,void u(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},className:"checkbox-custom"}),(0,l.jsx)("span",{className:"checkmark"}),(0,l.jsxs)("div",{className:"user-info",children:[(0,l.jsx)("span",{className:"user-name",children:e.name}),(0,l.jsxs)("span",{className:"user-balance",children:["\uc794\uc561: ",(null===(a=e.cash)||void 0===a?void 0:a.toLocaleString())||0,"\uc6d0"]}),void 0!==s&&(0,l.jsxs)("span",{className:"preview-amount ".concat(j),children:["send"===j?"+":"\u2212",s.toLocaleString(),"\uc6d0"]})]})]})},e.id)})})]}),(0,l.jsx)("button",{type:"submit",className:"submit-btn ".concat(j),disabled:s||w,children:w?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"spinner"})," \ucc98\ub9ac \uc911..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"icon",children:"send"===j?"\ud83d\udce4":"\ud83d\udce5"})," ","send"===j?"\ubcf4\ub0b4\uae30":"\uac00\uc838\uc624\uae30"," \uc2e4\ud589"]})})]})]})}},7262(e,a,s){s(2555),s(5010),s(5472),s(5452)}}]);
//# sourceMappingURL=909.c07d4fd9.chunk.js.map