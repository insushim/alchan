"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[757],{6757(e,t,n){n.r(t),n.d(t,{default:()=>k});var a=n(2555),s=n(5043),l=n(5016),c=n(577),r=n(5010),i=n(9270),o=n(9306),u=n(579);const d=(0,s.lazy)(()=>Promise.all([n.e(985),n.e(886)]).then(n.bind(n,3886))),m={wK:"\u2654",wQ:"\u2655",wR:"\u2656",wB:"\u2657",wN:"\u2658",wP:"\u2659",bK:"\u265a",bQ:"\u265b",bR:"\u265c",bB:"\u265d",bN:"\u265e",bP:"\u265f"},h=[{name:"Unranked",minPoints:0},{name:"C",minPoints:800},{name:"B",minPoints:1e3},{name:"A",minPoints:1200},{name:"S",minPoints:1400},{name:"SS",minPoints:1600}],w=15,f=-10,b=e=>{const t={};return e.forEach((e,n)=>{e.forEach((e,a)=>{e&&(t["".concat(n,"-").concat(a)]=e)})}),t},p=e=>{const t=Array(8).fill(null).map(()=>Array(8).fill(null));for(const n in e){const[a,s]=n.split("-").map(Number);t[a][s]=e[n]}return t},v={P:100,N:320,B:330,R:500,Q:900,K:2e4},g=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],y=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]],x=(e,t,n,a,s,l,c)=>{if(0===t)return((e,t)=>{let n=0;for(let a=0;a<8;a++)for(let s=0;s<8;s++){const l=e[a][s];if(!l)continue;const c=l[0],r=l[1],i=v[r]||0;let o=0;"P"===r?o=g["w"===c?a:7-a][s]:"N"===r&&(o=y[a][s]);const u=i+o;c===t?n+=u:n-=u}return n})(e,l);const r=n?l:"w"===l?"b":"w",i=[];for(let o=0;o<8;o++)for(let t=0;t<8;t++){const n=e[o][t];if(n&&n[0]===r){c(e,o,t,n,!0).forEach(e=>{let[a,s]=e;i.push({from:[o,t],to:[a,s],piece:n})})}}if(0===i.length)return n?-999999:999999;if(n){let n=-1/0;for(const r of i){const i=e.map(e=>[...e]);i[r.to[0]][r.to[1]]=r.piece,i[r.from[0]][r.from[1]]=null;const o=x(i,t-1,!1,a,s,l,c);if(n=Math.max(n,o),s<=(a=Math.max(a,o)))break}return n}{let n=1/0;for(const r of i){const i=e.map(e=>[...e]);i[r.to[0]][r.to[1]]=r.piece,i[r.from[0]][r.from[1]]=null;const o=x(i,t-1,!0,a,s,l,c);if(n=Math.min(n,o),(s=Math.min(s,o))<=a)break}return n}},k=()=>{var e,t,n,v,g;const{user:y,userDoc:k,isAdmin:j}=(0,l.As)(),[N,C]=(0,s.useState)(null),[R,P]=(0,s.useState)(null),[S,E]=(0,s.useState)(!0),[M,I]=(0,s.useState)(""),[A,H]=(0,s.useState)({message:"",type:""}),[K,G]=(0,s.useState)(null),[Q,T]=(0,s.useState)([]),[B,D]=(0,s.useState)([]),[_,L]=(0,s.useState)(600),[U,q]=(0,s.useState)(600),[F,V]=(0,s.useState)(600),[W,z]=(0,s.useState)(null),[J,O]=(0,s.useState)([]),X=(0,s.useRef)(null),Y=(0,s.useRef)(null),Z=(0,s.useRef)(null),$=(0,s.useRef)(0),[ee,te]=(0,s.useState)("player"),[ne,ae]=(0,s.useState)("intermediate"),[se,le]=(0,s.useState)(!1),[ce,re]=(0,s.useState)(!1),[ie,oe]=(0,s.useState)(!0),[ue,de]=(0,s.useState)(!1),[me,he]=(0,s.useState)([]),[we,fe]=(0,s.useState)(0),be=R&&y&&(R.aiMode?R.playerColor:R.players.white===y.uid?"w":"b"),pe=R&&R.turn===be,{rank:ve,nextRank:ge,pointsForNextRank:ye}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=h[0];for(let l=h.length-1;l>=0;l--)if(e>=h[l].minPoints){t=h[l];break}const n=h.findIndex(e=>e.name===t.name)+1,a=n<h.length?h[n]:null,s=a?a.minPoints-e:0;return{rank:t.name,nextRank:null===a||void 0===a?void 0:a.name,pointsForNextRank:s}}(null===k||void 0===k?void 0:k.chessRating),xe=(0,s.useRef)(N);(0,s.useEffect)(()=>{xe.current=N},[N]);const ke=(0,s.useRef)(R);(0,s.useEffect)(()=>{ke.current=R},[R]);const je=(0,s.useRef)(y);(0,s.useEffect)(()=>{je.current=y},[y]),(0,s.useEffect)(()=>{const e=()=>{var e;const t=xe.current,n=ke.current,a=je.current;t&&n&&a&&(null===(e=n.players)||void 0===e?void 0:e.white)===a.uid&&(0,r.kd)((0,r.H9)(r.db,"chessGames",t))};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);const Ne=(0,s.useCallback)(async e=>{if(!N)return;const t=(0,r.H9)(r.db,"chessGames",N),n="w"===e?"b":"w";await(0,r.c4)(r.db,async a=>{const s=await a.get(t);if(!s.exists()||"active"!==s.data().status)return;s.data().players["w"===n?"white":"black"],s.data().players["w"===e?"white":"black"];a.update(t,{status:"finished",winner:n,endReason:"timeout",ratingChange:{["w"===n?"white":"black"]:w,["w"===e?"white":"black"]:f}})}),Y.current&&await Y.current()},[N]);(0,s.useEffect)(()=>(R&&"active"===R.status&&pe&&(X.current=setInterval(async()=>{(0,r.H9)(r.db,"chessGames",N);if("w"===R.turn){const e=Math.max(0,U-1);q(e),e<=0&&await Ne("w")}else{const e=Math.max(0,F-1);V(e),e<=0&&await Ne("b")}},1e3)),()=>clearInterval(X.current)),[R,pe,U,F,N,Ne]);const Ce=(0,s.useCallback)(async()=>{if(y)try{const e=(0,r.P)((0,r.rJ)(r.db,"chessGames"),(0,r._M)("status","==","waiting")),t=await(0,r.GG)(e),n=[];t.forEach(e=>{const t=e.data();t.players.white!==y.uid&&n.push((0,a.A)({id:e.id},t))}),D(n)}catch(e){console.error("Error fetching rooms:",e)}},[y]);(0,s.useEffect)(()=>{if(S&&y){Ce();const e=setInterval(Ce,6e4);return()=>clearInterval(e)}},[S,y,Ce]);const Re=(0,s.useCallback)(async()=>{if(!N)return;const e=(0,r.H9)(r.db,"chessGames",N),t=await(0,r.x7)(e);if(t.exists()){const e=t.data(),n=(0,a.A)((0,a.A)({},e),{},{board:p(e.board)});P(n),E(!1),void 0!==e.whiteTime&&q(e.whiteTime),void 0!==e.blackTime&&V(e.blackTime),e.moveHistory&&O(e.moveHistory)}else H({message:"\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"}),C(null),P(null),E(!0)},[N]),{refetch:Pe}=(0,c.nm)(Re,{interval:18e4,enabled:!!N});(0,s.useEffect)(()=>{Y.current=Pe},[Pe]),(0,s.useEffect)(()=>{(()=>{if(!y)return;const e=(new Date).toDateString(),t="chessPlayCount_".concat(y.uid,"_").concat(e),n=parseInt(localStorage.getItem(t)||"0",10);fe(n)})()},[y]),(0,s.useEffect)(()=>{if(A.message){const e=setTimeout(()=>H({message:"",type:""}),3e3);return()=>clearTimeout(e)}},[A.message]);const Se=(0,s.useCallback)(function(e,t,n,a){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const l=[],c=a[0],r=a[1],i=(r,i)=>{if(r>=0&&r<8&&i>=0&&i<8){const o=e[r][i];if(!o||o[0]!==c)if(s){const s=e.map(e=>[...e]);s[r][i]=a,s[t][n]=null,Me(s,c)||l.push([r,i])}else l.push([r,i])}};switch(r){case"P":const a="w"===c?-1:1,l="w"===c?6:1;if(t+a>=0&&t+a<8&&!e[t+a][n]&&(i(t+a,n),t!==l||e[t+2*a][n]||i(t+2*a,n)),[-1,1].forEach(s=>{if(t+a>=0&&t+a<8&&n+s>=0&&n+s<8){const l=e[t+a][n+s];l&&l[0]!==c&&i(t+a,n+s)}}),null!==R&&void 0!==R&&R.enPassant){const[e,s]=R.enPassant;t+a===e&&1===Math.abs(n-s)&&i(e,s)}break;case"N":[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(e=>{let[a,s]=e;i(t+a,n+s)});break;case"B":case"R":case"Q":({B:[[1,1],[1,-1],[-1,1],[-1,-1]],R:[[0,1],[0,-1],[1,0],[-1,0]],Q:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]]})[r].forEach(a=>{let[s,l]=a;for(let r=1;r<8;r++){const a=t+s*r,o=n+l*r;if(!(a>=0&&a<8&&o>=0&&o<8))break;if(e[a][o]){e[a][o][0]!==c&&i(a,o);break}i(a,o)}});break;case"K":if([[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(e=>{let[a,s]=e;i(t+a,n+s)}),s&&null!==R&&void 0!==R&&R.castling){const a="w"===c?7:0;t===a&&4===n&&(!R.castling[c+"K"]||e[a][5]||e[a][6]||e[a][7]!==c+"R"||Ee(e,a,4,c)||Ee(e,a,5,c)||Ee(e,a,6,c)||i(a,6),!R.castling[c+"Q"]||e[a][3]||e[a][2]||e[a][1]||e[a][0]!==c+"R"||Ee(e,a,4,c)||Ee(e,a,3,c)||Ee(e,a,2,c)||i(a,2))}}return l},[R]),Ee=(0,s.useCallback)((e,t,n,a)=>{const s="w"===a?"b":"w";for(let l=0;l<8;l++)for(let a=0;a<8;a++){const c=e[l][a];if(c&&c[0]===s){if(Se(e,l,a,c,!1).some(e=>{let[a,s]=e;return a===t&&s===n}))return!0}}return!1},[Se]),Me=(0,s.useCallback)((e,t)=>{let n=null;for(let a=0;a<8;a++){for(let s=0;s<8;s++)if(e[a][s]===t+"K"){n=[a,s];break}if(n)break}return!!n&&Ee(e,n[0],n[1],t)},[Ee]),Ie=(0,s.useCallback)((e,t)=>{for(let n=0;n<8;n++)for(let a=0;a<8;a++){const s=e[n][a];if(s&&s[0]===t){if(Se(e,n,a,s,!0).length>0)return null}}return Me(e,t)?"checkmate":"stalemate"},[Se,Me]),Ae=async()=>{if(!y)return void H({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});if("ai"===ee){const e=(new Date).toDateString(),t="chessPlayCount_".concat(y.uid,"_").concat(e);if(parseInt(localStorage.getItem(t)||"0",10)>=3)return void H({message:"\uc624\ub298\uc758 AI \ub300\uc804 \ud69f\uc218\ub97c \ubaa8\ub450 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. (3/3)",type:"error"})}const e=Math.random().toString(36).substring(2,8),t=(0,r.H9)(r.db,"chessGames",e),n="ai"===ee,a=Math.random()>.5?"w":"b",s="w"===a?"b":"w",l={board:b([["bR","bN","bB","bQ","bK","bB","bN","bR"],["bP","bP","bP","bP","bP","bP","bP","bP"],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],["wP","wP","wP","wP","wP","wP","wP","wP"],["wR","wN","wB","wQ","wK","wB","wN","wR"]]),players:n?"w"===a?{white:y.uid,black:"AI"}:{white:"AI",black:y.uid}:{white:y.uid,black:null},playerNames:n?"w"===a?{white:k.name,black:"AI (".concat("beginner"===ne?"\ucd08\uae09":"intermediate"===ne?"\uc911\uae09":"\uace0\uae09",")")}:{white:"AI (".concat("beginner"===ne?"\ucd08\uae09":"intermediate"===ne?"\uc911\uae09":"\uace0\uae09",")"),black:k.name}:{white:k.name,black:null},playerRanks:n?"w"===a?{white:ve,black:"AI"}:{white:"AI",black:ve}:{white:ve,black:"Unranked"},playerRatings:n?"w"===a?{white:k.chessRating||0,black:0}:{white:0,black:k.chessRating||0}:{white:k.chessRating||0,black:null},turn:"w",status:n?"active":"waiting",winner:null,timeControl:_,whiteTime:_,blackTime:_,castling:{wK:!0,wQ:!0,bK:!0,bQ:!0},enPassant:null,moveHistory:[],createdAt:(0,r.O5)(),ratingChange:null,aiMode:n,aiDifficulty:n?ne:null,aiColor:n?s:null,playerColor:n?a:null};try{await(0,r.BN)(t,l),C(e),H({message:n?"AI \ub300\uc804 \uc2dc\uc791!":"\uccb4\uc2a4 \ubc29 \uc0dd\uc131 \uc644\ub8cc! \ucf54\ub4dc: ".concat(e),type:"success"}),Y.current&&await Y.current()}catch(c){console.error("Error creating room:",c),H({message:"\ubc29 \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}},He=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||M.trim();if(!e)return void H({message:"\ucc38\uac00\ud560 \ubc29 \ucf54\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694.",type:"error"});if(!y)return void H({message:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.",type:"error"});const t=(0,r.H9)(r.db,"chessGames",e);try{await(0,r.c4)(r.db,async e=>{const n=await e.get(t);if(!n.exists())throw new Error("\ubc29\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const a=n.data();if(a.players.black)throw new Error("\ubc29\uc774 \uac00\ub4dd \ucc3c\uc2b5\ub2c8\ub2e4.");if(a.players.white===y.uid)throw new Error("\uc790\uc2e0\uc774 \ub9cc\ub4e0 \ubc29\uc5d0\ub294 \ucc38\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");e.update(t,{"players.black":y.uid,"playerNames.black":k.name,"playerRanks.black":ve,"playerRatings.black":k.chessRating||0,status:"active"})}),C(e),Y.current&&await Y.current()}catch(n){console.error("Error joining room: ",n),H({message:"\ucc38\uac00 \uc2e4\ud328: ".concat(n.message),type:"error"})}},Ke=(e,t)=>{if(!pe||"active"!==R.status||ce)return;const n=R.board[e][t];if(K&&Q.some(n=>{let[a,s]=n;return a===e&&s===t}))Ge(e,t);else if(n&&n[0]===be){G({row:e,col:t,piece:n});const a=Se(R.board,e,t,n);T(a)}else G(null),T([])},Ge=async(e,t)=>{if(!K||!R)return;const{row:n,col:a,piece:s}=K;"P"!==s[1]||0!==e&&7!==e?await Te(n,a,e,t,s):z({toRow:e,toCol:t,fromRow:n,fromCol:a})},Qe=(0,s.useCallback)(async()=>{var e;if(R&&N&&(null===(e=R.players)||void 0===e?void 0:e.white)===(null===y||void 0===y?void 0:y.uid))try{await(0,r.kd)((0,r.H9)(r.db,"chessGames",N))}catch(t){console.error("Error deleting room:",t)}C(null),P(null),E(!0),G(null),T([])},[R,N,y]),Te=(0,s.useCallback)(async function(e,t,n,s,l){let c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(!N||ce)return;re(!0);const i=(0,r.H9)(r.db,"chessGames",N);try{const o=await(0,r.c4)(r.db,async r=>{const o=await r.get(i);if(!o.exists())throw new Error("\uac8c\uc784\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const u=o.data();if("active"!==u.status)return{status:u.status,winner:u.winner,aiMode:u.aiMode,moveMade:!1};const d=l[0];if(u.turn!==d)throw new Error("\uc0c1\ub300\ubc29\uc758 \ud134\uc785\ub2c8\ub2e4.");let m=p(u.board).map(e=>[...e]);m[e][t]=null,m[n][s]=c?d+c:l;const h=(0,a.A)({},u.castling);let v=null;if("wK"===l&&(h.wK=!1,h.wQ=!1),"bK"===l&&(h.bK=!1,h.bQ=!1),"wR"===l&&7===e&&0===t&&(h.wQ=!1),"wR"===l&&7===e&&7===t&&(h.wK=!1),"bR"===l&&0===e&&0===t&&(h.bQ=!1),"bR"===l&&0===e&&7===t&&(h.bK=!1),"K"===l[1]&&2===Math.abs(t-s)&&(6===s?(m[e][5]=m[e][7],m[e][7]=null):(m[e][3]=m[e][0],m[e][0]=null)),"P"===l[1]&&u.enPassant){const[t,a]=u.enPassant;n===t&&s===a&&(m[e][s]=null)}"P"===l[1]&&2===Math.abs(e-n)&&(v=[(e+n)/2,t]);const g="abcdefgh",y="".concat("P"!==l[1]?l[1]:"").concat(g[t]).concat(8-e," -> ").concat(g[s]).concat(8-n),x=[...u.moveHistory,y],k="w"===d?"b":"w";let j=u.status,N=null,C=null,R=null;const P=Ie(m,k);P&&(j="finished",C=P,N="checkmate"===P?d:"draw"),"finished"===j&&"draw"!==N&&(R={["w"===N?"white":"black"]:w,["w"===N?"black":"white"]:f});const S={board:b(m),turn:k,castling:h,enPassant:v,moveHistory:x,status:j,winner:N,endReason:C,ratingChange:R};return r.update(i,S),{status:j,winner:N,aiMode:u.aiMode,moveMade:!0}});if(o.moveMade&&"finished"===o.status&&o.aiMode){const e=o.winner===be,t="draw"===o.winner;if(e||t&&Math.random()<.5){const e=(()=>{const e=e=>{const t=e.reduce((e,t)=>e+t.weight,0);let n=Math.random()*t;for(const a of e)if(n-=a.weight,n<=0)return a.amount;return e[e.length-1].amount};return[{type:"cash",amount:e([{amount:5e4,weight:5},{amount:3e4,weight:10},{amount:2e4,weight:15},{amount:1e4,weight:20},{amount:5e3,weight:18},{amount:3e3,weight:12},{amount:1e3,weight:10},{amount:500,weight:7},{amount:100,weight:3}])},{type:"coupon",amount:e([{amount:20,weight:10},{amount:10,weight:20},{amount:5,weight:20},{amount:3,weight:20},{amount:1,weight:30}])}]})();he(e),de(!0)}else{const e=(new Date).toDateString(),n="chessPlayCount_".concat(y.uid,"_").concat(e),a=we+1;localStorage.setItem(n,a.toString()),fe(a),t&&H({message:"\ubb34\uc2b9\ubd80! \uc544\uc27d\uc9c0\ub9cc \ubcf4\uc0c1\uc740 \ub2e4\uc74c \uae30\ud68c\uc5d0!",type:"info"}),setTimeout(()=>Qe(),2e3)}}G(null),T([]),Y.current&&await Y.current()}catch(o){console.error("Error making move: ",o),H({message:"\uc774\ub3d9 \uc911 \uc624\ub958 \ubc1c\uc0dd: ".concat(o.message),type:"error"}),Y.current&&await Y.current()}finally{re(!1)}},[N,ce,be,we,y,Ie,he,de,fe,H,Qe,G,T]);(0,s.useEffect)(()=>()=>{Z.current&&(clearTimeout(Z.current),Z.current=null)},[]),(0,s.useEffect)(()=>{(async()=>{var e;if(!R||!N||"active"!==R.status)return;if(!R.aiMode)return;if(se||ce)return;const t=R.aiColor;if(R.turn!==t)return;const n=(null===(e=R.moveHistory)||void 0===e?void 0:e.length)||0;if(n===$.current&&n>0)return;le(!0),$.current=n+1;const a=500+1e3*Math.random();Z.current=setTimeout(async()=>{try{const e=(0,r.H9)(r.db,"chessGames",N),n=await(0,r.x7)(e);if(!n.exists())return void le(!1);const a=n.data();if("active"!==a.status||a.turn!==t)return void le(!1);const s=((e,t,n,a)=>{const s=[];for(let i=0;i<8;i++)for(let n=0;n<8;n++){const l=e[i][n];l&&l[0]===t&&a(e,i,n,l,!0).forEach(e=>{let[t,a]=e;s.push({from:[i,n],to:[t,a],piece:l})})}if(0===s.length)return null;if("beginner"===n)return s[Math.floor(Math.random()*s.length)];const l="intermediate"===n?2:3;let c=null,r=-1/0;for(const i of s){const n=e.map(e=>[...e]);n[i.to[0]][i.to[1]]=i.piece,n[i.from[0]][i.from[1]]=null;const s=x(n,l-1,!1,-1/0,1/0,t,a);s>r&&(r=s,c=i)}return c})(p(a.board),t,ne,Se);if(s){const{from:e,to:t,piece:n}=s;await Te(e[0],e[1],t[0],t[1],n)}}catch(e){console.error("AI move error:",e),le(!1)}le(!1),Z.current=null},a)})()},[null===R||void 0===R?void 0:R.turn,null===R||void 0===R?void 0:R.status,null===R||void 0===R||null===(e=R.moveHistory)||void 0===e?void 0:e.length,N,ne,Te,Se,ce]);const Be=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))};if(S){return(0,u.jsx)("div",{className:"chess-container",children:(0,u.jsxs)("div",{className:"room-creation",children:[(0,u.jsx)("h2",{children:"\u265a \uccb4\uc2a4 \uac8c\uc784 \u2654"}),(0,u.jsx)("p",{children:"\uc804\ub7b5\uc801 \uc0ac\uace0\ub825\uc744 \uae30\ub974\ub294 \ucd5c\uace0\uc758 \ub450\ub1cc \uac8c\uc784!"}),(0,u.jsxs)("div",{className:"user-rank-info",children:[(0,u.jsxs)("p",{children:["\ub0b4 \ub4f1\uae09: ",(0,u.jsx)("strong",{children:ve})," (",(null===k||void 0===k?void 0:k.chessRating)||0,"\uc810)"]}),ge&&(0,u.jsxs)("p",{className:"next-rank-guide",children:["\ub2e4\uc74c \ub4f1\uae09 (",ge,")\uae4c\uc9c0 ",(0,u.jsxs)("strong",{children:[ye,"\uc810"]})," \ub0a8\uc558\uc2b5\ub2c8\ub2e4."]})]}),(0,u.jsxs)("div",{className:"game-mode-selector",children:[(0,u.jsx)("h3",{children:"\uac8c\uc784 \ubaa8\ub4dc \uc120\ud0dd"}),(0,u.jsxs)("div",{className:"mode-options",children:[(0,u.jsx)("button",{className:"player"===ee?"selected":"",onClick:()=>te("player"),children:"\ud83d\udc65 \ud50c\ub808\uc774\uc5b4 \ub300\uc804"}),(0,u.jsxs)("button",{className:"ai"===ee?"selected":"",onClick:()=>te("ai"),children:["\ud83e\udd16 AI \ub300\uc804 (",we,"/3)"]})]})]}),"ai"===ee&&(0,u.jsxs)("div",{className:"ai-difficulty-selector",children:[(0,u.jsx)("h3",{children:"AI \ub09c\uc774\ub3c4"}),(0,u.jsxs)("div",{className:"difficulty-options",children:[(0,u.jsx)("button",{className:"beginner"===ne?"selected":"",onClick:()=>ae("beginner"),children:"\ud83d\ude0a \ucd08\uae09"}),(0,u.jsx)("button",{className:"intermediate"===ne?"selected":"",onClick:()=>ae("intermediate"),children:"\ud83e\udd14 \uc911\uae09"}),(0,u.jsx)("button",{className:"advanced"===ne?"selected":"",onClick:()=>ae("advanced"),children:"\ud83d\udd25 \uace0\uae09"})]})]}),A.message&&(0,u.jsx)("div",{className:"feedback ".concat(A.type),children:A.message}),(0,u.jsxs)("div",{className:"time-control-selector",children:[(0,u.jsx)("h3",{children:"\uc2dc\uac04 \uc81c\ud55c \uc120\ud0dd"}),(0,u.jsx)("div",{className:"time-options",children:[180,300,600,900].map(e=>(0,u.jsxs)("button",{className:_===e?"selected":"",onClick:()=>L(e),children:[e/60,"\ubd84"]},e))})]}),(0,u.jsxs)("div",{className:"room-actions",children:[(0,u.jsx)("button",{onClick:Ae,className:"create-room-btn",children:"ai"===ee?"\ud83e\udd16 AI \ub300\uc804 \uc2dc\uc791":"\uc0c8\ub85c\uc6b4 \ubc29 \ub9cc\ub4e4\uae30"}),"player"===ee&&(0,u.jsxs)("div",{className:"join-room",children:[(0,u.jsx)("input",{type:"text",value:M,onChange:e=>I(e.target.value),placeholder:"\ubc29 \ucf54\ub4dc \uc785\ub825",maxLength:"6"}),(0,u.jsx)("button",{onClick:()=>He(),children:"\ucf54\ub4dc\ub85c \ucc38\uac00"})]})]}),B.length>0&&(0,u.jsxs)("div",{className:"available-rooms",children:[(0,u.jsx)("h3",{children:"\ud83d\udccb \ub300\uae30 \uc911\uc778 \ubc29 \ubaa9\ub85d"}),(0,u.jsx)("div",{className:"rooms-list",children:B.map(e=>{var t,n;return(0,u.jsxs)("div",{className:"room-item",children:[(0,u.jsxs)("div",{className:"room-info",children:[(0,u.jsxs)("span",{className:"room-host",children:["\ud638\uc2a4\ud2b8: ",e.playerNames.white," (",(null===(t=e.playerRanks)||void 0===t?void 0:t.white)||"Unranked",", ",(null===(n=e.playerRatings)||void 0===n?void 0:n.white)||0,"\uc810)"]}),(0,u.jsxs)("span",{className:"room-time",children:["\u23f1 ",Be(e.timeControl)]}),(0,u.jsxs)("span",{className:"room-code",children:["\ucf54\ub4dc: ",e.id]})]}),(0,u.jsxs)("div",{className:"room-item-buttons",children:[(0,u.jsx)("button",{onClick:()=>He(e.id),className:"join-btn",children:"\ucc38\uac00"}),(null===j||void 0===j?void 0:j())&&(0,u.jsx)("button",{onClick:()=>(async e=>{if(null!==j&&void 0!==j&&j())try{await(0,r.kd)((0,r.H9)(r.db,"chessGames",e)),H({message:"\ubc29 ".concat(e,"\uac00 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),type:"success"}),Ce()}catch(t){console.error("Error deleting room by admin:",t),H({message:"\ubc29 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}else H({message:"\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",type:"error"})})(e.id),className:"delete-btn",children:"\uc0ad\uc81c"})]})]},e.id)})})]}),(0,u.jsxs)("div",{className:"chess-rules",children:[(0,u.jsx)("h3",{children:"\uccb4\uc2a4 \uae30\ubcf8 \uaddc\uce59"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"\ubc31(White)\uc774 \uba3c\uc800 \uc2dc\uc791\ud569\ub2c8\ub2e4."}),(0,u.jsx)("li",{children:"\uc0c1\ub300\ubc29\uc758 \ud0b9\uc744 \uccb4\ud06c\uba54\uc774\ud2b8\ud558\uba74 \uc2b9\ub9ac\ud569\ub2c8\ub2e4."}),(0,u.jsxs)("li",{children:["\ud50c\ub808\uc774\uc5b4 \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,u.jsx)("strong",{children:"\uc810\uc218(+15)"}),"\uc640 \ucfe0\ud3f0 3\uac1c, \ud328\ubc30 \uc2dc ",(0,u.jsx)("strong",{children:"\uc810\uc218(-10)"})]}),(0,u.jsxs)("li",{children:["AI \ub300\uc804: \uc2b9\ub9ac \uc2dc ",(0,u.jsx)("strong",{children:"\uce74\ub4dc \ubcf4\uc0c1"})," \uc120\ud0dd (\ud604\uae08 \ub610\ub294 \ucfe0\ud3f0), \ud558\ub8e8 3\ud68c \uc81c\ud55c"]})]})]})]})})}if(!R)return(0,u.jsx)(o.AlchanLoading,{});const De=R.players.white,_e=R.players.black;return(0,u.jsxs)("div",{className:"chess-container",style:{backgroundColor:"#0a0a12",minHeight:"100%",width:"100%"},children:[(0,u.jsxs)("div",{className:"game-info",children:[(0,u.jsxs)("div",{className:"player black ".concat("b"===R.turn?"active":""," ").concat((null===y||void 0===y?void 0:y.uid)===_e?"my-player":"opponent-player"),children:[(0,u.jsxs)("span",{className:"player-name",children:["\u265b ",R.playerNames.black||"\ub300\uae30\uc911...",(0,u.jsxs)("span",{className:"player-rank",children:["[",(null===(t=R.playerRanks)||void 0===t?void 0:t.black)||"Unranked","] (",(null===(n=R.playerRatings)||void 0===n?void 0:n.black)||0,"\uc810)"]})]}),(0,u.jsx)("span",{className:"player-time",children:Be(F)})]}),(0,u.jsx)("div",{className:"game-status",children:"finished"===R.status?"draw"===R.winner?(0,u.jsx)("span",{children:"\ubb34\uc2b9\ubd80!"}):R.winner===be?(0,u.jsxs)("span",{className:"winner",children:["\ud83c\udf89 \uc2b9\ub9ac! (",R.ratingChange["w"===be?"white":"black"]>0?"+":"",R.ratingChange["w"===be?"white":"black"],"\uc810) \ucfe0\ud3f0 3\uac1c \ud68d\ub4dd!"]}):(0,u.jsxs)("span",{className:"loser",children:["\ud328\ubc30! (",R.ratingChange["w"===be?"white":"black"],"\uc810)"]}):"waiting"===R.status?(0,u.jsxs)("span",{children:["\uc0c1\ub300\ubc29\uc744 \uae30\ub2e4\ub9ac\ub294 \uc911... (\ucf54\ub4dc: ",N,")"]}):(0,u.jsx)("span",{children:pe?"\ub2f9\uc2e0\uc758 \ucc28\ub840":"\uc0c1\ub300\ubc29 \ucc28\ub840"})}),(0,u.jsxs)("div",{className:"player white ".concat("w"===R.turn?"active":""," ").concat((null===y||void 0===y?void 0:y.uid)===De?"my-player":"opponent-player"),children:[(0,u.jsxs)("span",{className:"player-name",children:["\u2655 ",R.playerNames.white,(0,u.jsxs)("span",{className:"player-rank",children:["[",(null===(v=R.playerRanks)||void 0===v?void 0:v.white)||"Unranked","] (",(null===(g=R.playerRatings)||void 0===g?void 0:g.white)||0,"\uc810)"]})]}),(0,u.jsx)("span",{className:"player-time",children:Be(U)})]})]}),(0,u.jsxs)("div",{className:"board-container",children:[(0,u.jsxs)("div",{className:"view-toggle",children:[(0,u.jsx)("button",{className:"toggle-btn ".concat(ie?"":"active"),onClick:()=>oe(!1),children:"2D"}),(0,u.jsx)("button",{className:"toggle-btn ".concat(ie?"active":""),onClick:()=>oe(!0),children:"3D"})]}),ie?(0,u.jsx)("div",{className:"chess-board-3d",children:(0,u.jsx)(s.Suspense,{fallback:(0,u.jsx)("div",{className:"loading-3d",children:"3D \ubcf4\ub4dc \ub85c\ub529 \uc911..."}),children:(0,u.jsx)(d,{board:R.board,selectedPiece:K,possibleMoves:Q,onSquareClick:Ke,myColor:be,isInCheck:Me})})}):(0,u.jsx)("div",{className:"chess-board ".concat("b"===be?"flipped":""),children:R.board.map((e,t)=>e.map((e,n)=>{const a=(null===K||void 0===K?void 0:K.row)===t&&(null===K||void 0===K?void 0:K.col)===n,s=Q.some(e=>{let[a,s]=e;return a===t&&s===n}),l=(t+n)%2===0,c=e&&"K"===e[1]&&Me(R.board,e[0]);return(0,u.jsxs)("div",{className:"square ".concat(l?"light":"dark","\n                                                   ").concat(a?"selected":"","\n                                                   ").concat(s?"possible":"","\n                                                   ").concat(c?"check":""),onClick:()=>Ke(t,n),children:[e&&(0,u.jsx)("div",{className:"piece ".concat("w"===e[0]?"white-piece":"black-piece"),children:m[e]}),s&&!e&&(0,u.jsx)("div",{className:"move-dot"}),s&&e&&(0,u.jsx)("div",{className:"capture-hint"})]},"".concat(t,"-").concat(n))}))}),W&&(0,u.jsx)("div",{className:"promotion-modal",children:(0,u.jsxs)("div",{className:"promotion-content",children:[(0,u.jsx)("h3",{children:"\ud504\ub85c\ubaa8\uc158 \uc120\ud0dd"}),(0,u.jsx)("div",{className:"promotion-pieces",children:["Q","R","B","N"].map(e=>(0,u.jsx)("button",{onClick:()=>(async e=>{if(!W)return;const{fromRow:t,fromCol:n,toRow:a,toCol:s}=W,l=R.board[t][n];await Te(t,n,a,s,l,e),z(null)})(e),className:"promotion-piece",children:m[be+e]},e))})]})}),se&&(0,u.jsx)("div",{className:"ai-thinking",children:(0,u.jsxs)("div",{className:"thinking-content",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"AI\uac00 \uc218\ub97c \uace0\ubbfc\ud558\ub294 \uc911..."})]})}),ue&&2===me.length&&(0,u.jsx)("div",{className:"reward-modal",children:(0,u.jsxs)("div",{className:"reward-content",children:[(0,u.jsx)("h3",{children:"\ud83c\udf89 \uc2b9\ub9ac \ubcf4\uc0c1!"}),(0,u.jsx)("p",{children:"\ud558\ub098\uc758 \uce74\ub4dc\ub97c \uc120\ud0dd\ud558\uc138\uc694"}),(0,u.jsx)("div",{className:"reward-cards",children:me.map((e,t)=>(0,u.jsxs)("div",{className:"reward-card",onClick:()=>(async e=>{if(y&&N)try{const t=(0,r.H9)(r.db,"users",y.uid),n=(new Date).toDateString(),a="chessPlayCount_".concat(y.uid,"_").concat(n);await(0,r.c4)(r.db,async n=>{if(!(await n.get(t)).exists())return;const a={};"cash"===e.type?a.balance=(0,r.GV)(e.amount):"coupon"===e.type&&(a.couponBalance=(0,r.GV)(e.amount)),n.update(t,a)});const s=we+1;localStorage.setItem(a,s.toString()),fe(s),de(!1),H({message:"cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0\uc744 \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c\ub97c \ud68d\ub4dd\ud588\uc2b5\ub2c8\ub2e4!"),type:"success"}),(0,i.Mx)(r.db,{classCode:null===k||void 0===k?void 0:k.classCode,userId:y.uid,userName:(null===k||void 0===k?void 0:k.name)||"\uc0ac\uc6a9\uc790",type:i.gI.GAME_WIN,description:"\uccb4\uc2a4 AI(".concat(ne,") \uc2b9\ub9ac - ").concat("cash"===e.type?"\ud604\uae08 ".concat(e.amount.toLocaleString(),"\uc6d0"):"\ucfe0\ud3f0 ".concat(e.amount,"\uac1c")," \ud68d\ub4dd"),amount:"cash"===e.type?e.amount:0,couponAmount:"coupon"===e.type?e.amount:0,metadata:{gameType:"chess",opponent:"AI",difficulty:ne,rewardType:e.type,rewardAmount:e.amount}}),setTimeout(()=>{Qe()},2e3)}catch(t){console.error("Error applying reward:",t),H({message:"\ubcf4\uc0c1 \uc9c0\uae09\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",type:"error"})}})(e),children:[(0,u.jsx)("div",{className:"card-icon",children:"cash"===e.type?"\ud83d\udcb5":"\ud83c\udfab"}),(0,u.jsx)("div",{className:"card-title",children:"cash"===e.type?"\ud604\uae08":"\ucfe0\ud3f0"}),(0,u.jsx)("div",{className:"card-amount",children:"cash"===e.type?"".concat(e.amount.toLocaleString(),"\uc6d0"):"".concat(e.amount,"\uac1c")})]},t))})]})})]}),A.message&&(0,u.jsx)("div",{className:"feedback ".concat(A.type),children:A.message}),(0,u.jsx)("div",{className:"game-controls",children:(0,u.jsx)("button",{onClick:Qe,className:"leave-button",children:"\uac8c\uc784 \ub098\uac00\uae30"})}),J.length>0&&(0,u.jsxs)("div",{className:"move-history",children:[(0,u.jsx)("h4",{children:"\uc774\ub3d9 \uae30\ub85d"}),(0,u.jsx)("div",{className:"moves-list",children:J.map((e,t)=>(0,u.jsxs)("span",{className:"move",children:[t%2===0?"".concat(Math.floor(t/2)+1,". "):"",e]},t))})]})]})}}}]);
//# sourceMappingURL=757.8b3a61ba.chunk.js.map