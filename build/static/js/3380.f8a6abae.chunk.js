"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[3380],{3380(e,t,s){s.r(t),s.d(t,{default:()=>u});var a=s(2555),n=s(5043),i=s(3216),c=s(2864),r=s(5472),o=s(5452);var l=s(5016),d=s(579);const u=()=>{const{roomId:e}=(0,i.g)(),{user:t,userDoc:s}=(0,l.As)(),[u,h]=(0,n.useState)(""),[m,p]=(0,n.useState)(0),[v,x]=(0,n.useState)(""),[b,f]=(0,n.useState)(""),[j,g]=(0,n.useState)([]),[y,S]=(0,n.useState)(null),[w,N]=(0,n.useState)(""),[k,q]=(0,n.useState)(!1),[I,C]=(0,n.useState)(!1),[A,E]=(0,n.useState)(""),[L,z]=(0,n.useState)(!1),D=(0,i.Zp)();(0,n.useEffect)(()=>{(async()=>{const t=await(0,r.x7)((0,r.H9)(c.db,"musicRooms",e));if(t.exists()){const e=t.data();h(e.name),p(e.pricePerSong||0),x(e.teacherId||"")}else E("\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ubc29\uc785\ub2c8\ub2e4.")})()},[e]),(0,n.useEffect)(()=>{null!==s&&void 0!==s&&s.name&&N(s.name)},[s]);return A&&!j.length?(0,d.jsx)("div",{className:"student-request-container error-container",children:A}):(0,d.jsxs)("div",{className:"student-request-container",children:[(0,d.jsx)("h2",{children:u||"\uc74c\uc545 \uc2e0\uccad"}),m>0&&(0,d.jsxs)("div",{className:"price-info",children:["1\uace1\ub2f9 ",m.toLocaleString()," \uc54c\ucc2c",t&&s&&(0,d.jsxs)("span",{children:[" (\ubcf4\uc720: ",(s.cash||0).toLocaleString(),")"]})]}),L?(0,d.jsxs)("div",{className:"success-section",children:[(0,d.jsxs)("h3",{children:['"',y.snippet.title,'"']}),(0,d.jsx)("p",{children:"\uc74c\uc545 \uc2e0\uccad\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4!"}),m>0&&(0,d.jsxs)("p",{style:{color:"#a5b4fc",fontSize:"0.9rem"},children:[m.toLocaleString()," \uc54c\ucc2c\uc774 \ucc28\uac10\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]}),(0,d.jsxs)("div",{className:"success-actions",children:[(0,d.jsx)("button",{onClick:()=>{z(!1),S(null),f(""),g([])},className:"action-btn continue-btn",children:"\uacc4\uc18d \uc2e0\uccad\ud558\uae30"}),(0,d.jsx)("button",{onClick:()=>D("/learning-board/music-request"),className:"action-btn back-btn",children:"\ub3cc\uc544\uac00\uae30"})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),b.trim()){q(!0),E("");try{const e=await(async e=>{const t=await fetch("https://www.googleapis.com/youtube/v3/search?part=snippet&q=".concat(encodeURIComponent(e),"&type=video&key=").concat("AIzaSyCLoVzkfTOLt7qtESk0_EKrdogn9nqD9Oc","&maxResults=10"));if(!t.ok){const e=await t.json();throw o.vF.error("YouTube API Error:",e),new Error("YouTube \uc601\uc0c1\uc744 \uac80\uc0c9\ud558\ub294 \ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4. API \ud0a4\ub098 \uc694\uccad\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694.")}return(await t.json()).items})(b);g(e),z(!1)}catch(t){E("YouTube \uc601\uc0c1\uc744 \uac80\uc0c9\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4."),o.vF.error(t)}finally{q(!1)}}},className:"search-form",children:[(0,d.jsx)("input",{type:"text",className:"search-input",value:b,onChange:e=>f(e.target.value),placeholder:"\uc2e0\uccad\ud560 \ub178\ub798 \uc81c\ubaa9\uc774\ub098 \uc544\ud2f0\uc2a4\ud2b8\ub97c \uac80\uc0c9\ud558\uc138\uc694"}),(0,d.jsx)("button",{type:"submit",className:"search-btn",disabled:k,children:k?"\uac80\uc0c9 \uc911...":"\uac80\uc0c9"})]}),A&&(0,d.jsx)("p",{style:{color:"#f87171",marginBottom:"1rem"},children:A}),j.length>0&&(0,d.jsx)("div",{className:"search-results",children:(0,d.jsx)("ul",{className:"video-list",children:j.map(e=>(0,d.jsxs)("li",{className:"video-item ".concat((null===y||void 0===y?void 0:y.id.videoId)===e.id.videoId?"selected":""),onClick:()=>S(e),children:[(0,d.jsx)("img",{src:e.snippet.thumbnails.default.url,alt:e.snippet.title,loading:"lazy",width:"120",height:"90"}),(0,d.jsx)("p",{children:e.snippet.title})]},e.id.videoId))})}),y&&(0,d.jsxs)("div",{className:"request-section",children:[(0,d.jsx)("h4",{children:"\uc2e0\uccad \uc815\ubcf4"}),(0,d.jsxs)("p",{children:["\uc120\ud0dd\ub41c \uace1: ",y.snippet.title]}),!t&&(0,d.jsx)("input",{type:"text",className:"requester-name-input",value:w,onChange:e=>N(e.target.value),placeholder:"\uc2e0\uccad\uc790 \uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694"}),(0,d.jsx)("button",{onClick:async()=>{if(!y)return void alert("\uc601\uc0c1\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694.");const n=w.trim();if(n)if(m>0&&!t)alert("\uc720\ub8cc \uc74c\uc545 \uc2e0\uccad\uc740 \ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.");else{C(!0);try{if(m>0&&t&&v){const e=(null===s||void 0===s?void 0:s.cash)||0;if(e<m)return alert("\uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. \ud544\uc694: ".concat(m.toLocaleString(),", \ubcf4\uc720: ").concat(e.toLocaleString())),void C(!1);await(0,r.c4)(c.db,async e=>{const s=(0,r.H9)(c.db,"users",t.uid),a=(0,r.H9)(c.db,"users",v),n=await e.get(s);if(!n.exists())throw new Error("\uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");if((n.data().cash||0)<m)throw new Error("\uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4.");e.update(s,{cash:(0,r.GV)(-m)}),e.update(a,{cash:(0,r.GV)(m)})})}await(0,r.addDoc)((0,r.rJ)(c.db,"musicRooms",e,"playlist"),(0,a.A)((0,a.A)({videoId:y.id.videoId,title:y.snippet.title,requesterName:n,requestedAt:(0,r.O5)()},t?{requesterId:t.uid}:{}),{},{paidAmount:m||0})),z(!0)}catch(i){"\uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4."===i.message?alert("\uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4."):(E("\uc74c\uc545\uc744 \uc2e0\uccad\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4."),o.vF.error(i))}finally{C(!1)}}else alert("\uc2e0\uccad\uc790 \uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.")},className:"request-btn",disabled:I,children:I?"\uc2e0\uccad \uc911...":m>0?"".concat(m.toLocaleString()," \uc54c\ucc2c\uc73c\ub85c \uc2e0\uccad\ud558\uae30"):"\uc774 \uace1\uc73c\ub85c \uc2e0\uccad\ud558\uae30"})]})]})]})}}}]);
//# sourceMappingURL=3380.f8a6abae.chunk.js.map