{"version":3,"file":"static/js/559.3377437b.chunk.js","mappings":"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","sources":["pages/banking/StockExchange.js"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useCallback,\n  useMemo,\n  useRef,\n} from \"react\";\nimport \"./StockExchange.css\";\nimport { formatKoreanCurrency } from '../../numberFormatter';\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { db, functions } from \"../../firebase\";\nimport { applyStockTax } from \"../../utils/taxUtils\";\n// ğŸ”¥ ìë™ ìƒì¥/íì§€: Firebase Functionsì—ì„œ ì²˜ë¦¬ (10ë¶„ë§ˆë‹¤)\nimport { httpsCallable } from \"firebase/functions\";\nimport { usePolling, POLLING_INTERVALS } from \"../../hooks/usePolling\";\nimport {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  setDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  orderBy,\n  limit,\n  serverTimestamp,\n  increment,\n  writeBatch,\n  runTransaction,\n  where,\n  collectionGroup,\n} from \"firebase/firestore\";\n\nimport { globalCache, cacheStats } from \"../../services/globalCacheService\";\nimport { logActivity, ACTIVITY_TYPES } from \"../../utils/firestoreHelpers\";\n\n// === ë°°ì¹˜ ë°ì´í„° ë¡œë”© ì‹œìŠ¤í…œ ===\nconst batchDataLoader = {\n  pendingRequests: new Map(),\n\n  // ë°°ì¹˜ë¡œ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë¡œë“œ\n  loadBatchData: async function (classCode, userId, forceRefresh = false) {\n    const batchKey = globalCache.generateKey('BATCH', { classCode, userId });\n\n    if (!forceRefresh) {\n      const cached = globalCache.get(batchKey);\n      if (cached) {\n        console.log('[batchDataLoader] Cache HIT - ìºì‹œëœ ë°ì´í„° ì‚¬ìš©');\n        return cached;\n      }\n    } else {\n      console.log('[batchDataLoader] forceRefresh=true - ìºì‹œ ë¬´ì‹œí•˜ê³  ì„œë²„ì—ì„œ ë¡œë“œ');\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹œ ìºì‹œ ë¬´íš¨í™”\n      globalCache.invalidate(batchKey);\n    }\n\n    // ì´ë¯¸ ê°™ì€ ë°°ì¹˜ ìš”ì²­ì´ ì§„í–‰ ì¤‘ì´ë©´ ëŒ€ê¸°\n    if (this.pendingRequests.has(batchKey)) {\n      return await this.pendingRequests.get(batchKey);\n    }\n\n    const batchPromise = this._executeBatchLoad(classCode, userId);\n    this.pendingRequests.set(batchKey, batchPromise);\n\n    try {\n      const result = await batchPromise;\n      globalCache.set(batchKey, result, 30 * 60 * 1000); // ğŸ”¥ [ìµœì í™”] 30ë¶„ ìºì‹œ - ê±°ë˜ ì‹œ ê°•ì œ ë¬´íš¨í™”ë˜ë¯€ë¡œ ì•ˆì „\n      return result;\n    } finally {\n      this.pendingRequests.delete(batchKey);\n    }\n  },\n\n  _executeBatchLoad: async function (classCode, userId) {\n    const [stocks, portfolio] = await Promise.all([\n      this._loadStocks(classCode),\n      this._loadPortfolio(userId, classCode),\n    ]);\n\n    return {\n      stocks: stocks || [],\n      portfolio: portfolio || [],\n      errors: []\n    };\n  },\n\n  _loadStocks: async function (classCode) {\n    try {\n      // 1) Cloud Function ìš°ì„ : Firestore Rules ìš°íšŒ + ë‹¨ì¼ í˜¸ì¶œ\n      try {\n        const getSnapshotFn = httpsCallable(functions, 'getStocksSnapshot');\n        const result = await getSnapshotFn({});\n        if (result.data && Array.isArray(result.data.stocks) && result.data.stocks.length > 0) {\n          return result.data.stocks;\n        }\n      } catch (fnError) {\n        console.warn('[batchDataLoader] ìŠ¤ëƒ…ìƒ· í•¨ìˆ˜ í˜¸ì¶œ ì‹¤íŒ¨, ë¬¸ì„œ/ì¿¼ë¦¬ í´ë°± ì‹œë„:', fnError);\n      }\n\n      // 2) ìŠ¤ëƒ…ìƒ· ë¬¸ì„œ ì§ì ‘ ì½ê¸° (ê¶Œí•œ í—ˆìš© ì‹œ)\n      try {\n        const cacheRef = doc(db, \"Settings\", \"centralStocksCache\");\n        const cacheDoc = await getDoc(cacheRef);\n        const cacheData = cacheDoc.exists() ? cacheDoc.data() : null;\n\n        if (cacheData && Array.isArray(cacheData.stocks) && cacheData.stocks.length > 0) {\n          return cacheData.stocks;\n        }\n      } catch (snapshotError) {\n        console.warn('[batchDataLoader] ìŠ¤ëƒ…ìƒ· ë¬¸ì„œ ì½ê¸° ì‹¤íŒ¨:', snapshotError);\n      }\n\n      // 3) ìµœì¢… í´ë°±: ì»¬ë ‰ì…˜ ì¿¼ë¦¬\n      const stocksRef = collection(db, \"CentralStocks\");\n      const q = query(stocksRef, where(\"isListed\", \"==\", true));\n      const querySnapshot = await getDocs(q);\n\n      return querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n    } catch (error) {\n      console.error('[batchDataLoader] Stocks load error:', error);\n      return [];\n    }\n  },\n\n  _loadPortfolio: async function (userId, classCode) {\n    try {\n      const portfolioRef = collection(db, \"users\", userId, \"portfolio\");\n      const q = query(portfolioRef, where(\"classCode\", \"==\", classCode));\n      const querySnapshot = await getDocs(q);\n\n      return querySnapshot.docs.map(doc => {\n        const data = doc.data();\n        return {\n          id: doc.id,\n          ...data,\n          // ğŸ”¥ Timestampë¥¼ Dateë¡œ ë³€í™˜í•˜ì—¬ ìºì‹œ í˜¸í™˜ì„± í™•ë³´\n          lastBuyTime: data.lastBuyTime?.toDate ? data.lastBuyTime.toDate() : data.lastBuyTime,\n          delistedAt: data.delistedAt?.toDate ? data.delistedAt.toDate() : data.delistedAt,\n        };\n      });\n    } catch (error) {\n      console.error('[batchDataLoader] Portfolio load error:', error);\n      return [];\n    }\n  },\n\n\n};\n\n// ğŸ”¥ [ìµœì í™”] ì‹¤ì‹œê°„ marketState ê³„ì‚° í•¨ìˆ˜ (ì„œë²„ ë°ì´í„° ì˜ì¡´ì„± ì œê±°)\n// ì£¼ì‹ ì‹¬ë³¼ì„ ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ì—ì„œ ì¥ì¤‘/ì¥ë§ˆê° ìƒíƒœë¥¼ ê³„ì‚°\nconst getRealtimeMarketState = (stock) => {\n  // ì‹¤ì‹œê°„ ì£¼ì‹ì´ ì•„ë‹ˆë©´ null ë°˜í™˜\n  if (!stock?.isRealStock) {\n    return null;\n  }\n\n  // realStockDataì— ì´ë¯¸ ì„œë²„ì—ì„œ ê³„ì‚°ëœ marketStateê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©\n  if (stock.realStockData?.marketState) {\n    return stock.realStockData.marketState;\n  }\n\n  // realStockDataê°€ ì—†ìœ¼ë©´ null ë°˜í™˜\n  return null;\n};\n\n// marketStateë¥¼ í•œê¸€ë¡œ ë³€í™˜\nconst getMarketStateLabel = (stock) => {\n  const state = getRealtimeMarketState(stock);\n  if (!state) return null;\n\n  switch (state) {\n    case 'REGULAR': return 'ì¥ì¤‘';\n    case 'PRE': return 'ì¥ì „';\n    case 'POST': return 'ì¥í›„';\n    default: return 'ì¥ë§ˆê°';\n  }\n};\n\n// === ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ë“¤ ===\nconst TrendingUp = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"22,7 13.5,15.5 8.5,10.5 2,17\" /><polyline points=\"16,7 22,7 22,13\" /></svg>\n);\nconst TrendingDown = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"22,17 13.5,8.5 8.5,13.5 2,7\" /><polyline points=\"16,17 22,17 22,11\" /></svg>\n);\nconst Settings = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><circle cx=\"12\" cy=\"12\" r=\"3\" /><path d=\"M12 1v6m0 6v6m11-7h-6m-6 0H1m17.5-3.5L19 10m-2 2l-2.5 2.5M6.5 6.5L9 9m-2 2l-2.5 2.5\" /></svg>\n);\nconst RefreshCw = ({ size = 16, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"23 4 23 10 17 10\"></polyline><polyline points=\"1 20 1 14 7 14\"></polyline><path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L20.49 10\"></path><path d=\"M20.49 15a9 9 0 0 1-14.85 3.36L3.51 14\"></path></svg>\n);\nconst BarChart3 = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><line x1=\"12\" y1=\"20\" x2=\"12\" y2=\"10\" /><line x1=\"18\" y1=\"20\" x2=\"18\" y2=\"4\" /><line x1=\"6\" y1=\"20\" x2=\"6\" y2=\"16\" /></svg>\n);\nconst ChevronDown = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"6 9 12 15 18 9\" /></svg>\n);\nconst ChevronUp = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><polyline points=\"18 15 12 9 6 15\" /></svg>\n);\nconst Lock = ({ size = 24, color = \"currentColor\" }) => (\n  <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" /><path d=\"M7 11V7a5 5 0 0 1 10 0v4\" /></svg>\n);\n\n// === ìƒìˆ˜ ë° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ ===\nconst PRODUCT_TYPES = {\n  STOCK: \"stock\",\n  ETF: \"etf\",\n  BOND: \"bond\"\n};\n\nconst SECTORS = {\n  TECH: { name: \"ê¸°ìˆ \" },\n  FINANCE: { name: \"ê¸ˆìœµ\" },\n  CONSUMER: { name: \"ì†Œë¹„ì¬\" },\n  HEALTHCARE: { name: \"í—¬ìŠ¤ì¼€ì–´\" },\n  ENERGY: { name: \"ì—ë„ˆì§€\" },\n  INDUSTRIAL: { name: \"ì‚°ì—…\" },\n  MATERIALS: { name: \"ì†Œì¬\" },\n  REALESTATE: { name: \"ë¶€ë™ì‚°\" },\n  UTILITIES: { name: \"ìœ í‹¸ë¦¬í‹°\" },\n  COMMUNICATION: { name: \"í†µì‹ \" },\n  ENTERTAINMENT: { name: \"ì—”í„°í…Œì¸ë¨¼íŠ¸\" },\n  INDEX: { name: \"ì§€ìˆ˜\" },\n  GOVERNMENT: { name: \"êµ­ì±„\" },\n  CORPORATE: { name: \"íšŒì‚¬ì±„\" }\n};\n\nconst HOLDING_LOCK_PERIOD = 60 * 60 * 1000; // 1ì‹œê°„ (60ë¶„)\nconst COMMISSION_RATE = 0.003;\nconst TAX_RATE = 0.22;\nconst BOND_TAX_RATE = 0.154;\n\nconst CACHE_TTL = {\n  BATCH_DATA: 1000 * 60 * 30, // ğŸ”¥ [ìµœì í™”] 30ë¶„ ìºì‹œ - ì‹¤ì‹œê°„ ì£¼ê°€ê°€ 15ë¶„ ì£¼ê¸°ì´ë¯€ë¡œ 2ì‚¬ì´í´ ìºì‹œ\n  STOCKS: 1000 * 60 * 30, // 30ë¶„ (ê°€ê²© ë°˜ì˜ ì£¼ê¸° 2ë°°)\n  PORTFOLIO: 1000 * 60 * 30, // ğŸ”¥ ê±°ë˜ ì‹œ forceRefreshë¡œ ì¦‰ì‹œ ë¬´íš¨í™”í•˜ë¯€ë¡œ ê¸°ë³¸ ì£¼ê¸°ëŠ” 30ë¶„\n  MARKET_STATUS: 1000 * 60 * 120, // 120ë¶„ (ì‹œì¥ ìƒíƒœëŠ” ê±°ì˜ ë³€ê²½ë˜ì§€ ì•ŠìŒ)\n};\n\n// === ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ ===\nconst formatCurrency = (amount) => {\n  if (typeof amount !== \"number\" || isNaN(amount)) return \"0ì›\";\n  return new Intl.NumberFormat(\"ko-KR\").format(Math.round(amount)) + \"ì›\";\n};\n\nconst formatPercent = (percent) => {\n  const num = parseFloat(percent);\n  if (isNaN(num)) return \"0.00%\";\n  return (num >= 0 ? \"+\" : \"\") + num.toFixed(2) + \"%\";\n};\n\nconst calculateStockTax = (profit, productType = PRODUCT_TYPES.STOCK) => {\n  if (profit <= 0) return 0;\n  if (productType === PRODUCT_TYPES.BOND) {\n    return Math.round(profit * BOND_TAX_RATE);\n  }\n  return Math.round(profit * TAX_RATE);\n};\n\n// ë°°ì¹˜ ì²˜ë¦¬ë¥¼ ìœ„í•œ êµ­ê³  ì—…ë°ì´íŠ¸ ìµœì í™”\nconst treasuryUpdateQueue = new Map();\nconst updateNationalTreasury = async (amount, type, classCode) => {\n  if (amount <= 0 || !classCode) return;\n\n  const key = `${classCode}_${type}`;\n  const existing = treasuryUpdateQueue.get(key) || { amount: 0, type, classCode };\n  existing.amount += amount;\n  treasuryUpdateQueue.set(key, existing);\n\n  // ë°°ì¹˜ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì§€ì—°\n  setTimeout(() => processTreasuryQueue(), 1000);\n};\n\nconst processTreasuryQueue = async () => {\n  if (treasuryUpdateQueue.size === 0) return;\n\n  const batch = writeBatch(db);\n  const updates = Array.from(treasuryUpdateQueue.values());\n  treasuryUpdateQueue.clear();\n\n  for (const { amount, type, classCode } of updates) {\n    const treasuryRef = doc(db, \"nationalTreasuries\", classCode);\n    const updateData = {\n      totalAmount: increment(amount),\n      lastUpdated: serverTimestamp(),\n    };\n\n    if (type === 'tax') {\n      updateData.stockTaxRevenue = increment(amount);\n    } else if (type === 'commission') {\n      updateData.stockCommissionRevenue = increment(amount);\n    }\n\n    batch.update(treasuryRef, updateData, { merge: true });\n  }\n\n  try {\n    await batch.commit();\n  } catch (error) {\n    // ì‹¤íŒ¨í•œ ì—…ë°ì´íŠ¸ë“¤ì„ ë‹¤ì‹œ íì— ì¶”ê°€\n    updates.forEach(update => {\n      const key = `${update.classCode}_${update.type}`;\n      treasuryUpdateQueue.set(key, update);\n    });\n  }\n};\n\nconst calculateMarketIndex = (stocks) => {\n  if (!stocks || stocks.length === 0) return 1000;\n  const listedStocks = stocks.filter(s => s && s.isListed && s.productType === PRODUCT_TYPES.STOCK);\n  if (listedStocks.length === 0) return 1000;\n\n  const totalMarketCap = listedStocks.reduce((sum, stock) => {\n    const shares = 1000;\n    return sum + (stock.price * shares);\n  }, 0);\n\n  const baseMarketCap = listedStocks.reduce((sum, stock) => {\n    const shares = 1000;\n    const basePrice = stock.initialPrice || stock.minListingPrice || stock.price;\n    return sum + (basePrice * shares);\n  }, 0);\n\n  if (baseMarketCap === 0) return 1000;\n\n  return Math.round((totalMarketCap / baseMarketCap) * 1000);\n};\n\nconst canSellHolding = (holding) => {\n  if (!holding.lastBuyTime) return true;\n\n  // ğŸ”¥ Date ê°ì²´, Timestamp, ë¬¸ìì—´ ëª¨ë‘ ì²˜ë¦¬\n  let lastBuyTimeMs;\n  if (holding.lastBuyTime instanceof Date) {\n    lastBuyTimeMs = holding.lastBuyTime.getTime();\n  } else if (holding.lastBuyTime?.toDate) {\n    lastBuyTimeMs = holding.lastBuyTime.toDate().getTime();\n  } else if (typeof holding.lastBuyTime === 'number') {\n    lastBuyTimeMs = holding.lastBuyTime;\n  } else if (typeof holding.lastBuyTime === 'string') {\n    lastBuyTimeMs = new Date(holding.lastBuyTime).getTime();\n  } else {\n    return true; // ì•Œ ìˆ˜ ì—†ëŠ” í˜•ì‹ì´ë©´ ë§¤ë„ ê°€ëŠ¥\n  }\n\n  const timeSinceBuy = Date.now() - lastBuyTimeMs;\n  return timeSinceBuy >= HOLDING_LOCK_PERIOD;\n};\n\nconst getRemainingLockTime = (holding) => {\n  if (!holding.lastBuyTime) return 0;\n\n  // ğŸ”¥ Date ê°ì²´, Timestamp, ë¬¸ìì—´ ëª¨ë‘ ì²˜ë¦¬\n  let lastBuyTimeMs;\n  if (holding.lastBuyTime instanceof Date) {\n    lastBuyTimeMs = holding.lastBuyTime.getTime();\n  } else if (holding.lastBuyTime?.toDate) {\n    lastBuyTimeMs = holding.lastBuyTime.toDate().getTime();\n  } else if (typeof holding.lastBuyTime === 'number') {\n    lastBuyTimeMs = holding.lastBuyTime;\n  } else if (typeof holding.lastBuyTime === 'string') {\n    lastBuyTimeMs = new Date(holding.lastBuyTime).getTime();\n  } else {\n    return 0; // ì•Œ ìˆ˜ ì—†ëŠ” í˜•ì‹ì´ë©´ 0 ë°˜í™˜\n  }\n\n  const now = Date.now();\n  const timeSinceBuy = now - lastBuyTimeMs;\n  const remaining = HOLDING_LOCK_PERIOD - timeSinceBuy;\n\n  return Math.max(0, remaining);\n};\n\nconst formatTime = (milliseconds) => {\n  const seconds = Math.floor(milliseconds / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const remainingSeconds = seconds % 60;\n  return `${minutes}ë¶„ ${remainingSeconds}ì´ˆ`;\n};\n\nconst getProductIcon = (productType) => {\n  switch (productType) {\n    case PRODUCT_TYPES.ETF: return \"ğŸ“Š\";\n    case PRODUCT_TYPES.BOND: return \"ğŸ“œ\";\n    default: return \"ğŸ“ˆ\";\n  }\n};\n\nconst getProductBadgeClass = (productType) => {\n  switch (productType) {\n    case PRODUCT_TYPES.ETF: return \"etf\";\n    case PRODUCT_TYPES.BOND: return \"bond\";\n    default: return \"stock\";\n  }\n};\n\n// === ìºì‹œ ë¬´íš¨í™” í•¨ìˆ˜ ===\nconst invalidateCache = (pattern) => {\n  // globalCache.invalidatePattern ë©”ì„œë“œ ì‚¬ìš© (ë” ì•ˆì „í•¨)\n  if (globalCache && typeof globalCache.invalidatePattern === 'function') {\n    globalCache.invalidatePattern(pattern);\n  }\n};\n\n// ğŸ”¥ [ìµœì í™”] localStorage BATCH ìºì‹œ ì¼ê´„ ì‚­ì œ í—¬í¼\nconst clearLocalStorageBatchCache = () => {\n  try {\n    const keysToDelete = [];\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key && key.includes('BATCH')) {\n        keysToDelete.push(key);\n      }\n    }\n    keysToDelete.forEach(key => {\n      localStorage.removeItem(key);\n    });\n    if (keysToDelete.length > 0) {\n      console.log('[ìºì‹œ] localStorage BATCH ìºì‹œ ì‚­ì œ:', keysToDelete.length, 'ê°œ');\n    }\n  } catch (error) {\n    console.warn('[ìºì‹œ] localStorage ì •ë¦¬ ì˜¤ë¥˜:', error);\n  }\n};\n\n// === ê°œë³„ ì‹¤ì œ ì£¼ì‹ ì¶”ê°€ ì»´í¬ë„ŒíŠ¸ ===\nconst RealStockAdder = React.memo(({ onAddStock }) => {\n  const [showForm, setShowForm] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [formData, setFormData] = useState({ name: '', symbol: '', sector: 'TECH', productType: 'stock' });\n\n  const commonStocks = [\n    { name: 'ì‚¼ì„±ì „ì', symbol: '005930.KS', type: 'í•œêµ­ ì£¼ì‹' },\n    { name: 'SKí•˜ì´ë‹‰ìŠ¤', symbol: '000660.KS', type: 'í•œêµ­ ì£¼ì‹' },\n    { name: 'LGì—ë„ˆì§€ì†”ë£¨ì…˜', symbol: '373220.KS', type: 'í•œêµ­ ì£¼ì‹' },\n    { name: 'NAVER', symbol: '035420.KS', type: 'í•œêµ­ ì£¼ì‹' },\n    { name: 'ì¹´ì¹´ì˜¤', symbol: '035720.KS', type: 'í•œêµ­ ì£¼ì‹' },\n    { name: 'í˜„ëŒ€ì°¨', symbol: '005380.KS', type: 'í•œêµ­ ì£¼ì‹' },\n    { name: 'Apple', symbol: 'AAPL', type: 'ë¯¸êµ­ ì£¼ì‹' },\n    { name: 'Microsoft', symbol: 'MSFT', type: 'ë¯¸êµ­ ì£¼ì‹' },\n    { name: 'Google', symbol: 'GOOGL', type: 'ë¯¸êµ­ ì£¼ì‹' },\n    { name: 'Tesla', symbol: 'TSLA', type: 'ë¯¸êµ­ ì£¼ì‹' },\n    { name: 'NVIDIA', symbol: 'NVDA', type: 'ë¯¸êµ­ ì£¼ì‹' },\n    { name: 'Amazon', symbol: 'AMZN', type: 'ë¯¸êµ­ ì£¼ì‹' },\n    { name: 'KODEX 200', symbol: '069500.KS', type: 'í•œêµ­ ETF' },\n    { name: 'KODEX ë ˆë²„ë¦¬ì§€', symbol: '122630.KS', type: 'í•œêµ­ ETF' },\n    { name: 'TIGER ë¯¸êµ­S&P500', symbol: '360750.KS', type: 'í•œêµ­ ETF' },\n    { name: 'SPY', symbol: 'SPY', type: 'ë¯¸êµ­ ETF (S&P500)' },\n    { name: 'QQQ', symbol: 'QQQ', type: 'ë¯¸êµ­ ETF (ë‚˜ìŠ¤ë‹¥100)' },\n    { name: 'TLT', symbol: 'TLT', type: 'ì±„ê¶Œ ETF (ë¯¸êµ­ ì¥ê¸°êµ­ì±„)' },\n    { name: 'GLD', symbol: 'GLD', type: 'ì›ìì¬ ETF (ê¸ˆ)' },\n  ];\n\n  const handleQuickAdd = async (stock) => {\n    if (isAdding) return;\n    setIsAdding(true);\n    try {\n      await onAddStock({ name: stock.name, symbol: stock.symbol });\n      alert(`${stock.name} ì¶”ê°€ ì™„ë£Œ!`);\n    } catch (error) {\n      alert('ì¶”ê°€ ì‹¤íŒ¨: ' + error.message);\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  const handleCustomAdd = async () => {\n    if (!formData.name || !formData.symbol) {\n      alert('ì´ë¦„ê³¼ ì‹¬ë³¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');\n      return;\n    }\n    if (isAdding) return;\n    setIsAdding(true);\n    try {\n      await onAddStock(formData);\n      alert(`${formData.name} ì¶”ê°€ ì™„ë£Œ!`);\n      setFormData({ name: '', symbol: '', sector: 'TECH', productType: 'stock' });\n      setShowForm(false);\n    } catch (error) {\n      alert('ì¶”ê°€ ì‹¤íŒ¨: ' + error.message);\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: '10px' }}>\n      <button onClick={() => setShowForm(!showForm)} className=\"btn btn-secondary\" style={{ width: '100%', marginBottom: '10px' }}>\n        {showForm ? 'ì ‘ê¸°' : 'â• ê°œë³„ ì£¼ì‹/ETF ì¶”ê°€'}\n      </button>\n      {showForm && (\n        <div style={{ background: 'rgba(20, 20, 35, 0.8)', padding: '12px', borderRadius: '8px', border: '1px solid rgba(255, 255, 255, 0.1)' }}>\n          <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '10px' }}>\n            ğŸ“Œ ë¹ ë¥¸ ì¶”ê°€ (í´ë¦­í•˜ë©´ ë°”ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤)\n          </p>\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', marginBottom: '15px' }}>\n            {commonStocks.map(stock => (\n              <button\n                key={stock.symbol}\n                onClick={() => handleQuickAdd(stock)}\n                disabled={isAdding}\n                style={{\n                  padding: '4px 8px',\n                  fontSize: '0.75rem',\n                  background: stock.type.includes('ETF') ? 'rgba(59, 130, 246, 0.2)' : stock.type.includes('ì±„ê¶Œ') ? 'rgba(245, 158, 11, 0.2)' : stock.type.includes('ì›ìì¬') ? 'rgba(236, 72, 153, 0.2)' : 'rgba(16, 185, 129, 0.2)',\n                  border: stock.type.includes('ETF') ? '1px solid rgba(59, 130, 246, 0.3)' : stock.type.includes('ì±„ê¶Œ') ? '1px solid rgba(245, 158, 11, 0.3)' : stock.type.includes('ì›ìì¬') ? '1px solid rgba(236, 72, 153, 0.3)' : '1px solid rgba(16, 185, 129, 0.3)',\n                  color: 'white',\n                  borderRadius: '4px',\n                  cursor: 'pointer',\n                  whiteSpace: 'nowrap'\n                }}\n                title={`${stock.type} - ${stock.symbol}`}\n              >\n                {stock.name}\n              </button>\n            ))}\n          </div>\n          <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '8px' }}>\n            âœï¸ ì§ì ‘ ì…ë ¥ (Yahoo Finance ì‹¬ë³¼ ì‚¬ìš©)\n          </p>\n          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>\n            <input\n              type=\"text\"\n              placeholder=\"ì´ë¦„ (ì˜ˆ: ì‚¼ì„±ì „ì)\"\n              value={formData.name}\n              onChange={e => setFormData(p => ({ ...p, name: e.target.value }))}\n              style={{ flex: 1, minWidth: '120px', padding: '8px', borderRadius: '4px', border: '1px solid rgba(255, 255, 255, 0.2)', background: 'rgba(0,0,0,0.3)', color: 'white' }}\n            />\n            <input\n              type=\"text\"\n              placeholder=\"ì‹¬ë³¼ (ì˜ˆ: 005930.KS)\"\n              value={formData.symbol}\n              onChange={e => setFormData(p => ({ ...p, symbol: e.target.value }))}\n              style={{ flex: 1, minWidth: '120px', padding: '8px', borderRadius: '4px', border: '1px solid rgba(255, 255, 255, 0.2)', background: 'rgba(0,0,0,0.3)', color: 'white' }}\n            />\n            <button onClick={handleCustomAdd} disabled={isAdding} className=\"btn btn-success\" style={{ padding: '8px 16px' }}>\n              {isAdding ? 'ì¶”ê°€ ì¤‘...' : 'ì¶”ê°€'}\n            </button>\n          </div>\n          <p style={{ fontSize: '0.75rem', color: '#9ca3af', marginTop: '8px' }}>\n            ğŸ’¡ í•œêµ­ ì£¼ì‹: ì¢…ëª©ì½”ë“œ.KS (ì˜ˆ: 005930.KS) | ë¯¸êµ­ ì£¼ì‹: í‹°ì»¤ (ì˜ˆ: AAPL, TSLA)\n          </p>\n        </div>\n      )}\n    </div>\n  );\n});\n\n// === ê´€ë¦¬ì íŒ¨ë„ ì»´í¬ë„ŒíŠ¸ ===\nconst AdminPanel = React.memo(({ stocks, classCode, onClose, onAddStock, onDeleteStock, onEditStock, onToggleManualStock, cacheStats, onManualUpdate, onCreateRealStocks, onUpdateRealStocks, onAddSingleRealStock, onDeleteSimulationStocks }) => {\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [isCreatingRealStocks, setIsCreatingRealStocks] = useState(false);\n  const [isUpdatingRealStocks, setIsUpdatingRealStocks] = useState(false);\n  const [isDeletingSimulation, setIsDeletingSimulation] = useState(false);\n  const [newStock, setNewStock] = useState({\n    name: \"\",\n    price: \"\",\n    minListingPrice: \"\",\n    isManual: false,\n    sector: \"TECH\",\n    productType: PRODUCT_TYPES.STOCK,\n    maturityYears: \"\",\n    couponRate: \"\"\n  });\n\n  const handleManualUpdate = async () => {\n    if (isUpdating) return;\n    setIsUpdating(true);\n    try {\n      await onManualUpdate();\n      alert(\"ì£¼ì‹ ê°€ê²© ì—…ë°ì´íŠ¸ ì™„ë£Œ!\");\n    } catch (error) {\n      alert(\"ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: \" + error.message);\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleCreateRealStocks = async () => {\n    if (!window.confirm(\"ì‹¤ì œ ì£¼ì‹ ë°ì´í„°(ì‚¼ì„±ì „ì, ì• í”Œ ë“±)ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n(Yahoo Financeì—ì„œ ì‹¤ì‹œê°„ ê°€ê²©ì„ ê°€ì ¸ì˜µë‹ˆë‹¤)\")) {\n      return;\n    }\n    if (isCreatingRealStocks) return;\n    setIsCreatingRealStocks(true);\n    try {\n      await onCreateRealStocks();\n      alert(\"ì‹¤ì œ ì£¼ì‹ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! 15ë¶„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ê°€ê²©ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.\");\n    } catch (error) {\n      alert(\"ì‹¤ì œ ì£¼ì‹ ìƒì„± ì‹¤íŒ¨: \" + error.message);\n    } finally {\n      setIsCreatingRealStocks(false);\n    }\n  };\n\n  const handleUpdateRealStocks = async () => {\n    if (isUpdatingRealStocks) return;\n    setIsUpdatingRealStocks(true);\n    try {\n      await onUpdateRealStocks();\n      alert(\"ì‹¤ì œ ì£¼ì‹ ê°€ê²©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!\");\n    } catch (error) {\n      alert(\"ì‹¤ì œ ì£¼ì‹ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: \" + error.message);\n    } finally {\n      setIsUpdatingRealStocks(false);\n    }\n  };\n\n  const handleDeleteSimulationStocks = async () => {\n    if (!window.confirm(\"âš ï¸ ëª¨ë“  ì‹œë®¬ë ˆì´ì…˜ ì£¼ì‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\\n(ì‹¤ì œ ì£¼ì‹ì€ ìœ ì§€ë©ë‹ˆë‹¤)\")) {\n      return;\n    }\n    if (isDeletingSimulation) return;\n    setIsDeletingSimulation(true);\n    try {\n      await onDeleteSimulationStocks();\n      alert(\"ì‹œë®¬ë ˆì´ì…˜ ì£¼ì‹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!\");\n    } catch (error) {\n      alert(\"ì‚­ì œ ì‹¤íŒ¨: \" + error.message);\n    } finally {\n      setIsDeletingSimulation(false);\n    }\n  };\n\n  const handleAddStock = async () => {\n    if (!newStock.name || !newStock.price || !newStock.minListingPrice) return alert(\"ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\n    const price = parseFloat(newStock.price);\n    const minPrice = parseFloat(newStock.minListingPrice);\n    if (price <= 0 || minPrice <= 0) return alert(\"ê°€ê²©ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.\");\n\n    const stockData = {\n      name: newStock.name,\n      price,\n      minListingPrice: minPrice,\n      isListed: true,\n      isManual: newStock.isManual,\n      sector: newStock.sector,\n      productType: newStock.productType,\n      buyVolume: 0,\n      sellVolume: 0,\n      recentBuyVolume: 0,\n      recentSellVolume: 0,\n      volatility: newStock.productType === PRODUCT_TYPES.BOND ? 0.005 : 0.02\n    };\n\n    if (newStock.productType === PRODUCT_TYPES.BOND) {\n      stockData.maturityYears = parseFloat(newStock.maturityYears) || 10;\n      stockData.couponRate = parseFloat(newStock.couponRate) || 3.5;\n      stockData.sector = \"GOVERNMENT\";\n    }\n\n    if (newStock.productType === PRODUCT_TYPES.ETF) {\n      stockData.sector = \"INDEX\";\n    }\n\n    await onAddStock(stockData);\n    setNewStock({ name: \"\", price: \"\", minListingPrice: \"\", isManual: false, sector: \"TECH\", productType: PRODUCT_TYPES.STOCK, maturityYears: \"\", couponRate: \"\" });\n    setShowAddForm(false);\n  };\n\n  return (\n    <div className=\"admin-panel-fullscreen\">\n      <div className=\"admin-header\">\n        <h2><Settings size={24} /> ê´€ë¦¬ì íŒ¨ë„ ({classCode})</h2>\n        <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n          <div style={{ fontSize: '0.85rem', color: '#666' }}>\n            ìºì‹œ í†µê³„: ì ì¤‘ {cacheStats.hits}, ëˆ„ë½ {cacheStats.misses}, ì ˆì•½ {cacheStats.savings}íšŒ\n          </div>\n          <button onClick={onClose} className=\"btn btn-danger\">ë‹«ê¸°</button>\n        </div>\n      </div>\n      <div className=\"admin-content\">\n        <div className=\"admin-section\">\n          <h3>ğŸ“Š ì‹¤ì œ ì£¼ì‹ ê´€ë¦¬ (Yahoo Finance)</h3>\n          <div style={{ marginBottom: '20px', padding: '15px', background: 'rgba(16, 185, 129, 0.1)', borderRadius: '8px', border: '1px solid rgba(16, 185, 129, 0.3)' }}>\n            <p style={{ marginBottom: '10px', color: '#34d399', fontSize: '0.9rem' }}>\n              ğŸŒ ì‹¤ì œ ì£¼ì‹ ë°ì´í„°ë¥¼ Yahoo Financeì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.<br />\n              ğŸ“ˆ ì‚¼ì„±ì „ì, SKí•˜ì´ë‹‰ìŠ¤, ì• í”Œ, í…ŒìŠ¬ë¼, ETF, ì±„ê¶Œ ETF ë“± ì§€ì›<br />\n              â° 15ë¶„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ê°€ê²©ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. | ğŸ’± í™˜ìœ¨: í•˜ë£¨ 1íšŒ ìë™ ì—…ë°ì´íŠ¸\n            </p>\n            <div style={{ display: 'flex', gap: '10px', marginBottom: '10px' }}>\n              <button\n                onClick={handleCreateRealStocks}\n                disabled={isCreatingRealStocks}\n                className=\"btn btn-success\"\n                style={{ flex: 1, padding: '12px', fontSize: '0.9rem', fontWeight: 'bold' }}\n              >\n                {isCreatingRealStocks ? 'â³ ìƒì„± ì¤‘...' : 'ğŸ¢ ê¸°ë³¸ ì£¼ì‹ ìƒì„±'}\n              </button>\n              <button\n                onClick={handleUpdateRealStocks}\n                disabled={isUpdatingRealStocks}\n                className=\"btn btn-primary\"\n                style={{ flex: 1, padding: '12px', fontSize: '0.9rem', fontWeight: 'bold' }}\n              >\n                {isUpdatingRealStocks ? 'â³ ì—…ë°ì´íŠ¸ ì¤‘...' : 'ğŸ”„ ê°€ê²© ì¦‰ì‹œ ì—…ë°ì´íŠ¸'}\n              </button>\n            </div>\n            <RealStockAdder onAddStock={onAddSingleRealStock} />\n            <div style={{ marginTop: '10px', paddingTop: '10px', borderTop: '1px solid rgba(255,255,255,0.1)' }}>\n              <button\n                onClick={handleDeleteSimulationStocks}\n                disabled={isDeletingSimulation}\n                className=\"btn btn-danger\"\n                style={{ width: '100%', padding: '10px', fontSize: '0.85rem' }}\n              >\n                {isDeletingSimulation ? 'â³ ì‚­ì œ ì¤‘...' : 'ğŸ—‘ï¸ ì‹œë®¬ë ˆì´ì…˜ ì£¼ì‹ ì „ì²´ ì‚­ì œ'}\n              </button>\n              <p style={{ fontSize: '0.75rem', color: '#9ca3af', marginTop: '5px', textAlign: 'center' }}>\n                âš ï¸ ì‹¤ì œ ì£¼ì‹(ì‹¤ì‹œê°„)ë§Œ ë‚¨ê¸°ê³  ê°€ìƒ ì£¼ì‹ì„ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤\n              </p>\n            </div>\n          </div>\n        </div>\n        <div className=\"admin-section\">\n          <h3><BarChart3 size={20} /> ìƒí’ˆ ëª©ë¡ ê´€ë¦¬</h3>\n          <div className=\"admin-stock-list\">\n            {stocks.map(stock => (\n              <div key={stock.id} className=\"admin-stock-item\">\n                <div className=\"admin-stock-info\">\n                  <span className=\"stock-name\">\n                    {getProductIcon(stock.productType)} {stock.name}\n                    {stock.isRealStock && <span style={{ marginLeft: '6px', background: '#10b981', color: 'white', fontSize: '0.65rem', padding: '1px 4px', borderRadius: '3px', fontWeight: 'bold' }}>ì‹¤ì‹œê°„</span>}\n                  </span>\n                  <span className=\"stock-details\">\n                    {formatCurrency(stock.price)} | {SECTORS[stock.sector]?.name || 'ê¸°íƒ€'} | {stock.isListed ? 'ìƒì¥' : 'ìƒì¥íì§€'} | {stock.isManual ? 'ìˆ˜ë™' : stock.isRealStock ? 'ì‹¤ì‹œê°„' : 'ìë™'}\n                    {stock.productType === PRODUCT_TYPES.BOND && ` | ë§Œê¸°: ${stock.maturityYears}ë…„ | ì´ììœ¨: ${stock.couponRate}%`}\n                  </span>\n                </div>\n                <div className=\"form-actions\">\n                  <button onClick={() => onEditStock(stock.id)} className=\"btn btn-primary\">ê°€ê²© ìˆ˜ì •</button>\n                  <button onClick={() => onToggleManualStock(stock.id, stock.isListed)} className={`btn ${stock.isListed ? 'btn-secondary' : 'btn-success'}`}>{stock.isListed ? 'ìƒì¥íì§€' : 'ì¬ìƒì¥'}</button>\n                  <button onClick={() => onDeleteStock(stock.id, stock.name)} className=\"btn btn-danger\">ì‚­ì œ</button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div className=\"admin-section\">\n          <h3>ìƒˆ ìƒí’ˆ ì¶”ê°€</h3>\n          <button onClick={() => setShowAddForm(!showAddForm)} className=\"btn btn-primary\">{showAddForm ? 'ì·¨ì†Œ' : 'ìƒˆ ìƒí’ˆ ì¶”ê°€ ì–‘ì‹ ì—´ê¸°'}</button>\n          {showAddForm && (\n            <div className=\"add-stock-form\">\n              <div className=\"form-grid\">\n                <div className=\"form-group\">\n                  <label className=\"form-label\">ìƒí’ˆ ìœ í˜•</label>\n                  <select value={newStock.productType} onChange={e => setNewStock(p => ({ ...p, productType: e.target.value }))} className=\"form-input\">\n                    <option value={PRODUCT_TYPES.STOCK}>ì£¼ì‹</option>\n                    <option value={PRODUCT_TYPES.ETF}>ETF/ì§€ìˆ˜</option>\n                    <option value={PRODUCT_TYPES.BOND}>ì±„ê¶Œ</option>\n                  </select>\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">ìƒí’ˆëª…</label>\n                  <input type=\"text\" value={newStock.name} onChange={e => setNewStock(p => ({ ...p, name: e.target.value }))} className=\"form-input\"\n                    placeholder={newStock.productType === PRODUCT_TYPES.BOND ? \"ì˜ˆ: êµ­ê³ ì±„ 10ë…„\" : newStock.productType === PRODUCT_TYPES.ETF ? \"ì˜ˆ: KOSPI 200\" : \"ì˜ˆ: ì‚¼ì„±ì „ì\"} />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">ì´ˆê¸° ê°€ê²©</label>\n                  <input type=\"number\" value={newStock.price} onChange={e => setNewStock(p => ({ ...p, price: e.target.value }))} className=\"form-input\" />\n                </div>\n                <div className=\"form-group\">\n                  <label className=\"form-label\">ìµœì†Œ ìƒì¥ê°€</label>\n                  <input type=\"number\" value={newStock.minListingPrice} onChange={e => setNewStock(p => ({ ...p, minListingPrice: e.target.value }))} className=\"form-input\" />\n                </div>\n                {newStock.productType === PRODUCT_TYPES.STOCK && (\n                  <div className=\"form-group\">\n                    <label className=\"form-label\">ì„¹í„°</label>\n                    <select value={newStock.sector} onChange={e => setNewStock(p => ({ ...p, sector: e.target.value }))} className=\"form-input\">\n                      {Object.entries(SECTORS).filter(([key]) => !['INDEX', 'GOVERNMENT', 'CORPORATE'].includes(key)).map(([key, value]) => (\n                        <option key={key} value={key}>{value.name}</option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n                {newStock.productType === PRODUCT_TYPES.BOND && (\n                  <>\n                    <div className=\"form-group\">\n                      <label className=\"form-label\">ë§Œê¸° (ë…„)</label>\n                      <input type=\"number\" value={newStock.maturityYears} onChange={e => setNewStock(p => ({ ...p, maturityYears: e.target.value }))} className=\"form-input\" placeholder=\"ì˜ˆ: 10\" />\n                    </div>\n                    <div className=\"form-group\">\n                      <label className=\"form-label\">í‘œë©´ì´ììœ¨ (%)</label>\n                      <input type=\"number\" step=\"0.1\" value={newStock.couponRate} onChange={e => setNewStock(p => ({ ...p, couponRate: e.target.value }))} className=\"form-input\" placeholder=\"ì˜ˆ: 3.5\" />\n                    </div>\n                  </>\n                )}\n                <div className=\"form-group checkbox-group\">\n                  <input type=\"checkbox\" checked={newStock.isManual} onChange={e => setNewStock(p => ({ ...p, isManual: e.target.checked }))} id=\"isManualCheckbox\" className=\"checkbox-input\" />\n                  <label htmlFor=\"isManualCheckbox\">ìˆ˜ë™ ê´€ë¦¬ (ìë™ ê°€ê²© ë³€ë™ ì œì™¸)</label>\n                </div>\n              </div>\n              <div className=\"form-actions\">\n                <button onClick={handleAddStock} className=\"btn btn-success\">ìƒí’ˆ ì¶”ê°€</button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n});\n\n// === ë©”ì¸ ì»´í¬ë„ŒíŠ¸ ===\nconst StockExchange = () => {\n  const { user, userDoc, isAdmin, loading: authLoading, firebaseReady, functions, optimisticUpdate, refreshUserDocument } = useAuth();\n\n  const [classCode, setClassCode] = useState(null);\n  const [stocks, setStocks] = useState([]);\n  const [portfolio, setPortfolio] = useState([]);\n  const [showAdminPanel, setShowAdminPanel] = useState(false);\n  const [buyQuantities, setBuyQuantities] = useState({});\n  const [sellQuantities, setSellQuantities] = useState({});\n  const [isTrading, setIsTrading] = useState(false);\n  const [lockTimers, setLockTimers] = useState({});\n  const [activeTab, setActiveTab] = useState(\"stocks\");\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [isFetching, setIsFetching] = useState(false);\n  const [marketOpen, setMarketOpen] = useState(false);\n\n  // ğŸ”¥ ë°©í•™ ëª¨ë“œ ìƒíƒœ (ìŠˆí¼ê´€ë¦¬ì ì „ìš©)\n  const [vacationMode, setVacationMode] = useState(false);\n  const [vacationLoading, setVacationLoading] = useState(false);\n\n  // ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ìƒíƒœ ì¶”ê°€\n  const [cacheStatus, setCacheStatus] = useState({ hits: 0, misses: 0, savings: 0 });\n  const [lastBatchLoad, setLastBatchLoad] = useState(null);\n\n  const lastFetchTimeRef = useRef({\n    stocks: 0,\n    portfolio: 0,\n    marketStatus: 0,\n    batchLoad: 0\n  });\n\n  // ğŸ”¥ fetching ìƒíƒœë¥¼ refë¡œ ê´€ë¦¬ (ë¬´í•œ ë£¨í”„ ë°©ì§€)\n  const isFetchingRef = useRef(false);\n\n  // ì‹œì¥ ê°œì¥ ìƒíƒœë¥¼ 1ë¶„ë§ˆë‹¤ í™•ì¸í•˜ì—¬ marketOpen ìƒíƒœë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ (ìë™ í´ë§ ì‹œì‘ ë²„ê·¸ ìˆ˜ì •)\n  useEffect(() => {\n    const checkMarketStatus = () => {\n      const now = new Date();\n\n      // í•œêµ­ ì‹œì¥ ì‹œê°„ ì²´í¬ (09:00 ~ 15:30 KST)\n      const koreaTime = new Date(now.toLocaleString(\"en-US\", { timeZone: \"Asia/Seoul\" }));\n      const kstDay = koreaTime.getDay();\n      const kstHour = koreaTime.getHours();\n      const kstMinute = koreaTime.getMinutes();\n      const kstTotalMinutes = kstHour * 60 + kstMinute;\n      const isKoreaWeekday = kstDay >= 1 && kstDay <= 5;\n      const isKoreaMarketOpen = isKoreaWeekday && kstTotalMinutes >= 9 * 60 && kstTotalMinutes < 15 * 60 + 30;\n\n      // ë¯¸êµ­ ì‹œì¥ ì‹œê°„ ì²´í¬ (09:30 ~ 16:00 EST/EDT)\n      const usTime = new Date(now.toLocaleString(\"en-US\", { timeZone: \"America/New_York\" }));\n      const usDay = usTime.getDay();\n      const usHour = usTime.getHours();\n      const usMinute = usTime.getMinutes();\n      const usTotalMinutes = usHour * 60 + usMinute;\n      const isUsWeekday = usDay >= 1 && usDay <= 5;\n      const isUsMarketOpen = isUsWeekday && usTotalMinutes >= 9 * 60 + 30 && usTotalMinutes < 16 * 60;\n\n      // í•œêµ­ ë˜ëŠ” ë¯¸êµ­ ì‹œì¥ ì¤‘ í•˜ë‚˜ë¼ë„ ì—´ë ¤ìˆìœ¼ë©´ true\n      setMarketOpen(isKoreaMarketOpen || isUsMarketOpen);\n    };\n\n    checkMarketStatus(); // ì´ˆê¸° ë¡œë“œ ì‹œ ì¦‰ì‹œ í™•ì¸\n    const interval = setInterval(checkMarketStatus, 60000); // 1ë¶„ë§ˆë‹¤ í™•ì¸\n\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    if (userDoc?.classCode) {\n      setClassCode(userDoc.classCode);\n    }\n  }, [userDoc]);\n\n  // ğŸ”¥ ë§¤ë„ ì œí•œ íƒ€ì´ë¨¸: 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ (portfolioë¥¼ refë¡œ ì°¸ì¡°)\n  const portfolioRef = useRef(portfolio);\n\n  useEffect(() => {\n    portfolioRef.current = portfolio;\n  }, [portfolio]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setLockTimers(prevTimers => {\n        const newTimers = {};\n        portfolioRef.current.forEach(holding => {\n          const remaining = getRemainingLockTime(holding);\n          if (remaining > 0) {\n            newTimers[holding.id] = remaining;\n          }\n        });\n        return newTimers;\n      });\n\n      // ìºì‹œ í†µê³„ ì—…ë°ì´íŠ¸\n      setCacheStatus({\n        hits: cacheStats.hits,\n        misses: cacheStats.misses,\n        savings: cacheStats.savings\n      });\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []); // ë¹ˆ ì˜ì¡´ì„± ë°°ì—´ - portfolioRefë¥¼ í†µí•´ ìµœì‹  portfolio ì°¸ì¡°\n\n  // ğŸ”¥ portfolioê°€ ë³€ê²½ë˜ë©´ ì¦‰ì‹œ íƒ€ì´ë¨¸ ì¬ê³„ì‚°\n  useEffect(() => {\n    const newTimers = {};\n    portfolio.forEach(holding => {\n      const remaining = getRemainingLockTime(holding);\n      if (remaining > 0) {\n        newTimers[holding.id] = remaining;\n      }\n    });\n    setLockTimers(newTimers);\n  }, [portfolio]);\n\n  // === ìµœì í™”ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ (ë°°ì¹˜ ì²˜ë¦¬ ì‚¬ìš©) ===\n  const fetchAllData = useCallback(async (forceRefresh = false) => { // forceRefresh ê¸°ë³¸ê°’ì„ falseë¡œ ë˜ëŒë ¤ ìºì‹œ í™œì„±í™”\n    if (!user) return;\n    if (!classCode) return; // classCodeê°€ ì—†ìœ¼ë©´ ë°ì´í„° ë¡œë“œí•˜ì§€ ì•ŠìŒ\n\n    if (isFetchingRef.current && !forceRefresh) {\n      console.log('[StockExchange] ì´ë¯¸ fetching ì¤‘ì´ë¯€ë¡œ ëŒ€ê¸°');\n      return;\n    }\n\n    const now = Date.now();\n\n    // usePollingì´ ê°„ê²©ì„ ì œì–´í•˜ë¯€ë¡œ, ì‹œê°„ ê¸°ë°˜ ìºì‹œ ì²´í¬ ë¡œì§ì€ ì œê±°í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆì§€ë§Œ,\n    // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ë™ì‘í•´ì•¼ í•˜ë¯€ë¡œ ìœ ì§€.\n    const timeSinceLastBatch = now - lastFetchTimeRef.current.batchLoad;\n    if (!forceRefresh && timeSinceLastBatch <= CACHE_TTL.BATCH_DATA) {\n      return;\n    }\n\n    isFetchingRef.current = true;\n    setIsFetching(true);\n\n    try {\n      // usePollingì—ì„œ í˜¸ì¶œ ì‹œ í•­ìƒ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ forceRefreshë¥¼ trueë¡œ ì „ë‹¬\n      const batchResult = await batchDataLoader.loadBatchData(classCode, user.uid, forceRefresh);\n\n      if (batchResult.errors && batchResult.errors.length > 0) {\n        console.warn('[StockExchange] ë°°ì¹˜ ë¡œë“œ ì¤‘ ì¼ë¶€ ì˜¤ë¥˜ ë°œìƒ:', batchResult.errors);\n      }\n\n      setStocks(batchResult.stocks || []);\n      setPortfolio(batchResult.portfolio || []);\n\n      lastFetchTimeRef.current.batchLoad = now;\n      lastFetchTimeRef.current.stocks = now;\n      lastFetchTimeRef.current.portfolio = now;\n      lastFetchTimeRef.current.marketStatus = now;\n\n      setLastBatchLoad(new Date());\n      setLastUpdated(new Date());\n\n    } catch (error) {\n      console.error('[StockExchange] ë°°ì¹˜ ë¡œë“œ ì‹¤íŒ¨:', error);\n      // Polling ì¤‘ì—ëŠ” alertì„ ë„ìš°ì§€ ì•ŠëŠ” ê²ƒì´ ì‚¬ìš©ì ê²½í—˜ì— ì¢‹ìŒ\n      // alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      isFetchingRef.current = false;\n      setIsFetching(false);\n    }\n  }, [classCode, user, isAdmin]);\n\n  // === ë°ì´í„° ìë™ ê°±ì‹  (Polling) ===\n  // ğŸ”¥ [ìµœì í™”] í´ë§ ê°„ê²©ì„ 60ë¶„ìœ¼ë¡œ ì™„í™” - ê±°ë˜ ì‹œ forceRefreshë¡œ ì¦‰ì‹œ ê°±ì‹ ë˜ë¯€ë¡œ ìë™ ê°±ì‹ ì€ ìµœì†Œí™”\n  usePolling(fetchAllData, {\n    interval: 60 * 60 * 1000, // ğŸ”¥ [ìµœì í™”] 60ë¶„ë§ˆë‹¤ í¬íŠ¸í´ë¦¬ì˜¤ ê°±ì‹  (Firestore ì½ê¸° ìµœì†Œí™”)\n    enabled: firebaseReady && !!user && !!classCode,\n    deps: [user, classCode, isAdmin]\n  });\n\n  // ğŸ”¥ [ìµœì í™”] onSnapshot ë¦¬ìŠ¤ë„ˆ ì œê±° - ì½ê¸° ë¹„ìš© ì ˆê°\n  // ëŒ€ì‹  10ë¶„ë§ˆë‹¤ fetchAllDataê°€ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´\n  // ì‚¬ìš©ìê°€ í•„ìš”ì‹œ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ê°€ëŠ¥\n\n  // ğŸ”¥ FCM í‘¸ì‹œ ì•Œë¦¼ ì œê±°ë¨ (ì´ìœ : ì•Œë¦¼ ìŠ¤íŒ¸, ì½ê¸° ì¦ê°€, ì‚¬ìš©ì ê²½í—˜ ì•…í™”)\n  // ëŒ€ì‹  30ë¶„ ìºì‹œ + ì‹œê°„ë‹¹ 1íšŒ ìë™ í´ë§ìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ ì—…ë°ì´íŠ¸ ì œê³µ\n\n  // === ìë™ ìƒì¥/íì§€ ê´€ë¦¬ëŠ” Firebase Functionsì—ì„œ ì²˜ë¦¬ ===\n  // 10ë¶„ë§ˆë‹¤ ì„œë²„ì—ì„œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë¨ (autoManageStocks í•¨ìˆ˜)\n  // í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ë³„ë„ ìŠ¤ì¼€ì¤„ëŸ¬ ë¶ˆí•„ìš”\n\n  // === ì‹œì¥ ì§€ìˆ˜ ê³„ì‚° ===\n  // ì‹œì¥ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜ ë¹„í™œì„±í™”\n\n  // ğŸ”¥ ë°©í•™ ëª¨ë“œ ìƒíƒœ ì¡°íšŒ (ìŠˆí¼ê´€ë¦¬ì ì „ìš©)\n  const fetchVacationMode = useCallback(async () => {\n    if (!userDoc?.isSuperAdmin) return;\n    try {\n      const getVacationModeStatusFn = httpsCallable(functions, 'getVacationModeStatus');\n      const result = await getVacationModeStatusFn({});\n      setVacationMode(result.data.vacationMode);\n    } catch (error) {\n      console.error('[fetchVacationMode] ì¡°íšŒ ì‹¤íŒ¨:', error);\n    }\n  }, [functions, userDoc?.isSuperAdmin]);\n\n  // ğŸ”¥ ë°©í•™ ëª¨ë“œ ì´ˆê¸° ë¡œë“œ\n  useEffect(() => {\n    if (userDoc?.isSuperAdmin && functions) {\n      fetchVacationMode();\n    }\n  }, [userDoc?.isSuperAdmin, functions, fetchVacationMode]);\n\n  // ğŸ”¥ ë°©í•™ ëª¨ë“œ í† ê¸€ (ìŠˆí¼ê´€ë¦¬ì ì „ìš©)\n  const toggleVacationMode = useCallback(async () => {\n    if (!userDoc?.isSuperAdmin) return;\n    setVacationLoading(true);\n    try {\n      const toggleVacationModeFn = httpsCallable(functions, 'toggleVacationMode');\n      const result = await toggleVacationModeFn({ enabled: !vacationMode });\n      setVacationMode(result.data.vacationMode);\n      alert(result.data.message);\n    } catch (error) {\n      console.error('[toggleVacationMode] í† ê¸€ ì‹¤íŒ¨:', error);\n      alert('ë°©í•™ ëª¨ë“œ ì„¤ì • ì‹¤íŒ¨: ' + error.message);\n    } finally {\n      setVacationLoading(false);\n    }\n  }, [functions, userDoc?.isSuperAdmin, vacationMode]);\n\n  // ì¤‘ì•™ ì£¼ì‹ ìŠ¤ëƒ…ìƒ· ë¬¸ì„œ ê°•ì œ ê°±ì‹  (ê´€ë¦¬ì ì‘ì—… í›„ ì½ê¸° ìµœì í™” ìœ ì§€)\n  const refreshStocksSnapshot = useCallback(async () => {\n    try {\n      const updateSnapshotFn = httpsCallable(functions, 'updateStocksSnapshot');\n      await updateSnapshotFn({});\n      console.log('[updateStocksSnapshot] ìŠ¤ëƒ…ìƒ· ê°±ì‹  ì™„ë£Œ');\n    } catch (error) {\n      console.error('[updateStocksSnapshot] ìŠ¤ëƒ…ìƒ· ê°±ì‹  ì‹¤íŒ¨:', error);\n    }\n  }, [functions]);\n\n  // === ê±°ë˜ í•¨ìˆ˜ë“¤ (ìµœì í™”ëœ ìºì‹œ ë¬´íš¨í™”) ===\n  const addStock = useCallback(async (stockData) => {\n    if (!classCode || !user) return alert(\"í´ë˜ìŠ¤ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\n    try {\n      // ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ Cloud Function ë¨¼ì € ì‹œë„ (Rules ìš°íšŒ)\n      const addStockFn = httpsCallable(functions, 'addStockDoc');\n      await addStockFn({ stock: stockData });\n\n      await refreshStocksSnapshot();\n\n      // ìºì‹œ ë¬´íš¨í™”\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      alert(`${stockData.name} ìƒí’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n    } catch (error) {\n      console.error('[addStock] í•¨ìˆ˜ ì¶”ê°€ ì‹¤íŒ¨, Firestore ì§ì ‘ ì‹œë„:', error);\n      try {\n        const stockRef = doc(collection(db, \"CentralStocks\"));\n        await setDoc(stockRef, {\n          ...stockData,\n          initialPrice: stockData.price,\n          priceHistory: [stockData.price],\n          createdAt: serverTimestamp(),\n          holderCount: 0,\n          tradingVolume: 1000,\n          buyVolume: 0,\n          sellVolume: 0,\n          recentBuyVolume: 0,\n          recentSellVolume: 0,\n          volatility: stockData.volatility || 0.02\n        });\n\n        await refreshStocksSnapshot();\n\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        await fetchAllData(true);\n\n        alert(`${stockData.name} ìƒí’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n      } catch (innerError) {\n        console.error('[addStock] Firestore ì§ì ‘ ì¶”ê°€ ì‹¤íŒ¨:', innerError);\n        alert(\"ìƒí’ˆ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ê¶Œí•œ/Rulesë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.\");\n      }\n    }\n  }, [classCode, user, fetchAllData, refreshStocksSnapshot, functions]);\n\n  const deleteStock = useCallback(async (stockId, stockName) => {\n    if (!classCode || !user) return alert(\"í´ë˜ìŠ¤ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\n    if (window.confirm(`'${stockName}' ìƒí’ˆì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      try {\n        await deleteDoc(doc(db, \"CentralStocks\", stockId));\n\n        await refreshStocksSnapshot();\n\n        // ìºì‹œ ë¬´íš¨í™”\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        await fetchAllData(true);\n\n        alert(`${stockName} ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);\n      } catch (error) {\n        alert(\"ìƒí’ˆ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\");\n      }\n    }\n  }, [classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const editStock = useCallback(async (stockId) => {\n    if (!classCode || !user) return alert(\"í´ë˜ìŠ¤ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!stock) return;\n    const newPriceStr = prompt(`'${stock.name}'ì˜ ìƒˆë¡œìš´ ê°€ê²©:`, stock.price.toString());\n    const newPrice = parseFloat(newPriceStr);\n    if (isNaN(newPrice) || newPrice <= 0) return alert(\"ìœ íš¨í•œ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\n    try {\n      await updateDoc(doc(db, \"CentralStocks\", stockId), {\n        price: newPrice,\n        priceHistory: [...(stock.priceHistory || []).slice(-19), newPrice]\n      });\n\n      await refreshStocksSnapshot();\n\n      // ìºì‹œ ë¬´íš¨í™”\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      alert('ê°€ê²©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      alert(\"ê°€ê²© ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\");\n    }\n  }, [stocks, classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const toggleManualStock = useCallback(async (stockId, currentIsListed) => {\n    if (!classCode || !user) return alert(\"í´ë˜ìŠ¤ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!stock) return;\n    const action = currentIsListed ? 'ìƒì¥íì§€' : 'ì¬ìƒì¥';\n\n    if (window.confirm(`'${stock.name}' ìƒí’ˆì„ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      try {\n        const updateData = currentIsListed\n          ? { isListed: false, price: 0, delistedAt: serverTimestamp() }\n          : { isListed: true, price: stock.minListingPrice, priceHistory: [stock.minListingPrice], delistedAt: null };\n\n        await updateDoc(doc(db, \"CentralStocks\", stockId), updateData);\n\n        if (currentIsListed) {\n          const batch = writeBatch(db);\n\n          const portfoliosToDelistQuery = query(\n            collectionGroup(db, 'portfolio'),\n            where('classCode', '==', classCode),\n            where('stockId', '==', stockId)\n          );\n\n          const snapshot = await getDocs(portfoliosToDelistQuery);\n\n          snapshot.forEach(doc => {\n            batch.update(doc.ref, { delistedAt: serverTimestamp() });\n          });\n\n          await batch.commit();\n        }\n\n        await refreshStocksSnapshot();\n\n        // ìºì‹œ ë¬´íš¨í™”\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`STOCKS_${classCode}`);\n        invalidateCache(`PORTFOLIO`);\n        await fetchAllData(true);\n\n        alert(`${action} ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n      } catch (error) {\n        alert(`${action} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);\n      }\n    }\n  }, [stocks, classCode, user, fetchAllData, refreshStocksSnapshot]);\n\n  const buyStock = useCallback(async (stockId, quantityString) => {\n    if (!marketOpen) return alert(\"ì£¼ì‹ì‹œì¥ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ìš´ì˜ ì‹œê°„: ì›”-ê¸ˆ ì˜¤ì „ 8ì‹œ-ì˜¤í›„ 3ì‹œ\");\n    if (isTrading || !classCode) return;\n    const quantity = parseInt(quantityString, 10);\n    if (isNaN(quantity) || quantity <= 0) return alert(\"ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\n    const stock = stocks.find(s => s.id === stockId);\n    if (!user || !stock || !stock.isListed) return alert(\"ë§¤ìˆ˜í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤.\");\n\n    const cost = stock.price * quantity;\n    const commission = Math.round(cost * COMMISSION_RATE);\n    const taxRate = 0.01; // ê¸°ë³¸ ê±°ë˜ì„¸ìœ¨ 1%\n    const taxAmount = Math.floor(cost * taxRate);\n    const totalCost = cost + commission + taxAmount;\n\n    console.log('[buyStock] ë§¤ìˆ˜ ì‹œì‘:', { stockId, stockName: stock.name, quantity, totalCost });\n\n    // ğŸ”¥ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\n    if (optimisticUpdate) {\n      optimisticUpdate({ cash: -totalCost });\n    }\n\n    setIsTrading(true);\n    try {\n      // Cloud Function í˜¸ì¶œ\n      const buyStockFunction = httpsCallable(functions, 'buyStock');\n      const result = await buyStockFunction({ stockId, quantity });\n\n      console.log('[buyStock] ë§¤ìˆ˜ ì„±ê³µ:', result.data);\n\n      // ğŸ”¥ [ìˆ˜ì •] ì„œë²„ì—ì„œ ë°›ì€ ì •í™•í•œ ì”ì•¡ìœ¼ë¡œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ë³´ì •\n      if (result.data.newBalance !== undefined && optimisticUpdate) {\n        const currentCash = userDoc?.cash || 0;\n        const cashDiff = result.data.newBalance - currentCash;\n        optimisticUpdate({ cash: cashDiff });\n        console.log('[buyStock] í˜„ê¸ˆ ì •í™•í•œ ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸:', result.data.newBalance);\n      }\n\n      // ğŸ”¥ [ìµœì í™”] ìºì‹œ ë¬´íš¨í™” (í†µí•©)\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`PORTFOLIO_user_${user.uid}`);\n      clearLocalStorageBatchCache();\n\n      // ğŸ”¥ [ìµœì í™”] í¬íŠ¸í´ë¦¬ì˜¤ë§Œ ë¡œì»¬ì—ì„œ ì—…ë°ì´íŠ¸ - ì „ì²´ fetchAllData í˜¸ì¶œ ì œê±°\n      // ì„œë²„ì—ì„œ ë°˜í™˜ëœ ë°ì´í„°ë¡œ í¬íŠ¸í´ë¦¬ì˜¤ ìƒíƒœ ì§ì ‘ ì—…ë°ì´íŠ¸\n      setPortfolio(prev => {\n        const existingIndex = prev.findIndex(h => h.stockId === stockId);\n        if (existingIndex >= 0) {\n          const existing = prev[existingIndex];\n          const newQuantity = existing.quantity + quantity;\n          const newAvgPrice = ((existing.averagePrice * existing.quantity) + (stock.price * quantity)) / newQuantity;\n          return [\n            ...prev.slice(0, existingIndex),\n            { ...existing, quantity: newQuantity, averagePrice: newAvgPrice, lastBuyTime: new Date() },\n            ...prev.slice(existingIndex + 1)\n          ];\n        } else {\n          return [...prev, {\n            id: `temp_${Date.now()}`,\n            stockId,\n            stockName: stock.name,\n            quantity,\n            averagePrice: stock.price,\n            classCode,\n            lastBuyTime: new Date()\n          }];\n        }\n      });\n\n      setBuyQuantities(prev => ({ ...prev, [stockId]: \"\" }));\n\n      // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì£¼ì‹ ë§¤ìˆ˜)\n      logActivity(db, {\n        classCode,\n        userId: user.uid,\n        userName: userDoc?.name || user.displayName || 'ì‚¬ìš©ì',\n        type: ACTIVITY_TYPES.STOCK_BUY,\n        description: `${stock.name} ${quantity}ì£¼ ë§¤ìˆ˜ (${formatCurrency(totalCost)})`,\n        amount: -totalCost,\n        metadata: {\n          stockId,\n          stockName: stock.name,\n          quantity,\n          pricePerShare: stock.price,\n          commission,\n          taxAmount,\n          totalCost\n        }\n      });\n\n      alert(`${stock.name} ${quantity}ì£¼ ë§¤ìˆ˜ ì™„ë£Œ!\\nìˆ˜ìˆ˜ë£Œ: ${formatCurrency(commission)}`);\n    } catch (error) {\n      console.error('[buyStock] ë§¤ìˆ˜ ì‹¤íŒ¨:', error);\n\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°± (ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì·¨ì†Œ)\n      if (optimisticUpdate) {\n        optimisticUpdate({ cash: totalCost });\n      }\n\n      alert(error.message || 'ë§¤ìˆ˜ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setIsTrading(false);\n    }\n  }, [stocks, user, isTrading, classCode, marketOpen, functions, fetchAllData, invalidateCache, optimisticUpdate, refreshUserDocument]);\n\n  const sellStock = useCallback(async (holdingId, quantityString) => {\n    if (!marketOpen) return alert(\"ì£¼ì‹ì‹œì¥ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ìš´ì˜ ì‹œê°„: ì›”-ê¸ˆ ì˜¤ì „ 8ì‹œ-ì˜¤í›„ 3ì‹œ\");\n    if (isTrading) return;\n    const quantity = parseInt(quantityString, 10);\n    if (isNaN(quantity) || quantity <= 0) return alert(\"ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\n    const holding = portfolio.find(h => h.id === holdingId);\n    if (!user || !userDoc || !holding || quantity > holding.quantity) return alert(\"ë§¤ë„í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤.\");\n    if (holding.delistedAt) return alert(\"ìƒì¥íì§€ëœ ìƒí’ˆì€ ë§¤ë„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n\n    if (!canSellHolding(holding)) {\n      const remaining = getRemainingLockTime(holding);\n      return alert(`ë§¤ìˆ˜ í›„ 1ì‹œê°„ ë™ì•ˆì€ ë§¤ë„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\\në‚¨ì€ ì‹œê°„: ${formatTime(remaining)}`);\n    }\n\n    const stock = stocks.find(s => s.id === holding.stockId);\n    if (!stock || !stock.isListed) return alert(\"í˜„ì¬ ê±°ë˜í•  ìˆ˜ ì—†ëŠ” ìƒí’ˆì…ë‹ˆë‹¤.\");\n\n    // ì˜ˆìƒ ìˆ˜ìµ ê³„ì‚° (ë‚™ê´€ì  ì—…ë°ì´íŠ¸ìš©)\n    const sellPrice = stock.price * quantity;\n    const commission = Math.round(sellPrice * COMMISSION_RATE);\n    const profit = (stock.price - holding.averagePrice) * quantity;\n    const profitTax = profit > 0 ? Math.floor(profit * 0.22) : 0;\n    const transactionTax = Math.floor(sellPrice * 0.01);\n    const totalTax = profitTax + transactionTax;\n    const estimatedNetRevenue = sellPrice - commission - totalTax;\n\n    console.log('[sellStock] ë§¤ë„ ì‹œì‘:', { holdingId, stockName: stock.name, quantity, estimatedNetRevenue });\n\n    // ğŸ”¥ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\n    if (optimisticUpdate) {\n      optimisticUpdate({ cash: estimatedNetRevenue });\n    }\n\n    setIsTrading(true);\n\n    try {\n      const sellStockFunction = httpsCallable(functions, 'sellStock');\n      const result = await sellStockFunction({ holdingId, quantity });\n\n      console.log('[sellStock] ë§¤ë„ ì„±ê³µ:', result.data);\n\n      // ğŸ”¥ [ìˆ˜ì •] ì„œë²„ì—ì„œ ë°›ì€ ì •í™•í•œ ì”ì•¡ìœ¼ë¡œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ë³´ì •\n      if (result.data.newBalance !== undefined && optimisticUpdate) {\n        const currentCash = userDoc?.cash || 0;\n        const cashDiff = result.data.newBalance - currentCash;\n        optimisticUpdate({ cash: cashDiff });\n        console.log('[sellStock] í˜„ê¸ˆ ì •í™•í•œ ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸:', result.data.newBalance);\n      }\n\n      // ğŸ”¥ [ìµœì í™”] ìºì‹œ ë¬´íš¨í™” (í†µí•©)\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`PORTFOLIO_user_${user.uid}`);\n      clearLocalStorageBatchCache();\n\n      // ğŸ”¥ [ìµœì í™”] í¬íŠ¸í´ë¦¬ì˜¤ ë¡œì»¬ ì—…ë°ì´íŠ¸ - fetchAllData í˜¸ì¶œ ì œê±°\n      setPortfolio(prev => {\n        const existingIndex = prev.findIndex(h => h.id === holdingId);\n        if (existingIndex >= 0) {\n          const existing = prev[existingIndex];\n          const newQuantity = existing.quantity - quantity;\n          if (newQuantity <= 0) {\n            // ì „ëŸ‰ ë§¤ë„ ì‹œ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì œê±°\n            return [...prev.slice(0, existingIndex), ...prev.slice(existingIndex + 1)];\n          } else {\n            return [\n              ...prev.slice(0, existingIndex),\n              { ...existing, quantity: newQuantity },\n              ...prev.slice(existingIndex + 1)\n            ];\n          }\n        }\n        return prev;\n      });\n\n      setSellQuantities(prev => ({ ...prev, [holdingId]: \"\" }));\n\n      const { stockName, sellPrice: actualSellPrice, commission: actualCommission, totalTax: actualTax, profit: actualProfit, netRevenue } = result.data;\n\n      // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì£¼ì‹ ë§¤ë„)\n      logActivity(db, {\n        classCode,\n        userId: user.uid,\n        userName: userDoc?.name || user.displayName || 'ì‚¬ìš©ì',\n        type: ACTIVITY_TYPES.STOCK_SELL,\n        description: `${stockName} ${quantity}ì£¼ ë§¤ë„ (ìˆœìˆ˜ìµ: ${formatCurrency(netRevenue)})`,\n        amount: netRevenue,\n        metadata: {\n          holdingId,\n          stockName,\n          quantity,\n          sellPrice: actualSellPrice,\n          commission: actualCommission,\n          tax: actualTax,\n          profit: actualProfit,\n          netRevenue\n        }\n      });\n\n      const taxInfo = actualTax > 0 ? `\\nì„¸ê¸ˆ: ${formatCurrency(actualTax)}` : '';\n      alert(`${stockName} ${quantity}ì£¼ ë§¤ë„ ì™„ë£Œ!\\nìˆ˜ìµ: ${formatCurrency(actualProfit)}${taxInfo}\\nìˆ˜ìˆ˜ë£Œ: ${formatCurrency(actualCommission)}\\nìˆœìˆ˜ìµ: ${formatCurrency(netRevenue)}`);\n    } catch (error) {\n      console.error('[sellStock] ë§¤ë„ ì‹¤íŒ¨:', error);\n\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°± (ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì·¨ì†Œ)\n      if (optimisticUpdate) {\n        optimisticUpdate({ cash: -estimatedNetRevenue });\n      }\n\n      alert(error.message || 'ë§¤ë„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setIsTrading(false);\n    }\n  }, [stocks, portfolio, user, userDoc, isTrading, classCode, marketOpen, fetchAllData, functions, optimisticUpdate, refreshUserDocument]);\n\n  const deleteHolding = useCallback(async (holdingId) => {\n    if (!user || !classCode) return;\n    if (window.confirm(\"ì´ ìƒí’ˆ(íœ´ì§€ì¡°ê°)ì„ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\")) {\n      try {\n        await deleteDoc(doc(db, \"users\", user.uid, \"portfolio\", holdingId));\n\n        // ìºì‹œ ë¬´íš¨í™”\n        const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n        globalCache.invalidate(batchKey);\n        invalidateCache(`PORTFOLIO_user_${user.uid}`);\n        await fetchAllData(true);\n\n        alert(\"ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\");\n      } catch (error) {\n        alert(\"ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\");\n      }\n    }\n  }, [user, classCode, fetchAllData]);\n\n  // ğŸ”¥ ìˆ˜ë™ìœ¼ë¡œ ì£¼ì‹ ì‹œì¥ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì ì „ìš©)\n  const manualUpdateStockMarket = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functionsê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\n    }\n\n    try {\n      console.log('[manualUpdateStockMarket] ìˆ˜ë™ ì—…ë°ì´íŠ¸ ì‹œì‘');\n      const manualUpdateFunction = httpsCallable(functions, 'manualUpdateStockMarket');\n      const result = await manualUpdateFunction({});\n\n      console.log('[manualUpdateStockMarket] ì—…ë°ì´íŠ¸ ì„±ê³µ:', result.data);\n\n      // ìºì‹œ ë¬´íš¨í™” ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[manualUpdateStockMarket] ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // ğŸ”¥ ì‹¤ì œ ì£¼ì‹ ìƒì„± (ê´€ë¦¬ì ì „ìš©)\n  const createRealStocks = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functionsê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\n    }\n\n    try {\n      console.log('[createRealStocks] ì‹¤ì œ ì£¼ì‹ ìƒì„± ì‹œì‘');\n      const createRealStocksFunction = httpsCallable(functions, 'createRealStocks');\n      const result = await createRealStocksFunction({});\n\n      console.log('[createRealStocks] ìƒì„± ì„±ê³µ:', result.data);\n\n      // ìºì‹œ ë¬´íš¨í™” ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[createRealStocks] ìƒì„± ì‹¤íŒ¨:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // ğŸ”¥ ì‹¤ì œ ì£¼ì‹ ê°€ê²© ìˆ˜ë™ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì ì „ìš©)\n  const updateRealStocks = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functionsê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\n    }\n\n    try {\n      console.log('[updateRealStocks] ì‹¤ì œ ì£¼ì‹ ì—…ë°ì´íŠ¸ ì‹œì‘');\n      const updateRealStocksFunction = httpsCallable(functions, 'updateRealStocks');\n      const result = await updateRealStocksFunction({});\n\n      console.log('[updateRealStocks] ì—…ë°ì´íŠ¸ ì„±ê³µ:', result.data);\n\n      // ìºì‹œ ë¬´íš¨í™” ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[updateRealStocks] ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // ğŸ”¥ ê°œë³„ ì‹¤ì œ ì£¼ì‹ ì¶”ê°€ (ê´€ë¦¬ì ì „ìš©)\n  const addSingleRealStock = useCallback(async ({ name, symbol, sector, productType }) => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functionsê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\n    }\n\n    try {\n      console.log('[addSingleRealStock] ê°œë³„ ì‹¤ì œ ì£¼ì‹ ì¶”ê°€ ì‹œì‘:', name);\n      const addSingleRealStockFunction = httpsCallable(functions, 'addSingleRealStock');\n      const result = await addSingleRealStockFunction({ name, symbol, sector, productType });\n\n      console.log('[addSingleRealStock] ì¶”ê°€ ì„±ê³µ:', result.data);\n\n      // ìºì‹œ ë¬´íš¨í™” ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[addSingleRealStock] ì¶”ê°€ ì‹¤íŒ¨:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // ğŸ”¥ ì‹œë®¬ë ˆì´ì…˜ ì£¼ì‹ ì „ì²´ ì‚­ì œ (ê´€ë¦¬ì ì „ìš©)\n  const deleteSimulationStocks = useCallback(async () => {\n    if (!functions || !classCode || !user) {\n      throw new Error(\"Firebase Functionsê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\n    }\n\n    try {\n      console.log('[deleteSimulationStocks] ì‹œë®¬ë ˆì´ì…˜ ì£¼ì‹ ì‚­ì œ ì‹œì‘');\n      const deleteSimulationStocksFunction = httpsCallable(functions, 'deleteSimulationStocks');\n      const result = await deleteSimulationStocksFunction({});\n\n      console.log('[deleteSimulationStocks] ì‚­ì œ ì„±ê³µ:', result.data);\n\n      // ìºì‹œ ë¬´íš¨í™” ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨\n      const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n      globalCache.invalidate(batchKey);\n      invalidateCache(`STOCKS_${classCode}`);\n      await fetchAllData(true);\n\n      return result.data;\n    } catch (error) {\n      console.error('[deleteSimulationStocks] ì‚­ì œ ì‹¤íŒ¨:', error);\n      throw error;\n    }\n  }, [functions, classCode, user, fetchAllData]);\n\n  // === stocks ë°ì´í„°ë¥¼ Mapìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ ===\n  const stocksMap = useMemo(() => {\n    const map = new Map();\n    stocks.forEach(stock => map.set(stock.id, stock));\n    return map;\n  }, [stocks]);\n\n  // === ê³„ì‚°ëœ ê°’ë“¤ ===\n  const portfolioStats = useMemo(() => {\n    let totalValue = 0, totalInvested = 0;\n    portfolio.forEach(holding => {\n      const investedValue = holding.averagePrice * holding.quantity;\n      totalInvested += investedValue;\n      if (!holding.delistedAt) {\n        const stock = stocksMap.get(holding.stockId);\n        if (stock && stock.isListed) totalValue += stock.price * holding.quantity;\n      }\n    });\n    const totalProfit = totalValue - totalInvested;\n    const profitPercent = totalInvested > 0 ? (totalProfit / totalInvested) * 100 : 0;\n    return { totalValue, totalInvested, totalProfit, profitPercent };\n  }, [portfolio, stocksMap]);\n\n  const categoryCounts = useMemo(() => {\n    const counts = { stocks: 0, etfs: 0, bonds: 0 };\n    stocks.forEach(s => {\n      if (!s.isListed) return;\n      if (s.productType === PRODUCT_TYPES.ETF) {\n        counts.etfs++;\n      } else if (s.productType === PRODUCT_TYPES.BOND) {\n        counts.bonds++;\n      } else {\n        counts.stocks++;\n      }\n    });\n    return counts;\n  }, [stocks]);\n\n  const filteredStocks = useMemo(() => {\n    return stocks.filter(s => {\n      if (!s.isListed) return false;\n      if (activeTab === \"stocks\") return s.productType === PRODUCT_TYPES.STOCK || !s.productType;\n      if (activeTab === \"etfs\") return s.productType === PRODUCT_TYPES.ETF;\n      if (activeTab === \"bonds\") return s.productType === PRODUCT_TYPES.BOND;\n      return false;\n    });\n  }, [stocks, activeTab]);\n\n  const [showAllStocks, setShowAllStocks] = useState(false);\n\n  const displayedStocks = useMemo(() => {\n    return showAllStocks ? filteredStocks : filteredStocks.slice(0, 20);\n  }, [filteredStocks, showAllStocks]);\n\n  // === ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ ===\n  const handleManualRefresh = useCallback(() => {\n    if (!classCode || !user) return;\n    // ìºì‹œ ê°•ì œ ì‚­ì œ\n    const batchKey = globalCache.generateKey('BATCH', { classCode, userId: user.uid });\n    globalCache.invalidate(batchKey);\n    fetchAllData(true);\n  }, [fetchAllData, classCode, user]);\n\n  if (authLoading || !firebaseReady) return <div className=\"loading-message\">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>;\n  if (!user || !userDoc) return <div className=\"loading-message\">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>;\n\n  // í•™ìƒ ì‚¬ìš©ìê°€ í•™ê¸‰ì— ë°°ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ\n  if (!isAdmin() && (!classCode || classCode === 'ë¯¸ì§€ì •')) {\n    return (\n      <div className=\"stock-exchange-container\">\n        <header className=\"stock-header\">\n          <div className=\"stock-header-content\">\n            <div className=\"logo-title\">\n              <BarChart3 size={32} color=\"white\" /><h1>íˆ¬ì ê±°ë˜ì†Œ</h1>\n            </div>\n          </div>\n        </header>\n        <main className=\"market-section\" style={{ justifyContent: 'center', alignItems: 'center', display: 'flex' }}>\n          <div style={{ textAlign: 'center', padding: '20px', background: '#fff', borderRadius: '8px', boxShadow: '0 2px 10px rgba(0,0,0,0.1)' }}>\n            <h2>í•™ê¸‰ ë¯¸ë°°ì • ì•ˆë‚´</h2>\n            <p style={{ marginTop: '10px', fontSize: '1rem', color: '#333' }}>\n              ì†Œì†ëœ í•™ê¸‰ì´ ì—†ì–´ ì£¼ì‹ ì‹œì¥ì„ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n            </p>\n            <p style={{ marginTop: '5px', fontSize: '0.9rem', color: '#666' }}>\n              ë‹´ë‹¹ ì„ ìƒë‹˜ê»˜ ë¬¸ì˜í•˜ì—¬ í•™ê¸‰ì— ë“±ë¡í•´ì£¼ì„¸ìš”.\n            </p>\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  if (!classCode && !authLoading) return <div className=\"loading-message\">ì°¸ì—¬ ì¤‘ì¸ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;\n  if (showAdminPanel && isAdmin()) return <AdminPanel stocks={stocks} classCode={classCode} onClose={() => setShowAdminPanel(false)} onAddStock={addStock} onDeleteStock={deleteStock} onEditStock={editStock} onToggleManualStock={toggleManualStock} cacheStats={cacheStatus} onManualUpdate={manualUpdateStockMarket} onCreateRealStocks={createRealStocks} onUpdateRealStocks={updateRealStocks} onAddSingleRealStock={addSingleRealStock} onDeleteSimulationStocks={deleteSimulationStocks} />;\n\n  return (\n    <div className=\"stock-exchange-container\">\n      <header className=\"stock-header\">\n        <div className=\"stock-header-content\">\n          <div className=\"logo-title\">\n            <BarChart3 size={32} color=\"white\" /><h1>íˆ¬ì ê±°ë˜ì†Œ ({classCode})</h1>\n          </div>\n          <div className={`market-status ${marketOpen ? 'open' : 'closed'}`}>\n            {marketOpen ? 'â— ê°œì¥' : 'â—‹ ë§ˆê°'}\n          </div>\n          <div className=\"stock-header-actions\">\n            <div className=\"user-info-display\">{formatCurrency(userDoc.cash)}</div>\n            {isAdmin() && <button onClick={() => setShowAdminPanel(true)} className=\"btn btn-primary\"><Settings size={16} /> ê´€ë¦¬</button>}\n            {/* ğŸ”¥ ë°©í•™ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ (ìŠˆí¼ê´€ë¦¬ì ì „ìš©) */}\n            {userDoc?.isSuperAdmin && (\n              <button\n                onClick={toggleVacationMode}\n                disabled={vacationLoading}\n                className={`btn ${vacationMode ? \"btn-warning\" : \"btn-secondary\"}`}\n                style={{ marginLeft: '8px' }}\n                title={vacationMode ? 'ë°©í•™ ëª¨ë“œ ON - ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€ë¨' : 'ë°©í•™ ëª¨ë“œ OFF - ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ë™ ì¤‘'}\n              >\n                {vacationLoading ? '...' : vacationMode ? 'ğŸ–ï¸ ë°©í•™ëª¨ë“œ ON' : 'ğŸ“… ë°©í•™ëª¨ë“œ OFF'}\n              </button>\n            )}\n          </div>\n        </div>\n      </header>\n      <main className=\"market-section\">\n        <section className=\"asset-summary\">\n          <div className=\"asset-cards\">\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>íˆ¬ì í‰ê°€ì•¡</h3><p className=\"value\">{formatCurrency(portfolioStats.totalValue)}</p></div><div className=\"asset-card-icon blue\">ğŸ“Š</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>ì´ ìì‚°</h3><p className=\"value\">{formatCurrency(userDoc.cash + portfolioStats.totalValue)}</p></div><div className=\"asset-card-icon purple\">ğŸ’</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>í‰ê°€ì†ìµ</h3><p className={`value ${portfolioStats.totalProfit >= 0 ? 'profit-positive' : 'profit-negative'}`}>{formatCurrency(portfolioStats.totalProfit)}</p></div><div className={`asset-card-icon ${portfolioStats.totalProfit >= 0 ? 'red' : 'blue'}`}>{portfolioStats.totalProfit >= 0 ? <TrendingUp size={24} color=\"white\" /> : <TrendingDown size={24} color=\"white\" />}</div></div></div>\n            <div className=\"asset-card\"><div className=\"asset-card-content\"><div className=\"asset-card-info\"><h3>ìˆ˜ìµë¥ </h3><p className={`value ${portfolioStats.profitPercent >= 0 ? 'profit-positive' : 'profit-negative'}`}>{formatPercent(portfolioStats.profitPercent)}</p></div><div className={`asset-card-icon ${portfolioStats.profitPercent >= 0 ? 'red' : 'blue'}`}>{portfolioStats.profitPercent >= 0 ? <TrendingUp size={24} color=\"white\" /> : <TrendingDown size={24} color=\"white\" />}</div></div></div>\n          </div>\n\n          {/* ì„±ëŠ¥ í†µê³„ í‘œì‹œ (ê´€ë¦¬ì ì „ìš©) */}\n          {isAdmin() && (\n            <div style={{\n              marginTop: '10px',\n              padding: '8px 12px',\n              background: '#f0f9ff',\n              borderRadius: '6px',\n              fontSize: '0.8rem',\n              color: '#0369a1',\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center'\n            }}>\n              <div>\n                ğŸš€ ì„±ëŠ¥ ìµœì í™” ìƒíƒœ: ìºì‹œ ì ì¤‘ {cacheStatus.hits}íšŒ, ëˆ„ë½ {cacheStatus.misses}íšŒ\n                (ì ˆì•½ë¥ : {cacheStatus.hits + cacheStatus.misses > 0 ? Math.round((cacheStatus.hits / (cacheStatus.hits + cacheStatus.misses)) * 100) : 0}%)\n              </div>\n              {lastBatchLoad && (\n                <div>ë§ˆì§€ë§‰ ë°°ì¹˜ë¡œë“œ: {lastBatchLoad.toLocaleTimeString()}</div>\n              )}\n            </div>\n          )}\n        </section>\n\n        <section className=\"market-list-section\">\n          <div className=\"section-header\">\n            <h2 className=\"section-title\">ğŸ“ˆ íˆ¬ì ì‹œì¥</h2>\n            <div className=\"update-indicator\">\n              <button onClick={handleManualRefresh} disabled={isFetching} className=\"btn btn-secondary\" style={{ padding: '4px 8px', fontSize: '0.75rem' }}>\n                <RefreshCw size={12} />\n                {isFetching ? 'ê°±ì‹ ì¤‘...' : 'ìƒˆë¡œê³ ì¹¨'}\n              </button>\n              {lastUpdated && <span style={{ fontSize: '0.75rem', color: '#6b7280' }}>ë§ˆì§€ë§‰ ê°±ì‹ : {lastUpdated.toLocaleTimeString()}</span>}\n            </div>\n          </div>\n\n          <div className=\"market-tabs\">\n            <button onClick={() => setActiveTab(\"stocks\")} className={`tab-button ${activeTab === \"stocks\" ? \"active\" : \"\"}`}>ì£¼ì‹ ({categoryCounts.stocks})</button>\n            <button onClick={() => setActiveTab(\"etfs\")} className={`tab-button ${activeTab === \"etfs\" ? \"active\" : \"\"}`}>ETF/ì§€ìˆ˜ ({categoryCounts.etfs})</button>\n            <button onClick={() => setActiveTab(\"bonds\")} className={`tab-button ${activeTab === \"bonds\" ? \"active\" : \"\"}`}>ì±„ê¶Œ ({categoryCounts.bonds})</button>\n          </div>\n\n          <div className=\"market-grid\">\n            {displayedStocks.map(stock => {\n              const priceHistory = stock.priceHistory || [stock.price];\n              const priceChange = priceHistory.length >= 2 ? ((priceHistory.slice(-1)[0] - priceHistory.slice(-2)[0]) / priceHistory.slice(-2)[0]) * 100 : 0;\n              const isRealStock = stock.isRealStock === true;\n              return (\n                <div key={stock.id} className={`stock-card ${priceChange > 0 ? 'price-up' : priceChange < 0 ? 'price-down' : ''} ${isRealStock ? 'real-stock' : ''}`}>\n                  <div className=\"stock-card-header\">\n                    <div className=\"stock-info\">\n                      <h3>{getProductIcon(stock.productType)} {stock.name}</h3>\n                      <div className=\"stock-badges\">\n                        {isRealStock && (\n                          <span className=\"stock-badge real\" style={{\n                            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                            color: 'white',\n                            fontWeight: 'bold',\n                            fontSize: '0.7rem',\n                            padding: '2px 6px',\n                            borderRadius: '4px',\n                            marginRight: '4px'\n                          }}>\n                            ì‹¤ì‹œê°„\n                          </span>\n                        )}\n                        <span className={`stock-badge ${getProductBadgeClass(stock.productType)}`}>\n                          {stock.productType === PRODUCT_TYPES.BOND ? `${stock.maturityYears}ë…„ ${stock.couponRate}%` : SECTORS[stock.sector]?.name || 'ê¸°íƒ€'}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"stock-price-section\">\n                      <div className=\"stock-price\">{formatCurrency(stock.price)}</div>\n                      <div className={`stock-change ${priceChange > 0 ? 'up' : 'down'}`}>\n                        <span>{formatPercent(priceChange)}</span>\n                      </div>\n                      {isRealStock && (\n                        <div style={{ fontSize: '0.7rem', color: '#6b7280', marginTop: '2px' }}>\n                          {getMarketStateLabel(stock) || 'ì¥ë§ˆê°'}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"stock-actions\">\n                    <input type=\"number\" min=\"1\" value={buyQuantities[stock.id] || ''} onChange={e => setBuyQuantities(p => ({ ...p, [stock.id]: e.target.value }))} placeholder=\"ìˆ˜ëŸ‰\" className=\"quantity-input\" />\n                    <button onClick={() => buyStock(stock.id, buyQuantities[stock.id])} disabled={!buyQuantities[stock.id] || isTrading || !marketOpen} className=\"trade-button buy\">ë§¤ìˆ˜</button>\n                  </div>\n                  <div className=\"cost-display\">\n                    {buyQuantities[stock.id] && `ì˜ˆìƒ ë¹„ìš©: ${formatCurrency(stock.price * parseInt(buyQuantities[stock.id]) * (1 + COMMISSION_RATE))}`}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n          {filteredStocks.length > 20 && (\n            <div className=\"load-more-container\">\n              <button onClick={() => setShowAllStocks(!showAllStocks)} className=\"load-more-button\">\n                {showAllStocks ? \"ì ‘ê¸°\" : \"ë” ë³´ê¸°\"}\n              </button>\n            </div>\n          )}\n        </section>\n        <section className=\"portfolio-section\">\n          <div className=\"section-header\">\n            <h2 className=\"section-title\">ğŸ’¼ ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</h2>\n          </div>\n          <div className=\"portfolio-cards\">\n            {portfolio.length === 0 ? <p className=\"no-transactions\">ë³´ìœ í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p> : portfolio.map(holding => {\n              const stock = stocksMap.get(holding.stockId);\n\n              // íœ´ì§€ì¡°ê° ì£¼ì‹ ì²˜ë¦¬ (ìƒì¥íì§€ë¡œ ê°€ì¹˜ 0ì´ ëœ ì£¼ì‹)\n              if (holding.isWorthless) {\n                return (\n                  <div key={holding.id} className=\"portfolio-card delisted\">\n                    <div className=\"portfolio-card-header\">\n                      <div className=\"stock-title-section\">\n                        <h3 className=\"stock-name\">{holding.stockName}</h3>\n                        <span className=\"stock-status delisted\">ğŸ—‘ï¸ íœ´ì§€ì¡°ê°</span>\n                      </div>\n                      <div className=\"stock-quantity\">{holding.quantity}<span className=\"unit\">ì£¼</span></div>\n                    </div>\n                    <div className=\"portfolio-metrics-compact\">\n                      <div className=\"metrics-row\">\n                        <div className=\"metric-item\"><span className=\"metric-label\">í˜„ì¬ ê°€ì¹˜</span><span className=\"metric-value\" style={{ color: '#ef4444', fontWeight: 'bold' }}>0ì›</span></div>\n                        <div className=\"metric-item\"><span className=\"metric-label\">ì†ì‹¤</span><span className=\"metric-value\" style={{ color: '#ef4444' }}>-100%</span></div>\n                      </div>\n                    </div>\n                    <p style={{ fontSize: '0.85rem', color: '#6b7280', marginTop: '8px' }}>ìƒì¥íì§€ëœ ìƒí’ˆì…ë‹ˆë‹¤. 10ë¶„ í›„ ìë™ ì‚­ì œë©ë‹ˆë‹¤.</p>\n                    <div className=\"portfolio-card-actions\">\n                      <button onClick={() => deleteHolding(holding.id)} className=\"action-btn delete-btn\">ì§€ê¸ˆ ì‚­ì œ</button>\n                    </div>\n                  </div>\n                );\n              }\n\n              if (!stock) return null;\n              const currentValue = stock.price * holding.quantity;\n              const investedValue = holding.averagePrice * holding.quantity;\n              const profit = currentValue - investedValue;\n              const profitPercent = investedValue > 0 ? (profit / investedValue) * 100 : 0;\n              const isLocked = !!lockTimers[holding.id];\n              const canSell = !isLocked;\n\n              return (\n                <div key={holding.id} className={`portfolio-card ${profit >= 0 ? 'profit' : 'loss'}`}>\n                  <div className=\"portfolio-card-header\">\n                    <div className=\"stock-title-section\">\n                      <h3 className=\"stock-name\">{getProductIcon(stock.productType)} {holding.stockName}</h3>\n                      {isLocked && (\n                        <span style={{\n                          fontSize: '0.75rem',\n                          padding: '2px 8px',\n                          background: '#fef3c7',\n                          color: '#92400e',\n                          borderRadius: '4px',\n                          fontWeight: 'bold',\n                          display: 'inline-flex',\n                          alignItems: 'center',\n                          gap: '4px'\n                        }}>\n                          <Lock size={12} />\n                          ë§¤ë„ ë¶ˆê°€\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"stock-quantity\">{holding.quantity}<span className=\"unit\">ì£¼</span></div>\n                  </div>\n                  <div className=\"portfolio-metrics-compact\">\n                    <div className=\"metrics-row\">\n                      <div className=\"metric-item\"><span className=\"metric-label\">í‰ê·  ë§¤ìˆ˜ê°€</span><span className=\"metric-value\">{formatCurrency(holding.averagePrice)}</span></div>\n                      <div className=\"metric-item\"><span className=\"metric-label\">í˜„ì¬ê°€</span><span className=\"metric-value current\">{formatCurrency(stock.price)}</span></div>\n                    </div>\n                  </div>\n                  <div className={`profit-summary ${profit >= 0 ? 'profit' : 'loss'}`}>\n                    <div className=\"profit-amount\">{formatCurrency(profit)}</div>\n                    <div className=\"profit-percent\">{formatPercent(profitPercent)}</div>\n                  </div>\n                  {isLocked && (\n                    <div style={{\n                      padding: '10px 12px',\n                      background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',\n                      borderRadius: '8px',\n                      display: 'flex',\n                      flexDirection: 'column',\n                      gap: '4px',\n                      marginTop: '8px',\n                      border: '1px solid #fbbf24'\n                    }}>\n                      <div style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '8px',\n                        fontSize: '0.9rem',\n                        color: '#92400e',\n                        fontWeight: 'bold'\n                      }}>\n                        <Lock size={16} />\n                        <span>ë§¤ë„ ì œí•œ ì‹œê°„</span>\n                      </div>\n                      <div style={{\n                        fontSize: '1.1rem',\n                        color: '#78350f',\n                        fontWeight: 'bold',\n                        textAlign: 'center',\n                        marginTop: '4px',\n                        fontFamily: 'monospace'\n                      }}>\n                        â±ï¸ {formatTime(lockTimers[holding.id])} ë‚¨ìŒ\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"portfolio-card-actions\">\n                    <div className=\"trade-section\">\n                      <div className=\"trade-input-group\">\n                        <input type=\"number\" min=\"1\" max={holding.quantity} value={sellQuantities[holding.id] || ''} onChange={e => setSellQuantities(p => ({ ...p, [holding.id]: e.target.value }))} placeholder=\"ë§¤ë„ ìˆ˜ëŸ‰\" className=\"trade-input\" disabled={!!lockTimers[holding.id] || !marketOpen} />\n                        <button onClick={() => sellStock(holding.id, sellQuantities[holding.id])} disabled={!sellQuantities[holding.id] || isTrading || !!lockTimers[holding.id] || !marketOpen} className=\"action-btn sell-btn\">ë§¤ë„</button>\n                      </div>\n                      {sellQuantities[holding.id] && !lockTimers[holding.id] && (\n                        <div className=\"expected-amount\">\n                          ì˜ˆìƒ ìˆ˜ìµ: {formatCurrency((stock.price * parseInt(sellQuantities[holding.id])) * (1 - COMMISSION_RATE) - calculateStockTax(Math.max(0, (stock.price - holding.averagePrice) * parseInt(sellQuantities[holding.id])), stock.productType))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </section>\n      </main>\n    </div>\n  );\n};\n\nexport default StockExchange;\n"],"names":["batchDataLoader","pendingRequests","Map","loadBatchData","async","classCode","userId","forceRefresh","arguments","length","undefined","batchKey","globalCache","generateKey","console","log","invalidate","cached","get","this","has","batchPromise","_executeBatchLoad","set","result","delete","stocks","portfolio","Promise","all","_loadStocks","_loadPortfolio","errors","getSnapshotFn","httpsCallable","functions","data","Array","isArray","fnError","warn","cacheRef","doc","db","cacheDoc","getDoc","cacheData","exists","snapshotError","stocksRef","collection","q","query","where","getDocs","docs","map","_objectSpread","id","error","portfolioRef","_data$lastBuyTime","_data$delistedAt","lastBuyTime","toDate","delistedAt","getMarketStateLabel","stock","state","_stock$realStockData","isRealStock","realStockData","marketState","getRealtimeMarketState","TrendingUp","_ref","size","color","_jsxs","width","height","viewBox","fill","stroke","strokeWidth","children","_jsx","points","TrendingDown","_ref2","Settings","_ref3","cx","cy","r","d","RefreshCw","_ref4","strokeLinecap","strokeLinejoin","BarChart3","_ref5","x1","y1","x2","y2","Lock","_ref8","x","y","rx","ry","PRODUCT_TYPES","SECTORS","TECH","name","FINANCE","CONSUMER","HEALTHCARE","ENERGY","INDUSTRIAL","MATERIALS","REALESTATE","UTILITIES","COMMUNICATION","ENTERTAINMENT","INDEX","GOVERNMENT","CORPORATE","HOLDING_LOCK_PERIOD","COMMISSION_RATE","CACHE_TTL","formatCurrency","amount","isNaN","Intl","NumberFormat","format","Math","round","formatPercent","percent","num","parseFloat","toFixed","calculateStockTax","profit","getRemainingLockTime","holding","_holding$lastBuyTime2","lastBuyTimeMs","Date","getTime","now","remaining","max","formatTime","milliseconds","seconds","floor","minutes","remainingSeconds","concat","getProductIcon","productType","getProductBadgeClass","invalidateCache","pattern","invalidatePattern","clearLocalStorageBatchCache","keysToDelete","i","localStorage","key","includes","push","forEach","removeItem","RealStockAdder","React","_ref9","onAddStock","showForm","setShowForm","useState","isAdding","setIsAdding","formData","setFormData","symbol","sector","style","marginTop","onClick","className","marginBottom","background","padding","borderRadius","border","fontSize","display","flexWrap","gap","type","alert","message","handleQuickAdd","disabled","cursor","whiteSpace","title","placeholder","value","onChange","e","p","target","flex","minWidth","AdminPanel","_ref0","onClose","onDeleteStock","onEditStock","onToggleManualStock","cacheStats","onManualUpdate","onCreateRealStocks","onUpdateRealStocks","onAddSingleRealStock","onDeleteSimulationStocks","showAddForm","setShowAddForm","isUpdating","setIsUpdating","isCreatingRealStocks","setIsCreatingRealStocks","isUpdatingRealStocks","setIsUpdatingRealStocks","isDeletingSimulation","setIsDeletingSimulation","newStock","setNewStock","price","minListingPrice","isManual","maturityYears","couponRate","alignItems","hits","misses","savings","window","confirm","fontWeight","paddingTop","borderTop","textAlign","_SECTORS$stock$sector","marginLeft","isListed","Object","entries","filter","_ref1","_ref10","_Fragment","step","checked","htmlFor","minPrice","stockData","buyVolume","sellVolume","recentBuyVolume","recentSellVolume","volatility","StockExchange","user","userDoc","isAdmin","loading","authLoading","firebaseReady","optimisticUpdate","refreshUserDocument","useAuth","setClassCode","setStocks","setPortfolio","showAdminPanel","setShowAdminPanel","buyQuantities","setBuyQuantities","sellQuantities","setSellQuantities","isTrading","setIsTrading","lockTimers","setLockTimers","activeTab","setActiveTab","lastUpdated","setLastUpdated","isFetching","setIsFetching","marketOpen","setMarketOpen","vacationMode","setVacationMode","vacationLoading","setVacationLoading","cacheStatus","setCacheStatus","lastBatchLoad","setLastBatchLoad","lastFetchTimeRef","useRef","marketStatus","batchLoad","isFetchingRef","useEffect","checkMarketStatus","koreaTime","toLocaleString","timeZone","kstDay","getDay","kstTotalMinutes","getHours","getMinutes","isKoreaMarketOpen","usTime","usDay","usTotalMinutes","interval","setInterval","clearInterval","current","prevTimers","newTimers","fetchAllData","useCallback","timeSinceLastBatch","batchResult","uid","usePolling","enabled","deps","fetchVacationMode","isSuperAdmin","getVacationModeStatusFn","toggleVacationMode","toggleVacationModeFn","refreshStocksSnapshot","updateSnapshotFn","addStock","addStockFn","stockRef","setDoc","initialPrice","priceHistory","createdAt","serverTimestamp","holderCount","tradingVolume","innerError","deleteStock","stockId","stockName","deleteDoc","editStock","find","s","newPriceStr","prompt","toString","newPrice","updateDoc","slice","toggleManualStock","currentIsListed","action","updateData","batch","writeBatch","portfoliosToDelistQuery","collectionGroup","update","ref","commit","buyStock","quantityString","quantity","parseInt","cost","commission","taxAmount","totalCost","cash","buyStockFunction","newBalance","currentCash","cashDiff","prev","existingIndex","findIndex","h","existing","newQuantity","newAvgPrice","averagePrice","logActivity","userName","displayName","ACTIVITY_TYPES","STOCK_BUY","description","metadata","pricePerShare","sellStock","holdingId","_holding$lastBuyTime","canSellHolding","sellPrice","estimatedNetRevenue","sellStockFunction","actualSellPrice","actualCommission","totalTax","actualTax","actualProfit","netRevenue","STOCK_SELL","tax","taxInfo","deleteHolding","manualUpdateStockMarket","Error","manualUpdateFunction","createRealStocks","createRealStocksFunction","updateRealStocks","updateRealStocksFunction","addSingleRealStock","_ref11","addSingleRealStockFunction","deleteSimulationStocks","deleteSimulationStocksFunction","stocksMap","useMemo","portfolioStats","totalValue","totalInvested","investedValue","totalProfit","profitPercent","categoryCounts","counts","etfs","bonds","filteredStocks","showAllStocks","setShowAllStocks","displayedStocks","handleManualRefresh","justifyContent","toLocaleTimeString","_SECTORS$stock$sector2","priceChange","marginRight","min","isWorthless","currentValue","isLocked","flexDirection","fontFamily","boxShadow"],"sourceRoot":""}