"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[5635],{262(t,e,s){s.d(e,{A:()=>n});s(5043);var i=s(579);const n=()=>(0,i.jsxs)("div",{className:"login-warning",children:[(0,i.jsx)("h3",{children:"\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4"}),(0,i.jsx)("p",{children:"\uc544\uc774\ud15c\uc744 \uad6c\ub9e4\ud558\uac70\ub098 \uc0ac\uc6a9\ud558\ub824\uba74 \ub85c\uadf8\uc778\ud574\uc8fc\uc138\uc694."})]})},5635(t,e,s){s.r(e),s.d(e,{default:()=>v});var i=s(2555),n=s(5043),a=s(5016),o=s(8719),r=s(262),c=s(3216),l=s(5452),m=s(2864),d=s(579);const u=3e5,y=function(t){const e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:u)-(Date.now()-t);if(e<=0)return"\ub9cc\ub8cc\ub428";const s=Math.floor(e/36e5),i=Math.floor(e%36e5/6e4),n=Math.floor(e%6e4/1e3);let a="";return s>0&&(a+="".concat(s,"\uc2dc\uac04 ")),(i>0||s>0)&&(a+="".concat(i,"\ubd84 ")),a+="".concat(n,"\ucd08 \ub0a8\uc74c"),a.trim()},h=t=>{let{quantity:e}=t,s="";return s=e>10?"quantity-high":e>5?"quantity-medium":"quantity-low",(0,d.jsxs)("span",{className:"quantity-badge ".concat(s),children:["\xd7",e]})},p=()=>{const{user:t,userDoc:e,users:s,classmates:p}=(0,a.As)()||{},{userItems:v,useItem:f,listItemForSale:x,refreshData:I,updateLocalUserItems:g}=(0,o.wB)()||{userItems:[],useItem:null,listItemForSale:null,refreshData:null,updateLocalUserItems:null},j=(0,c.Zp)(),[b,N]=(0,n.useState)(null),M=(t,e)=>{N({type:t,message:e}),setTimeout(()=>N(null),3e3)},q=(0,n.useMemo)(()=>{if(!v||0===v.length)return[];const t=new Map;return v.forEach(e=>{if(!e||!e.itemId||"number"!==typeof e.quantity||e.quantity<=0)return;const s=e.itemId;if(t.has(s)){const i=t.get(s);i.totalQuantity+=e.quantity,i.sourceDocs.push(e),e.name&&!i.displayInfo.name&&(i.displayInfo.name=e.name),e.icon&&!i.displayInfo.icon&&(i.displayInfo.icon=e.icon),e.description&&!i.displayInfo.description&&(i.displayInfo.description=e.description)}else t.set(s,{displayInfo:{itemId:e.itemId,name:e.name||"\uc54c \uc218 \uc5c6\ub294 \uc544\uc774\ud15c",icon:e.icon||"\ud83d\udd2e",description:e.description||"",type:e.type||"general",price:e.price||0,durationMs:e.durationMs||u},totalQuantity:e.quantity,sourceDocs:[e]})}),Array.from(t.values()).sort((t,e)=>t.displayInfo.name.localeCompare(e.displayInfo.name))},[v]),[w,F]=(0,n.useState)(()=>{try{const e=localStorage.getItem("recentlyUsedItems_".concat((null===t||void 0===t?void 0:t.uid)||"guest"));return e?JSON.parse(e):{}}catch(e){return{}}});(0,n.useEffect)(()=>{null!==t&&void 0!==t&&t.uid&&localStorage.setItem("recentlyUsedItems_".concat(t.uid),JSON.stringify(w))},[w,null===t||void 0===t?void 0:t.uid]);const k=Object.keys(w).length>0;(0,n.useEffect)(()=>{if(!k)return;const t=setInterval(()=>{F(t=>{let e=!1;const s=(0,i.A)({},t),n=Date.now();return Object.keys(s).forEach(t=>{var i;const a=s[t],o=(null===(i=a.itemDetails)||void 0===i?void 0:i.durationMs)||u;n-a.usedTimestamp>o&&(delete s[t],e=!0)}),e?s:t})},1e3);return()=>clearInterval(t)},[k]);const[Q,C]=(0,n.useState)({isOpen:!1,item:null,quantity:1}),[A,O]=(0,n.useState)({isOpen:!1,item:null}),[D,E]=(0,n.useState)(""),[S,T]=(0,n.useState)(1),[U,W]=(0,n.useState)(!1),[_,G]=(0,n.useState)(!1),[J,L]=(0,n.useState)({isOpen:!1,item:null,quantity:1,price:0}),P=()=>{C({isOpen:!1,item:null,quantity:1})},R=()=>{O({isOpen:!1,item:null})},z=()=>{L({isOpen:!1,item:null,quantity:1,price:0})},Z=A.isOpen?A.item:null;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"page-container relative",children:[(0,d.jsx)("h2",{className:"page-title",children:"\ub0b4 \uc544\uc774\ud15c \uad00\ub9ac"}),!t&&(0,d.jsx)(r.A,{}),b&&(0,d.jsx)("div",{className:"notification bg-".concat(b.type,"-100"),children:b.message}),t&&(0,d.jsxs)(d.Fragment,{children:[Object.keys(w).length>0&&(0,d.jsxs)("div",{className:"content-card-section",children:[(0,d.jsx)("h3",{className:"section-title",children:"\uc0ac\uc6a9 \uc911\uc778 \uc544\uc774\ud15c"}),(0,d.jsx)("div",{className:"items-grid",children:Object.entries(w).map(t=>{let[e,s]=t;return(0,d.jsx)("div",{className:"store-item-card active-item-card",children:(0,d.jsxs)("div",{className:"item-content",children:[(0,d.jsxs)("div",{className:"my-item-header",children:[(0,d.jsx)("div",{className:"item-icon-group",children:(0,d.jsx)("div",{className:"item-icon",children:s.itemDetails.icon||"\u2728"})}),(0,d.jsxs)("div",{className:"item-info",children:[(0,d.jsx)("h3",{className:"item-name",children:s.itemDetails.name}),(0,d.jsx)("p",{className:"timer-text",children:y(s.usedTimestamp,s.itemDetails.durationMs)})]})]}),(0,d.jsx)("div",{className:"my-item-actions",children:(0,d.jsx)("button",{className:"stop-using-button",onClick:()=>(t=>{F(e=>{const s=(0,i.A)({},e);return delete s[t],s}),M("info","\uc544\uc774\ud15c \uc0ac\uc6a9\uc744 \uc911\uc9c0\ud588\uc2b5\ub2c8\ub2e4.")})(e),children:"\uc0ac\uc6a9 \uc911\uc9c0"})})]})},e)})})]}),(0,d.jsxs)("div",{className:"content-card-section",children:[(0,d.jsx)("h3",{className:"section-title",children:"\ubcf4\uc720 \uc544\uc774\ud15c"}),q.length>0?(0,d.jsx)("div",{className:"items-grid",children:q.map(e=>(0,d.jsx)("div",{className:"store-item-card compact-myitem-card",children:(0,d.jsxs)("div",{className:"item-content",children:[(0,d.jsxs)("div",{className:"my-item-header-compact",children:[(0,d.jsx)("h3",{className:"my-item-name-compact",children:e.displayInfo.name}),(0,d.jsx)(h,{quantity:e.totalQuantity})]}),e.displayInfo.description&&e.displayInfo.description.trim()&&(0,d.jsx)("p",{className:"my-item-description-compact",children:e.displayInfo.description}),(0,d.jsxs)("div",{className:"my-item-actions",children:[(0,d.jsx)("button",{className:"use-item-button",onClick:()=>{(e=>{t?!e||e.totalQuantity<=0?M("error","\uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc544\uc774\ud15c\uc774 \uc544\ub2d9\ub2c8\ub2e4."):C({isOpen:!0,item:e,quantity:1}):M("error","\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.")})(e)},disabled:_,children:"\uc0ac\uc6a9\ud558\uae30"}),(0,d.jsx)("button",{className:"gift-item-button",onClick:()=>{(e=>{t?p&&0!==p.length?!e||e.totalQuantity<=0?M("error","\uc120\ubb3c\ud560 \uc544\uc774\ud15c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."):(E(""),T(1),O({isOpen:!0,item:e})):M("error","\uc120\ubb3c\ud560 \uce5c\uad6c \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc62c \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."):M("error","\ub85c\uadf8\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.")})(e)},disabled:!p||0===p.length||_,children:_?"\ub3d9\uae30\ud654 \uc911":"\uc120\ubb3c\ud558\uae30"})]})]})},e.displayInfo.itemId))}):(0,d.jsx)("div",{className:"empty-message",children:(0,d.jsx)("p",{children:"\ubcf4\uc720 \uc911\uc778 \uc544\uc774\ud15c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})})]})]})]}),Q.isOpen&&Q.item&&(0,d.jsx)("div",{className:"myitems-modal-overlay",onClick:t=>{t.target===t.currentTarget&&P()},children:(0,d.jsxs)("div",{className:"myitems-modal-container",children:[(0,d.jsxs)("div",{className:"myitems-modal-header",children:[(0,d.jsxs)("h3",{children:[Q.item.displayInfo.name," \uc0ac\uc6a9\ud558\uae30"]}),(0,d.jsx)("button",{onClick:P,className:"myitems-close-button",children:"\u2715"})]}),(0,d.jsx)("div",{className:"myitems-modal-body",children:(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"useQuantity",children:["\uc0ac\uc6a9\ud560 \uc218\ub7c9: (\ucd5c\ub300 ",Q.item.totalQuantity,"\uac1c)"]}),(0,d.jsxs)("div",{className:"quantity-controls",children:[(0,d.jsx)("button",{onClick:()=>C(t=>(0,i.A)((0,i.A)({},t),{},{quantity:Math.max(1,t.quantity-1)})),disabled:Q.quantity<=1,children:"-"}),(0,d.jsx)("input",{id:"useQuantity",type:"number",min:"1",max:Q.item.totalQuantity,value:Q.quantity,onChange:t=>C(e=>(0,i.A)((0,i.A)({},e),{},{quantity:Math.max(1,Math.min(e.item.totalQuantity,parseInt(t.target.value)||1))}))}),(0,d.jsx)("button",{onClick:()=>C(t=>(0,i.A)((0,i.A)({},t),{},{quantity:Math.min(t.item.totalQuantity,t.quantity+1)})),disabled:Q.quantity>=Q.item.totalQuantity,children:"+"})]})]})}),(0,d.jsxs)("div",{className:"myitems-modal-footer",children:[(0,d.jsx)("button",{onClick:P,className:"button-secondary",children:"\ucde8\uc18c"}),(0,d.jsx)("button",{onClick:async()=>{const{item:t,quantity:e}=Q;if(!t||!e||e<=0)M("error","\uc0ac\uc6a9\ud560 \uc544\uc774\ud15c \uc815\ubcf4\uac00 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");else if(t.totalQuantity<e)M("error","\ubcf4\uc720 \uc218\ub7c9\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4.");else{M("success","".concat(t.displayInfo.name," ").concat(e,"\uac1c\ub97c \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4.")),P(),F(e=>(0,i.A)((0,i.A)({},e),{},{[t.displayInfo.itemId]:{usedTimestamp:Date.now(),itemDetails:{name:t.displayInfo.name,icon:t.displayInfo.icon,durationMs:t.displayInfo.durationMs||u}}}));try{let s=e;const i=[...t.sourceDocs].sort((t,e)=>t.quantity-e.quantity);for(const t of i){if(s<=0)break;const e=Math.min(t.quantity,s),i=await f(t.id,e);if(!i.success)throw new Error(i.message||"\uc544\uc774\ud15c \uc0ac\uc6a9\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4 (".concat(t.id,")"));s-=e}if(s>0)throw new Error("\uc694\uccad\ud55c \uc218\ub7c9\uc744 \ubaa8\ub450 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. (\ubd80\uc871\ud55c \uc218\ub7c9: ".concat(s,")"))}catch(s){M("error","\uc544\uc774\ud15c \uc0ac\uc6a9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(s.message)),F(e=>{const s=(0,i.A)({},e);return delete s[t.displayInfo.itemId],s})}}},className:"button-primary",children:"\uc0ac\uc6a9\ud558\uae30"})]})]})}),A.isOpen&&Z&&(0,d.jsx)("div",{className:"myitems-modal-overlay",onClick:t=>{t.target===t.currentTarget&&R()},children:(0,d.jsxs)("div",{className:"myitems-modal-container",children:[(0,d.jsxs)("div",{className:"myitems-modal-header",children:[(0,d.jsxs)("h3",{children:[Z.displayInfo.name||"\uc544\uc774\ud15c"," \uc120\ubb3c\ud558\uae30"]}),(0,d.jsx)("button",{onClick:R,className:"myitems-close-button",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"myitems-modal-body",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"giftRecipient",children:"\uc120\ubb3c \ubc1b\uc744 \uce5c\uad6c:"}),(0,d.jsxs)("select",{id:"giftRecipient",value:D,onChange:t=>E(t.target.value),className:"form-select",children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"-- \uce5c\uad6c\ub97c \uc120\ud0dd\ud558\uc138\uc694 --"}),p.map(t=>(0,d.jsxs)("option",{value:t.uid||t.id,children:[t.name," (",t.nickname,")"]},t.uid||t.id))]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"giftQuantity",children:["\uc120\ubb3c\ud560 \uc218\ub7c9: (\ucd5c\ub300 ",Z.totalQuantity,"\uac1c)"]}),(0,d.jsxs)("div",{className:"quantity-controls",children:[(0,d.jsx)("button",{onClick:()=>T(t=>Math.max(1,t-1)),disabled:S<=1,children:"-"}),(0,d.jsx)("input",{id:"giftQuantity",type:"number",min:"1",max:Z.totalQuantity,value:S,onChange:t=>T(Math.max(1,Math.min(Z.totalQuantity,parseInt(t.target.value)||1)))}),(0,d.jsx)("button",{onClick:()=>T(t=>Math.min(Z.totalQuantity,t+1)),disabled:S>=Z.totalQuantity,children:"+"})]})]})]}),(0,d.jsxs)("div",{className:"myitems-modal-footer",children:[(0,d.jsx)("button",{onClick:R,className:"button-secondary",children:"\ucde8\uc18c"}),(0,d.jsx)("button",{onClick:async()=>{if(U)return;const{item:s}=A;if(!t||!D||!s)return l.vF.error("[MyItems] \uc120\ubb3c \uc815\ubcf4 \uc624\ub958:",{user:!!t,giftRecipientUid:D,group:!!s}),void M("error","\uc120\ubb3c \uc815\ubcf4\uac00 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");const n=Number(S)||1;if(n<=0||n>s.totalQuantity)return l.vF.error("[MyItems] \uc120\ubb3c \uc218\ub7c9 \uc624\ub958:",{quantity:n,totalQuantity:s.totalQuantity}),void M("error","\uc120\ubb3c \uc218\ub7c9\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");const a=p.find(t=>(t.uid||t.id)===D),o=a?a.name:"\uc54c \uc218 \uc5c6\ub294 \uc0ac\uc6a9\uc790";let r;l.vF.log("[MyItems] \uc120\ubb3c \uc2dc\uc791:",{"\uc544\uc774\ud15c":s.displayInfo.name,"\uc218\ub7c9":n,"\ubcf4\ub0b4\ub294\uc0ac\ub78c":(null===e||void 0===e?void 0:e.name)||t.uid,"\ubc1b\ub294\uc0ac\ub78c":o,"\ubc1b\ub294\uc0ac\ub78cUID":D}),W(!0);try{const e=(0,m.rJ)(m.db,"users",t.uid,"inventory"),a=await(0,m.GG)(e),c=a.docs.map(t=>({id:t.id,itemId:t.data().itemId,name:t.data().name,quantity:t.data().quantity}));l.vF.log("[MyItems] \ud83d\udd0d \uc2e4\uc81c inventory \uceec\ub809\uc158 \uc804\uccb4 \uc870\ud68c:"),l.vF.log("\ucd1d\ubb38\uc11c\uc218:",a.size),l.vF.log("\ubb38\uc11c\ub4e4:",c);const d={};c.forEach(t=>{const e=t.itemId||t.id;d[e]||(d[e]=[]),d[e].push(t.id)}),l.vF.log("[MyItems] itemId\ubcc4 \uadf8\ub8f9:",d);const u=s.sourceDocs.map(t=>t.id);l.vF.log("[MyItems] \uce90\uc2dc\ub41c \ubb38\uc11c ID \ubaa9\ub85d:",u);const y=[];let h=0;for(const s of u){const e=(0,m.EW)(m.db,"users",t.uid,"inventory",s),n=await(0,m.x7)(e);if(n.exists()){const t=n.data();y.push((0,i.A)({id:n.id},t)),h+=t.quantity||0,l.vF.log("[MyItems] \u2705 \ubb38\uc11c \ubc1c\uacac:",{id:n.id,quantity:t.quantity})}else l.vF.warn("[MyItems] \u26a0\ufe0f \ubb38\uc11c \uc5c6\uc74c:",s)}if(l.vF.log("[MyItems] \ubcf4\ub0b4\ub294 \uc0ac\ub78c \uc778\ubca4\ud1a0\ub9ac \uc2e4\uc81c \uc870\ud68c \uc644\ub8cc:",{"\uce90\uc2dc\ubb38\uc11c\uc218":s.sourceDocs.length,"\uc2e4\uc81c\ubb38\uc11c\uc218":y.length,"\uc2e4\uc81c\ucd1d\uc218\ub7c9":h}),0===y.length)throw new Error("\ubcf4\uc720 \uc911\uc778 \uc544\uc774\ud15c\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ud398\uc774\uc9c0\ub97c \uc0c8\ub85c\uace0\uce68\ud574\uc8fc\uc138\uc694.");if(h<n)throw new Error("\uc544\uc774\ud15c \uc218\ub7c9\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. (\ud544\uc694: ".concat(n,", \uc2e4\uc81c \ubcf4\uc720: ").concat(h,")"));const p=(0,m.rJ)(m.db,"users",D,"inventory"),f=(0,m.P)(p,(0,m._M)("itemId","==",s.displayInfo.itemId)),x=await(0,m.GG)(f),j=x.empty?null:x.docs[0].ref;l.vF.log("[MyItems] \ubc1b\ub294 \uc0ac\ub78c \uc778\ubca4\ud1a0\ub9ac \uc870\ud68c (\ud2b8\ub79c\uc7ad\uc158 \uc678\ubd80):",{"\uae30\uc874\uc544\uc774\ud15c\uc874\uc7ac":!x.empty,"\ubb38\uc11c\uc218":x.size}),r=[...v];const b=[];let N=n;for(const t of v)if(t.itemId===s.displayInfo.itemId&&N>0){const e=Math.min(t.quantity,N),s=t.quantity-e;s>0&&b.push((0,i.A)((0,i.A)({},t),{},{quantity:s})),N-=e}else b.push(t);g&&g(b),await(0,m.c4)(m.db,async e=>{const i=[];for(const s of y){const n=(0,m.EW)(m.db,"users",t.uid,"inventory",s.id),a=await e.get(n);if(!a.exists())throw l.vF.error("[MyItems] \u274c \ud2b8\ub79c\uc7ad\uc158 \uc911 \uc544\uc774\ud15c \ubb38\uc11c\uac00 \uc0ac\ub77c\uc9d0:",s.id),new Error("\ud2b8\ub79c\uc7ad\uc158 \uc911 \uc544\uc774\ud15c\uc774 \uc0ac\ub77c\uc84c\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.");const o=a.data().quantity||0;if(o<=0)throw l.vF.error("[MyItems] \u274c \ud2b8\ub79c\uc7ad\uc158 \uc911 \uc544\uc774\ud15c \uc218\ub7c9\uc774 0:",s.id),new Error("\ud2b8\ub79c\uc7ad\uc158 \uc911 \uc544\uc774\ud15c \uc218\ub7c9\uc774 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.");i.push({ref:n,snap:a,quantity:o})}let a=null,o=0;if(j){a=j;const t=await e.get(a);t.exists()?(o=t.data().quantity||0,l.vF.log("[MyItems] \ubc1b\ub294 \uc0ac\ub78c \uae30\uc874 \uc544\uc774\ud15c \ubc1c\uacac:",{"\ubb38\uc11cID":a.id,"\ud604\uc7ac\uc218\ub7c9":o})):(l.vF.warn("[MyItems] \u26a0\ufe0f \ubc1b\ub294 \uc0ac\ub78c\uc758 \uae30\uc874 \uc544\uc774\ud15c\uc774 \uc0ac\ub77c\uc9d0, \uc0c8\ub85c \uc0dd\uc131\ud569\ub2c8\ub2e4."),a=null)}else l.vF.log("[MyItems] \ubc1b\ub294 \uc0ac\ub78c\uc5d0\uac8c \uc0c8 \uc544\uc774\ud15c \uc0dd\uc131 \uc608\uc815");let r=n,c=0;for(const{ref:t,quantity:s}of i){if(r<=0)break;const i=Math.min(s,r),n=s-i;l.vF.log("[MyItems] \uc544\uc774\ud15c \ucc28\uac10:",{"\ubb38\uc11cID":t.id,"\uae30\uc874\uc218\ub7c9":s,"\ucc28\uac10\uc218\ub7c9":i,"\ub0a8\uc740\uc218\ub7c9":n}),n<=0?e.delete(t):e.update(t,{quantity:n}),r-=i,c+=i}if(c<n)throw l.vF.error("[MyItems] \ucc98\ub9ac\ub41c \uc218\ub7c9 \ubd80\uc871:",{"\uc694\uccad":n,"\ucc98\ub9ac\ub428":c}),new Error("\uc544\uc774\ud15c \uc218\ub7c9\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. (\ud544\uc694: ".concat(n,", \uc2e4\uc81c \ubcf4\uc720: ").concat(c,")"));if(a)l.vF.log("[MyItems] \ubc1b\ub294 \uc0ac\ub78c \uc544\uc774\ud15c \uc5c5\ub370\uc774\ud2b8 (\uae30\uc874 \uc544\uc774\ud15c\uc5d0 \ucd94\uac00):",{"\uae30\uc874\uc218\ub7c9":o,"\ucd94\uac00\uc218\ub7c9":c,"\ucd5c\uc885\uc218\ub7c9":o+c}),e.update(a,{quantity:o+c,updatedAt:(0,m.O5)()});else{l.vF.log("[MyItems] \ubc1b\ub294 \uc0ac\ub78c \uc544\uc774\ud15c \uc0dd\uc131 (\uc0c8 \uc544\uc774\ud15c):",{"\uc218\ub7c9":c});const t=(0,m.EW)(p);e.set(t,{itemId:s.displayInfo.itemId,name:s.displayInfo.name,icon:s.displayInfo.icon,description:s.displayInfo.description,type:s.displayInfo.type,quantity:c,receivedAt:(0,m.O5)(),updatedAt:(0,m.O5)()})}}),l.vF.log("[MyItems] \u2705 \uc120\ubb3c \ud2b8\ub79c\uc7ad\uc158 \uc644\ub8cc"),M("success","".concat(o,"\ub2d8\uc5d0\uac8c ").concat(s.displayInfo.name," ").concat(n,"\uac1c\ub97c \uc120\ubb3c\ud588\uc2b5\ub2c8\ub2e4.")),R(),setTimeout(()=>{I&&I()},2e3)}catch(c){if(l.vF.error("[MyItems] \uc120\ubb3c\ud558\uae30 \uc2e4\ud328:",c),g&&r&&(l.vF.log("[MyItems] \ub099\uad00\uc801 \uc5c5\ub370\uc774\ud2b8 \ub864\ubc31 - \uc6d0\ub798 \uc0c1\ud0dc\ub85c \ubcf5\uc6d0"),g(r)),M("error","\uc120\ubb3c\ud558\uae30 \uc2e4\ud328: ".concat(c.message)),I){l.vF.log("[MyItems] \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc2dc\uc791");try{const t=I();t&&"function"===typeof t.then&&await t,l.vF.log("[MyItems] \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc644\ub8cc")}catch(d){l.vF.error("[MyItems] \ub370\uc774\ud130 \uc0c8\ub85c\uace0\uce68 \uc2e4\ud328:",d)}}}finally{W(!1)}},className:"button-primary",disabled:U||_,children:U?"\uc120\ubb3c\ud558\ub294 \uc911...":_?"\ub3d9\uae30\ud654 \uc911...":"\uc120\ubb3c\ud558\uae30"})]})]})}),J.isOpen&&J.item&&(0,d.jsx)("div",{className:"myitems-modal-overlay",onClick:t=>{t.target===t.currentTarget&&z()},children:(0,d.jsxs)("div",{className:"myitems-modal-container",children:[(0,d.jsxs)("div",{className:"myitems-modal-header",children:[(0,d.jsxs)("h3",{children:["'",J.item.displayInfo.name,"' \uc2dc\uc7a5\uc5d0 \ud310\ub9e4\ud558\uae30"]}),(0,d.jsx)("button",{onClick:z,className:"myitems-close-button",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"myitems-modal-body",children:[(0,d.jsxs)("div",{className:"item-preview-simple",children:[(0,d.jsx)("span",{className:"item-icon-small",children:J.item.displayInfo.icon}),(0,d.jsxs)("span",{children:[J.item.displayInfo.name," (\ubcf4\uc720:"," ",J.item.totalQuantity,"\uac1c)"]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"sellToMarketQuantity",children:["\ud310\ub9e4 \uc218\ub7c9 (\ucd5c\ub300: ",J.item.totalQuantity,"\uac1c):"]}),(0,d.jsx)("input",{type:"number",id:"sellToMarketQuantity",value:J.quantity,onChange:t=>(t=>{var e;const s=(null===(e=J.item)||void 0===e?void 0:e.totalQuantity)||1,n=Math.max(1,Math.min(s,parseInt(t)||1));L(t=>(0,i.A)((0,i.A)({},t),{},{quantity:n}))})(t.target.value),min:"1",max:J.item.totalQuantity})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"sellToMarketPrice",children:"\uac1c\ub2f9 \ud310\ub9e4 \uac00\uaca9 (\uc6d0):"}),(0,d.jsx)("input",{type:"number",id:"sellToMarketPrice",value:J.price,onChange:t=>(t=>{const e=Math.max(1,parseInt(t)||1);L(t=>(0,i.A)((0,i.A)({},t),{},{price:e}))})(t.target.value),min:"1"})]}),(0,d.jsxs)("div",{className:"total-price-preview",children:["\uc608\uc0c1 \ud310\ub9e4 \ucd1d\uc561:"," ",(0,d.jsxs)("strong",{children:[(J.price*J.quantity).toLocaleString(),"\uc6d0"]})]})]}),(0,d.jsxs)("div",{className:"myitems-modal-footer",children:[(0,d.jsx)("button",{onClick:z,className:"button-secondary",children:"\ucde8\uc18c"}),(0,d.jsx)("button",{onClick:async()=>{const{item:e,quantity:s,price:n}=J;if(e&&s&&n)try{const a=e.sourceDocs.map(t=>t.id),o=[];let r=0;for(const e of a){const s=(0,m.EW)(m.db,"users",t.uid,"inventory",e),n=await(0,m.x7)(s);if(n.exists()){const t=n.data();o.push((0,i.A)({id:n.id},t)),r+=t.quantity||0}}if(l.vF.log("[MyItems] \uc2dc\uc7a5\uc5d0 \ud314\uae30 - \uc2e4\uc81c \uc870\ud68c:",{"\uc694\uccad\uc218\ub7c9":s,"\uc2e4\uc81c\ubcf4\uc720":r,"\ubb38\uc11c\uc218":o.length}),0===o.length)throw new Error("\ud310\ub9e4\ud560 \uc544\uc774\ud15c\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ud398\uc774\uc9c0\ub97c \uc0c8\ub85c\uace0\uce68\ud574\uc8fc\uc138\uc694.");if(r<s)throw new Error("\uc544\uc774\ud15c \uc218\ub7c9\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. (\ud544\uc694: ".concat(s,", \uc2e4\uc81c \ubcf4\uc720: ").concat(r,")"));let c=s;const d=[...o].sort((t,e)=>t.quantity-e.quantity);for(const e of d){if(c<=0)break;const s=Math.min(e.quantity,c),i={};if(void 0===e.description&&(l.vF.warn("[MyItems] \ub204\ub77d\ub41c description \ud544\ub4dc \uc218\uc815: ".concat(e.id)),i.description=""),void 0===e.icon&&(l.vF.warn("[MyItems] \ub204\ub77d\ub41c icon \ud544\ub4dc \uc218\uc815: ".concat(e.id)),i.icon="\ud83d\udd2e"),void 0===e.type&&(l.vF.warn("[MyItems] \ub204\ub77d\ub41c type \ud544\ub4dc \uc218\uc815: ".concat(e.id)),i.type="general"),Object.keys(i).length>0){const s=(0,m.EW)(m.db,"users",t.uid,"inventory",e.id);await(0,m.mZ)(s,i),Object.assign(e,i)}const a=await x({itemId:e.id,quantity:s,price:n});if(!a.success)throw new Error(a.message||"\uc77c\ubd80 \uc544\uc774\ud15c \ud310\ub9e4 \ub4f1\ub85d\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.");c-=s}M("success","".concat(e.displayInfo.name," ").concat(s,"\uac1c\ub97c \uc2dc\uc7a5\uc5d0 \ud310\ub9e4 \ub4f1\ub85d\ud588\uc2b5\ub2c8\ub2e4.")),z(),setTimeout(()=>{window.confirm("\uc544\uc774\ud15c \uc2dc\uc7a5\uc73c\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?")&&j("/item-market")},500)}catch(a){l.vF.error("[MyItems] \uc2dc\uc7a5 \ud310\ub9e4 \ub4f1\ub85d \uc2e4\ud328:",a),a.message.includes("\uc544\uc774\ud15c\uc744 \ucc3e\uc744 \uc218 \uc5c6")||a.message.includes("\uc218\ub7c9\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4")?(M("warning","\uc544\uc774\ud15c \uc815\ubcf4\uac00 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ub370\uc774\ud130\ub97c \ub3d9\uae30\ud654\ud569\ub2c8\ub2e4."),G(!0),I?I().then(()=>{M("success","\ub3d9\uae30\ud654\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."),G(!1)}).catch(t=>{l.vF.error("[MyItems] \ub370\uc774\ud130 \ub3d9\uae30\ud654 \uc2e4\ud328:",t),M("error","\ub370\uc774\ud130 \ub3d9\uae30\ud654\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),G(!1)}):(M("error","\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc73c\uba70 \ub370\uc774\ud130\ub97c \uc0c8\ub85c\uace0\uce60 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4: ".concat(a.message)),G(!1))):M("error","\uc2dc\uc7a5 \ud310\ub9e4 \ub4f1\ub85d \uc911 \uc624\ub958: ".concat(a.message))}else M("error","\ud310\ub9e4 \uc815\ubcf4\uac00 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")},className:"button-primary sell-button",disabled:_,children:_?"\ub3d9\uae30\ud654 \uc911...":"\ud310\ub9e4 \ub4f1\ub85d"})]})]})})]})},v=n.memo(p)}}]);
//# sourceMappingURL=5635.f5084b45.chunk.js.map