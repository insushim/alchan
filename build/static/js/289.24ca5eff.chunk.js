"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[289],{7262(e,a,t){t(2555),t(2419),t(5472),t(3744),t(5452)},8289(e,a,t){t.r(a),t.d(a,{default:()=>d});var n=t(2555),s=t(5043),c=t(5016),o=t(2419);t(7262);const r=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{min:t=0,max:n=Number.MAX_SAFE_INTEGER,allowZero:s=!1,fieldName:c="\uae08\uc561"}=a,o=Number(e);if(isNaN(o))throw new Error("".concat(c,"\ub294 \uc720\ud6a8\ud55c \uc22b\uc790\uc5ec\uc57c \ud569\ub2c8\ub2e4."));if(!isFinite(o))throw new Error("".concat(c,"\ub294 \uc720\ud55c\ud55c \uc22b\uc790\uc5ec\uc57c \ud569\ub2c8\ub2e4."));if(o<0)throw new Error("".concat(c,"\ub294 \uc74c\uc218\uc77c \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));if(!s&&0===o)throw new Error("".concat(c,"\ub294 0\ubcf4\ub2e4 \ucee4\uc57c \ud569\ub2c8\ub2e4."));if(o<t)throw new Error("".concat(c,"\ub294 \ucd5c\uc18c ").concat(t.toLocaleString(),"\uc6d0 \uc774\uc0c1\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4."));if(o>n)throw new Error("".concat(c,"\ub294 \ucd5c\ub300 ").concat(n.toLocaleString(),"\uc6d0\uc744 \ucd08\uacfc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));return Math.floor(o)};var i=t(5452);var l=t(579);const d=function(){const{userDoc:e,allClassMembers:a,loading:t,setUserDoc:d,setAllClassMembers:m}=(0,c.As)(),[u,h]=(0,s.useState)([]),[x,p]=(0,s.useState)(""),[N,g]=(0,s.useState)("fixed"),[j,v]=(0,s.useState)("send"),[f,b]=(0,s.useState)("toMe"),[k,S]=(0,s.useState)(10),[y,w]=(0,s.useState)(""),[C,M]=(0,s.useState)(""),[L,A]=(0,s.useState)(!1),[E,F]=(0,s.useState)(!1),T=null===e||void 0===e?void 0:e.name,_=null===e||void 0===e?void 0:e.classCode,R=(0,s.useMemo)(()=>a&&0!==a.length?[...a].sort((e,a)=>{const t=e.name||e.nickname||"",n=a.name||a.nickname||"";return t.localeCompare(n,"ko")}):[],[a]);(0,s.useEffect)(()=>{h([]),A(!1)},[j,N]);const D=(0,s.useCallback)(function(e,a){let t,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t="percentage"===N?Math.floor(e*Number(a)/100):Number(a),n&&"send"===j){return t-Math.floor(t*k/100)}return t},[N,j,k]),H=(0,s.useMemo)(()=>{if(!x||0===u.length)return{};const e={};return u.forEach(a=>{const t=R.find(e=>e.id===a);if(t){const n=Number(t.cash||0),s="send"===j;e[a]=D(n,x,s)}}),e},[u,x,j,R,D]);return(0,l.jsxs)("div",{className:"money-transfer-container",children:[(0,l.jsx)("div",{className:"header",children:(0,l.jsxs)("div",{className:"admin-info",children:[(0,l.jsx)("span",{className:"admin-label",children:"\uad00\ub9ac\uc790"}),(0,l.jsx)("span",{className:"admin-name",children:T||"\ub85c\ub529 \uc911..."}),(0,l.jsxs)("span",{className:"admin-cash",children:["\ud604\uae08: ",((null===e||void 0===e?void 0:e.cash)||0).toLocaleString(),"\uc6d0"]})]})}),C&&(0,l.jsx)("div",{className:"alert alert-error",children:C}),y&&(0,l.jsx)("div",{className:"alert alert-success",children:y}),(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0===u.length||!x||isNaN(Number(x)))return void M("\uc0ac\uc6a9\uc790\ub97c \uc120\ud0dd\ud558\uace0 \uc720\ud6a8\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694.");const a=Number(x);if(a<=0)M("".concat("percentage"===N?"\ud37c\uc13c\ud2b8":"\uae08\uc561","\uc740 0\ubcf4\ub2e4 \ucee4\uc57c \ud569\ub2c8\ub2e4."));else if("percentage"===N&&(a>100||a<0))M("\ud37c\uc13c\ud2b8\ub294 0\uacfc 100 \uc0ac\uc774\uc758 \uac12\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.");else{F(!0),w(""),M("");try{const e=R.filter(e=>u.includes(e.id)),{count:t,totalProcessed:s,updatedUsers:c}=await(async e=>{let{adminName:a,adminClassCode:t,targetUsers:n,action:s,takeMode:c,amountType:l,amount:d,taxRate:m}=e;i.vF.log("[database.js] adminCashAction \uc2dc\uc791:",{adminName:a,action:s,takeMode:c,amountType:l,amount:d,taxRate:m,targetUsersCount:n.length});try{if("percentage"===l){if(d<0||d>100)throw new Error("\ud37c\uc13c\ud2b8\ub294 0\uacfc 100 \uc0ac\uc774\uc758 \uac12\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.")}else r(d,{min:1,fieldName:"\uae08\uc561"})}catch(C){throw new Error("\uc785\ub825 \uac80\uc99d \uc2e4\ud328: ".concat(C.message))}const u=[];let h=0,x=0;for(const N of n)try{await(0,o.c4)(o.db,async e=>{const n=(0,o.H9)(o.db,"users",N.id),p=await e.get(n);if(!p.exists())throw new Error("\uc0ac\uc6a9\uc790 ".concat(N.name,"\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));const g=p.data(),j=Number(g.cash||0);let v;if(v="percentage"===l?Math.floor(j*d/100):r(d,{min:1,fieldName:"\uae08\uc561"}),v<=0)return void i.vF.log("[database.js] ".concat(N.name,": \ucc98\ub9ac\ud560 \uae08\uc561\uc774 0\uc6d0\uc774\ubbc0\ub85c \uc2a4\ud0b5"));let f,b=v,k=0;if("send"===s&&m>0&&(k=Math.floor(v*m/100),b=v-k),"send"===s)f=j+b;else{if(j<v)throw new Error("".concat(N.name,"\ub2d8\uc758 \uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. (\ubcf4\uc720: ").concat(j.toLocaleString(),"\uc6d0, \ud544\uc694: ").concat(v.toLocaleString(),"\uc6d0)"));f=j-v}e.update(n,{cash:f,updatedAt:(0,o.O5)()});const S=(0,o.H9)((0,o.rJ)(o.db,"activity_logs"));let y,w;"send"===s?(y="ADMIN_CASH_SEND","percentage"===l?(w="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc5d0\uac8c ").concat(d,"% (").concat(b.toLocaleString(),"\uc6d0)\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),k>0&&(w+=" (\uc6d0\uae08 ".concat(v.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(k.toLocaleString(),"\uc6d0 \uc81c\uc678)"))):(w="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc5d0\uac8c ").concat(b.toLocaleString(),"\uc6d0\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),k>0&&(w+=" (\uc6d0\uae08 ".concat(v.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(k.toLocaleString(),"\uc6d0 \uc81c\uc678)")))):"take"===s&&("remove"===c?(y="ADMIN_CASH_REMOVE",w="percentage"===l?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc758 ").concat(d,"% (").concat(v.toLocaleString(),"\uc6d0)\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc758 ").concat(v.toLocaleString(),"\uc6d0\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4.")):(y="ADMIN_CASH_TAKE",w="percentage"===l?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(d,"% (").concat(v.toLocaleString(),"\uc6d0)\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(v.toLocaleString(),"\uc6d0\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4.")));const C={userId:N.id,userName:N.name,timestamp:(0,o.O5)(),type:y,description:w,classCode:t,metadata:{adminName:a,action:s,amountType:l,inputValue:d,taxRate:"send"===s?m:0,baseAmount:v,taxAmount:k,finalAmount:b,previousCash:j,newCash:f}};e.set(S,C);const M=(0,o.H9)((0,o.rJ)(o.db,"transactions")),L={userId:N.id,amount:"send"===s?b:-v,type:"send"===s?"income":"expense",category:"admin",description:"send"===s?"\uad00\ub9ac\uc790 \uc9c0\uae09":"\uad00\ub9ac\uc790 \ud68c\uc218",timestamp:(0,o.O5)(),metadata:{adminName:a,amountType:l,taxRate:"send"===s?m:0}};e.set(M,L),u.push({id:N.id,newCash:f}),h+=v,x++,i.vF.log("[database.js] ".concat(N.name," \ud2b8\ub79c\uc7ad\uc158 \ucc98\ub9ac \uc644\ub8cc:"),{"\ud604\uc7ac\uc794\uc561":j,"\uae30\ubcf8\uae08\uc561":v,"\uc138\uae08":k,"\ucd5c\uc885\uae08\uc561":b,"\uc0c8\uc794\uc561":f})})}catch(p){throw i.vF.error("[database.js] \uc0ac\uc6a9\uc790 ".concat(N.name," \ucc98\ub9ac \uc911 \uc624\ub958:"),p),new Error("".concat(N.name,"\ub2d8 \ucc98\ub9ac \uc2e4\ud328: ").concat(p.message))}return i.vF.log("[database.js] adminCashAction \uc644\ub8cc: ".concat(x,"\uba85 \ucc98\ub9ac, \ucd1d ").concat(h.toLocaleString(),"\uc6d0")),{count:x,totalProcessed:h,updatedUsers:u}})({adminName:T,adminClassCode:_,targetUsers:e,action:j,takeMode:"take"===j?f:void 0,amountType:N,amount:a,taxRate:k});c&&c.length>0&&(m(e=>e.map(e=>{const a=c.find(a=>a.id===e.id);return a?(0,n.A)((0,n.A)({},e),{},{cash:a.newCash}):e})),d(e=>{const a=Number(e.cash||0);let t;return t="send"===j?a-s:"take"===j&&"toMe"===f?a+s:a,(0,n.A)((0,n.A)({},e),{},{cash:t})}));const l="send"===j?"\ubcf4\ub0b4\uae30":"toMe"===f?"\uac00\uc838\uc624\uae30":"\uc5c6\uc560\uae30";w("".concat(t,"\uba85\uc5d0\uac8c ").concat("percentage"===N?"".concat(a,"%"):"".concat(a.toLocaleString(),"\uc6d0")," ").concat(l," \uc644\ub8cc! (\ucd1d ").concat(s.toLocaleString(),"\uc6d0 \ucc98\ub9ac").concat("send"===j&&k>0?", \uc138\uae08 ".concat(k,"% \uc801\uc6a9"):"",")")),p(""),h([]),A(!1),setTimeout(()=>w(""),3e3)}catch(t){i.vF.error("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd:",t),M("\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(t.message)),setTimeout(()=>M(""),5e3)}finally{F(!1)}}},className:"transfer-form",children:[(0,l.jsxs)("div",{className:"action-selector",children:[(0,l.jsxs)("button",{type:"button",className:"action-btn ".concat("send"===j?"active send":""),onClick:()=>v("send"),children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\udce4"})," \ubcf4\ub0b4\uae30"]}),(0,l.jsxs)("button",{type:"button",className:"action-btn ".concat("take"===j?"active take":""),onClick:()=>v("take"),children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\udce5"})," \uac00\uc838\uc624\uae30"]})]}),"take"===j&&(0,l.jsxs)("div",{className:"take-mode-section",children:[(0,l.jsx)("h4",{children:"\uac00\uc838\uc624\uae30 \uc635\uc158"}),(0,l.jsxs)("div",{className:"take-mode-selector",children:[(0,l.jsxs)("label",{className:"mode-option ".concat("toMe"===f?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"takeMode",value:"toMe",checked:"toMe"===f,onChange:e=>b(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"}),(0,l.jsxs)("span",{className:"mode-text",children:[(0,l.jsx)("strong",{children:"\ud83d\udcb0 \ub098\uc5d0\uac8c \uac00\uc838\uc624\uae30"}),(0,l.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \ub0b4 \uacc4\uc88c\ub85c \uac00\uc838\uc635\ub2c8\ub2e4"})]})]}),(0,l.jsxs)("label",{className:"mode-option ".concat("remove"===f?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"takeMode",value:"remove",checked:"remove"===f,onChange:e=>b(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"}),(0,l.jsxs)("span",{className:"mode-text",children:[(0,l.jsx)("strong",{children:"\ud83d\uddd1\ufe0f \ub3c8 \uc5c6\uc560\uae30"}),(0,l.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \uc601\uad6c\uc801\uc73c\ub85c \uc81c\uac70\ud569\ub2c8\ub2e4"})]})]})]})]}),(0,l.jsxs)("div",{className:"amount-section",children:[(0,l.jsxs)("div",{className:"amount-type-selector",children:[(0,l.jsxs)("label",{className:"type-option ".concat("fixed"===N?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"amountType",value:"fixed",checked:"fixed"===N,onChange:e=>g(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"})," \uace0\uc815 \uae08\uc561"]}),(0,l.jsxs)("label",{className:"type-option ".concat("percentage"===N?"active":""),children:[(0,l.jsx)("input",{type:"radio",name:"amountType",value:"percentage",checked:"percentage"===N,onChange:e=>g(e.target.value)}),(0,l.jsx)("span",{className:"radio-custom"})," \ud37c\uc13c\ud2b8 (%)"]})]}),(0,l.jsxs)("div",{className:"amount-input-group",children:[(0,l.jsx)("input",{type:"number",value:x,onChange:e=>p(e.target.value),placeholder:"fixed"===N?"\uae08\uc561 \uc785\ub825":"\ud37c\uc13c\ud2b8 \uc785\ub825",min:"1",max:"percentage"===N?"100":void 0,required:!0,className:"amount-input"}),(0,l.jsx)("span",{className:"amount-unit",children:"fixed"===N?"\uc6d0":"%"})]})]}),"send"===j&&(0,l.jsxs)("div",{className:"tax-section",children:[(0,l.jsxs)("div",{className:"tax-header",children:[(0,l.jsx)("h4",{children:"\ud83d\udcb8 \uc138\uae08 \uc124\uc815"}),(0,l.jsx)("span",{className:"tax-description",children:"\ubcf4\ub0b4\ub294 \uae08\uc561\uc5d0\uc11c \uc138\uae08\uc744 \uc81c\uc678\ud558\uace0 \uc9c0\uae09\ub429\ub2c8\ub2e4."})]}),(0,l.jsxs)("div",{className:"tax-input-group",children:[(0,l.jsx)("label",{htmlFor:"taxRate",children:"\uc138\uae08\uc728:"}),(0,l.jsx)("input",{type:"number",id:"taxRate",value:k,onChange:e=>S(Math.max(0,Math.min(100,Number(e.target.value)))),min:"0",max:"100",className:"tax-input"}),(0,l.jsx)("span",{className:"tax-unit",children:"%"})]}),x&&(0,l.jsx)("div",{className:"tax-preview",children:"fixed"===N?(0,l.jsxs)(l.Fragment,{children:["\uc2e4\uc81c \uc9c0\uae09\uc561: ",D(0,x,!0).toLocaleString(),"\uc6d0 (\uc138\uae08 ",Math.floor(Number(x)*k/100).toLocaleString(),"\uc6d0 \uc81c\uc678)"]}):"\uac01 \ud559\uc0dd \uc794\uc561\uc758 ".concat(x,"%\uc5d0\uc11c \uc138\uae08 ").concat(k,"%\uac00 \ucd94\uac00\ub85c \ucc28\uac10\ub429\ub2c8\ub2e4.")})]}),(0,l.jsxs)("div",{className:"user-selection-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("h3",{children:"\ub300\uc0c1 \uc120\ud0dd"}),(0,l.jsxs)("label",{className:"select-all-label",children:[(0,l.jsx)("input",{type:"checkbox",checked:L,onChange:()=>{A(e=>{const a=!e;return h(a?R.map(e=>e.id):[]),a})},className:"checkbox-custom"}),(0,l.jsx)("span",{className:"checkmark"})," \uc804\uccb4 \uc120\ud0dd"]})]}),t&&0===R.length?(0,l.jsx)("div",{className:"loading",children:"\uc0ac\uc6a9\uc790 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."}):(0,l.jsx)("div",{className:"user-list",children:R.map(e=>{var a;const t=H[e.id];return(0,l.jsx)("div",{className:"user-item",children:(0,l.jsxs)("label",{className:"user-label",children:[(0,l.jsx)("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>{return a=e.id,void h(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},className:"checkbox-custom"}),(0,l.jsx)("span",{className:"checkmark"}),(0,l.jsxs)("div",{className:"user-info",children:[(0,l.jsx)("span",{className:"user-name",children:e.name}),(0,l.jsxs)("span",{className:"user-balance",children:["\uc794\uc561: ",(null===(a=e.cash)||void 0===a?void 0:a.toLocaleString())||0,"\uc6d0"]}),void 0!==t&&(0,l.jsxs)("span",{className:"preview-amount ".concat(j),children:["send"===j?"+":"\u2212",t.toLocaleString(),"\uc6d0"]})]})]})},e.id)})})]}),(0,l.jsx)("button",{type:"submit",className:"submit-btn ".concat(j),disabled:t||E,children:E?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"spinner"})," \ucc98\ub9ac \uc911..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"icon",children:"send"===j?"\ud83d\udce4":"\ud83d\udce5"})," ","send"===j?"\ubcf4\ub0b4\uae30":"\uac00\uc838\uc624\uae30"," \uc2e4\ud589"]})})]})]})}}}]);
//# sourceMappingURL=289.24ca5eff.chunk.js.map