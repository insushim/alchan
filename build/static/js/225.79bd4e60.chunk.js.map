{"version":3,"file":"static/js/225.79bd4e60.chunk.js","mappings":"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","sources":["pages/my-assets/MyAssets.js"],"sourcesContent":["// src/pages/my-assets/MyAssets.js - Firestore ì§ì ‘ ì¡°íšŒ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •ëœ ìµœì¢… ë²„ì „\r\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport {\r\n  db,\r\n  doc,\r\n  getDoc,\r\n  setDoc,\r\n  serverTimestamp,\r\n  increment,\r\n  writeBatch,\r\n  arrayUnion,\r\n  getDocs,\r\n  collection,\r\n  query,\r\n  where,\r\n  functions,\r\n  httpsCallable,\r\n} from \"../../firebase\";\r\nimport { limit, runTransaction } from \"firebase/firestore\";\r\nimport { formatKoreanCurrency } from '../../utils/numberFormatter';\r\nimport { logActivity, ACTIVITY_TYPES } from '../../utils/firestoreHelpers';\r\nimport LoginWarning from \"../../components/LoginWarning\";\r\nimport TransferModal from \"../../components/modals/TransferModal\";\r\nimport { AlchanLoading } from \"../../components/AlchanLayout\";\r\nimport { DailyRewardBanner } from \"../../components/DailyReward\";\r\n\r\nimport { logger } from \"../../utils/logger\";\r\nexport default function MyAssets() {\r\n  const {\r\n    user,\r\n    userDoc,\r\n    users, // ì „ì²´ ì‚¬ìš©ì ëª©ë¡ (ì†¡ê¸ˆ ëŒ€ìƒ ì°¾ê¸° ë“±ì—ì„œ í•„ìš”)\r\n    classmates, // 'ë‚˜'ë¥¼ ì œì™¸í•œ í•™ê¸‰ ì¹œêµ¬ ëª©ë¡ (ì†¡ê¸ˆ, ì„ ë¬¼ ëª¨ë‹¬ìš©)\r\n    allClassMembers, // ğŸ”¥ [ì¶”ê°€] 'ë‚˜'ë¥¼ í¬í•¨í•œ í•™ê¸‰ ì „ì²´ êµ¬ì„±ì› ëª©ë¡ (ê¸°ë¶€ ë‚´ì—­ ëª¨ë‹¬ìš©)\r\n    loading: authLoading,\r\n    updateUser: updateUserInAuth,\r\n    addCashToUserById,\r\n    deductCash,\r\n    optimisticUpdate,\r\n  } = useAuth();\r\n\r\n  const userId = user?.uid;\r\n  const userName =\r\n    userDoc?.name || userDoc?.nickname || user?.displayName || \"ì‚¬ìš©ì\";\r\n  const currentUserClassCode = userDoc?.classCode;\r\n\r\n  // ğŸ”¥ [ìµœì í™” 1] ìƒíƒœ ë° ë ˆí¼ëŸ°ìŠ¤\r\n  const [assetsLoading, setAssetsLoading] = useState(true);\r\n  const loadingRef = useRef(false); // ë¡œë”© ì¤‘ë³µ ë°©ì§€ìš© í”Œë˜ê·¸\r\n  const dataFetchRef = useRef({}); // ë°ì´í„° í˜ì¹˜ ì‹œê°„ ì¶”ì ìš©\r\n  const [parkingBalance, setParkingBalance] = useState(0);\r\n  const [deposits, setDeposits] = useState([]); // ì˜ˆê¸ˆ ìƒí’ˆ ëª©ë¡\r\n  const [savings, setSavings] = useState([]); // ì ê¸ˆ ìƒí’ˆ ëª©ë¡\r\n  const [loans, setLoans] = useState([]);\r\n  const [realEstateAssets, setRealEstateAssets] = useState([]);\r\n  const [totalNetAssets, setTotalNetAssets] = useState(0);\r\n  const [goalDonations, setGoalDonations] = useState([]);\r\n  const [transactionHistory, setTransactionHistory] = useState([]);\r\n  const [forceReload, setForceReload] = useState(0); // ìºì‹œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ìƒíƒœ ë³€ìˆ˜\r\n\r\n  // ğŸ”¥ [ìµœì í™” 2] Firebase Functions í˜¸ì¶œ í•¨ìˆ˜ë“¤ (ê¸°ë¶€ ì œì™¸)\r\n  const getUserAssetsDataFunction = httpsCallable(functions, 'getUserAssetsData');\r\n  const sellCouponFunction = httpsCallable(functions, 'sellCoupon');\r\n  const giftCouponFunction = httpsCallable(functions, 'giftCoupon');\r\n\r\n  // ğŸ”¥ [ìµœì í™” 4] ìºì‹œ ìœ íš¨ ì‹œê°„ ì„¤ì •\r\n  const CACHE_DURATION = 60 * 60 * 1000; // ğŸ”¥ [ìµœì í™”] 1ì‹œê°„ (Firestore ì½ê¸° ìµœì†Œí™”)\r\n\r\n  const currentGoalId = currentUserClassCode\r\n    ? `${currentUserClassCode}_goal`\r\n    : null;\r\n\r\n  const [classCouponGoal, setClassCouponGoal] = useState(1000);\r\n  const [couponValue, setCouponValue] = useState(1000);\r\n\r\n  // ğŸ”¥ [ë²„ê·¸ ìˆ˜ì •] Firestoreì—ì„œ ì¿ í° ê°€ì¹˜ ì„¤ì • ë¡œë“œ\r\n  useEffect(() => {\r\n    const loadCouponValueFromSettings = async () => {\r\n      try {\r\n        const settingsRef = doc(db, \"settings\", \"mainSettings\");\r\n        const settingsSnap = await getDoc(settingsRef);\r\n        if (settingsSnap.exists()) {\r\n          const settingsData = settingsSnap.data();\r\n          if (settingsData.couponValue) {\r\n            setCouponValue(Number(settingsData.couponValue));\r\n          }\r\n        }\r\n      } catch (error) {\r\n        logger.error(\"[MyAssets] ì¿ í° ê°€ì¹˜ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:\", error);\r\n      }\r\n    };\r\n\r\n    if (userId) {\r\n      loadCouponValueFromSettings();\r\n    }\r\n  }, [userId]);\r\n\r\n  const [goalProgress, setGoalProgress] = useState(0);\r\n  const [myContribution, setMyContribution] = useState(0);\r\n  const [goalAchieved, setGoalAchieved] = useState(false);\r\n  const [isResettingGoal, setIsResettingGoal] = useState(false);\r\n\r\n  const [showDonateModal, setShowDonateModal] = useState(false);\r\n  const [showSellCouponModal, setShowSellCouponModal] = useState(false);\r\n  const [sellAmount, setSellAmount] = useState(\"\");\r\n  const [showGiftCouponModal, setShowGiftCouponModal] = useState(false);\r\n  const [giftRecipient, setGiftRecipient] = useState(\"\");\r\n  const [giftAmount, setGiftAmount] = useState(\"\");\r\n  const [showDonationHistoryModal, setShowDonationHistoryModal] =\r\n    useState(false);\r\n  const [showTransferModal, setShowTransferModal] = useState(false);\r\n  const [transferRecipient, setTransferRecipient] = useState(\"\");\r\n  const [transferAmount, setTransferAmount] = useState(\"\");\r\n  const [showAllTransactions, setShowAllTransactions] = useState(false); // ê±°ë˜ ë‚´ì—­ í¼ì¹˜ê¸°/ì ‘ê¸° ìƒíƒœ\r\n\r\n  // ğŸ”¥ [ìˆ˜ì • 1] ì•ˆì „í•œ timestamp ë³€í™˜ í•¨ìˆ˜\r\n  const safeTimestampToDate = (timestamp) => {\r\n    try {\r\n      // nullì´ë‚˜ undefinedì¸ ê²½ìš°\r\n      if (!timestamp) {\r\n        return new Date();\r\n      }\r\n\r\n      // ì´ë¯¸ Date ê°ì²´ì¸ ê²½ìš°\r\n      if (timestamp instanceof Date) {\r\n        return isNaN(timestamp.getTime()) ? new Date() : timestamp;\r\n      }\r\n\r\n      // Firestore Timestamp ê°ì²´ì¸ ê²½ìš°\r\n      if (timestamp && typeof timestamp.toDate === 'function') {\r\n        const date = timestamp.toDate();\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n\r\n      // seconds í•„ë“œê°€ ìˆëŠ” Firestore Timestamp í˜•íƒœì¸ ê²½ìš°\r\n      if (timestamp && timestamp.seconds) {\r\n        const date = new Date(timestamp.seconds * 1000);\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n\r\n      // ISO ë¬¸ìì—´ì¸ ê²½ìš°\r\n      if (typeof timestamp === 'string') {\r\n        const date = new Date(timestamp);\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n\r\n      // ìˆ«ì íƒ€ì„ìŠ¤íƒ¬í”„ì¸ ê²½ìš°\r\n      if (typeof timestamp === 'number') {\r\n        const date = new Date(timestamp);\r\n        return isNaN(date.getTime()) ? new Date() : date;\r\n      }\r\n\r\n      // ê¸°íƒ€ ê²½ìš° í˜„ì¬ ë‚ ì§œ ë°˜í™˜\r\n      return new Date();\r\n    } catch (error) {\r\n      return new Date();\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ìµœì í™” 5] ìºì‹œ ìœ íš¨ì„± í™•ì¸ í•¨ìˆ˜\r\n  const isCacheValid = (cacheKey) => {\r\n    const cachedTime = dataFetchRef.current[cacheKey];\r\n    return cachedTime && (Date.now() - cachedTime) < CACHE_DURATION;\r\n  };\r\n\r\n  // ğŸ”¥ [ìµœì í™” 6] localStorage ê¸°ë°˜ ìºì‹œ í•¨ìˆ˜ë“¤\r\n  const getCachedFirestoreData = (key) => {\r\n    try {\r\n      const cached = localStorage.getItem(`firestore_cache_${key}_${userId}`);\r\n      if (cached) {\r\n        const { data, timestamp } = JSON.parse(cached);\r\n        if (Date.now() - timestamp < CACHE_DURATION) {\r\n          return data;\r\n        }\r\n      }\r\n    } catch (error) {\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const setCachedFirestoreData = (key, data) => {\r\n    try {\r\n      const cacheItem = {\r\n        data,\r\n        timestamp: Date.now(),\r\n      };\r\n      localStorage.setItem(`firestore_cache_${key}_${userId}`, JSON.stringify(cacheItem));\r\n    } catch (error) {\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ìˆ˜ì • 2] ì•ˆì „í•œ íŠ¸ëœì­ì…˜ ê¸°ë¡ í•¨ìˆ˜ - ë¡œì»¬ì—ì„œë§Œ ì²˜ë¦¬í•˜ê³  ë‚˜ì¤‘ì— ë°°ì¹˜ë¡œ ë™ê¸°í™”\r\n  const addTransaction = async (userId, amount, description) => {\r\n    try {\r\n      // ë¨¼ì € ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥\r\n      const localKey = `pending_transactions_${userId}`;\r\n      const existing = localStorage.getItem(localKey);\r\n      const pendingTransactions = existing ? JSON.parse(existing) : [];\r\n\r\n      // ğŸ”¥ ì¼ê´€ëœ timestamp í˜•ì‹ ì‚¬ìš© - Date ê°ì²´ ìƒì„±\r\n      const now = new Date();\r\n      const newTransaction = {\r\n        id: `local_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        amount: Number(amount) || 0, // ìˆ«ìë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜\r\n        description: String(description) || \"ê±°ë˜ ë‚´ì—­\", // ë¬¸ìì—´ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜\r\n        timestamp: now, // Date ê°ì²´ë¡œ ì§ì ‘ ì €ì¥\r\n        timestampISO: now.toISOString(), // ISO ë¬¸ìì—´ë„ ë³´ê´€\r\n        synced: false,\r\n      };\r\n\r\n      pendingTransactions.push(newTransaction);\r\n      localStorage.setItem(localKey, JSON.stringify(pendingTransactions, (key, value) => {\r\n        // Date ê°ì²´ë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™”í•  ë•Œ ISO ë¬¸ìì—´ë¡œ ë³€í™˜\r\n        if (key === 'timestamp' && value instanceof Date) {\r\n          return value.toISOString();\r\n        }\r\n        return value;\r\n      }));\r\n\r\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\r\n      setTransactionHistory(prev => [newTransaction, ...prev.slice(0, 4)]);\r\n\r\n\r\n      // ğŸ”¥ [ìˆ˜ì • 3] ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¹„ë™ê¸° ë™ê¸°í™” (ì‹¤íŒ¨í•´ë„ ë©”ì¸ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ)\r\n      setTimeout(async () => {\r\n        try {\r\n          await syncPendingTransactions(userId);\r\n        } catch (error) {\r\n        }\r\n      }, 1000);\r\n\r\n    } catch (error) {\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ìˆ˜ì • 4] ë³´ë¥˜ ì¤‘ì¸ íŠ¸ëœì­ì…˜ ë™ê¸°í™” í•¨ìˆ˜\r\n  const syncPendingTransactions = async (userId) => {\r\n    const localKey = `pending_transactions_${userId}`;\r\n    const pendingStr = localStorage.getItem(localKey);\r\n\r\n    if (!pendingStr) return;\r\n\r\n    try {\r\n      const pendingTransactions = JSON.parse(pendingStr, (key, value) => {\r\n        // JSONì—ì„œ Date ê°ì²´ë¡œ ë³µì›\r\n        if (key === 'timestamp' && typeof value === 'string') {\r\n          return new Date(value);\r\n        }\r\n        return value;\r\n      });\r\n\r\n      const unsyncedTransactions = pendingTransactions.filter(tx => !tx.synced);\r\n\r\n      if (unsyncedTransactions.length === 0) return;\r\n\r\n      const batch = writeBatch(db);\r\n      const userTransactionsRef = collection(db, \"users\", userId, \"transactions\");\r\n\r\n      unsyncedTransactions.forEach(tx => {\r\n        const docRef = doc(userTransactionsRef);\r\n        batch.set(docRef, {\r\n          amount: tx.amount,\r\n          description: tx.description,\r\n          timestamp: serverTimestamp(), // Firestoreì—ëŠ” serverTimestamp ì‚¬ìš©\r\n          localTimestamp: tx.timestampISO || tx.timestamp, // ë¡œì»¬ íƒ€ì„ìŠ¤íƒ¬í”„ë„ ë³´ì¡´\r\n          syncedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      // ë™ê¸°í™” ì™„ë£Œ í‘œì‹œ\r\n      const updatedTransactions = pendingTransactions.map(tx =>\r\n        unsyncedTransactions.find(utx => utx.id === tx.id)\r\n          ? { ...tx, synced: true }\r\n          : tx\r\n      );\r\n\r\n      localStorage.setItem(localKey, JSON.stringify(updatedTransactions, (key, value) => {\r\n        if (key === 'timestamp' && value instanceof Date) {\r\n          return value.toISOString();\r\n        }\r\n        return value;\r\n      }));\r\n\r\n    } catch (error) {\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] ë°ì´í„° ë®ì–´ì“°ê¸° ë°©ì§€ë¥¼ ìœ„í•´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œ ì•ˆì „í•œ ëª©í‘œ ìƒì„± í•¨ìˆ˜\r\n  const createDefaultGoalForClass = useCallback(async (classCode, goalId) => {\r\n    try {\r\n      const goalDocRef = doc(db, \"goals\", goalId);\r\n      const defaultGoalData = {\r\n        classCode: classCode,\r\n        targetAmount: 1000,\r\n        progress: 0,\r\n        donations: [],\r\n        donationCount: 0,\r\n        title: `${classCode} í•™ê¸‰ ëª©í‘œ`,\r\n        description: `${classCode} í•™ê¸‰ì˜ ì¿ í° ëª©í‘œì…ë‹ˆë‹¤.`,\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n        createdBy: userId,\r\n      };\r\n\r\n      // íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œê°€ ì—†ì„ ë•Œë§Œ ì•ˆì „í•˜ê²Œ ìƒì„± (ë®ì–´ì“°ê¸° ë°©ì§€)\r\n      await runTransaction(db, async (transaction) => {\r\n        const goalDoc = await transaction.get(goalDocRef);\r\n        if (!goalDoc.exists()) {\r\n          transaction.set(goalDocRef, defaultGoalData);\r\n          setCachedFirestoreData(`goal_${goalId}`, defaultGoalData);\r\n        } else {\r\n          const existingData = goalDoc.data();\r\n          setCachedFirestoreData(`goal_${goalId}`, existingData);\r\n        }\r\n      });\r\n\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [userId]);\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ëª©í‘œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ - ìºì‹œ ì¶”ê°€ ë° ìµœì í™”\r\n  const loadGoalData = useCallback(async () => {\r\n    if (!currentGoalId || !currentUserClassCode) {\r\n      return;\r\n    }\r\n\r\n    // ğŸ”¥ ìºì‹œ ë¨¼ì € í™•ì¸\r\n    const cacheKey = `goal_${currentGoalId}`;\r\n    const cachedData = getCachedFirestoreData(cacheKey);\r\n\r\n    if (cachedData) {\r\n      setClassCouponGoal(Number(cachedData.targetAmount) || 1000);\r\n      setGoalProgress(Number(cachedData.progress) || 0);\r\n\r\n      const donations = Array.isArray(cachedData.donations) ? cachedData.donations : [];\r\n      setGoalDonations(donations);\r\n\r\n      const myDonations = donations.filter(d => d.userId === userId);\r\n      const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n      setMyContribution(myTotal);\r\n\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n      const goalDocSnap = await getDoc(goalDocRef);\r\n\r\n      if (goalDocSnap.exists()) {\r\n        const goalData = goalDocSnap.data();\r\n\r\n        // ëª©í‘œ ì •ë³´ ì—…ë°ì´íŠ¸\r\n        setClassCouponGoal(Number(goalData.targetAmount) || 1000);\r\n        setGoalProgress(Number(goalData.progress) || 0);\r\n\r\n        // ê¸°ë¶€ ë‚´ì—­ ì²˜ë¦¬\r\n        const donations = Array.isArray(goalData.donations)\r\n          ? goalData.donations.map((donation) => {\r\n            let processedTimestamp;\r\n            if (donation.timestamp && donation.timestamp.toDate) {\r\n              processedTimestamp = donation.timestamp.toDate().toISOString();\r\n            } else if (donation.timestamp && donation.timestamp.seconds) {\r\n              processedTimestamp = new Date(donation.timestamp.seconds * 1000).toISOString();\r\n            } else if (donation.timestampISO) {\r\n              processedTimestamp = donation.timestampISO;\r\n            } else if (typeof donation.timestamp === 'string') {\r\n              processedTimestamp = donation.timestamp;\r\n            } else {\r\n              processedTimestamp = new Date().toISOString();\r\n            }\r\n\r\n            return {\r\n              ...donation,\r\n              amount: Number(donation.amount) || 0,\r\n              timestamp: processedTimestamp,\r\n              userId: donation.userId || '',\r\n              userName: donation.userName || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì',\r\n              message: donation.message || '',\r\n              classCode: donation.classCode || currentUserClassCode,\r\n            };\r\n          })\r\n          : [];\r\n\r\n        setGoalDonations(donations);\r\n\r\n        // ë‚´ ê¸°ì—¬ ê³„ì‚°\r\n        const myDonations = donations.filter(d => d.userId === userId);\r\n        const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n        setMyContribution(myTotal);\r\n\r\n        // ğŸ”¥ ìºì‹œì— ì €ì¥\r\n        setCachedFirestoreData(cacheKey, goalData);\r\n      } else {\r\n        // ëª©í‘œ ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ìƒì„±\r\n        logger.log('[MyAssets] ëª©í‘œ ë¬¸ì„œê°€ ì—†ì–´ ê¸°ë³¸ê°’ ìƒì„±');\r\n        await createDefaultGoalForClass(currentUserClassCode, currentGoalId);\r\n      }\r\n    } catch (error) {\r\n      logger.error('[MyAssets] ëª©í‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentGoalId, currentUserClassCode, userId, createDefaultGoalForClass]);\r\n\r\n  const loadMyAssetsData = useCallback(async () => {\r\n    if (!userId || !db) {\r\n      setAssetsLoading(false);\r\n      return;\r\n    }\r\n\r\n    // ì´ë¯¸ ë¡œë”© ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€\r\n    if (loadingRef.current) {\r\n      return;\r\n    }\r\n\r\n    loadingRef.current = true;\r\n\r\n    // ğŸ”¥ [ìµœì í™”] ìºì‹œ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ (ë¡œë”© ìŠ¤í”¼ë„ˆ ì—†ì´)\r\n    const cachedAssets = getCachedFirestoreData('myAssets');\r\n    if (cachedAssets) {\r\n      setParkingBalance(cachedAssets.parkingBalance || 0);\r\n      setDeposits(cachedAssets.deposits || []);\r\n      setSavings(cachedAssets.savings || []);\r\n      setLoans(cachedAssets.loans || []);\r\n      setRealEstateAssets(cachedAssets.realEstateAssets || []);\r\n      setTransactionHistory(cachedAssets.transactionHistory || []);\r\n      setAssetsLoading(false); // ìºì‹œë¡œ ì¦‰ì‹œ ë¡œë”© í•´ì œ\r\n    } else {\r\n      setAssetsLoading(true);\r\n    }\r\n\r\n    try {\r\n      // ğŸ”¥ [ìµœì í™”] ëª¨ë“  ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì˜ Promise.allë¡œ ë³‘ë ¬ ì‹¤í–‰\r\n      const realEstateRef1 = query(collection(db, \"classes\", currentUserClassCode, \"realEstateProperties\"), where(\"owner\", \"==\", userId), limit(50));\r\n      const realEstateRef2 = query(collection(db, \"ClassStock\", currentUserClassCode, \"students\", userId, \"realestates\"), limit(50));\r\n      const realEstateRef3 = query(collection(db, \"realEstate\"), where(\"ownerId\", \"==\", userId), limit(50));\r\n      const parkingRef1 = doc(db, \"users\", userId, \"financials\", \"parkingAccount\");\r\n      const parkingRef2 = collection(db, \"ClassStock\", currentUserClassCode, \"students\", userId, \"parkingAccounts\");\r\n      const productsRef = query(collection(db, \"users\", userId, \"products\"), limit(50));\r\n      const activityLogsRef = query(\r\n        collection(db, \"activity_logs\"),\r\n        where(\"classCode\", \"==\", currentUserClassCode),\r\n        where(\"userId\", \"==\", userId),\r\n        limit(50)\r\n      );\r\n      const transactionsRef = query(\r\n        collection(db, \"users\", userId, \"transactions\"),\r\n        limit(50)\r\n      );\r\n\r\n      const [snap1, snap2, snap3, parkingSnap1, parkingSnap2, productsSnap, activityLogsSnap, transactionsSnap] = await Promise.all([\r\n        getDocs(realEstateRef1),\r\n        getDocs(realEstateRef2),\r\n        getDocs(realEstateRef3),\r\n        getDoc(parkingRef1),\r\n        getDocs(parkingRef2),\r\n        getDocs(productsRef),\r\n        getDocs(activityLogsRef).catch(() => ({ docs: [] })),\r\n        getDocs(transactionsRef).catch(() => ({ docs: [] })),\r\n      ]);\r\n\r\n      // ë¶€ë™ì‚° ì²˜ë¦¬\r\n      const allRealEstateAssets = [];\r\n      snap1.forEach(doc => allRealEstateAssets.push({ id: doc.id, ...doc.data() }));\r\n      snap2.forEach(doc => allRealEstateAssets.push({ id: doc.id, ...doc.data() }));\r\n      snap3.forEach(doc => allRealEstateAssets.push({ id: doc.id, ...doc.data() }));\r\n\r\n      // íŒŒí‚¹í†µì¥ ì²˜ë¦¬\r\n      let totalParkingBalance = 0;\r\n      if (parkingSnap1.exists()) {\r\n        totalParkingBalance += parkingSnap1.data().balance || 0;\r\n      }\r\n      parkingSnap2.forEach(doc => {\r\n        totalParkingBalance += doc.data().balance || 0;\r\n      });\r\n      setParkingBalance(totalParkingBalance);\r\n\r\n      // ìƒí’ˆ(ì˜ˆê¸ˆ/ì ê¸ˆ/ëŒ€ì¶œ) ì²˜ë¦¬\r\n      const depositsData = [];\r\n      const savingsData = [];\r\n      const loansData = [];\r\n      productsSnap.forEach(docSnap => {\r\n        const product = {\r\n          id: docSnap.id,\r\n          ...docSnap.data(),\r\n          maturityDate: docSnap.data().maturityDate?.toDate ? docSnap.data().maturityDate.toDate() : docSnap.data().maturityDate\r\n        };\r\n        if (product.type === 'deposit') depositsData.push(product);\r\n        else if (product.type === 'savings') savingsData.push(product);\r\n        else if (product.type === 'loan') loansData.push(product);\r\n      });\r\n      setDeposits(depositsData);\r\n      setSavings(savingsData);\r\n      setLoans(loansData);\r\n      setRealEstateAssets(allRealEstateAssets);\r\n\r\n      // ê±°ë˜ ë‚´ì—­ ì²˜ë¦¬\r\n      const activityData = (activityLogsSnap.docs || [])\r\n        .map(doc => {\r\n          const data = doc.data();\r\n          const desc = data.description || data.type || 'ê±°ë˜ ë‚´ì—­';\r\n          return {\r\n            id: doc.id,\r\n            amount: data.amount || 0,\r\n            description: desc === 'undefined' ? 'ê±°ë˜ ë‚´ì—­' : desc,\r\n            timestamp: data.timestamp,\r\n            type: data.type,\r\n            couponAmount: data.couponAmount || 0,\r\n            source: 'activity_logs'\r\n          };\r\n        })\r\n        .filter(tx => tx.amount !== 0 || tx.couponAmount !== 0);\r\n\r\n      const transactionsData = (transactionsSnap.docs || [])\r\n        .map(doc => {\r\n          const data = doc.data();\r\n          const desc = data.description || 'ê±°ë˜ ë‚´ì—­';\r\n          return {\r\n            id: doc.id,\r\n            amount: data.amount || 0,\r\n            description: (!desc || desc === 'undefined') ? 'ê±°ë˜ ë‚´ì—­' : desc,\r\n            timestamp: data.timestamp || data.createdAt,\r\n            type: data.type || 'transaction',\r\n            source: 'transactions'\r\n          };\r\n        })\r\n        .filter(tx => tx.amount !== 0);\r\n\r\n      const allTransactions = [...activityData, ...transactionsData];\r\n      allTransactions.sort((a, b) => {\r\n        const dateA = a.timestamp?.toDate ? a.timestamp.toDate() : new Date(a.timestamp?.seconds * 1000 || 0);\r\n        const dateB = b.timestamp?.toDate ? b.timestamp.toDate() : new Date(b.timestamp?.seconds * 1000 || 0);\r\n        return dateB - dateA;\r\n      });\r\n      const recentTransactions = allTransactions.slice(0, 20);\r\n      setTransactionHistory(recentTransactions);\r\n\r\n      // ğŸ”¥ [ìµœì í™”] ê²°ê³¼ë¥¼ localStorageì— ìºì‹œ (ë‹¤ìŒ ë¡œë“œì‹œ ì¦‰ì‹œ í‘œì‹œ)\r\n      setCachedFirestoreData('myAssets', {\r\n        parkingBalance: totalParkingBalance,\r\n        deposits: depositsData,\r\n        savings: savingsData,\r\n        loans: loansData,\r\n        realEstateAssets: allRealEstateAssets,\r\n        transactionHistory: recentTransactions.map(tx => ({\r\n          ...tx,\r\n          timestamp: tx.timestamp?.toDate ? tx.timestamp.toDate().toISOString() : tx.timestamp?.seconds ? new Date(tx.timestamp.seconds * 1000).toISOString() : null,\r\n        })),\r\n      });\r\n\r\n    } catch (fallbackError) {\r\n      logger.error('[MyAssets] ğŸš¨ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì§ì ‘ ì¡°íšŒ ì‹¤íŒ¨:', fallbackError);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n      loadingRef.current = false;\r\n    }\r\n  }, [userId, currentUserClassCode]); // loadGoalData ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!authLoading && user) {\r\n      loadMyAssetsData();\r\n    } else if (!authLoading && !user) {\r\n      setAssetsLoading(false);\r\n      setParkingBalance(0);\r\n      setLoans([]);\r\n      setRealEstateAssets([]);\r\n      setTotalNetAssets(0);\r\n      setMyContribution(0);\r\n      setClassCouponGoal(1000);\r\n      setGoalProgress(0);\r\n      setCouponValue(1000);\r\n      setGoalDonations([]);\r\n      setTransactionHistory([]);\r\n    } else if (authLoading) {\r\n      setAssetsLoading(true);\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [authLoading, user]); // loadMyAssetsData ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€\r\n\r\n  useEffect(() => {\r\n    const cashValue = Number(userDoc?.cash) || 0;\r\n    const couponMonetaryValue = (Number(userDoc?.coupons) || 0) * Number(couponValue);\r\n    const realEstateValue = realEstateAssets.reduce(\r\n      (sum, asset) => sum + (Number(asset.price) || 0),\r\n      0\r\n    );\r\n    // ì˜ˆê¸ˆ ì´ì•¡ (balance ê¸°ì¤€)\r\n    const depositsTotal = deposits.reduce(\r\n      (sum, deposit) => sum + (Number(deposit.balance) || 0),\r\n      0\r\n    );\r\n    // ì ê¸ˆ ì´ì•¡ (balance ê¸°ì¤€)\r\n    const savingsTotal = savings.reduce(\r\n      (sum, saving) => sum + (Number(saving.balance) || 0),\r\n      0\r\n    );\r\n    // ëŒ€ì¶œ ì´ì•¡ (balance ê¸°ì¤€ - remainingPrincipalì´ ì—†ìœ¼ë©´ balance ì‚¬ìš©)\r\n    const loanTotal = loans.reduce(\r\n      (sum, loan) => sum + (Number(loan.remainingPrincipal) || Number(loan.balance) || 0),\r\n      0\r\n    );\r\n    const calculatedTotalAssets =\r\n      cashValue +\r\n      couponMonetaryValue +\r\n      Number(parkingBalance) +\r\n      depositsTotal +\r\n      savingsTotal +\r\n      realEstateValue -\r\n      loanTotal;\r\n\r\n    setTotalNetAssets(calculatedTotalAssets);\r\n  }, [\r\n    userDoc?.cash,\r\n    userDoc?.coupons,\r\n    couponValue,\r\n    parkingBalance,\r\n    deposits,\r\n    savings,\r\n    realEstateAssets,\r\n    loans,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    setGoalAchieved(goalProgress >= classCouponGoal && classCouponGoal > 0);\r\n  }, [goalProgress, classCouponGoal]);\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ëª©í‘œ ë°ì´í„° í´ë§ ì œê±° - ìºì‹œë¡œ ì¶©ë¶„í•¨\r\n  // ì´ˆê¸° ë¡œë“œë§Œ ìˆ˜í–‰í•˜ê³  í´ë§ì€ í•˜ì§€ ì•ŠìŒ (ë¶ˆí•„ìš”í•œ Firestore ì¡°íšŒ ë°©ì§€)\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!user || !currentGoalId) {\r\n      return;\r\n    }\r\n\r\n    loadGoalData();\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [user, currentGoalId]); // loadGoalData ì œê±°í•˜ì—¬ ë¬´í•œ ë£¨í”„ ë°©ì§€\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ê¸°ë¶€ ì²˜ë¦¬ í•¨ìˆ˜ - ìºì‹œ ë¬´íš¨í™” ê°œì„ \r\n  const handleDonateCoupon = async (amount, memo) => {\r\n    if (!userId || !currentUserClassCode) {\r\n      alert(\"ì‚¬ìš©ì ë˜ëŠ” í•™ê¸‰ ì •ë³´ê°€ ì—†ì–´ ê¸°ë¶€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return false;\r\n    }\r\n\r\n    const donationAmount = parseInt(amount, 10);\r\n    if (isNaN(donationAmount) || donationAmount <= 0) {\r\n      alert(\"ìœ íš¨í•œ ì¿ í° ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return false;\r\n    }\r\n\r\n    // ì¿ í° ë³´ìœ ëŸ‰ í™•ì¸\r\n    const currentCoupons = Number(userDoc?.coupons) || 0;\r\n    if (currentCoupons < donationAmount) {\r\n      alert(`ì¿ í°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${currentCoupons}ê°œ, í•„ìš”: ${donationAmount}ê°œ)`);\r\n      return false;\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n\r\n    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\r\n    const previousProgress = goalProgress;\r\n    const previousMyContribution = myContribution;\r\n    const previousDonations = goalDonations;\r\n\r\n    const newDonation = {\r\n      userId: userId,\r\n      userName: userName,\r\n      amount: donationAmount,\r\n      timestamp: new Date().toISOString(),\r\n      timestampISO: new Date().toISOString(),\r\n      message: memo || '',\r\n      classCode: currentUserClassCode,\r\n    };\r\n\r\n    setGoalProgress(prev => prev + donationAmount);\r\n    setMyContribution(prev => prev + donationAmount);\r\n    setGoalDonations(prev => [...prev, newDonation]);\r\n\r\n    // ğŸ”¥ ì¿ í° ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({ coupons: -donationAmount });\r\n    }\r\n\r\n    try {\r\n      // 1. ì‚¬ìš©ì ì¿ í° ì°¨ê° (AuthContext ì‚¬ìš©)\r\n      const couponDeducted = await updateUserInAuth({\r\n        coupons: increment(-donationAmount)\r\n      });\r\n\r\n      if (!couponDeducted) {\r\n        throw new Error(\"ì¿ í° ì°¨ê°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\r\n      }\r\n\r\n      // 2. Firestore íŠ¸ëœì­ì…˜ìœ¼ë¡œ ëª©í‘œ ì—…ë°ì´íŠ¸\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n\r\n      await runTransaction(db, async (transaction) => {\r\n        const goalDoc = await transaction.get(goalDocRef);\r\n\r\n        if (!goalDoc.exists()) {\r\n          throw new Error(\"ëª©í‘œ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n        }\r\n\r\n        const firestoreDonation = {\r\n          userId: userId,\r\n          userName: userName,\r\n          amount: donationAmount,\r\n          timestamp: serverTimestamp(),\r\n          timestampISO: new Date().toISOString(),\r\n          message: memo || '',\r\n          classCode: currentUserClassCode,\r\n        };\r\n\r\n        // progress ì¦ê°€ ë° donations ë°°ì—´ì— ì¶”ê°€\r\n        transaction.update(goalDocRef, {\r\n          progress: increment(donationAmount),\r\n          donations: arrayUnion(firestoreDonation),\r\n          updatedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      // 3. donations ì»¬ë ‰ì…˜ì—ë„ ê¸°ë¡ (ì„ íƒì‚¬í•­, íˆìŠ¤í† ë¦¬ ì¶”ì ìš©)\r\n      const donationRecordRef = doc(collection(db, \"donations\"));\r\n      await setDoc(donationRecordRef, {\r\n        userId: userId,\r\n        userName: userName,\r\n        amount: donationAmount,\r\n        timestamp: serverTimestamp(),\r\n        timestampISO: new Date().toISOString(),\r\n        message: memo || '',\r\n        classCode: currentUserClassCode,\r\n        goalId: currentGoalId,\r\n      });\r\n\r\n      // 4. íŠ¸ëœì­ì…˜ ê¸°ë¡\r\n      await addTransaction(userId, -donationAmount * couponValue, `í•™ê¸‰ ëª©í‘œì— ${donationAmount}ì¿ í° ê¸°ë¶€`);\r\n\r\n      // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° ê¸°ë¶€)\r\n      logActivity(db, {\r\n        classCode: currentUserClassCode,\r\n        userId: userId,\r\n        userName: userName,\r\n        type: ACTIVITY_TYPES.COUPON_DONATE,\r\n        description: `í•™ê¸‰ ëª©í‘œì— ì¿ í° ${donationAmount}ê°œ ê¸°ë¶€`,\r\n        couponAmount: -donationAmount,\r\n        metadata: {\r\n          goalId: currentGoalId,\r\n          goalProgress: goalProgress + donationAmount,\r\n          message: memo || ''\r\n        }\r\n      });\r\n\r\n      // ğŸ”¥ 5. ìºì‹œ ë¬´íš¨í™” (ëª¨ë“  ê´€ë ¨ ìºì‹œ ì‚­ì œ)\r\n      const cacheKey = `goal_${currentGoalId}`;\r\n      localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n\r\n      alert(`${donationAmount}ê°œ ì¿ í° ê¸°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);\r\n      setShowDonateModal(false);\r\n\r\n      // ğŸ”¥ 6. ìµœì‹  ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ìºì‹œê°€ ì‚­ì œë˜ì—ˆìœ¼ë¯€ë¡œ Firestoreì—ì„œ ê°€ì ¸ì˜´)\r\n      setTimeout(() => {\r\n        loadGoalData();\r\n      }, 500);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('[MyAssets] ê¸°ë¶€ ì˜¤ë¥˜:', error);\r\n      alert(`ê¸°ë¶€ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n      // ì—ëŸ¬ ë°œìƒ ì‹œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ë¡¤ë°±\r\n      setGoalProgress(previousProgress);\r\n      setMyContribution(previousMyContribution);\r\n      setGoalDonations(previousDonations);\r\n\r\n      // ì¿ í°ë„ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: donationAmount });\r\n      }\r\n\r\n      return false;\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ìˆ˜ì •] ê¸°ë¶€ ë‚´ì—­ ë³µêµ¬ë¥¼ ìœ„í•œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜\r\n  const forceRefreshGoalData = async () => {\r\n    if (!currentGoalId || !currentUserClassCode) {\r\n      alert(\"í•™ê¸‰ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n\r\n    try {\r\n      // ëª¨ë“  ê´€ë ¨ ìºì‹œ ì‚­ì œ\r\n      const cacheKey = `goal_${currentGoalId}`;\r\n      localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n      localStorage.removeItem(`firestore_cache_settings_${userId}`);\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n\r\n      logger.log('[MyAssets] ìºì‹œ ì‚­ì œ ì™„ë£Œ, Firestoreì—ì„œ ìµœì‹  ë°ì´í„° ë¡œë“œ ì¤‘...');\r\n\r\n      // ğŸ”¥ Firestoreì—ì„œ ì§ì ‘ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\r\n      const goalDocRef = doc(db, \"goals\", currentGoalId);\r\n      const goalDocSnap = await getDoc(goalDocRef);\r\n\r\n      if (goalDocSnap.exists()) {\r\n        const latestGoalData = goalDocSnap.data();\r\n\r\n        setClassCouponGoal(Number(latestGoalData.targetAmount) || 1000);\r\n        setGoalProgress(Number(latestGoalData.progress) || 0);\r\n\r\n        const freshDonations = Array.isArray(latestGoalData.donations)\r\n          ? latestGoalData.donations.map((donation) => {\r\n            let processedTimestamp;\r\n            if (donation.timestamp && donation.timestamp.toDate) {\r\n              processedTimestamp = donation.timestamp.toDate().toISOString();\r\n            } else if (donation.timestamp && donation.timestamp.seconds) {\r\n              processedTimestamp = new Date(donation.timestamp.seconds * 1000).toISOString();\r\n            } else if (donation.timestampISO) {\r\n              processedTimestamp = donation.timestampISO;\r\n            } else if (typeof donation.timestamp === 'string') {\r\n              processedTimestamp = donation.timestamp;\r\n            } else {\r\n              processedTimestamp = new Date().toISOString();\r\n            }\r\n\r\n            return {\r\n              ...donation,\r\n              amount: Number(donation.amount) || 0,\r\n              timestamp: processedTimestamp,\r\n              userId: donation.userId || '',\r\n              userName: donation.userName || 'ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì',\r\n              message: donation.message || '',\r\n              classCode: donation.classCode || currentUserClassCode,\r\n            };\r\n          })\r\n          : [];\r\n\r\n        setGoalDonations(freshDonations);\r\n\r\n        // ë‚´ ê¸°ì—¬ë„ ì¬ê³„ì‚°\r\n        const myDonations = freshDonations.filter(d => d.userId === userId);\r\n        const myTotal = myDonations.reduce((sum, d) => sum + d.amount, 0);\r\n        setMyContribution(myTotal);\r\n\r\n        // ìºì‹œì— ì €ì¥\r\n        setCachedFirestoreData(cacheKey, latestGoalData);\r\n\r\n        alert(`ëª©í‘œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ!\\nëª©í‘œ ì§„í–‰ë¥ : ${latestGoalData.progress || 0}/${latestGoalData.targetAmount || 1000}\\nê¸°ë¶€ ë‚´ì—­: ${freshDonations.length}ê°œ\\në‚´ ê¸°ì—¬ë„: ${myTotal}ê°œ`);\r\n      } else {\r\n        alert(\"ëª©í‘œ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.\");\r\n      }\r\n    } catch (error) {\r\n      logger.error('[MyAssets] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);\r\n      alert(`ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  // ğŸ”¥ [ì¶”ê°€] ê°œë°œììš© ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜\r\n  const showDebugInfo = () => {\r\n    const debugInfo = {\r\n      userId,\r\n      currentUserClassCode,\r\n      currentGoalId,\r\n      goalProgress,\r\n      classCouponGoal,\r\n      myContribution,\r\n      donationsCount: goalDonations.length,\r\n      donations: goalDonations,\r\n      userCoupons: userDoc?.coupons,\r\n      userCash: userDoc?.cash,\r\n    };\r\n\r\n    alert(`ë””ë²„ê·¸ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.\\nê¸°ë¶€ ë‚´ì—­: ${goalDonations.length}ê°œ\\nëª©í‘œ ì§„í–‰ë¥ : ${goalProgress}/${classCouponGoal}`);\r\n  };\r\n\r\n  // ğŸ”¥ [í•µì‹¬ ìˆ˜ì •] 'resetCouponGoal' í•¨ìˆ˜ì— async í‚¤ì›Œë“œ ì¶”ê°€\r\n  const resetCouponGoal = async () => {\r\n    if (!userDoc?.isAdmin && !userDoc?.isSuperAdmin) {\r\n      alert(\"ê´€ë¦¬ìë§Œ ì´ˆê¸°í™” ê°€ëŠ¥í•©ë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n    if (!currentUserClassCode || !currentGoalId) {\r\n      alert(\"í•™ê¸‰ ì½”ë“œë‚˜ ëª©í‘œ ì •ë³´ê°€ ì—†ì–´ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n    if (\r\n      !window.confirm(\r\n        `ì •ë§ë¡œ ${currentUserClassCode} í•™ê¸‰ì˜ ì¿ í° ëª©í‘œì™€ ê¸°ì—¬ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\r\n      )\r\n    )\r\n      return;\r\n\r\n    setIsResettingGoal(true);\r\n    try {\r\n      const batch = writeBatch(db);\r\n      const goalRef = doc(db, \"goals\", currentGoalId);\r\n\r\n      // ğŸ”¥ [ìµœì í™”] ì‚¬ìš©ì ì¡°íšŒì— limit ì¶”ê°€\r\n      const usersQuery = query(\r\n        collection(db, \"users\"),\r\n        where(\"classCode\", \"==\", currentUserClassCode),\r\n        limit(100)\r\n      );\r\n      const usersSnapshot = await getDocs(usersQuery);\r\n\r\n      usersSnapshot.forEach((userDocument) => {\r\n        const userRef = doc(db, \"users\", userDocument.id);\r\n        batch.update(userRef, {\r\n          myContribution: 0,\r\n          updatedAt: serverTimestamp(),\r\n        });\r\n      });\r\n\r\n      batch.update(goalRef, {\r\n        progress: 0,\r\n        donations: [],\r\n        donationCount: 0,\r\n        updatedAt: serverTimestamp(),\r\n        resetAt: serverTimestamp(),\r\n        resetBy: userId,\r\n      });\r\n\r\n      await batch.commit();\r\n\r\n      // ğŸ”¥ [ìµœì í™” 23] ì´ˆê¸°í™” í›„ ê´€ë ¨ ìºì‹œ ëª¨ë‘ ì‚­ì œ\r\n      localStorage.removeItem(`goalDonationHistory_${currentUserClassCode}_goal`);\r\n      localStorage.removeItem(`firestore_cache_goal_${currentGoalId}_${userId}`);\r\n\r\n      setMyContribution(0);\r\n      setGoalProgress(0);\r\n      setGoalDonations([]);\r\n\r\n      alert(`í•™ê¸‰(${currentUserClassCode})ì˜ ì¿ í° ëª©í‘œì™€ ê¸°ì—¬ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);\r\n    } catch (error) {\r\n      alert(`ëª©í‘œ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`);\r\n    } finally {\r\n      setIsResettingGoal(false);\r\n    }\r\n  };\r\n\r\n  const handleSellCoupon = async () => {\r\n    const amount = parseInt(sellAmount, 10);\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert(\"ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    // ğŸ”¥ ì¿ í° ì°¨ê° ë° í˜„ê¸ˆ ì¦ê°€ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n    const cashGained = amount * couponValue;\r\n    if (optimisticUpdate) {\r\n      optimisticUpdate({ coupons: -amount, cash: cashGained });\r\n    }\r\n\r\n    setAssetsLoading(true);\r\n    try {\r\n      await sellCouponFunction({ amount });\r\n\r\n      // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° íŒë§¤)\r\n      logActivity(db, {\r\n        classCode: currentUserClassCode,\r\n        userId: userId,\r\n        userName: userName,\r\n        type: ACTIVITY_TYPES.COUPON_USE,\r\n        description: `ì¿ í° ${amount}ê°œ íŒë§¤ (${cashGained.toLocaleString()}ì›)`,\r\n        amount: cashGained,\r\n        couponAmount: -amount,\r\n        metadata: {\r\n          couponsSold: amount,\r\n          cashReceived: cashGained,\r\n          couponValue: couponValue\r\n        }\r\n      });\r\n\r\n      alert(`${amount}ê°œ ì¿ í°ì„ íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);\r\n      setShowSellCouponModal(false);\r\n      setSellAmount(\"\");\r\n      // ğŸ”¥ [ìµœì í™”] Firebase Functionì´ ìë™ìœ¼ë¡œ userDocë¥¼ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ\r\n      // AuthContextì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UIë¥¼ ê°±ì‹ í•¨ (loadMyAssetsData ì œê±°)\r\n    } catch (error) {\r\n      alert(`íŒë§¤ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: amount, cash: -cashGained });\r\n      }\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGiftCoupon = async () => {\r\n    const recipientUser = users.find((u) => u.id === giftRecipient);\r\n    const amount = parseInt(giftAmount, 10);\r\n\r\n    if (!recipientUser) {\r\n      alert(\"ë°›ëŠ” ì‚¬ëŒì„ ì„ íƒí•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n    if (isNaN(amount) || amount <= 0) {\r\n      alert(\"ì˜¬ë°”ë¥¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    if (window.confirm(`${recipientUser.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œë¥¼ ì„ ë¬¼í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\r\n      // ğŸ”¥ ì¿ í° ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ coupons: -amount });\r\n      }\r\n\r\n      setAssetsLoading(true);\r\n      try {\r\n        await giftCouponFunction({ recipientId: recipientUser.id, amount, message: \"\" });\r\n\r\n        // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° ì„ ë¬¼ ë°œì†¡)\r\n        logActivity(db, {\r\n          classCode: currentUserClassCode,\r\n          userId: userId,\r\n          userName: userName,\r\n          type: ACTIVITY_TYPES.COUPON_GIFT_SEND,\r\n          description: `${recipientUser.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œ ì„ ë¬¼`,\r\n          couponAmount: -amount,\r\n          metadata: {\r\n            recipientId: recipientUser.id,\r\n            recipientName: recipientUser.name\r\n          }\r\n        });\r\n\r\n        // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì¿ í° ì„ ë¬¼ ìˆ˜ì‹ ) - ë°›ëŠ” ì‚¬ëŒë„ ê¸°ë¡\r\n        logActivity(db, {\r\n          classCode: currentUserClassCode,\r\n          userId: recipientUser.id,\r\n          userName: recipientUser.name,\r\n          type: ACTIVITY_TYPES.COUPON_GIFT_RECEIVE,\r\n          description: `${userName}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ${amount}ê°œ ìˆ˜ì‹ `,\r\n          couponAmount: amount,\r\n          metadata: {\r\n            senderId: userId,\r\n            senderName: userName\r\n          }\r\n        });\r\n\r\n        alert(\"ì¿ í° ì„ ë¬¼ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\");\r\n        setShowGiftCouponModal(false);\r\n        setGiftRecipient(\"\");\r\n        setGiftAmount(\"\");\r\n        // ğŸ”¥ [ìµœì í™”] Firebase Functionì´ ìë™ìœ¼ë¡œ userDocë¥¼ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ\r\n        // AuthContextì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UIë¥¼ ê°±ì‹ í•¨ (loadMyAssetsData ì œê±°)\r\n      } catch (error) {\r\n        alert(`ì„ ë¬¼ ì˜¤ë¥˜: ${error.message}`);\r\n\r\n        // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n        if (optimisticUpdate) {\r\n          optimisticUpdate({ coupons: amount });\r\n        }\r\n      } finally {\r\n        setAssetsLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTransferMoney = async () => {\r\n    setAssetsLoading(true);\r\n    try {\r\n      if (\r\n        !userDoc ||\r\n        !userId ||\r\n        !db ||\r\n        !users ||\r\n        !deductCash ||\r\n        !addCashToUserById\r\n      ) {\r\n        alert(\"í•„ìˆ˜ ì •ë³´ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\r\n        return;\r\n      }\r\n\r\n      const amount = parseInt(transferAmount, 10);\r\n      if (isNaN(amount) || amount <= 0) {\r\n        alert(\"ì˜¬ë°”ë¥¸ ì†¡ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\r\n        return;\r\n      }\r\n\r\n      if ((Number(userDoc.cash) || 0) < amount) {\r\n        alert(\"ë³´ìœ  í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\");\r\n        return;\r\n      }\r\n\r\n      const recipientUser = users.find((u) => u.id === transferRecipient);\r\n      if (!recipientUser) {\r\n        alert(\"ì†¡ê¸ˆ ëŒ€ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\r\n        return;\r\n      }\r\n\r\n      if (recipientUser.id === userId) {\r\n        alert(\"ìê¸° ìì‹ ì—ê²ŒëŠ” ì†¡ê¸ˆí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\r\n        return;\r\n      }\r\n\r\n      const recipientName = recipientUser.name || recipientUser.nickname || \"ì‚¬ìš©ì\";\r\n\r\n      // ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ í™•ì¸ ì°½ì„ ì œê±°í•©ë‹ˆë‹¤.\r\n      const deductSuccess = await deductCash(amount, `${recipientName}ë‹˜ì—ê²Œ ì†¡ê¸ˆ`);\r\n      if (deductSuccess) {\r\n        const addSuccess = await addCashToUserById(recipientUser.id, amount, `${userName}ë‹˜ìœ¼ë¡œë¶€í„° ì…ê¸ˆ`);\r\n        if (addSuccess) {\r\n          // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì†¡ê¸ˆ ë°œì†¡)\r\n          logActivity(db, {\r\n            classCode: currentUserClassCode,\r\n            userId: userId,\r\n            userName: userName,\r\n            type: ACTIVITY_TYPES.TRANSFER_SEND,\r\n            description: `${recipientName}ë‹˜ì—ê²Œ ${amount.toLocaleString()}ì› ì†¡ê¸ˆ`,\r\n            amount: -amount,\r\n            metadata: {\r\n              recipientId: recipientUser.id,\r\n              recipientName: recipientName\r\n            }\r\n          });\r\n\r\n          // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (ì†¡ê¸ˆ ìˆ˜ì‹ ) - ë°›ëŠ” ì‚¬ëŒë„ ê¸°ë¡\r\n          logActivity(db, {\r\n            classCode: currentUserClassCode,\r\n            userId: recipientUser.id,\r\n            userName: recipientName,\r\n            type: ACTIVITY_TYPES.TRANSFER_RECEIVE,\r\n            description: `${userName}ë‹˜ìœ¼ë¡œë¶€í„° ${amount.toLocaleString()}ì› ì…ê¸ˆ`,\r\n            amount: amount,\r\n            metadata: {\r\n              senderId: userId,\r\n              senderName: userName\r\n            }\r\n          });\r\n\r\n          alert(\"ì†¡ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\");\r\n          setShowTransferModal(false);\r\n          setTransferRecipient(\"\");\r\n          setTransferAmount(\"\");\r\n        } else {\r\n          alert(\"ë°›ëŠ” ì‚¬ëŒì—ê²Œ í˜„ê¸ˆì„ ì „ë‹¬í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì†¡ê¸ˆì´ ì·¨ì†Œë©ë‹ˆë‹¤.\");\r\n          // ì†¡ê¸ˆ ì‹¤íŒ¨ ì‹œ ì°¨ê°í–ˆë˜ ê¸ˆì•¡ì„ ë‹¤ì‹œ ë³µì›í•©ë‹ˆë‹¤.\r\n          await addCashToUserById(userId, amount, \"ì†¡ê¸ˆ ì‹¤íŒ¨ë¡œ ì¸í•œ ë³µì›\");\r\n        }\r\n      } else {\r\n        alert(\"ê³„ì¢Œì—ì„œ í˜„ê¸ˆì„ ì¸ì¶œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\r\n      }\r\n    } catch (error) {\r\n      logger.error(\"!!! ì†¡ê¸ˆ ì²˜ë¦¬ ì¤‘ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ ë°œìƒ !!!\", error);\r\n      alert(`ì†¡ê¸ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);\r\n      // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n      if (optimisticUpdate) {\r\n        optimisticUpdate({ cash: parseInt(transferAmount, 10) || 0 });\r\n      }\r\n    } finally {\r\n      setAssetsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleForceRefresh = () => {\r\n    // ìºì‹œ ì‚­ì œ\r\n    const cacheKey = `myAssets_${userId}`;\r\n    localStorage.removeItem(`firestore_cache_${cacheKey}_${userId}`);\r\n\r\n    logger.log('[MyAssets] ğŸ”„ ìºì‹œ ì‚­ì œ ë° ê°•ì œ ìƒˆë¡œê³ ì¹¨');\r\n\r\n    // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ\r\n    loadMyAssetsData();\r\n  };\r\n\r\n  const renderTitle = () => (\r\n    <div className=\"flex justify-between items-center mb-5\">\r\n      <h2 className=\"text-2xl font-bold text-cyber-cyan border-b-2 border-cyber-cyan/20 pb-2.5 m-0 drop-shadow-[0_0_10px_rgba(0,255,242,0.3)]\">\r\n        ë‚˜ì˜ ìì‚° í˜„í™© ğŸ’³\r\n      </h2>\r\n      <button\r\n        onClick={handleForceRefresh}\r\n        disabled={assetsLoading}\r\n        className={`px-4 py-2 bg-cyber-cyan/10 text-cyber-cyan border border-cyber-cyan/30 rounded-lg text-sm font-semibold transition-all duration-200 ${\r\n          assetsLoading ? 'cursor-not-allowed opacity-60' : 'cursor-pointer hover:bg-cyber-cyan/20'\r\n        }`}\r\n      >\r\n        ğŸ”„ ìƒˆë¡œê³ ì¹¨\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  const renderAssetSummary = () => {\r\n    const displayCash = Number(userDoc?.cash) || 0;\r\n    const displayCoupons = Number(userDoc?.coupons) || 0;\r\n\r\n    // ê±°ë˜ ë‚´ì—­ í‘œì‹œ ê°œìˆ˜ ê²°ì •\r\n    const displayedTransactions = showAllTransactions\r\n      ? transactionHistory\r\n      : transactionHistory.slice(0, 5);\r\n\r\n    return (\r\n      <div className=\"p-0 bg-transparent mb-6\">\r\n        {/* ë³´ìœ  í˜„ê¸ˆ - ë©”ì¸ ê°•ì¡° ì¹´ë“œ */}\r\n        <div className=\"bg-gradient-to-br from-[#667eea] to-[#764ba2] rounded-[20px] p-[30px] mb-5 shadow-[0_10px_30px_rgba(102,126,234,0.3)] border-none\">\r\n          <div className=\"mb-2.5\">\r\n            <span className=\"text-white/90 text-base font-medium\">\r\n              ğŸ’° ë³´ìœ  í˜„ê¸ˆ\r\n            </span>\r\n          </div>\r\n          <div className=\"text-[42px] font-extrabold text-white tracking-tight mb-4 text-right\">\r\n            {displayCash.toLocaleString()} <span className=\"text-[28px] font-semibold\">ì›</span>\r\n          </div>\r\n          <div className=\"flex justify-end\">\r\n            <button\r\n              onClick={() => setShowTransferModal(true)}\r\n              className=\"px-7 py-3.5 bg-white/95 text-[#667eea] border-none rounded-xl text-base font-bold cursor-pointer shadow-[0_4px_15px_rgba(0,0,0,0.1)] transition-all duration-300 hover:-translate-y-0.5 hover:shadow-[0_6px_20px_rgba(0,0,0,0.15)]\"\r\n              disabled={assetsLoading || authLoading}\r\n            >\r\n              ğŸ’¸ ì†¡ê¸ˆí•˜ê¸°\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ìµœê·¼ ì…ì¶œê¸ˆ ë‚´ì—­ - ë³´ìœ  í˜„ê¸ˆ ë°”ë¡œ ë°‘ì— ë°°ì¹˜ */}\r\n        <div className=\"mb-5\">\r\n          <h4 className=\"text-[15px] text-[#e8e8ff] font-bold mb-3\">\r\n            ğŸ’³ ìµœê·¼ ì…ì¶œê¸ˆ ë‚´ì—­\r\n          </h4>\r\n          {transactionHistory.length > 0 ? (\r\n            <div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                {displayedTransactions.map((tx) => {\r\n                  let displayDate = \"ë‚ ì§œ ì—†ìŒ\";\r\n                  try {\r\n                    const validDate = safeTimestampToDate(tx.timestamp);\r\n                    displayDate = validDate.toLocaleDateString(\"ko-KR\", {\r\n                      month: \"2-digit\",\r\n                      day: \"2-digit\",\r\n                    });\r\n                  } catch (dateError) {\r\n                    displayDate = \"ì˜¤ëŠ˜\";\r\n                  }\r\n\r\n                  const txAmount = Number(tx.amount) || 0;\r\n                  const rawDesc = tx.description;\r\n                  const txDescription = (!rawDesc || rawDesc === 'undefined' || rawDesc === 'null') ? \"ê±°ë˜ ë‚´ì—­\" : String(rawDesc);\r\n\r\n                  return (\r\n                    <div\r\n                      key={tx.id || Math.random()}\r\n                      className={`flex justify-between items-center text-sm text-[#a0a0c0] px-4 py-3.5 rounded-[10px] ${\r\n                        txAmount > 0\r\n                          ? 'bg-emerald-600/10 border border-emerald-600/30'\r\n                          : 'bg-red-600/10 border border-red-600/30'\r\n                      }`}\r\n                    >\r\n                      <span className=\"flex-1 whitespace-nowrap overflow-hidden text-ellipsis mr-2.5 font-medium text-[#e8e8ff]\">\r\n                        {displayDate} â€¢ {txDescription}\r\n                      </span>\r\n                      <span className={`font-bold text-[15px] min-w-[110px] text-right ${\r\n                        txAmount > 0 ? 'text-emerald-400' : 'text-red-400'\r\n                      }`}>\r\n                        {txAmount > 0 ? \"+\" : \"\"}\r\n                        {txAmount.toLocaleString()}ì›\r\n                      </span>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n              {transactionHistory.length > 5 && (\r\n                <button\r\n                  onClick={() => setShowAllTransactions(!showAllTransactions)}\r\n                  className=\"w-full mt-3 p-3 bg-white/5 text-[#a0a0c0] border border-white/10 rounded-[10px] text-sm font-semibold cursor-pointer transition-all duration-200 hover:bg-white/10\"\r\n                >\r\n                  {showAllTransactions ? \"â–² ì ‘ê¸°\" : `â–¼ ${transactionHistory.length - 5}ê°œ ë” ë³´ê¸°`}\r\n                </button>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-[13px] text-gray-500 text-center p-5 bg-white/[0.03] rounded-[10px] border border-dashed border-white/10\">\r\n              ìµœê·¼ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* ì´ ìˆœìì‚° - ë‘ ë²ˆì§¸ ê°•ì¡° ì¹´ë“œ */}\r\n        <div className=\"bg-gradient-to-br from-[#f093fb] to-[#f5576c] rounded-[20px] py-6 px-[30px] mb-5 shadow-[0_10px_30px_rgba(240,147,251,0.3)] border-none\">\r\n          <div className=\"mb-2\">\r\n            <span className=\"text-white/90 text-base font-medium\">\r\n              ğŸ“Š ì´ ìˆœìì‚°\r\n            </span>\r\n          </div>\r\n          <div className=\"text-[38px] font-extrabold text-white tracking-tight text-right\">\r\n            {Number(totalNetAssets).toLocaleString()} <span className=\"text-2xl font-semibold\">ì›</span>\r\n          </div>\r\n          <p className=\"mt-2 text-xs text-white/80\">\r\n            í˜„ê¸ˆ + ì¿ í°ê°€ì¹˜ + íŒŒí‚¹í†µì¥ + ì˜ˆê¸ˆ + ì ê¸ˆ + ë¶€ë™ì‚° - ëŒ€ì¶œ\r\n          </p>\r\n        </div>\r\n\r\n        {/* íŒŒí‚¹í†µì¥ */}\r\n        <div className=\"mb-5\">\r\n          <h4 className=\"text-[15px] text-[#e8e8ff] font-bold mb-3\">\r\n            ğŸ…¿ï¸ íŒŒí‚¹í†µì¥\r\n          </h4>\r\n          <div className=\"bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-[14px] p-5 border-none shadow-[0_4px_15px_rgba(6,182,212,0.2)]\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-white/90 font-medium text-sm\">\r\n                ì”ì•¡\r\n              </span>\r\n              <span className=\"font-extrabold text-[26px] text-white tracking-tight text-right block\">\r\n                {Number(parkingBalance).toLocaleString()}<span className=\"text-lg font-semibold\">ì›</span>\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <p className=\"mt-2.5 text-xs text-gray-400 text-center\">\r\n            íŒŒí‚¹í†µì¥ ë©”ë‰´ì—ì„œ ì…ì¶œê¸ˆ ë° ìƒí’ˆ ê°€ì… ê°€ëŠ¥\r\n          </p>\r\n        </div>\r\n\r\n        {/* ê¸°íƒ€ ìì‚° ì •ë³´ - ê¹”ë”í•œ ì¹´ë“œ */}\r\n        <div className=\"p-6 bg-[rgba(20,20,35,0.4)] rounded-2xl border border-cyber-cyan/10 shadow-[0_4px_12px_rgba(0,0,0,0.2)]\">\r\n          {/* ë³´ìœ  ì¿ í° */}\r\n          <div className=\"mb-5\">\r\n            <h4 className=\"text-[15px] text-gray-700 font-bold mb-3\">\r\n              ğŸŸï¸ ë³´ìœ  ì¿ í°\r\n            </h4>\r\n            <div className=\"bg-gradient-to-br from-amber-400 to-amber-500 rounded-[14px] p-5 border-none shadow-[0_4px_15px_rgba(251,191,36,0.2)]\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <div className=\"w-full\">\r\n                  <div className=\"text-[26px] font-extrabold text-white tracking-tight text-right\">\r\n                    {displayCoupons.toLocaleString()} <span className=\"text-lg font-semibold\">ê°œ</span>\r\n                  </div>\r\n                  <div className=\"text-xs text-white/85 font-medium mt-1 text-right\">\r\n                    1ì¿ í° = {Number(couponValue).toLocaleString()}ì›\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (authLoading || assetsLoading) {\r\n    return <AlchanLoading />;\r\n  }\r\n  if (!user) {\r\n    return <LoginWarning />;\r\n  }\r\n  if (!userDoc && !authLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-[80vh] text-[1.2em] text-red-500\">\r\n        ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ì—ë„ ì´ ë©”ì‹œì§€ê°€ ë³´ì´ë©´ ì•±ì„ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì¬ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.\r\n      </div>\r\n    );\r\n  }\r\n  if (!currentUserClassCode && !authLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-[80vh] text-[1.2em] text-red-500\">\r\n        í•™ê¸‰ ì½”ë“œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì—¬ í•™ê¸‰ ì½”ë“œë¥¼ í• ë‹¹ë°›ìœ¼ì„¸ìš”.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full min-h-full bg-cyber-dark\">\r\n      <div className=\"w-full px-4 md:px-6 lg:px-8 py-6\">\r\n        {renderTitle()}\r\n\r\n        {/* ì¼ì¼ ì¶œì„ ë³´ìƒ ë°°ë„ˆ */}\r\n        <DailyRewardBanner\r\n          userId={userId}\r\n          onClaim={async (reward) => {\r\n            try {\r\n              // ì‹¤ì œ í˜„ê¸ˆ ì§€ê¸‰\r\n              const userRef = doc(db, \"users\", userId);\r\n              await setDoc(userRef, {\r\n                cash: increment(reward),\r\n                updatedAt: serverTimestamp(),\r\n              }, { merge: true });\r\n\r\n              // í™œë™ ë¡œê·¸ ê¸°ë¡\r\n              await logActivity(db, {\r\n                userId,\r\n                userName,\r\n                classCode: currentUserClassCode,\r\n                type: \"ì¼ì¼ ì¶œì„ ë³´ìƒ\",\r\n                description: `ì¼ì¼ ì¶œì„ ë³´ìƒìœ¼ë¡œ ${reward.toLocaleString()}ì› íšë“`,\r\n                amount: reward,\r\n                metadata: { rewardType: \"daily_streak\" }\r\n              });\r\n\r\n              // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸\r\n              if (optimisticUpdate) {\r\n                optimisticUpdate({ cash: (userDoc?.cash || 0) + reward });\r\n              }\r\n\r\n              logger.log(`Daily reward claimed and added: ${reward}`);\r\n            } catch (error) {\r\n              logger.error(\"ì¼ì¼ ë³´ìƒ ì§€ê¸‰ ì˜¤ë¥˜:\", error);\r\n              alert(\"ë³´ìƒ ì§€ê¸‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\r\n            }\r\n          }}\r\n        />\r\n\r\n        {renderAssetSummary()}\r\n        {showTransferModal && (\r\n          <TransferModal\r\n            showTransferModal={showTransferModal}\r\n            setShowTransferModal={setShowTransferModal}\r\n            recipients={classmates}\r\n            transferRecipient={transferRecipient}\r\n            setTransferRecipient={setTransferRecipient}\r\n            transferAmount={transferAmount}\r\n            setTransferAmount={setTransferAmount}\r\n            handleTransfer={handleTransferMoney}\r\n            userId={userId}\r\n            userCash={Number(userDoc?.cash) || 0}\r\n          />\r\n        )}\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":["MyAssets","user","userDoc","users","classmates","allClassMembers","loading","authLoading","updateUser","updateUserInAuth","addCashToUserById","deductCash","optimisticUpdate","useAuth","userId","uid","userName","name","nickname","displayName","currentUserClassCode","classCode","assetsLoading","setAssetsLoading","useState","loadingRef","useRef","parkingBalance","setParkingBalance","deposits","setDeposits","savings","setSavings","loans","setLoans","realEstateAssets","setRealEstateAssets","totalNetAssets","setTotalNetAssets","goalDonations","setGoalDonations","transactionHistory","setTransactionHistory","forceReload","setForceReload","CACHE_DURATION","httpsCallable","functions","currentGoalId","concat","classCouponGoal","setClassCouponGoal","couponValue","setCouponValue","useEffect","async","settingsRef","doc","db","settingsSnap","getDoc","exists","settingsData","data","Number","error","logger","loadCouponValueFromSettings","goalProgress","setGoalProgress","myContribution","setMyContribution","goalAchieved","setGoalAchieved","isResettingGoal","setIsResettingGoal","showDonateModal","setShowDonateModal","showSellCouponModal","setShowSellCouponModal","sellAmount","setSellAmount","showGiftCouponModal","setShowGiftCouponModal","giftRecipient","setGiftRecipient","giftAmount","setGiftAmount","showDonationHistoryModal","setShowDonationHistoryModal","showTransferModal","setShowTransferModal","transferRecipient","setTransferRecipient","transferAmount","setTransferAmount","showAllTransactions","setShowAllTransactions","getCachedFirestoreData","key","cached","localStorage","getItem","timestamp","JSON","parse","Date","now","setCachedFirestoreData","cacheItem","setItem","stringify","createDefaultGoalForClass","useCallback","goalId","goalDocRef","defaultGoalData","targetAmount","progress","donations","donationCount","title","description","createdAt","serverTimestamp","updatedAt","createdBy","runTransaction","goalDoc","transaction","get","existingData","set","loadGoalData","cacheKey","cachedData","Array","isArray","myTotal","filter","d","reduce","sum","amount","goalDocSnap","goalData","map","donation","processedTimestamp","toDate","toISOString","seconds","timestampISO","_objectSpread","message","log","loadMyAssetsData","current","cachedAssets","realEstateRef1","query","collection","where","limit","realEstateRef2","realEstateRef3","parkingRef1","parkingRef2","productsRef","activityLogsRef","transactionsRef","snap1","snap2","snap3","parkingSnap1","parkingSnap2","productsSnap","activityLogsSnap","transactionsSnap","Promise","all","getDocs","catch","docs","allRealEstateAssets","forEach","push","id","totalParkingBalance","balance","depositsData","savingsData","loansData","docSnap","_docSnap$data$maturit","product","maturityDate","type","activityData","desc","couponAmount","source","tx","transactionsData","allTransactions","sort","a","b","_a$timestamp","_a$timestamp2","_b$timestamp","_b$timestamp2","dateA","recentTransactions","slice","_tx$timestamp","_tx$timestamp2","fallbackError","cashValue","cash","couponMonetaryValue","coupons","realEstateValue","asset","price","depositsTotal","deposit","savingsTotal","saving","loanTotal","loan","remainingPrincipal","calculatedTotalAssets","handleForceRefresh","removeItem","_jsx","AlchanLoading","className","children","_jsxs","onClick","disabled","DailyRewardBanner","onClaim","userRef","setDoc","increment","reward","merge","logActivity","toLocaleString","metadata","rewardType","alert","renderAssetSummary","displayCash","displayCoupons","displayedTransactions","length","displayDate","isNaN","getTime","date","safeTimestampToDate","toLocaleDateString","month","day","dateError","txAmount","rawDesc","txDescription","String","Math","random","TransferModal","recipients","handleTransfer","parseInt","recipientUser","find","u","recipientName","ACTIVITY_TYPES","TRANSFER_SEND","recipientId","TRANSFER_RECEIVE","senderId","senderName","userCash","LoginWarning"],"ignoreList":[],"sourceRoot":""}