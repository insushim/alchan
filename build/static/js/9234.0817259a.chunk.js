"use strict";(self.webpackChunkinconomysu_class=self.webpackChunkinconomysu_class||[]).push([[9234],{9234(e,a,t){t.r(a),t.d(a,{default:()=>u});var n=t(2555),s=t(5043),c=t(5016),o=t(359),r=t(2864),i=(t(5472),t(3744),t(5452));var l=t(8343);const d=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{min:t=0,max:n=Number.MAX_SAFE_INTEGER,allowZero:s=!1,fieldName:c="\uae08\uc561"}=a,o=Number(e);if(isNaN(o))throw new Error("".concat(c,"\ub294 \uc720\ud6a8\ud55c \uc22b\uc790\uc5ec\uc57c \ud569\ub2c8\ub2e4."));if(!isFinite(o))throw new Error("".concat(c,"\ub294 \uc720\ud55c\ud55c \uc22b\uc790\uc5ec\uc57c \ud569\ub2c8\ub2e4."));if(o<0)throw new Error("".concat(c,"\ub294 \uc74c\uc218\uc77c \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));if(!s&&0===o)throw new Error("".concat(c,"\ub294 0\ubcf4\ub2e4 \ucee4\uc57c \ud569\ub2c8\ub2e4."));if(o<t)throw new Error("".concat(c,"\ub294 \ucd5c\uc18c ").concat(t.toLocaleString()).concat((0,l.mx)()," \uc774\uc0c1\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4."));if(o>n)throw new Error("".concat(c,"\ub294 \ucd5c\ub300 ").concat(n.toLocaleString()).concat((0,l.mx)(),"\uc744 \ucd08\uacfc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));return Math.floor(o)};var m=t(579);const u=function(){const{userDoc:e,allClassMembers:a,loading:t,setUserDoc:l,setAllClassMembers:u}=(0,c.As)(),{currencyUnit:h}=(0,o.H2)(),[x,p]=(0,s.useState)([]),[N,g]=(0,s.useState)(""),[j,v]=(0,s.useState)("fixed"),[f,b]=(0,s.useState)("send"),[k,S]=(0,s.useState)("toMe"),[y,w]=(0,s.useState)(10),[C,M]=(0,s.useState)(""),[L,A]=(0,s.useState)(""),[E,F]=(0,s.useState)(!1),[T,_]=(0,s.useState)(!1),R=null===e||void 0===e?void 0:e.name,D=null===e||void 0===e?void 0:e.classCode,H=(0,s.useMemo)(()=>a&&0!==a.length?[...a].sort((e,a)=>{const t=e.name||e.nickname||"",n=a.name||a.nickname||"";return t.localeCompare(n,"ko")}):[],[a]);(0,s.useEffect)(()=>{p([]),F(!1)},[f,j]);const U=(0,s.useCallback)(function(e,a){let t,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t="percentage"===j?Math.floor(e*Number(a)/100):Number(a),n&&"send"===f){return t-Math.floor(t*y/100)}return t},[j,f,y]),I=(0,s.useMemo)(()=>{if(!N||0===x.length)return{};const e={};return x.forEach(a=>{const t=H.find(e=>e.id===a);if(t){const n=Number(t.cash||0),s="send"===f;e[a]=U(n,N,s)}}),e},[x,N,f,H,U]);return(0,m.jsxs)("div",{className:"money-transfer-container",children:[(0,m.jsx)("div",{className:"header",children:(0,m.jsxs)("div",{className:"admin-info",children:[(0,m.jsx)("span",{className:"admin-label",children:"\uad00\ub9ac\uc790"}),(0,m.jsx)("span",{className:"admin-name",children:R||"\ub85c\ub529 \uc911..."}),(0,m.jsxs)("span",{className:"admin-cash",children:["\ud604\uae08: ",((null===e||void 0===e?void 0:e.cash)||0).toLocaleString(),h]})]})}),L&&(0,m.jsx)("div",{className:"alert alert-error",children:L}),C&&(0,m.jsx)("div",{className:"alert alert-success",children:C}),(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0===x.length||!N||isNaN(Number(N)))return void A("\uc0ac\uc6a9\uc790\ub97c \uc120\ud0dd\ud558\uace0 \uc720\ud6a8\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694.");const a=Number(N);if(a<=0)A("".concat("percentage"===j?"\ud37c\uc13c\ud2b8":"\uae08\uc561","\uc740 0\ubcf4\ub2e4 \ucee4\uc57c \ud569\ub2c8\ub2e4."));else if("percentage"===j&&(a>100||a<0))A("\ud37c\uc13c\ud2b8\ub294 0\uacfc 100 \uc0ac\uc774\uc758 \uac12\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.");else{_(!0),M(""),A("");try{const e=H.filter(e=>x.includes(e.id)),{count:t,totalProcessed:s,updatedUsers:c}=await(async e=>{let{adminName:a,adminClassCode:t,targetUsers:n,action:s,takeMode:c,amountType:o,amount:l,taxRate:m}=e;i.vF.log("[database.js] adminCashAction \uc2dc\uc791:",{adminName:a,action:s,takeMode:c,amountType:o,amount:l,taxRate:m,targetUsersCount:n.length});try{if("percentage"===o){if(l<0||l>100)throw new Error("\ud37c\uc13c\ud2b8\ub294 0\uacfc 100 \uc0ac\uc774\uc758 \uac12\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4.")}else d(l,{min:1,fieldName:"\uae08\uc561"})}catch(L){throw new Error("\uc785\ub825 \uac80\uc99d \uc2e4\ud328: ".concat(L.message))}const u=[];let h=0,x=0;for(const N of n)try{await(0,r.c4)(r.db,async e=>{const n=(0,r.H9)(r.db,"users",N.id),p=await e.get(n);if(!p.exists())throw new Error("\uc0ac\uc6a9\uc790 ".concat(N.name,"\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."));const g=p.data(),j=Number(g.cash||0);let v;if(v="percentage"===o?Math.floor(j*l/100):d(l,{min:1,fieldName:"\uae08\uc561"}),v<=0)return void i.vF.log("[database.js] ".concat(N.name,": \ucc98\ub9ac\ud560 \uae08\uc561\uc774 0\uc6d0\uc774\ubbc0\ub85c \uc2a4\ud0b5"));let f,b=v,k=0;if("send"===s&&m>0&&(k=Math.floor(v*m/100),b=v-k),"send"===s)f=j+b;else{if(j<v)throw new Error("".concat(N.name,"\ub2d8\uc758 \uc794\uc561\uc774 \ubd80\uc871\ud569\ub2c8\ub2e4. (\ubcf4\uc720: ").concat(j.toLocaleString(),"\uc6d0, \ud544\uc694: ").concat(v.toLocaleString(),"\uc6d0)"));f=j-v}e.update(n,{cash:f,updatedAt:(0,r.O5)()});const S=(0,r.H9)((0,r.rJ)(r.db,"activity_logs"));let y,w;"send"===s?(y="ADMIN_CASH_SEND","percentage"===o?(w="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc5d0\uac8c ").concat(l,"% (").concat(b.toLocaleString(),"\uc6d0)\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),k>0&&(w+=" (\uc6d0\uae08 ".concat(v.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(k.toLocaleString(),"\uc6d0 \uc81c\uc678)"))):(w="\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc5d0\uac8c ").concat(b.toLocaleString(),"\uc6d0\uc744 \uc9c0\uae09\ud588\uc2b5\ub2c8\ub2e4."),k>0&&(w+=" (\uc6d0\uae08 ".concat(v.toLocaleString(),"\uc6d0, \uc138\uae08 ").concat(k.toLocaleString(),"\uc6d0 \uc81c\uc678)")))):"take"===s&&("remove"===c?(y="ADMIN_CASH_REMOVE",w="percentage"===o?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc758 ").concat(l,"% (").concat(v.toLocaleString(),"\uc6d0)\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc758 ").concat(v.toLocaleString(),"\uc6d0\uc744 \uc81c\uac70\ud588\uc2b5\ub2c8\ub2e4.")):(y="ADMIN_CASH_TAKE",w="percentage"===o?"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(l,"% (").concat(v.toLocaleString(),"\uc6d0)\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4."):"\uad00\ub9ac\uc790(".concat(a,")\uac00 ").concat(N.name,"\ub2d8\uc73c\ub85c\ubd80\ud130 ").concat(v.toLocaleString(),"\uc6d0\uc744 \ud68c\uc218\ud588\uc2b5\ub2c8\ub2e4.")));const C={userId:N.id,userName:N.name,timestamp:(0,r.O5)(),type:y,description:w,classCode:t,metadata:{adminName:a,action:s,amountType:o,inputValue:l,taxRate:"send"===s?m:0,baseAmount:v,taxAmount:k,finalAmount:b,previousCash:j,newCash:f}};e.set(S,C);const M=(0,r.H9)((0,r.rJ)(r.db,"transactions")),L={userId:N.id,amount:"send"===s?b:-v,type:"send"===s?"income":"expense",category:"admin",description:"send"===s?"\uad00\ub9ac\uc790 \uc9c0\uae09":"\uad00\ub9ac\uc790 \ud68c\uc218",timestamp:(0,r.O5)(),metadata:{adminName:a,amountType:o,taxRate:"send"===s?m:0}};e.set(M,L),u.push({id:N.id,newCash:f}),h+=v,x++,i.vF.log("[database.js] ".concat(N.name," \ud2b8\ub79c\uc7ad\uc158 \ucc98\ub9ac \uc644\ub8cc:"),{"\ud604\uc7ac\uc794\uc561":j,"\uae30\ubcf8\uae08\uc561":v,"\uc138\uae08":k,"\ucd5c\uc885\uae08\uc561":b,"\uc0c8\uc794\uc561":f})})}catch(p){throw i.vF.error("[database.js] \uc0ac\uc6a9\uc790 ".concat(N.name," \ucc98\ub9ac \uc911 \uc624\ub958:"),p),new Error("".concat(N.name,"\ub2d8 \ucc98\ub9ac \uc2e4\ud328: ").concat(p.message))}return i.vF.log("[database.js] adminCashAction \uc644\ub8cc: ".concat(x,"\uba85 \ucc98\ub9ac, \ucd1d ").concat(h.toLocaleString(),"\uc6d0")),{count:x,totalProcessed:h,updatedUsers:u}})({adminName:R,adminClassCode:D,targetUsers:e,action:f,takeMode:"take"===f?k:void 0,amountType:j,amount:a,taxRate:y});c&&c.length>0&&(u(e=>e.map(e=>{const a=c.find(a=>a.id===e.id);return a?(0,n.A)((0,n.A)({},e),{},{cash:a.newCash}):e})),l(e=>{const a=Number(e.cash||0);let t;return t="send"===f?a-s:"take"===f&&"toMe"===k?a+s:a,(0,n.A)((0,n.A)({},e),{},{cash:t})}));const o="send"===f?"\ubcf4\ub0b4\uae30":"toMe"===k?"\uac00\uc838\uc624\uae30":"\uc5c6\uc560\uae30";M("".concat(t,"\uba85\uc5d0\uac8c ").concat("percentage"===j?"".concat(a,"%"):"".concat(a.toLocaleString()).concat(h)," ").concat(o," \uc644\ub8cc! (\ucd1d ").concat(s.toLocaleString()).concat(h," \ucc98\ub9ac").concat("send"===f&&y>0?", \uc138\uae08 ".concat(y,"% \uc801\uc6a9"):"",")")),g(""),p([]),F(!1),setTimeout(()=>M(""),3e3)}catch(t){i.vF.error("\ucc98\ub9ac \uc911 \uc624\ub958 \ubc1c\uc0dd:",t),A("\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: ".concat(t.message)),setTimeout(()=>A(""),5e3)}finally{_(!1)}}},className:"transfer-form",children:[(0,m.jsxs)("div",{className:"action-selector",children:[(0,m.jsxs)("button",{type:"button",className:"action-btn ".concat("send"===f?"active send":""),onClick:()=>b("send"),children:[(0,m.jsx)("span",{className:"icon",children:"\ud83d\udce4"})," \ubcf4\ub0b4\uae30"]}),(0,m.jsxs)("button",{type:"button",className:"action-btn ".concat("take"===f?"active take":""),onClick:()=>b("take"),children:[(0,m.jsx)("span",{className:"icon",children:"\ud83d\udce5"})," \uac00\uc838\uc624\uae30"]})]}),"take"===f&&(0,m.jsxs)("div",{className:"take-mode-section",children:[(0,m.jsx)("h4",{children:"\uac00\uc838\uc624\uae30 \uc635\uc158"}),(0,m.jsxs)("div",{className:"take-mode-selector",children:[(0,m.jsxs)("label",{className:"mode-option ".concat("toMe"===k?"active":""),children:[(0,m.jsx)("input",{type:"radio",name:"takeMode",value:"toMe",checked:"toMe"===k,onChange:e=>S(e.target.value)}),(0,m.jsx)("span",{className:"radio-custom"}),(0,m.jsxs)("span",{className:"mode-text",children:[(0,m.jsx)("strong",{children:"\ud83d\udcb0 \ub098\uc5d0\uac8c \uac00\uc838\uc624\uae30"}),(0,m.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \ub0b4 \uacc4\uc88c\ub85c \uac00\uc838\uc635\ub2c8\ub2e4"})]})]}),(0,m.jsxs)("label",{className:"mode-option ".concat("remove"===k?"active":""),children:[(0,m.jsx)("input",{type:"radio",name:"takeMode",value:"remove",checked:"remove"===k,onChange:e=>S(e.target.value)}),(0,m.jsx)("span",{className:"radio-custom"}),(0,m.jsxs)("span",{className:"mode-text",children:[(0,m.jsx)("strong",{children:"\ud83d\uddd1\ufe0f \ub3c8 \uc5c6\uc560\uae30"}),(0,m.jsx)("small",{children:"\uc120\ud0dd\ud55c \ud559\uc0dd\ub4e4\uc758 \ub3c8\uc744 \uc601\uad6c\uc801\uc73c\ub85c \uc81c\uac70\ud569\ub2c8\ub2e4"})]})]})]})]}),(0,m.jsxs)("div",{className:"amount-section",children:[(0,m.jsxs)("div",{className:"amount-type-selector",children:[(0,m.jsxs)("label",{className:"type-option ".concat("fixed"===j?"active":""),children:[(0,m.jsx)("input",{type:"radio",name:"amountType",value:"fixed",checked:"fixed"===j,onChange:e=>v(e.target.value)}),(0,m.jsx)("span",{className:"radio-custom"})," \uace0\uc815 \uae08\uc561"]}),(0,m.jsxs)("label",{className:"type-option ".concat("percentage"===j?"active":""),children:[(0,m.jsx)("input",{type:"radio",name:"amountType",value:"percentage",checked:"percentage"===j,onChange:e=>v(e.target.value)}),(0,m.jsx)("span",{className:"radio-custom"})," \ud37c\uc13c\ud2b8 (%)"]})]}),(0,m.jsxs)("div",{className:"amount-input-group",children:[(0,m.jsx)("input",{type:"number",value:N,onChange:e=>g(e.target.value),placeholder:"fixed"===j?"\uae08\uc561 \uc785\ub825":"\ud37c\uc13c\ud2b8 \uc785\ub825",min:"1",max:"percentage"===j?"100":void 0,required:!0,className:"amount-input"}),(0,m.jsx)("span",{className:"amount-unit",children:"fixed"===j?h:"%"})]})]}),"send"===f&&(0,m.jsxs)("div",{className:"tax-section",children:[(0,m.jsxs)("div",{className:"tax-header",children:[(0,m.jsx)("h4",{children:"\ud83d\udcb8 \uc138\uae08 \uc124\uc815"}),(0,m.jsx)("span",{className:"tax-description",children:"\ubcf4\ub0b4\ub294 \uae08\uc561\uc5d0\uc11c \uc138\uae08\uc744 \uc81c\uc678\ud558\uace0 \uc9c0\uae09\ub429\ub2c8\ub2e4."})]}),(0,m.jsxs)("div",{className:"tax-input-group",children:[(0,m.jsx)("label",{htmlFor:"taxRate",children:"\uc138\uae08\uc728:"}),(0,m.jsx)("input",{type:"number",id:"taxRate",value:y,onChange:e=>w(Math.max(0,Math.min(100,Number(e.target.value)))),min:"0",max:"100",className:"tax-input"}),(0,m.jsx)("span",{className:"tax-unit",children:"%"})]}),N&&(0,m.jsx)("div",{className:"tax-preview",children:"fixed"===j?(0,m.jsxs)(m.Fragment,{children:["\uc2e4\uc81c \uc9c0\uae09\uc561:"," ",U(0,N,!0).toLocaleString(),h,"(\uc138\uae08"," ",Math.floor(Number(N)*y/100).toLocaleString(),h," \uc81c\uc678)"]}):"\uac01 \ud559\uc0dd \uc794\uc561\uc758 ".concat(N,"%\uc5d0\uc11c \uc138\uae08 ").concat(y,"%\uac00 \ucd94\uac00\ub85c \ucc28\uac10\ub429\ub2c8\ub2e4.")})]}),(0,m.jsxs)("div",{className:"user-selection-section",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)("h3",{children:"\ub300\uc0c1 \uc120\ud0dd"}),(0,m.jsxs)("label",{className:"select-all-label",children:[(0,m.jsx)("input",{type:"checkbox",checked:E,onChange:()=>{F(e=>{const a=!e;return p(a?H.map(e=>e.id):[]),a})},className:"checkbox-custom"}),(0,m.jsx)("span",{className:"checkmark"})," \uc804\uccb4 \uc120\ud0dd"]})]}),t&&0===H.length?(0,m.jsx)("div",{className:"loading",children:"\uc0ac\uc6a9\uc790 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4..."}):(0,m.jsx)("div",{className:"user-list",children:H.map(e=>{var a;const t=I[e.id];return(0,m.jsx)("div",{className:"user-item",children:(0,m.jsxs)("label",{className:"user-label",children:[(0,m.jsx)("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>{return a=e.id,void p(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},className:"checkbox-custom"}),(0,m.jsx)("span",{className:"checkmark"}),(0,m.jsxs)("div",{className:"user-info",children:[(0,m.jsx)("span",{className:"user-name",children:e.name}),(0,m.jsxs)("span",{className:"user-balance",children:["\uc794\uc561: ",(null===(a=e.cash)||void 0===a?void 0:a.toLocaleString())||0,h]}),void 0!==t&&(0,m.jsxs)("span",{className:"preview-amount ".concat(f),children:["send"===f?"+":"\u2212",t.toLocaleString(),h]})]})]})},e.id)})})]}),(0,m.jsx)("button",{type:"submit",className:"submit-btn ".concat(f),disabled:t||T,children:T?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{className:"spinner"})," \ucc98\ub9ac \uc911..."]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{className:"icon",children:"send"===f?"\ud83d\udce4":"\ud83d\udce5"})," ","send"===f?"\ubcf4\ub0b4\uae30":"\uac00\uc838\uc624\uae30"," \uc2e4\ud589"]})})]})]})}}}]);
//# sourceMappingURL=9234.0817259a.chunk.js.map