{"version":3,"file":"static/js/393.ea0c4dd7.chunk.js","mappings":"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","sources":["pages/games/OmokGame.js"],"sourcesContent":["// src/OmokGame.js - ë­í‚¹ í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ìˆ˜ì • ë° UI ê°œì„  (ì¬ëŒ€ê²° ê¸°ëŠ¥ ì¶”ê°€)\r\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    addDoc,\r\n    updateDoc,\r\n    getDoc,\r\n    runTransaction,\r\n    serverTimestamp,\r\n    deleteDoc,\r\n    query,\r\n    where,\r\n    getDocs,\r\n    orderBy,\r\n    increment,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../firebase';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { usePolling } from '../../hooks/usePolling';\r\nimport { logActivity, ACTIVITY_TYPES } from '../../utils/firestoreHelpers';\r\nimport './OmokGame.css';\r\nimport './GamePage.css';\r\n\r\nimport { logger } from \"../../utils/logger\";\r\n// [ë­í¬ ì‹œìŠ¤í…œ] ë­í¬ í¬ì¸íŠ¸(RP) ê¸°ì¤€ ì •ì˜\r\nconst RANKS = [\r\n    { title: 'LEGEND', color: '#ff0066', minRP: 2000, icon: 'ğŸ‘‘' },\r\n    { title: 'MASTER', color: '#ff4500', minRP: 1500, icon: 'ğŸ’' },\r\n    { title: 'DIAMOND', color: '#00bfff', minRP: 1300, icon: 'ğŸ’ ' },\r\n    { title: 'PLATINUM', color: '#4169e1', minRP: 1150, icon: 'â­' },\r\n    { title: 'GOLD', color: '#ffd700', minRP: 1050, icon: 'ğŸ†' },\r\n    { title: 'SILVER', color: '#c0c0c0', minRP: 950, icon: 'ğŸ¥ˆ' },\r\n    { title: 'BRONZE', color: '#cd7f32', minRP: 0, icon: 'ğŸ¥‰' },\r\n];\r\n\r\nconst RP_ON_WIN = 15;\r\nconst RP_ON_LOSS = 8;\r\nconst BASE_RP = 1000;\r\n\r\nconst BOARD_SIZE = 21;\r\n\r\n// ===== ì˜¤ëª© AI ì—”ì§„ =====\r\nconst getIndex = (row, col) => row * BOARD_SIZE + col;\r\nconst getBoardValue = (board, row, col) => {\r\n    if (row < 0 || row >= BOARD_SIZE || col < 0 || col >= BOARD_SIZE) return undefined;\r\n    return board[getIndex(row, col)];\r\n};\r\n\r\n// íŒ¨í„´ í‰ê°€: ìƒˆë¡œìš´ í†µí•© í‰ê°€ í•¨ìˆ˜\r\nconst evaluatePattern = (board, row, col, color) => {\r\n    const directions = [[1, 0], [0, 1], [1, 1], [1, -1]];\r\n    let totalScore = 0;\r\n\r\n    for (const [dr, dc] of directions) {\r\n        let forward = 0;\r\n        let backward = 0;\r\n\r\n        // ì• ë°©í–¥ìœ¼ë¡œ ê°œìˆ˜ ì„¸ê¸°\r\n        for (let i = 1; i < 5; i++) {\r\n            const r = row + i * dr;\r\n            const c = col + i * dc;\r\n            if (r < 0 || r >= BOARD_SIZE || c < 0 || c >= BOARD_SIZE) break;\r\n            if (board[getIndex(r, c)] !== color) break;\r\n            forward++;\r\n        }\r\n\r\n        // ë’· ë°©í–¥ìœ¼ë¡œ ê°œìˆ˜ ì„¸ê¸°\r\n        for (let i = 1; i < 5; i++) {\r\n            const r = row - i * dr;\r\n            const c = col - i * dc;\r\n            if (r < 0 || r >= BOARD_SIZE || c < 0 || c >= BOARD_SIZE) break;\r\n            if (board[getIndex(r, c)] !== color) break;\r\n            backward++;\r\n        }\r\n\r\n        const total = forward + backward + 1; // í˜„ì¬ ëŒ í¬í•¨\r\n\r\n        // ì–‘ ë ìƒíƒœ í™•ì¸\r\n        const forwardR = row + (forward + 1) * dr;\r\n        const forwardC = col + (forward + 1) * dc;\r\n        const backwardR = row - (backward + 1) * dr;\r\n        const backwardC = col - (backward + 1) * dc;\r\n\r\n        let openEnds = 0;\r\n        // ì•ìª½ ëì´ ì—´ë ¤ìˆìœ¼ë©´\r\n        if (forwardR >= 0 && forwardR < BOARD_SIZE && forwardC >= 0 && forwardC < BOARD_SIZE) {\r\n            if (board[getIndex(forwardR, forwardC)] === null) openEnds++;\r\n        }\r\n        // ë’¤ìª½ ëì´ ì—´ë ¤ìˆìœ¼ë©´\r\n        if (backwardR >= 0 && backwardR < BOARD_SIZE && backwardC >= 0 && backwardC < BOARD_SIZE) {\r\n            if (board[getIndex(backwardR, backwardC)] === null) openEnds++;\r\n        }\r\n\r\n        // íŒ¨í„´ì— ë”°ë¥¸ ì ìˆ˜ ë¶€ì—¬\r\n        if (total >= 5) {\r\n            totalScore += 100000000; // 5ëª©\r\n        } else if (total === 4) {\r\n            if (openEnds === 2) totalScore += 500000; // ì—´ë¦° 4 (í•„ìŠ¹)\r\n            else if (openEnds === 1) totalScore += 50000; // ë‹«íŒ 4\r\n        } else if (total === 3) {\r\n            if (openEnds === 2) totalScore += 10000; // ì—´ë¦° 3\r\n            else if (openEnds === 1) totalScore += 1000; // ë‹«íŒ 3\r\n        } else if (total === 2) {\r\n            if (openEnds === 2) totalScore += 500; // ì—´ë¦° 2\r\n            else if (openEnds === 1) totalScore += 50; // ë‹«íŒ 2\r\n        } else if (total === 1) {\r\n            if (openEnds === 2) totalScore += 10;\r\n        }\r\n    }\r\n\r\n    return totalScore;\r\n};\r\n\r\nconst evaluateLine = (line) => {\r\n    const counts = { black: 0, white: 0 };\r\n    line.forEach(cell => {\r\n        if (cell) counts[cell]++;\r\n    });\r\n\r\n    if (counts.black > 0 && counts.white > 0) return 0; // Mixed line\r\n\r\n    const player = counts.black > 0 ? 'black' : 'white';\r\n    const count = counts[player];\r\n\r\n    if (count === 5) return 100000;\r\n    if (count === 4) return 10000;\r\n    if (count === 3) return 100;\r\n    if (count === 2) return 10;\r\n    if (count === 1) return 1;\r\n    return 0;\r\n};\r\n\r\nconst evaluateBoard = (board) => {\r\n    let score = 0;\r\n    const directions = [[1, 0], [0, 1], [1, 1], [1, -1]];\r\n\r\n    for (let r = 0; r < BOARD_SIZE; r++) {\r\n        for (let c = 0; c < BOARD_SIZE; c++) {\r\n            directions.forEach(([dr, dc]) => {\r\n                if (r + dr * 4 < BOARD_SIZE && c + dc * 4 < BOARD_SIZE && c + dc * 4 >= 0) {\r\n                    const line = [];\r\n                    for (let i = 0; i < 5; i++) {\r\n                        line.push(getBoardValue(board, r + i * dr, c + i * dc));\r\n                    }\r\n                    score += evaluateLine(line);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    return score;\r\n};\r\n\r\n// =======================\r\n// ìƒˆë¡œìš´ í†µí•© ìŠ¹ë¦¬ íŒì • ë¡œì§\r\nconst checkForWin = (board, row, col, player) => {\r\n    const directions = [\r\n        { y: 0, x: 1 },  // ê°€ë¡œ\r\n        { y: 1, x: 0 },  // ì„¸ë¡œ\r\n        { y: 1, x: 1 },  // ëŒ€ê°ì„  (\\)\r\n        { y: 1, x: -1 }  // ëŒ€ê°ì„  (/)\r\n    ];\r\n\r\n    for (const dir of directions) {\r\n        let count = 1; // í˜„ì¬ ë†“ì€ ëŒ í¬í•¨\r\n\r\n        // ì •ë°©í–¥ íƒìƒ‰\r\n        for (let i = 1; i < 6; i++) {\r\n            const r = row + i * dir.y;\r\n            const c = col + i * dir.x;\r\n            if (getBoardValue(board, r, c) === player) {\r\n                count++;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        // ì—­ë°©í–¥ íƒìƒ‰\r\n        for (let i = 1; i < 6; i++) {\r\n            const r = row - i * dir.y;\r\n            const c = col - i * dir.x;\r\n            if (getBoardValue(board, r, c) === player) {\r\n                count++;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        // 6ëª© ì´ìƒì€ ìŠ¹ë¦¬ê°€ ì•„ë‹˜\r\n        if (count === 5) {\r\n            return player;\r\n        }\r\n    }\r\n\r\n    return null; // ìŠ¹ë¦¬í•˜ì§€ ì•ŠìŒ\r\n};\r\n\r\n// ìœ„ì¹˜ í‰ê°€: ìƒˆë¡œìš´ íŒ¨í„´ ê¸°ë°˜ í‰ê°€ (1ì°¨ì›ì  ì‚¬ê³ )\r\nconst evaluatePosition = (board, row, col, color, opponentColor, difficulty) => {\r\n    // í•´ë‹¹ ìœ„ì¹˜ì— ëŒì„ ë†“ì•˜ë‹¤ê³  ê°€ì •í•˜ê³  í‰ê°€\r\n    const tempBoard = [...board];\r\n    const idx = getIndex(row, col);\r\n\r\n    tempBoard[idx] = color;\r\n    const myScore = evaluatePattern(tempBoard, row, col, color);\r\n\r\n    // ìƒëŒ€ë°©ì´ ì´ ìœ„ì¹˜ì— ë†“ì•˜ì„ ë•Œì˜ ì ìˆ˜ (ë°©ì–´ ê°€ì¹˜)\r\n    tempBoard[idx] = opponentColor;\r\n    const opponentScore = evaluatePattern(tempBoard, row, col, opponentColor);\r\n\r\n    // ë‚œì´ë„ë³„ ê°€ì¤‘ì¹˜ ì¡°ì •\r\n    let attackWeight = 1.0;\r\n    let defenseWeight = 1.0;\r\n\r\n    if (difficulty === 'ì´ˆê¸‰') {\r\n        attackWeight = 0.8;\r\n        defenseWeight = 0.6; // ë°©ì–´ ì•½í•¨\r\n    } else if (difficulty === 'ì¤‘ê¸‰') {\r\n        attackWeight = 1.0;\r\n        defenseWeight = 0.9;\r\n    } else if (difficulty === 'ìƒê¸‰') {\r\n        attackWeight = 1.2;\r\n        defenseWeight = 1.1; // ë°©ì–´ë„ ì¤‘ìš”í•˜ê²Œ\r\n    }\r\n\r\n    return myScore * attackWeight + opponentScore * defenseWeight;\r\n};\r\n\r\nconst findBestMove = (board, aiColor, difficulty) => {\r\n    // ëŒì´ ë†“ì¸ ìœ„ì¹˜ ì°¾ê¸°\r\n    const placedStones = [];\r\n    for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {\r\n        if (board[i]) {\r\n            placedStones.push({ r: Math.floor(i / BOARD_SIZE), c: i % BOARD_SIZE });\r\n        }\r\n    }\r\n\r\n    // ì²« ìˆ˜ë¼ë©´ ì¤‘ì•™ ê·¼ì²˜ì— ë†“ê¸°\r\n    if (placedStones.length <= 1) {\r\n        const center = Math.floor(BOARD_SIZE / 2);\r\n        const centerMoves = [\r\n            { r: center, c: center }, { r: center, c: center + 1 }, { r: center + 1, c: center }, { r: center + 1, c: center + 1 },\r\n            { r: center - 1, c: center }, { r: center, c: center - 1 }, { r: center + 1, c: center - 1 }, { r: center - 1, c: center + 1 }\r\n        ];\r\n        for (const move of centerMoves) {\r\n            if (!board[getIndex(move.r, move.c)]) {\r\n                return move;\r\n            }\r\n        }\r\n    }\r\n\r\n    const opponentColor = aiColor === 'black' ? 'white' : 'black';\r\n\r\n    // ë‚œì´ë„ì— ë”°ë¼ íƒìƒ‰ ë²”ìœ„ ì¡°ì •\r\n    let searchRange = 2;\r\n    if (difficulty === 'ì´ˆê¸‰') searchRange = 1;\r\n    else if (difficulty === 'ì¤‘ê¸‰') searchRange = 2;\r\n    else if (difficulty === 'ìƒê¸‰') searchRange = 3;\r\n\r\n    // ì´ë¯¸ ë†“ì¸ ëŒ ì£¼ë³€ ë²”ìœ„ ì´ë‚´ì˜ ë¹ˆ ìë¦¬ë§Œ íƒìƒ‰\r\n    const possibleMoves = [];\r\n    const checkedPositions = new Set();\r\n\r\n    for (const stone of placedStones) {\r\n        for (let dr = -searchRange; dr <= searchRange; dr++) {\r\n            for (let dc = -searchRange; dc <= searchRange; dc++) {\r\n                const r = stone.r + dr;\r\n                const c = stone.c + dc;\r\n                if (r >= 0 && r < BOARD_SIZE && c >= 0 && c < BOARD_SIZE) {\r\n                    const idx = getIndex(r, c);\r\n                    const key = `${r},${c}`;\r\n                    if (!board[idx] && !checkedPositions.has(key)) {\r\n                        possibleMoves.push({ r, c });\r\n                        checkedPositions.add(key);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (possibleMoves.length === 0) {\r\n        // ë§Œì•½ íƒìƒ‰ëœ ìˆ˜ê°€ ì—†ë‹¤ë©´, ê·¸ëƒ¥ ë¹„ì–´ìˆëŠ” ì²«ë²ˆì§¸ ì¹¸ì— ë‘”ë‹¤ (ì˜ˆì™¸ ì²˜ë¦¬)\r\n        const firstEmpty = board.findIndex(cell => cell === null);\r\n        if (firstEmpty !== -1) {\r\n            return { r: Math.floor(firstEmpty / BOARD_SIZE), c: firstEmpty % BOARD_SIZE };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // 1ìˆœìœ„: ì¦‰ì‹œ ìŠ¹ë¦¬ ìˆ˜ ì°¾ê¸°\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = aiColor;\r\n        if (checkForWin(testBoard, move.r, move.c, aiColor)) {\r\n            return move; // ì¦‰ì‹œ ìŠ¹ë¦¬\r\n        }\r\n    }\r\n\r\n    // 2ìˆœìœ„: ìƒëŒ€ë°©ì˜ ìŠ¹ë¦¬ ë§‰ê¸° (ë°©ì–´)\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = opponentColor;\r\n        if (checkForWin(testBoard, move.r, move.c, opponentColor)) {\r\n            return move; // í•„ìˆ˜ ë°©ì–´\r\n        }\r\n    }\r\n\r\n    // 3ìˆœìœ„: ë‚´ ì—´ë¦° 4 ì°¾ê¸° (ê±°ì˜ í•„ìŠ¹)\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = aiColor;\r\n        const patternScore = evaluatePattern(testBoard, move.r, move.c, aiColor);\r\n        if (patternScore >= 500000) { // ì—´ë¦° 4\r\n            logger.log('[AI] ë‚´ ì—´ë¦° 4 ë°œê²¬:', move);\r\n            return move;\r\n        }\r\n    }\r\n\r\n    // 4ìˆœìœ„: ìƒëŒ€ë°© 4 ë§‰ê¸° (ë‹«íŒ 4 í¬í•¨)\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = opponentColor;\r\n        const patternScore = evaluatePattern(testBoard, move.r, move.c, opponentColor);\r\n        if (patternScore >= 50000) { // ë‹«íŒ 4 ì´ìƒ\r\n            logger.log('[AI] ìƒëŒ€ 4ëª© ë§‰ê¸°:', move, 'score:', patternScore);\r\n            return move;\r\n        }\r\n    }\r\n\r\n    // 5ìˆœìœ„: ë‚´ ì—´ë¦° 3 ë§Œë“¤ê¸°\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = aiColor;\r\n        const patternScore = evaluatePattern(testBoard, move.r, move.c, aiColor);\r\n        if (patternScore >= 10000) { // ì—´ë¦° 3\r\n            logger.log('[AI] ë‚´ ì—´ë¦° 3 ë°œê²¬:', move);\r\n            return move;\r\n        }\r\n    }\r\n\r\n    // 6ìˆœìœ„: ìƒëŒ€ ì—´ë¦° 3 ë§‰ê¸° (ë§¤ìš° ì¤‘ìš”!)\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = opponentColor;\r\n        const patternScore = evaluatePattern(testBoard, move.r, move.c, opponentColor);\r\n        if (patternScore >= 10000) { // ì—´ë¦° 3\r\n            logger.log('[AI] ìƒëŒ€ ì—´ë¦° 3 ë§‰ê¸°:', move, 'score:', patternScore);\r\n            if (difficulty === 'ìƒê¸‰') {\r\n                return move; // ìƒê¸‰ì€ ë°˜ë“œì‹œ ë§‰ìŒ\r\n            } else if (difficulty === 'ì¤‘ê¸‰' && Math.random() > 0.1) {\r\n                return move; // ì¤‘ê¸‰ì€ 90% í™•ë¥ ë¡œ ë§‰ìŒ\r\n            }\r\n        }\r\n    }\r\n\r\n    // 7ìˆœìœ„: ìƒëŒ€ ë‹«íŒ 3 ë§‰ê¸°\r\n    if (difficulty !== 'ì´ˆê¸‰') {\r\n        for (const move of possibleMoves) {\r\n            const testBoard = [...board];\r\n            testBoard[getIndex(move.r, move.c)] = opponentColor;\r\n            const patternScore = evaluatePattern(testBoard, move.r, move.c, opponentColor);\r\n            if (patternScore >= 1000) { // ë‹«íŒ 3\r\n                logger.log('[AI] ìƒëŒ€ ë‹«íŒ 3 ë§‰ê¸°:', move, 'score:', patternScore);\r\n                if (difficulty === 'ìƒê¸‰' && Math.random() > 0.3) {\r\n                    return move; // ìƒê¸‰ì€ 70% í™•ë¥ ë¡œ ë§‰ìŒ\r\n                } else if (difficulty === 'ì¤‘ê¸‰' && Math.random() > 0.5) {\r\n                    return move; // ì¤‘ê¸‰ì€ 50% í™•ë¥ ë¡œ ë§‰ìŒ\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // 8ìˆœìœ„: ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ìˆ˜ ì„ íƒ\r\n    let bestMove = null;\r\n    let bestScore = -Infinity;\r\n\r\n    for (const move of possibleMoves) {\r\n        const testBoard = [...board];\r\n        testBoard[getIndex(move.r, move.c)] = aiColor;\r\n\r\n        let score = evaluatePosition(testBoard, move.r, move.c, aiColor, opponentColor, difficulty);\r\n\r\n        // ì¤‘ì•™ ë¶€ê·¼ì— ê°€ì¤‘ì¹˜ (ì´ˆë°˜ì— ìœ ë¦¬)\r\n        const center = Math.floor(BOARD_SIZE / 2);\r\n        const centerDist = Math.abs(move.r - center) + Math.abs(move.c - center);\r\n        score += (BOARD_SIZE - centerDist) * 5;\r\n\r\n        // ë‚œì´ë„ì— ë”°ë¥¸ ëœë¤ì„± ì¶”ê°€ (ì´ˆê¸‰ì€ ë” ë§ì€ ì‹¤ìˆ˜)\r\n        if (difficulty === 'ì´ˆê¸‰') {\r\n            score += (Math.random() - 0.5) * 3000; // í° ëœë¤ì„±\r\n        } else if (difficulty === 'ì¤‘ê¸‰') {\r\n            score += (Math.random() - 0.5) * 300; // ì‘ì€ ëœë¤ì„±\r\n        }\r\n        // ìƒê¸‰ì€ ëœë¤ì„± ì—†ìŒ\r\n\r\n        if (score > bestScore) {\r\n            bestScore = score;\r\n            bestMove = move;\r\n        }\r\n    }\r\n\r\n    logger.log('[AI] ìµœì¢… ì„ íƒ:', bestMove);\r\n    return bestMove;\r\n};\r\n// =======================\r\n\r\n\r\n// [ë­í¬ ì‹œìŠ¤í…œ] RP ê¸°ë°˜ìœ¼ë¡œ ë­í¬ ì •ë³´ë¥¼ ê³„ì‚°í•˜ëŠ” í—¬í¼ í•¨ìˆ˜\r\nconst getOmokRankDetails = (omokStats) => {\r\n    const wins = omokStats?.wins || 0;\r\n    const losses = omokStats?.losses || 0;\r\n    const totalRP = omokStats?.totalRP;\r\n\r\n    const currentRP = totalRP !== undefined ? totalRP : \r\n        Math.max(0, BASE_RP + (wins * RP_ON_WIN) - (losses * RP_ON_LOSS));\r\n\r\n    const currentRank = RANKS.find(rank => currentRP >= rank.minRP);\r\n    const currentRankIndex = RANKS.findIndex(rank => rank.title === currentRank.title);\r\n\r\n    let nextRank = null;\r\n    let pointsForNextRank = 0;\r\n\r\n    if (currentRankIndex > 0) {\r\n        nextRank = RANKS[currentRankIndex - 1];\r\n        pointsForNextRank = nextRank.minRP - currentRP;\r\n    }\r\n\r\n    return {\r\n        currentRank,\r\n        nextRank,\r\n        currentRP,\r\n        pointsForNextRank,\r\n        wins,\r\n        losses,\r\n    };\r\n};\r\n\r\n// [ë­í¬ ì‹œìŠ¤í…œ] ì‚¬ìš©ì ì˜¤ëª© ê¸°ë¡ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (RP í¬í•¨)\r\nconst updateUserOmokRecord = async (userId, result) => {\r\n    if (!userId || userId === 'AI') return;\r\n    try {\r\n        const userDocRef = doc(db, 'users', userId);\r\n        await runTransaction(db, async (transaction) => {\r\n            const userDoc = await transaction.get(userDocRef);\r\n            if (!userDoc.exists()) {\r\n                logger.error(`ì‚¬ìš©ì ${userId}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n                return;\r\n            }\r\n\r\n            const userData = userDoc.data();\r\n            const currentOmok = userData.omok || { wins: 0, losses: 0, totalRP: BASE_RP };\r\n            \r\n            let newWins = currentOmok.wins || 0;\r\n            let newLosses = currentOmok.losses || 0;\r\n            let newTotalRP = currentOmok.totalRP !== undefined ? currentOmok.totalRP : BASE_RP;\r\n\r\n            if (result === 'win') {\r\n                newWins += 1;\r\n                newTotalRP += RP_ON_WIN;\r\n            } else if (result === 'loss') {\r\n                newLosses += 1;\r\n                newTotalRP = Math.max(0, newTotalRP - RP_ON_LOSS);\r\n            }\r\n\r\n            const updatedOmok = {\r\n                wins: newWins,\r\n                losses: newLosses,\r\n                totalRP: newTotalRP,\r\n            };\r\n\r\n            transaction.update(userDocRef, { omok: updatedOmok });\r\n            logger.log(`ì‚¬ìš©ì ${userId} ì˜¤ëª© ê¸°ë¡ ì—…ë°ì´íŠ¸:`, updatedOmok);\r\n        });\r\n    } catch (error) {\r\n        logger.error('ì‚¬ìš©ì ì˜¤ëª© ê¸°ë¡ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);\r\n    }\r\n};\r\n\r\n// [UI ì»´í¬ë„ŒíŠ¸] ë­í¬ í‘œì‹œ ì»´í¬ë„ŒíŠ¸\r\nconst RankDisplay = ({ rankDetails, showProgress = false, size = 'normal' }) => {\r\n    if (!rankDetails) return null;\r\n    \r\n    const { currentRank, currentRP, nextRank, pointsForNextRank, wins, losses } = rankDetails;\r\n    const winRate = wins + losses > 0 ? Math.round((wins / (wins + losses)) * 100) : 0;\r\n    \r\n    const sizeClass = size === 'small' ? 'rank-display-small' : 'rank-display';\r\n    \r\n    return (\r\n        <div className={sizeClass}>\r\n            <div className=\"rank-badge\" style={{ backgroundColor: currentRank.color }}>\r\n                <span className=\"rank-icon\">{currentRank.icon}</span>\r\n                <span className=\"rank-title\">{currentRank.title}</span>\r\n            </div>\r\n            <div className=\"rp-info\">\r\n                <span className=\"rp-value\">{currentRP} RP</span>\r\n                {showProgress && (\r\n                    <div className=\"rank-stats\">\r\n                        <span className=\"win-loss\">{wins}ìŠ¹ {losses}íŒ¨ ({winRate}%)</span>\r\n                        {nextRank && (\r\n                            <div className=\"next-rank-progress\">\r\n                                <span className=\"next-rank-text\">\r\n                                    {nextRank.icon} {nextRank.title}ê¹Œì§€ {pointsForNextRank} RP\r\n                                </span>\r\n                                <div className=\"progress-bar\">\r\n                                    <div \r\n                                        className=\"progress-fill\" \r\n                                        style={{ \r\n                                            width: `${Math.max(10, (currentRP - currentRank.minRP) / (nextRank.minRP - currentRank.minRP) * 100)}%`,\r\n                                            backgroundColor: nextRank.color \r\n                                        }}\r\n                                    ></div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        {!nextRank && (\r\n                            <div className=\"max-rank\">ğŸ† ìµœê³  ë­í¬!</div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst OmokGame = () => {\r\n    const { user, userDoc, addCouponsToUserById, isAdmin, addCash } = useAuth();\r\n    const [gameId, setGameId] = useState(null);\r\n    const [game, setGame] = useState(null);\r\n    const [error, setError] = useState('');\r\n    const [createdGameId, setCreatedGameId] = useState(null);\r\n    const [isThinking, setIsThinking] = useState(false);\r\n    const [lastMove, setLastMove] = useState(null);\r\n    const [showWinAnimation, setShowWinAnimation] = useState(false);\r\n    const [availableGames, setAvailableGames] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [selectedCell, setSelectedCell] = useState(null);\r\n    const [gameResult, setGameResult] = useState(null);\r\n    const refetchGameDataRef = useRef(null);\r\n    const [feedback, setFeedback] = useState({ message: '', type: '' });\r\n    const [gameMode, setGameMode] = useState('player'); // 'player' or 'ai'\r\n    const [aiDifficulty, setAiDifficulty] = useState('ì¤‘ê¸‰'); // 'í•˜ê¸‰', 'ì¤‘ê¸‰', 'ìƒê¸‰'\r\n    const [dailyPlayCount, setDailyPlayCount] = useState(0);\r\n    const [omokStats, setOmokStats] = useState(userDoc?.omok);\r\n\r\n    useEffect(() => {\r\n        setOmokStats(userDoc?.omok);\r\n    }, [userDoc?.omok]);\r\n\r\n    // ë¡œì»¬ ìƒíƒœë¥¼ ì´ìš©í•œ ë‚™ê´€ì  ì „ì  ì—…ë°ì´íŠ¸\r\n    const localOptimisticOmokUpdate = useCallback((result) => {\r\n        setOmokStats(prevStats => {\r\n            if (!prevStats) return null;\r\n\r\n            const currentWins = prevStats.wins || 0;\r\n            const currentLosses = prevStats.losses || 0;\r\n            const currentRP = prevStats.totalRP !== undefined ? prevStats.totalRP : BASE_RP;\r\n\r\n            let newWins = currentWins;\r\n            let newLosses = currentLosses;\r\n            let newRP = currentRP;\r\n\r\n            if (result === 'win') {\r\n                newWins += 1;\r\n                newRP += RP_ON_WIN;\r\n            } else if (result === 'loss') {\r\n                newLosses += 1;\r\n                newRP = Math.max(0, newRP - RP_ON_LOSS);\r\n            }\r\n\r\n            const newStats = {\r\n                wins: newWins,\r\n                losses: newLosses,\r\n                totalRP: newRP\r\n            };\r\n            logger.log('[LocalOptimistic] ì „ì  ë¡œì»¬ ì—…ë°ì´íŠ¸:', newStats);\r\n            return newStats;\r\n        });\r\n    }, []);\r\n\r\n    const [showRewardSelection, setShowRewardSelection] = useState(false);\r\n    const [rewardCards, setRewardCards] = useState([]);\r\n    const [isAiThinking, setIsAiThinking] = useState(false);\r\n\r\n\r\n    const gameIdRef = useRef(gameId);\r\n    useEffect(() => { gameIdRef.current = gameId; }, [gameId]);\r\n    const gameRef = useRef(game);\r\n    useEffect(() => { gameRef.current = game; }, [game]);\r\n    const userRef = useRef(user);\r\n    useEffect(() => { userRef.current = user; }, [user]);\r\n\r\n    useEffect(() => {\r\n        const cleanup = () => {\r\n            const currentGameId = gameIdRef.current;\r\n            const currentGame = gameRef.current;\r\n            const currentUser = userRef.current;\r\n            // í˜¸ìŠ¤íŠ¸ê°€ ë‚˜ê°€ë©´ í•­ìƒ ë°© ì‚­ì œ (ìƒíƒœ ë¬´ê´€)\r\n            if (\r\n                currentGameId &&\r\n                currentGame &&\r\n                currentUser &&\r\n                currentGame.host === currentUser.uid\r\n            ) {\r\n                deleteDoc(doc(db, 'omokGames', currentGameId));\r\n            }\r\n        };\r\n        window.addEventListener('beforeunload', cleanup);\r\n        return () => {\r\n            window.removeEventListener('beforeunload', cleanup);\r\n        };\r\n    }, []);\r\n\r\n    const createEmptyBoard = () => new Array(BOARD_SIZE * BOARD_SIZE).fill(null);\r\n\r\n    const fetchAvailableGames = useCallback(async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const gamesRef = collection(db, 'omokGames');\r\n            const q = query(\r\n                gamesRef,\r\n                where('gameStatus', '==', 'waiting'),\r\n                orderBy('createdAt', 'desc')\r\n            );\r\n\r\n            const querySnapshot = await getDocs(q);\r\n            const games = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setAvailableGames(games);\r\n        } catch (err) {\r\n            logger.error('ê²Œì„ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', err);\r\n            setError('ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []); // user ì˜ì¡´ì„± ì œê±° - í•„ìš” ì‹œ userëŠ” í´ë¡œì €ë¡œ ì ‘ê·¼\r\n\r\n    const deleteGameRoom = async (roomId, e) => {\r\n        e.stopPropagation();\r\n        if (!isAdmin()) {\r\n            logger.error('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');\r\n            return;\r\n        }\r\n        if (!window.confirm('ì´ ê²Œì„ë°©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;\r\n        try {\r\n            await deleteDoc(doc(db, 'omokGames', roomId));\r\n            logger.log(`[ê´€ë¦¬ì] ê²Œì„ë°© ${roomId} ì‚­ì œ ì™„ë£Œ`);\r\n            fetchAvailableGames();\r\n        } catch (err) {\r\n            logger.error('ê²Œì„ë°© ì‚­ì œ ì˜¤ë¥˜:', err);\r\n            setError('ê²Œì„ë°© ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n        }\r\n    };\r\n\r\n    const createGame = async () => {\r\n        if (!user || !userDoc) {\r\n            setError('ì‚¬ìš©ì ì •ë³´ê°€ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');\r\n            return;\r\n        }\r\n\r\n        if (gameMode === 'ai') {\r\n            if (dailyPlayCount >= 5) {\r\n                setError('í•˜ë£¨ì— 5ë²ˆë§Œ AI ëŒ€ì „ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');\r\n                return;\r\n            }\r\n        }\r\n\r\n        setLoading(true);\r\n        const myName = userDoc.name || userDoc.nickname || user.displayName || 'ìµëª…';\r\n        const myClass = userDoc.classCode || 'ë¯¸ì„¤ì •';\r\n        const myRankDetails = getOmokRankDetails(omokStats);\r\n\r\n        const isAiMode = gameMode === 'ai';\r\n        const playerColor = 'black';\r\n        const aiColor = 'white';\r\n\r\n        try {\r\n            const newGame = {\r\n                board: createEmptyBoard(),\r\n                players: isAiMode ? { [user.uid]: playerColor, 'AI': aiColor } : { [user.uid]: 'black' },\r\n                playerNames: isAiMode ? { [user.uid]: myName, 'AI': `AI (${aiDifficulty})` } : { [user.uid]: myName },\r\n                playerClasses: { [user.uid]: myClass },\r\n                playerRanks: { [user.uid]: myRankDetails },\r\n                currentPlayer: user.uid,\r\n                winner: null,\r\n                createdAt: serverTimestamp(),\r\n                host: user.uid,\r\n                hostName: myName,\r\n                hostClass: myClass,\r\n                hostRank: myRankDetails.currentRank,\r\n                turnStartTime: serverTimestamp(),\r\n                history: [],\r\n                gameStatus: isAiMode ? 'playing' : 'waiting',\r\n                statsUpdated: false,\r\n                rematch: {},\r\n                aiMode: isAiMode,\r\n                aiDifficulty: isAiMode ? aiDifficulty : null,\r\n            };\r\n\r\n            const gameDocRef = await addDoc(collection(db, 'omokGames'), newGame);\r\n            setGameId(gameDocRef.id);\r\n\r\n            // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: ê²Œì„ ê°ì²´ë¥¼ ì¦‰ì‹œ ì„¤ì •í•˜ì—¬ UIê°€ ë°”ë¡œ ì „í™˜ë˜ë„ë¡ í•¨\r\n            setGame({\r\n                ...newGame,\r\n                id: gameDocRef.id,\r\n                createdAt: new Date(), // serverTimestamp ëŒ€ì‹  ì„ì‹œë¡œ í˜„ì¬ ì‹œê°„\r\n                turnStartTime: new Date()\r\n            });\r\n\r\n            // AI ëª¨ë“œì—ì„œëŠ” í”Œë ˆì´ì–´ê°€ ì„ ê³µì´ë¯€ë¡œ ì¦‰ì‹œ isThinkingì„ trueë¡œ ì„¤ì •\r\n            if (isAiMode) {\r\n                setIsThinking(true);\r\n            }\r\n\r\n            if (!isAiMode) {\r\n                setCreatedGameId(gameDocRef.id);\r\n            }\r\n            setError('');\r\n            if (refetchGameDataRef.current) refetchGameDataRef.current();\r\n        } catch (err) {\r\n            logger.error('ê²Œì„ ìƒì„± ì˜¤ë¥˜:', err);\r\n            setError('ê²Œì„ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const joinGame = async (id) => {\r\n        if (!user || !userDoc || !id) return;\r\n        setLoading(true);\r\n        setError('');\r\n        const myName = userDoc.name || userDoc.nickname || user.displayName || 'ìµëª…';\r\n        const myClass = userDoc.classCode || 'ë¯¸ì„¤ì •';\r\n        const myRankDetails = getOmokRankDetails(omokStats);\r\n\r\n        try {\r\n            const gameDocRef = doc(db, 'omokGames', id);\r\n            await runTransaction(db, async (transaction) => {\r\n                const gameDoc = await transaction.get(gameDocRef);\r\n                if (!gameDoc.exists()) throw new Error('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì„ì…ë‹ˆë‹¤.');\r\n                const gameData = gameDoc.data();\r\n                if (Object.keys(gameData.players).length >= 2 && !gameData.players[user.uid]) throw new Error('ì´ë¯¸ ê°€ë“ ì°¬ ë°©ì…ë‹ˆë‹¤.');\r\n                if (!gameData.players[user.uid]) {\r\n                    transaction.update(gameDocRef, {\r\n                        players: { ...gameData.players, [user.uid]: 'white' },\r\n                        playerNames: { ...gameData.playerNames, [user.uid]: myName },\r\n                        playerClasses: { ...gameData.playerClasses, [user.uid]: myClass },\r\n                        playerRanks: { ...gameData.playerRanks, [user.uid]: myRankDetails },\r\n                        gameStatus: 'playing',\r\n                        turnStartTime: serverTimestamp()\r\n                    });\r\n                }\r\n                setGameId(id);\r\n            });\r\n        } catch (err) {\r\n            logger.error('ê²Œì„ ì°¸ê°€ ì˜¤ë¥˜:', err);\r\n            setError(err.message);\r\n            fetchAvailableGames();\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };    \r\n    \r\n    const leaveGame = useCallback(async () => {\r\n        if (!gameId || !game || !user) return;\r\n\r\n        const gameDocRef = doc(db, 'omokGames', gameId);\r\n        try {\r\n            // í˜¸ìŠ¤íŠ¸ê°€ ë– ë‚˜ëŠ” ê²½ìš° í•­ìƒ ë°© ì‚­ì œ\r\n            if (game.host === user.uid) {\r\n                logger.log('[LeaveGame] í˜¸ìŠ¤íŠ¸ê°€ ë°©ì„ ë– ë‚¨ - ë°© ì‚­ì œ');\r\n\r\n                // ê²Œì„ ì§„í–‰ ì¤‘ì´ê³  ìƒëŒ€ë°©ì´ ìˆìœ¼ë©´ ì „ì  ì²˜ë¦¬\r\n                if (game.gameStatus === 'playing' && !game.winner) {\r\n                    const opponentId = Object.keys(game.players).find(p => p !== user.uid);\r\n                    if (opponentId && !game.aiMode) {\r\n                        // í˜¸ìŠ¤íŠ¸ íŒ¨ë°°, ìƒëŒ€ë°© ìŠ¹ë¦¬ ì²˜ë¦¬\r\n                        localOptimisticOmokUpdate('loss'); // ë¡œì»¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n                        await updateUserOmokRecord(user.uid, 'loss');\r\n                        await updateUserOmokRecord(opponentId, 'win');\r\n\r\n                        const gameStartTime = game.createdAt?.toDate().getTime();\r\n                        const shouldAwardCoupon = gameStartTime && (Date.now() - gameStartTime > 15000);\r\n                        if (shouldAwardCoupon && addCouponsToUserById) {\r\n                            await addCouponsToUserById(opponentId, 1);\r\n                        }\r\n                    } else if (game.aiMode) {\r\n                        // AI ëª¨ë“œì—ì„œëŠ” í˜¸ìŠ¤íŠ¸ íŒ¨ë°°ë§Œ ì²˜ë¦¬\r\n                        localOptimisticOmokUpdate('loss'); // ë¡œì»¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n                        await updateUserOmokRecord(user.uid, 'loss');\r\n                    }\r\n                }\r\n\r\n                // ë°© ì‚­ì œ\r\n                await deleteDoc(gameDocRef);\r\n            } else if (game.gameStatus === 'playing' && game.players[user.uid] && !game.winner) {\r\n                // í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹Œ í”Œë ˆì´ì–´ê°€ ê²Œì„ ì¤‘ ë– ë‚˜ëŠ” ê²½ìš°\r\n                const opponentId = Object.keys(game.players).find(p => p !== user.uid);\r\n                if (opponentId) {\r\n                    const gameStartTime = game.createdAt?.toDate().getTime();\r\n                    const shouldAwardCoupon = gameStartTime && (Date.now() - gameStartTime > 15000);\r\n\r\n                    const finalUpdate = { winner: opponentId, gameStatus: 'finished', statsUpdated: true };\r\n                    if (shouldAwardCoupon) finalUpdate.couponAwardedTo = opponentId;\r\n                    await updateDoc(gameDocRef, finalUpdate);\r\n\r\n                    localOptimisticOmokUpdate('loss'); // ë¡œì»¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n                    await updateUserOmokRecord(user.uid, 'loss');\r\n                    await updateUserOmokRecord(opponentId, 'win');\r\n\r\n                    if (shouldAwardCoupon && addCouponsToUserById) await addCouponsToUserById(opponentId, 1);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            logger.error(\"ê²Œì„ ë‚˜ê°€ê¸° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\", error);\r\n        } finally {\r\n            setGameId(null); setGame(null); setError(''); setCreatedGameId(null);\r\n            setShowWinAnimation(false); setSelectedCell(null); setGameResult(null);\r\n            setShowRewardSelection(false);\r\n            fetchAvailableGames();\r\n        }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [game, gameId, user, fetchAvailableGames, addCouponsToUserById]);\r\n\r\n    const checkForbiddenMove = (board, row, col, player) => false;\r\n\r\n    const placeStone = async (row, col) => {\r\n        logger.log('[Player] placeStone í•¨ìˆ˜ ì‹œì‘:', { row, col, gameId, userId: user.uid });\r\n\r\n        const boardWithNewStone = [...game.board];\r\n        const myColor = game.players[user.uid];\r\n        boardWithNewStone[getIndex(row, col)] = myColor;\r\n\r\n        logger.log('[Player] ë‚´ ìƒ‰:', myColor, 'ìœ„ì¹˜:', getIndex(row, col));\r\n\r\n        if (myColor === 'black') {\r\n          const forbiddenMove = checkForbiddenMove(boardWithNewStone, row, col, 'black');\r\n          if (forbiddenMove) {\r\n              setError(`ê¸ˆìˆ˜ì…ë‹ˆë‹¤: ${forbiddenMove}. ë‹¤ë¥¸ ê³³ì— ë‘ì„¸ìš”.`);\r\n              setSelectedCell(null);\r\n              logger.log('[Player] ê¸ˆìˆ˜ë¡œ ì¸í•´ ì¤‘ë‹¨');\r\n              return;\r\n          }\r\n        }\r\n\r\n        const winner = checkForWin(boardWithNewStone, row, col, myColor);\r\n        const nextPlayer = Object.keys(game.players).find((p) => p !== user.uid);\r\n        const moveData = { row, col, player: myColor, timestamp: new Date() };\r\n        const newHistory = [...(game.history || []), moveData];\r\n\r\n        logger.log('[Player] ìŠ¹ì ì²´í¬:', winner, 'ë‹¤ìŒ í”Œë ˆì´ì–´:', nextPlayer);\r\n\r\n        try {\r\n            const gameDocRef = doc(db, 'omokGames', gameId);\r\n            const updateData = {\r\n                board: boardWithNewStone,\r\n                currentPlayer: winner ? null : nextPlayer,\r\n                winner: winner ? user.uid : null,\r\n                history: newHistory,\r\n                turnStartTime: serverTimestamp(),\r\n                gameStatus: winner ? 'finished' : 'playing'\r\n            };\r\n\r\n            if (winner && !game.aiMode) {\r\n                const gameStartTime = game.createdAt?.toDate().getTime();\r\n                const shouldAwardCoupon = gameStartTime && (Date.now() - gameStartTime > 15000);\r\n                if (shouldAwardCoupon) updateData.couponAwardedTo = user.uid;\r\n            }\r\n\r\n            logger.log('[Player] Firestore ì—…ë°ì´íŠ¸ ì‹œì‘...', updateData);\r\n\r\n            // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: Firestore ì—…ë°ì´íŠ¸ ì „ì— ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸\r\n            setGame({\r\n                ...game,\r\n                board: boardWithNewStone,\r\n                currentPlayer: winner ? null : nextPlayer,\r\n                winner: winner ? user.uid : null,\r\n                history: newHistory,\r\n                gameStatus: winner ? 'finished' : 'playing'\r\n            });\r\n            setLastMove({ row, col });\r\n            setIsThinking(false);\r\n            setSelectedCell(null);\r\n\r\n            await updateDoc(gameDocRef, updateData);\r\n            logger.log('[Player] Firestore ì—…ë°ì´íŠ¸ ì™„ë£Œ!');\r\n\r\n            setError('');\r\n\r\n            logger.log('[Player] í”Œë ˆì´ì–´ ëŒ ë°°ì¹˜ ì™„ë£Œ. ë‹¤ìŒ ì°¨ë¡€:', nextPlayer);\r\n\r\n            if (winner) {\r\n                if (game.aiMode) {\r\n                    // AI ëª¨ë“œì—ì„œ ìŠ¹ë¦¬ ì‹œ í†µê³„ ì—…ë°ì´íŠ¸ ë° ë³´ìƒ ì¹´ë“œ í‘œì‹œ\r\n                    localOptimisticOmokUpdate('win'); // ë¡œì»¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n                    await updateUserOmokRecord(user.uid, 'win');\r\n                    await updateDoc(gameDocRef, { statsUpdated: true });\r\n                    setGameResult({ outcome: 'win', rpChange: RP_ON_WIN });\r\n\r\n                    const cards = generateRewardCards(game.aiDifficulty);\r\n                    setRewardCards(cards);\r\n                    setShowRewardSelection(true);\r\n                } else {\r\n                    setShowWinAnimation(true);\r\n                    if (updateData.couponAwardedTo && addCouponsToUserById) {\r\n                        await addCouponsToUserById(user.uid, 1);\r\n                    }\r\n                }\r\n            }\r\n        } catch (err) {\r\n            logger.error('ì›€ì§ì„ ì²˜ë¦¬ ì˜¤ë¥˜:', err);\r\n            setError('ì›€ì§ì„ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n            // ì—ëŸ¬ ì‹œ ë‹¤ì‹œ ë‚´ ì°¨ë¡€ë¡œ ì„¤ì •\r\n            setIsThinking(true);\r\n        }\r\n    };\r\n\r\n    const handleCellClick = async (row, col) => {\r\n        logger.log('[Click] ì…€ í´ë¦­:', { row, col });\r\n        logger.log('[Click] ìƒíƒœ ì²´í¬:', {\r\n            hasGame: !!game,\r\n            winner: game?.winner,\r\n            cellValue: getBoardValue(game?.board, row, col),\r\n            currentPlayer: game?.currentPlayer,\r\n            userId: user?.uid,\r\n            isMyTurn: game?.currentPlayer === user?.uid,\r\n            isThinking,\r\n            selectedCell\r\n        });\r\n\r\n        if (!game || game.winner || getBoardValue(game.board, row, col) ||\r\n            game.currentPlayer !== user.uid || !isThinking) {\r\n            logger.log('[Click] í´ë¦­ ë¬´ì‹œë¨');\r\n            return;\r\n        }\r\n\r\n        // AI ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ 2ëª… ì²´í¬\r\n        if (!game.aiMode && Object.keys(game.players).length < 2) {\r\n            logger.log('[Click] í”Œë ˆì´ì–´ 2ëª… ë¯¸ë§Œ');\r\n            return;\r\n        }\r\n\r\n        if (selectedCell && selectedCell.row === row && selectedCell.col === col) {\r\n            logger.log('[Click] ë‘ ë²ˆì§¸ í´ë¦­ - ëŒ ë°°ì¹˜ ì‹œì‘');\r\n            await placeStone(row, col);\r\n            setSelectedCell(null);\r\n        } else {\r\n            logger.log('[Click] ì²« ë²ˆì§¸ í´ë¦­ - ë¯¸ë¦¬ë³´ê¸°');\r\n            setSelectedCell({ row, col });\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // ë¡œë¹„ í™”ë©´ ì§„ì… ì‹œ 1íšŒë§Œ ê²Œì„ ëª©ë¡ ë¡œë“œ (ìë™ í´ë§ ì œê±°)\r\n    // ğŸ”¥ [ìµœì í™”] sessionStorage ì‚¬ìš©ìœ¼ë¡œ ì¤‘ë³µ í˜¸ì¶œ ì™„ì „ ë°©ì§€\r\n    const hasFetchedGamesRef = useRef(false);\r\n    const lastGameIdRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        // ê²Œì„ì—ì„œ ë‚˜ì™”ì„ ë•Œë§Œ í”Œë˜ê·¸ ë¦¬ì…‹ (gameIdê°€ ìˆì—ˆë‹¤ê°€ ì—†ì–´ì§„ ê²½ìš°)\r\n        if (lastGameIdRef.current && !gameId) {\r\n            hasFetchedGamesRef.current = false;\r\n        }\r\n        lastGameIdRef.current = gameId;\r\n\r\n        // ë¡œë¹„ í™”ë©´ì—ì„œë§Œ ê²Œì„ ëª©ë¡ ë¡œë“œ (í•œ ë²ˆë§Œ)\r\n        if (user && !gameId && !hasFetchedGamesRef.current) {\r\n            logger.log('[Lobby] ê²Œì„ ëª©ë¡ ìµœì´ˆ ë¡œë“œ');\r\n            fetchAvailableGames();\r\n            hasFetchedGamesRef.current = true;\r\n        }\r\n    }, [user, gameId, fetchAvailableGames]);\r\n\r\n    const fetchGameData = useCallback(async () => {\r\n        if (!gameId) return;\r\n\r\n        try {\r\n            const gameDocRef = doc(db, 'omokGames', gameId);\r\n            const docSnap = await getDoc(gameDocRef);\r\n\r\n            if (docSnap.exists()) {\r\n                const gameData = docSnap.data();\r\n                setGame(gameData);\r\n\r\n                if (gameData.winner && !gameData.statsUpdated && !gameData.aiMode) {\r\n                    // í”Œë ˆì´ì–´ ëŒ€ì „ ëª¨ë“œì—ì„œë§Œ ì—¬ê¸°ì„œ í†µê³„ ì—…ë°ì´íŠ¸\r\n                    const winnerId = gameData.winner;\r\n                    const loserId = Object.keys(gameData.players).find(p => p !== winnerId);\r\n\r\n                    if (loserId) {\r\n                        // ë¡œì»¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n                        if (user.uid === winnerId) {\r\n                            localOptimisticOmokUpdate('win');\r\n                        } else if (user.uid === loserId) {\r\n                            localOptimisticOmokUpdate('loss');\r\n                        }\r\n\r\n                        await updateUserOmokRecord(winnerId, 'win');\r\n                        await updateUserOmokRecord(loserId, 'loss');\r\n                        await updateDoc(gameDocRef, { statsUpdated: true });\r\n\r\n                        if (user.uid === winnerId) setGameResult({ outcome: 'win', rpChange: RP_ON_WIN });\r\n                        else if (user.uid === loserId) setGameResult({ outcome: 'loss', rpChange: -RP_ON_LOSS });\r\n                    }\r\n                }\r\n\r\n                const history = gameData.history || [];\r\n                if (history.length > 0) setLastMove({ row: history[history.length - 1].row, col: history[history.length - 1].col });\r\n\r\n                if (gameData.currentPlayer === user.uid && gameData.gameStatus === 'playing') {\r\n                    setIsThinking(true);\r\n                } else {\r\n                    setIsThinking(false); setSelectedCell(null);\r\n                }\r\n            } else {\r\n                setGameId(null); setGame(null); setError('ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆê±°ë‚˜ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\r\n            }\r\n        } catch (error) {\r\n            logger.error('ê²Œì„ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);\r\n            setError('ê²Œì„ ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\r\n        }\r\n    }, [gameId, user, localOptimisticOmokUpdate]);\r\n\r\n    // í´ë§ í™œì„±í™” ì¡°ê±´: ê²Œì„ IDê°€ ìˆê³ , ê²Œì„ì´ ì§„í–‰ ì¤‘ì´ë©°, AI ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ\r\n    // AI ëª¨ë“œì—ì„œëŠ” ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì²˜ë¦¬í•˜ë¯€ë¡œ í´ë§ ë¶ˆí•„ìš”\r\n    const shouldPoll = !!gameId && game?.gameStatus === 'playing' && !game?.aiMode;\r\n    const pollingInterval = 30000; // ğŸ”¥ [ìµœì í™”] 10ì´ˆ â†’ 30ì´ˆ (ì½ê¸° ë¹„ìš© ì ˆê°)\r\n    const { refetch: refetchGameData } = usePolling(fetchGameData, {\r\n        interval: pollingInterval,\r\n        enabled: shouldPoll,\r\n        deps: [gameId, game?.gameStatus, game?.aiMode]\r\n    });\r\n    useEffect(() => { refetchGameDataRef.current = refetchGameData; }, [refetchGameData]);\r\n\r\n    useEffect(() => { if (showWinAnimation) { const timer = setTimeout(() => setShowWinAnimation(false), 3000); return () => clearTimeout(timer); } }, [showWinAnimation]);\r\n\r\n    const handleRematchRequest = async () => {\r\n        if (!gameId || !user) return;\r\n        try {\r\n            await updateDoc(doc(db, 'omokGames', gameId), { [`rematch.${user.uid}`]: true });\r\n        } catch (err) {\r\n            logger.error(\"ì¬ëŒ€ê²° ìš”ì²­ ì˜¤ë¥˜:\", err);\r\n            setError(\"ì¬ëŒ€ê²°ì„ ìš”ì²­í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\");\r\n        }\r\n    };\r\n\r\n    const resetGameForRematch = useCallback(async () => {\r\n        if (!game || !game.winner || !gameId) return;\r\n\r\n        const playerIds = Object.keys(game.players);\r\n        if (playerIds.length < 2) return;\r\n\r\n        const winnerId = game.winner, loserId = playerIds.find(p => p !== winnerId);\r\n        if (!loserId) { logger.error(\"ì¬ëŒ€ê²°ì„ ìœ„í•œ íŒ¨ìë¥¼ ê²°ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"); return; }\r\n\r\n        const newPlayers = { [loserId]: 'black', [winnerId]: 'white' };\r\n        const newCurrentPlayer = loserId;\r\n\r\n        try {\r\n            await updateDoc(doc(db, 'omokGames', gameId), {\r\n                board: createEmptyBoard(),\r\n                currentPlayer: newCurrentPlayer,\r\n                players: newPlayers,\r\n                winner: null, history: [], gameStatus: 'playing', statsUpdated: false,\r\n                turnStartTime: serverTimestamp(), couponAwardedTo: null, rematch: {}\r\n            });\r\n            \r\n            setGameResult(null); setShowWinAnimation(false); setLastMove(null); setSelectedCell(null); setError('');\r\n        } catch (error) {\r\n            logger.error(\"ì¬ëŒ€ê²° ë¦¬ì…‹ ì˜¤ë¥˜:\", error);\r\n            setError(\"ì¬ëŒ€ê²° ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\r\n        }\r\n    }, [game, gameId]);\r\n\r\n    useEffect(() => {\r\n        if (game && game.gameStatus === 'finished' && game.rematch && user?.uid === game.host && !game.aiMode) {\r\n            const playerIds = Object.keys(game.players);\r\n            if (playerIds.length === 2 && game.rematch[playerIds[0]] && game.rematch[playerIds[1]]) {\r\n                resetGameForRematch();\r\n            }\r\n        }\r\n    }, [game, user, resetGameForRematch]);\r\n\r\n    // AI í„´ ì²˜ë¦¬ - useRefë¡œ ìµœì‹  game ì°¸ì¡°í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¬ì‹¤í–‰ ë°©ì§€\r\n    const aiTurnProcessedRef = useRef(false);\r\n\r\n    useEffect(() => {\r\n        // AI ëª¨ë“œê°€ ì•„ë‹ˆê±°ë‚˜ ê²Œì„ì´ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ\r\n        if (!game || !game.aiMode || game.winner || !gameId) {\r\n            aiTurnProcessedRef.current = false;\r\n            return;\r\n        }\r\n\r\n        // AI ì°¨ë¡€ê°€ ì•„ë‹ˆë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ\r\n        if (game.currentPlayer !== 'AI') {\r\n            logger.log('[AI] í˜„ì¬ ì°¨ë¡€:', game.currentPlayer, '(AI ì•„ë‹˜)');\r\n            setIsAiThinking(false);\r\n            aiTurnProcessedRef.current = false;\r\n            return;\r\n        }\r\n\r\n        // ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€\r\n        if (aiTurnProcessedRef.current) {\r\n            logger.log('[AI] ì´ë¯¸ ì²˜ë¦¬ ì¤‘ - ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');\r\n            return;\r\n        }\r\n\r\n        logger.log('[AI] AI ì°¨ë¡€ ì‹œì‘');\r\n        aiTurnProcessedRef.current = true;\r\n        setIsAiThinking(true);\r\n        const thinkingTime = 500 + Math.random() * 1000;\r\n\r\n        const timer = setTimeout(async () => {\r\n            try {\r\n                const aiColor = game.players['AI'];\r\n                logger.log('[AI] AI ìƒ‰ìƒ:', aiColor);\r\n\r\n                const bestMove = findBestMove(game.board, aiColor, game.aiDifficulty);\r\n                logger.log('[AI] ìµœì ì˜ ìˆ˜:', bestMove);\r\n\r\n                if (!bestMove) {\r\n                    logger.error('[AI] ìœ íš¨í•œ ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');\r\n                    setIsAiThinking(false);\r\n                    aiTurnProcessedRef.current = false;\r\n                    return;\r\n                }\r\n\r\n                const { r, c } = bestMove;\r\n                const boardWithNewStone = [...game.board];\r\n                boardWithNewStone[getIndex(r, c)] = aiColor;\r\n\r\n                const winner = checkForWin(boardWithNewStone, r, c, aiColor);\r\n                const nextPlayer = Object.keys(game.players).find((p) => p !== 'AI');\r\n                const moveData = { row: r, col: c, player: aiColor, timestamp: new Date() };\r\n                const newHistory = [...(game.history || []), moveData];\r\n\r\n                const gameDocRef = doc(db, 'omokGames', gameId);\r\n                const updateData = {\r\n                    board: boardWithNewStone,\r\n                    currentPlayer: winner ? null : nextPlayer,\r\n                    winner: winner ? 'AI' : null,\r\n                    history: newHistory,\r\n                    turnStartTime: serverTimestamp(),\r\n                    gameStatus: winner ? 'finished' : 'playing'\r\n                };\r\n\r\n                // AIê°€ ì´ê¸°ë©´ ì‚¬ìš©ìì˜ íŒ¨ë°° ê¸°ë¡ ì—…ë°ì´íŠ¸ ì˜ˆì•½\r\n                if (winner) {\r\n                    updateData.statsUpdated = false;\r\n                }\r\n\r\n                logger.log('[AI] Firestore ì—…ë°ì´íŠ¸ ì‹œì‘');\r\n\r\n                // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: Firestore ì—…ë°ì´íŠ¸ ì „ì— ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸\r\n                logger.log('[AI] setGame í˜¸ì¶œ ì „ - board[', getIndex(r, c), ']:', boardWithNewStone[getIndex(r, c)]);\r\n                setGame(prevGame => {\r\n                    const newGame = {\r\n                        ...prevGame,\r\n                        board: boardWithNewStone,\r\n                        currentPlayer: winner ? null : nextPlayer,\r\n                        winner: winner ? 'AI' : null,\r\n                        history: newHistory,\r\n                        gameStatus: winner ? 'finished' : 'playing'\r\n                    };\r\n                    logger.log('[AI] setGame í˜¸ì¶œ - ìƒˆë¡œìš´ currentPlayer:', newGame.currentPlayer);\r\n                    logger.log('[AI] setGame í˜¸ì¶œ - board[', getIndex(r, c), ']:', newGame.board[getIndex(r, c)]);\r\n                    return newGame;\r\n                });\r\n                setLastMove({ row: r, col: c });\r\n                setIsAiThinking(false);\r\n\r\n                // AIê°€ ëŒì„ ë†“ê³  í”Œë ˆì´ì–´ ì°¨ë¡€ê°€ ë˜ë©´ isThinkingì„ trueë¡œ ì„¤ì •\r\n                if (!winner && nextPlayer === user?.uid) {\r\n                    logger.log('[AI] í”Œë ˆì´ì–´ ì°¨ë¡€ë¡œ ë³€ê²½ - isThinkingì„ trueë¡œ ì„¤ì •');\r\n                    setIsThinking(true);\r\n                }\r\n\r\n                await updateDoc(gameDocRef, updateData);\r\n                logger.log('[AI] ëŒ ë°°ì¹˜ ì™„ë£Œ:', r, c);\r\n\r\n                // AI ìŠ¹ë¦¬ ì‹œ ì¦‰ì‹œ ì‚¬ìš©ì íŒ¨ë°° ê¸°ë¡ ì—…ë°ì´íŠ¸\r\n                if (winner && user?.uid) {\r\n                    localOptimisticOmokUpdate('loss'); // ë¡œì»¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸\r\n                    await updateUserOmokRecord(user.uid, 'loss');\r\n                    await updateDoc(gameDocRef, { statsUpdated: true });\r\n                    setGameResult({ outcome: 'loss', rpChange: -RP_ON_LOSS });\r\n                    logger.log('[AI] AI ìŠ¹ë¦¬ ì²˜ë¦¬ ì™„ë£Œ');\r\n                }\r\n\r\n                setIsAiThinking(false);\r\n                aiTurnProcessedRef.current = false;\r\n            } catch (err) {\r\n                logger.error('[AI] ì›€ì§ì„ ì²˜ë¦¬ ì˜¤ë¥˜:', err);\r\n                setIsAiThinking(false);\r\n                aiTurnProcessedRef.current = false;\r\n            }\r\n        }, thinkingTime);\r\n\r\n        return () => {\r\n            clearTimeout(timer);\r\n        };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [game?.currentPlayer, game?.aiMode, game?.winner, gameId, user]);\r\n\r\n    // ë³´ìƒ ì¹´ë“œ ìƒì„±\r\n    const generateRewardCards = (difficulty) => {\r\n        const baseCash = { 'í•˜ê¸‰': 1000, 'ì¤‘ê¸‰': 3000, 'ìƒê¸‰': 5000 };\r\n        const cashDifficultyBonus = { 'í•˜ê¸‰': 1000, 'ì¤‘ê¸‰': 2000, 'ìƒê¸‰': 4000 };\r\n        const couponDifficultyBonus = { 'í•˜ê¸‰': 1, 'ì¤‘ê¸‰': 2, 'ìƒê¸‰': 3 };\r\n\r\n        const cashAmount = baseCash[difficulty] + Math.floor(Math.random() * cashDifficultyBonus[difficulty]);\r\n        const couponAmount = 1 + Math.floor(Math.random() * couponDifficultyBonus[difficulty]);\r\n\r\n        return [\r\n            { type: 'cash', amount: cashAmount },\r\n            { type: 'coupon', amount: couponAmount }\r\n        ].sort(() => Math.random() - 0.5); // ì¹´ë“œë¥¼ ëœë¤ìœ¼ë¡œ ì„ìŒ\r\n    };\r\n\r\n    // ë³´ìƒ ì„ íƒ ì²˜ë¦¬\r\n    const handleRewardSelection = async (selectedCard) => {\r\n        if (!user || !gameId) {\r\n            logger.log('[Reward] user ë˜ëŠ” gameId ì—†ìŒ');\r\n            return;\r\n        }\r\n\r\n        logger.log('[Reward] ë³´ìƒ ì„ íƒ:', selectedCard);\r\n\r\n        // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: ì¦‰ì‹œ UIì— ë°˜ì˜\r\n        const today = new Date().toDateString();\r\n        const storageKey = `omokPlayCount_${user.uid}_${today}`;\r\n        const newCount = dailyPlayCount + 1;\r\n\r\n        localStorage.setItem(storageKey, newCount.toString());\r\n        setDailyPlayCount(newCount);\r\n        setShowRewardSelection(false);\r\n\r\n        setFeedback({\r\n            message: selectedCard.type === 'cash'\r\n                ? `í˜„ê¸ˆ ${selectedCard.amount.toLocaleString()}ì›ì„ íšë“í–ˆìŠµë‹ˆë‹¤!`\r\n                : `ì¿ í° ${selectedCard.amount}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`,\r\n            type: 'success'\r\n        });\r\n\r\n        try {\r\n            // ë‚™ê´€ì  ì—…ë°ì´íŠ¸: í—¤ë”ì— ì¦‰ì‹œ ë°˜ì˜\r\n            if (selectedCard.type === 'cash') {\r\n                // optimisticUpdate({ cash: selectedCard.amount });\r\n                logger.log('[Reward] í˜„ê¸ˆ ë‚™ê´€ì  ì—…ë°ì´íŠ¸:', selectedCard.amount);\r\n            } else if (selectedCard.type === 'coupon') {\r\n                // optimisticUpdate({ coupons: selectedCard.amount });\r\n                logger.log('[Reward] ì¿ í° ë‚™ê´€ì  ì—…ë°ì´íŠ¸:', selectedCard.amount);\r\n            }\r\n\r\n            // Firestore ì—…ë°ì´íŠ¸\r\n            if (selectedCard.type === 'cash') {\r\n                logger.log('[Reward] í˜„ê¸ˆ ì§€ê¸‰:', selectedCard.amount);\r\n                await addCash(selectedCard.amount, 'AI ì˜¤ëª© ìŠ¹ë¦¬ ë³´ìƒ');\r\n            } else if (selectedCard.type === 'coupon') {\r\n                logger.log('[Reward] ì¿ í° ì§€ê¸‰:', selectedCard.amount);\r\n                await addCouponsToUserById(user.uid, selectedCard.amount);\r\n            }\r\n\r\n            // ğŸ”¥ í™œë™ ë¡œê·¸ ê¸°ë¡ (AI ì˜¤ëª© ìŠ¹ë¦¬ ë³´ìƒ)\r\n            logActivity(db, {\r\n                classCode: userDoc?.classCode,\r\n                userId: user.uid,\r\n                userName: userDoc?.name || 'ì‚¬ìš©ì',\r\n                type: ACTIVITY_TYPES.GAME_WIN,\r\n                description: `ì˜¤ëª© AI(${game?.aiDifficulty || 'ì¤‘ê¸‰'}) ìŠ¹ë¦¬ - ${selectedCard.type === 'cash' ? `í˜„ê¸ˆ ${selectedCard.amount.toLocaleString()}ì›` : `ì¿ í° ${selectedCard.amount}ê°œ`} íšë“`,\r\n                amount: selectedCard.type === 'cash' ? selectedCard.amount : 0,\r\n                couponAmount: selectedCard.type === 'coupon' ? selectedCard.amount : 0,\r\n                metadata: {\r\n                    gameType: 'omok',\r\n                    opponent: 'AI',\r\n                    difficulty: game?.aiDifficulty || 'ì¤‘ê¸‰',\r\n                    rewardType: selectedCard.type,\r\n                    rewardAmount: selectedCard.amount\r\n                }\r\n            });\r\n\r\n            logger.log('[Reward] ë³´ìƒ ì§€ê¸‰ ì™„ë£Œ');\r\n            setTimeout(() => leaveGame(), 2000);\r\n\r\n        } catch (error) {\r\n            logger.error(\"[Reward] Error applying reward:\", error);\r\n            setFeedback({ message: 'ë³´ìƒ ì§€ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', type: 'error' });\r\n\r\n            // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡¤ë°± (í”Œë ˆì´ ì¹´ìš´íŠ¸ë§Œ)\r\n            const rollbackCount = dailyPlayCount;\r\n            localStorage.setItem(storageKey, rollbackCount.toString());\r\n            setDailyPlayCount(rollbackCount);\r\n        }\r\n    };\r\n\r\n    const renderBoard = () => {\r\n        const cells = [];\r\n        const starPointCoords = [4, 10, 16];\r\n\r\n        // ê°€ë¡œì„  ê·¸ë¦¬ê¸° (ê° ì…€ì˜ ì¤‘ì‹¬ì„ ì§€ë‚˜ë„ë¡)\r\n        const horizontalLines = [];\r\n        for (let i = 0; i < BOARD_SIZE; i++) {\r\n            horizontalLines.push(\r\n                <div\r\n                    key={`h-line-${i}`}\r\n                    className=\"grid-line horizontal\"\r\n                    style={{\r\n                        top: `calc((${i} + 0.5) * var(--cell-size))`,\r\n                    }}\r\n                />\r\n            );\r\n        }\r\n\r\n        // ì„¸ë¡œì„  ê·¸ë¦¬ê¸° (ê° ì…€ì˜ ì¤‘ì‹¬ì„ ì§€ë‚˜ë„ë¡)\r\n        const verticalLines = [];\r\n        for (let j = 0; j < BOARD_SIZE; j++) {\r\n            verticalLines.push(\r\n                <div\r\n                    key={`v-line-${j}`}\r\n                    className=\"grid-line vertical\"\r\n                    style={{\r\n                        left: `calc((${j} + 0.5) * var(--cell-size))`,\r\n                    }}\r\n                />\r\n            );\r\n        }\r\n\r\n        for (let i = 0; i < BOARD_SIZE; i++) {\r\n            for (let j = 0; j < BOARD_SIZE; j++) {\r\n                const cellValue = getBoardValue(game.board, i, j);\r\n                const isSelected = selectedCell && selectedCell.row === i && selectedCell.col === j;\r\n                const isLastMove = lastMove && lastMove.row === i && lastMove.col === j;\r\n                const isStarPoint = starPointCoords.includes(i) && starPointCoords.includes(j);\r\n\r\n                cells.push(\r\n                    <div\r\n                        key={`${i}-${j}`}\r\n                        className={`omok-cell ${game.currentPlayer === user.uid && !cellValue ? 'clickable' : ''} ${isSelected ? 'preview' : ''}`}\r\n                        onClick={() => handleCellClick(i, j)}\r\n                        style={{\r\n                            gridRow: i + 1,\r\n                            gridColumn: j + 1\r\n                        }}\r\n                    >\r\n                        {isStarPoint && <div className=\"star-point\"></div>}\r\n                        {cellValue && (\r\n                            <div className={`omok-stone ${cellValue}`}>\r\n                                {isLastMove && <div className=\"last-move-indicator\"></div>}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                );\r\n            }\r\n        }\r\n        return (\r\n            <div className=\"omok-board\" style={{'--board-size': BOARD_SIZE}}>\r\n                <div className=\"grid-lines-container\">\r\n                    {horizontalLines}\r\n                    {verticalLines}\r\n                </div>\r\n                {cells}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    useEffect(() => {\r\n        const loadDailyPlayCount = () => {\r\n            if (!user) return;\r\n\r\n            const today = new Date().toDateString();\r\n            const storageKey = `omokPlayCount_${user.uid}_${today}`;\r\n            const count = parseInt(localStorage.getItem(storageKey) || '0', 10);\r\n            setDailyPlayCount(count);\r\n        };\r\n\r\n        loadDailyPlayCount();\r\n    }, [user]);\r\n\r\n    if (!gameId || !game) {\r\n        const myRankDetails = getOmokRankDetails(omokStats);\r\n        return (\r\n            <div className=\"game-page-container\">\r\n                <div className=\"omok-header\">\r\n                    <h2>ê¸€ë¡œë²Œ ì˜¤ëª© ê²Œì„</h2>\r\n                    <p>ì „ ì„¸ê³„ ëª¨ë“  í”Œë ˆì´ì–´ì™€ í•¨ê»˜ ë‘ë‡Œ ëŒ€ê²°ì„ í¼ì¹˜ê³  ì¿ í°ì„ íšë“í•˜ì„¸ìš”!</p>\r\n                    <div className=\"my-profile\">\r\n                        <RankDisplay rankDetails={myRankDetails} showProgress={true} />\r\n                        <div className=\"player-info\">\r\n                            <strong>{userDoc?.name || userDoc?.nickname || 'ìµëª…'}</strong>\r\n                            {userDoc?.classCode && ` (${userDoc.classCode})`}\r\n                            {isAdmin() && <span className=\"admin-badge\">[ê´€ë¦¬ì]</span>}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"omok-lobby\">\r\n                    <div className=\"game-mode-selector\">\r\n                        <h3>ê²Œì„ ëª¨ë“œ ì„ íƒ</h3>\r\n                        <div className=\"mode-options\">\r\n                            <button\r\n                                className={`omok-button ${gameMode === 'player' ? 'primary' : ''}`}\r\n                                onClick={() => setGameMode('player')}\r\n                            >\r\n                                ğŸ‘¥ í”Œë ˆì´ì–´ ëŒ€ì „\r\n                            </button>\r\n                            <button\r\n                                className={`omok-button ${gameMode === 'ai' ? 'primary' : ''}`}\r\n                                onClick={() => setGameMode('ai')}\r\n                            >\r\n                                ğŸ¤– AI ëŒ€ì „ ({dailyPlayCount}/5)\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {gameMode === 'ai' && (\r\n                        <div className=\"ai-difficulty-selector\">\r\n                            <h3>AI ë‚œì´ë„</h3>\r\n                            <div className=\"difficulty-options\">\r\n                                <button\r\n                                    className={aiDifficulty === 'í•˜ê¸‰' ? 'selected' : ''}\r\n                                    onClick={() => setAiDifficulty('í•˜ê¸‰')}\r\n                                >\r\n                                    ğŸ˜Š í•˜ê¸‰\r\n                                </button>\r\n                                <button\r\n                                    className={aiDifficulty === 'ì¤‘ê¸‰' ? 'selected' : ''}\r\n                                    onClick={() => setAiDifficulty('ì¤‘ê¸‰')}\r\n                                >\r\n                                    ğŸ¤” ì¤‘ê¸‰\r\n                                </button>\r\n                                <button\r\n                                    className={aiDifficulty === 'ìƒê¸‰' ? 'selected' : ''}\r\n                                    onClick={() => setAiDifficulty('ìƒê¸‰')}\r\n                                >\r\n                                    ğŸ”¥ ìƒê¸‰\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"lobby-section\">\r\n                        <h3>ê²Œì„ ì°¸ì—¬í•˜ê¸°</h3>\r\n                        <div className=\"lobby-actions\">\r\n                            <button onClick={createGame} className=\"omok-button primary\" disabled={loading}>\r\n                                {loading ? 'ìƒì„± ì¤‘...' : (gameMode === 'ai' ? 'AI ëŒ€ì „ ì‹œì‘' : 'ìƒˆ ê²Œì„ ë§Œë“¤ê¸°')}\r\n                            </button>\r\n                            {createdGameId && !error && gameMode === 'player' && (\r\n                                <div className=\"omok-success\">\r\n                                    ê²Œì„ë°©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! <strong>ê²Œì„ ID: {createdGameId.slice(-6)}</strong><br />\r\n                                    ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì°¸ê°€í•˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {gameMode === 'player' && (\r\n                        <div className=\"lobby-section\">\r\n                            <div className=\"section-header\">\r\n                                <h3>ğŸŒ ì „ì²´ ê³µê°œë°©({availableGames.length})</h3>\r\n                                <button onClick={fetchAvailableGames} className=\"omok-button small\" disabled={loading}>\r\n                                    {loading ? '...' : 'ìƒˆë¡œê³ ì¹¨'}\r\n                                </button>\r\n                            </div>\r\n                            {availableGames.length > 0 ? (\r\n                                <div className=\"game-rooms\">\r\n                                    {availableGames.map((gameRoom) => {\r\n                                        const hostRankDetails = getOmokRankDetails({ \r\n                                            wins: gameRoom.hostRank?.wins || 0, \r\n                                            losses: gameRoom.hostRank?.losses || 0,\r\n                                            totalRP: gameRoom.hostRank?.currentRP || BASE_RP\r\n                                        });\r\n                                        return (\r\n                                            <div key={gameRoom.id} className=\"game-room-card\" onClick={() => joinGame(gameRoom.id)}>\r\n                                                {isAdmin() && <button className=\"admin-delete-btn\" onClick={(e) => deleteGameRoom(gameRoom.id, e)} title=\"ê²Œì„ë°© ì‚­ì œ\">âœ•</button>}\r\n                                                <div className=\"room-header\">\r\n                                                    <div className=\"room-host\">\r\n                                                        <RankDisplay rankDetails={hostRankDetails} size=\"small\" />\r\n                                                        <span className=\"host-name\">{gameRoom.hostName}ë‹˜ì˜ ë°©</span>\r\n                                                        <span className=\"host-class\">({gameRoom.hostClass || 'ë¯¸ì„¤ì •'})</span>\r\n                                                    </div>\r\n                                                    <div className=\"room-id\">#{gameRoom.id.slice(-6)}</div>\r\n                                                </div>\r\n                                                <div className=\"room-info\">\r\n                                                    <span className=\"player-count\">ğŸ‘¥{Object.keys(gameRoom.players).length}/2</span>\r\n                                                    <span className=\"room-status global-status\">ëŒ€ê¸°ì¤‘</span>\r\n                                                </div>\r\n                                                <div className=\"room-time\">\r\n                                                    {gameRoom.createdAt?.toDate ? gameRoom.createdAt.toDate().toLocaleTimeString('ko-KR') : 'ë°©ê¸ˆ ì „'}\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"no-games\">\r\n                                    {loading ? 'ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...' : 'í˜„ì¬ ì°¸ê°€ ê°€ëŠ¥í•œ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ê²Œì„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!'}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                    {error && <div className=\"omok-error\">{error}</div>}\r\n                    {feedback.message && <div className={`feedback ${feedback.type}`}>{feedback.message}</div>}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    const myColor = game.players[user.uid];\r\n    const opponentId = Object.keys(game.players).find(p => p !== user.uid);\r\n    const opponentColor = opponentId ? game.players[opponentId] : null;\r\n    const opponentName = opponentId ? (game.playerNames?.[opponentId] || 'ìƒëŒ€') : 'ëŒ€ê¸° ì¤‘...';\r\n    const myRankDetails = game.playerRanks?.[user.uid];\r\n    const opponentRankDetails = opponentId === 'AI' ? null : (opponentId ? game.playerRanks?.[opponentId] : null);\r\n    const isMyTurn = game.currentPlayer === user.uid;\r\n    const iRequestedRematch = game.rematch && game.rematch[user.uid];\r\n    const opponentRequestedRematch = opponentId && game.rematch && game.rematch[opponentId];\r\n\r\n    return (\r\n        <div className=\"omok-container\">\r\n            {showWinAnimation && <div className=\"win-animation\">ìŠ¹ë¦¬!</div>}\r\n\r\n            {showRewardSelection && (\r\n                 <div className=\"reward-modal\">\r\n                    <div className=\"reward-content\">\r\n                        <h3>ğŸ‰ ìŠ¹ë¦¬ ë³´ìƒ!</h3>\r\n                        <p>í•˜ë‚˜ì˜ ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>\r\n                        <div className=\"reward-cards\">\r\n                            {rewardCards.map((card, index) => (\r\n                                <div\r\n                                    key={index}\r\n                                    className=\"reward-card\"\r\n                                    onClick={() => handleRewardSelection(card)}\r\n                                >\r\n                                    <div className=\"card-icon\">\r\n                                        {card.type === 'cash' ? 'ğŸ’µ' : 'ğŸ«'}\r\n                                    </div>\r\n                                    <div className=\"card-title\">\r\n                                        {card.type === 'cash' ? 'í˜„ê¸ˆ' : 'ì¿ í°'}\r\n                                    </div>\r\n                                    <div className=\"card-amount\">\r\n                                        {card.type === 'cash'\r\n                                            ? `${card.amount.toLocaleString()}ì›`\r\n                                            : `${card.amount}ê°œ`}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"omok-header\">\r\n                <h2>{game.aiMode ? 'ğŸ¤– AI ëŒ€ì „' : 'ğŸŒ ê¸€ë¡œë²Œ ì˜¤ëª© ê²Œì„'}</h2>\r\n                <div className=\"game-info\">\r\n                    <span className=\"game-id\">ID: {gameId.slice(-6)}</span>\r\n                    <span className=\"game-rules\">ê·œì¹™: ë Œì£¼ë£°</span>\r\n                    {game.aiMode ? <span className=\"global-match\">ë‚œì´ë„: {game.aiDifficulty}</span> : <span className=\"global-match\">ì „ì„¸ê³„ ë§¤ì¹­</span>}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"player-status\">\r\n                <div className={`player-card ${myColor} ${isMyTurn && !game.winner ? 'active' : ''}`}>\r\n                    <div className=\"player-info\">\r\n                        <RankDisplay rankDetails={myRankDetails} size=\"small\" />\r\n                        <span className=\"player-name\">{game.playerNames?.[user.uid] || 'ë‚˜'}</span>\r\n                        <div className={`stone-indicator ${myColor}`}></div>\r\n                    </div>\r\n                    {isMyTurn && isThinking && !game.winner && (\r\n                        <div className=\"opponent-thinking\">ë‹¹ì‹  ì°¨ë¡€</div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className={`player-card ${opponentColor || ''} ${!isMyTurn && !game.winner && opponentId ? 'active' : ''}`}>\r\n                    <div className=\"player-info\">\r\n                        {opponentRankDetails && <RankDisplay rankDetails={opponentRankDetails} size=\"small\" />}\r\n                        <span className=\"player-name\">{opponentName}</span>\r\n                        {opponentColor && <div className={`stone-indicator ${opponentColor}`}></div>}\r\n                    </div>\r\n                    {((!isMyTurn && opponentId) || isAiThinking) && !game.winner && <div className=\"opponent-thinking\">ìƒê° ì¤‘...</div>}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"omok-board-container\">\r\n                {renderBoard()}\r\n            </div>\r\n\r\n            <div className=\"omok-status\">\r\n                {game.winner ? (\r\n                    <div className=\"winner-announcement\">\r\n                        {game.winner === 'AI' ? 'AIì˜ ìŠ¹ë¦¬!' : (game.playerNames?.[game.winner] || 'ìŠ¹ì') + ' ë‹˜ì˜ ìŠ¹ë¦¬!'}\r\n                        {gameResult && <span className={`rp-change ${gameResult.outcome}`}>({gameResult.rpChange > 0 ? '+' : ''}{gameResult.rpChange} RP)</span>}\r\n                        <br />\r\n                        {!game.aiMode && game.winner === user.uid && game.couponAwardedTo === user.uid && 'ğŸ‰ ì¿ í° 1ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!'}\r\n                        {!game.aiMode && game.winner === user.uid && game.couponAwardedTo !== user.uid && '(ê²Œì„ ì‹œê°„ì´ 15ì´ˆ ë¯¸ë§Œì´ë¼ ì¿ í°ì´ ì§€ê¸‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.)'}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"turn-info\">\r\n                        í˜„ì¬ ì°¨ë¡€: {isMyTurn ? 'ë‹¹ì‹ ' : (game.currentPlayer === 'AI' ? 'AI' : (game.playerNames?.[game.currentPlayer] || 'ìƒëŒ€'))}\r\n                        {Object.keys(game.players).length < 2 && !game.aiMode && <div className=\"waiting-player\">ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...</div>}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {error && <div className=\"omok-error\">{error}</div>}\r\n            {feedback.message && <div className={`feedback ${feedback.type}`}>{feedback.message}</div>}\r\n\r\n            <div className=\"game-controls\">\r\n                {game.gameStatus === 'finished' ? (\r\n                    <>\r\n                        {!game.aiMode && !iRequestedRematch && <button onClick={handleRematchRequest} className=\"omok-button primary\">ë‹¤ì‹œ í•˜ê¸°</button>}\r\n                        <button onClick={leaveGame} className=\"omok-button secondary\">ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°</button>\r\n                    </> \r\n                ) : (\r\n                    <button onClick={leaveGame} className=\"omok-button secondary\">ê¸°ê¶Œí•˜ê³  ë‚˜ê°€ê¸°</button>\r\n                )}\r\n            </div>\r\n            \r\n            {!game.aiMode && game.gameStatus === 'finished' && (\r\n                <div className=\"rematch-info\" style={{ textAlign: 'center', marginTop: '1rem', color: 'white', fontWeight: 600 }}>\r\n                    {iRequestedRematch && !opponentRequestedRematch && <p>ì¬ëŒ€ê²°ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤...</p>}\r\n                    {opponentRequestedRematch && !iRequestedRematch && <p>ìƒëŒ€ë°©ì´ ì¬ëŒ€ê²°ì„ ì›í•©ë‹ˆë‹¤!</p>}\r\n                    {iRequestedRematch && opponentRequestedRematch && <p>ì–‘ìª½ ëª¨ë‘ ì¬ëŒ€ê²°ì„ ì›í•©ë‹ˆë‹¤. ì ì‹œ í›„ ê²Œì„ì´ ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤!</p>}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default OmokGame;\r\n"],"names":["RANKS","title","color","minRP","icon","BASE_RP","BOARD_SIZE","getIndex","row","col","getBoardValue","board","evaluatePattern","directions","totalScore","dr","dc","forward","backward","i","r","c","total","forwardR","forwardC","backwardR","backwardC","openEnds","checkForWin","player","y","x","dir","count","evaluatePosition","opponentColor","difficulty","tempBoard","idx","myScore","attackWeight","defenseWeight","getOmokRankDetails","omokStats","wins","losses","totalRP","currentRP","undefined","Math","max","currentRank","find","rank","currentRankIndex","findIndex","nextRank","pointsForNextRank","updateUserOmokRecord","async","userId","result","userDocRef","doc","db","runTransaction","userDoc","transaction","get","exists","logger","error","concat","currentOmok","data","omok","newWins","newLosses","newTotalRP","updatedOmok","update","log","RankDisplay","_ref2","rankDetails","showProgress","size","winRate","round","sizeClass","_jsxs","className","children","style","backgroundColor","_jsx","width","OmokGame","_game$playerNames","_game$playerRanks","_game$playerRanks2","_game$playerNames2","_game$playerNames3","_game$playerNames4","user","addCouponsToUserById","isAdmin","addCash","useAuth","gameId","setGameId","useState","game","setGame","setError","createdGameId","setCreatedGameId","isThinking","setIsThinking","lastMove","setLastMove","showWinAnimation","setShowWinAnimation","availableGames","setAvailableGames","loading","setLoading","selectedCell","setSelectedCell","gameResult","setGameResult","refetchGameDataRef","useRef","feedback","setFeedback","message","type","gameMode","setGameMode","aiDifficulty","setAiDifficulty","dailyPlayCount","setDailyPlayCount","setOmokStats","useEffect","localOptimisticOmokUpdate","useCallback","prevStats","newRP","newStats","showRewardSelection","setShowRewardSelection","rewardCards","setRewardCards","isAiThinking","setIsAiThinking","gameIdRef","current","gameRef","userRef","cleanup","currentGameId","currentGame","currentUser","host","uid","deleteDoc","window","addEventListener","removeEventListener","createEmptyBoard","Array","fill","fetchAvailableGames","gamesRef","collection","q","query","where","orderBy","games","getDocs","docs","map","_objectSpread","id","err","createGame","myName","name","nickname","displayName","myClass","classCode","myRankDetails","isAiMode","newGame","players","playerNames","playerClasses","playerRanks","currentPlayer","winner","createdAt","serverTimestamp","hostName","hostClass","hostRank","turnStartTime","history","gameStatus","statsUpdated","rematch","aiMode","gameDocRef","addDoc","Date","leaveGame","opponentId","Object","keys","p","_game$createdAt","gameStartTime","toDate","getTime","now","_game$createdAt2","shouldAwardCoupon","finalUpdate","couponAwardedTo","updateDoc","handleCellClick","hasGame","cellValue","isMyTurn","length","boardWithNewStone","myColor","forbiddenMove","nextPlayer","moveData","timestamp","newHistory","updateData","_game$createdAt3","outcome","rpChange","cards","generateRewardCards","placeStone","hasFetchedGamesRef","lastGameIdRef","fetchGameData","docSnap","getDoc","gameData","winnerId","loserId","shouldPoll","refetch","refetchGameData","usePolling","interval","enabled","deps","timer","setTimeout","clearTimeout","resetGameForRematch","playerIds","newPlayers","newCurrentPlayer","aiTurnProcessedRef","thinkingTime","random","aiColor","bestMove","findBestMove","placedStones","push","floor","center","centerMoves","move","searchRange","possibleMoves","checkedPositions","Set","stone","key","has","add","firstEmpty","cell","testBoard","patternScore","bestScore","score","centerDist","abs","prevGame","amount","sort","loadDailyPlayCount","today","toDateString","storageKey","parseInt","localStorage","getItem","onClick","disabled","slice","gameRoom","_gameRoom$hostRank","_gameRoom$hostRank2","_gameRoom$hostRank3","_gameRoom$createdAt","hostRankDetails","gameDoc","Error","joinGame","e","roomId","stopPropagation","confirm","deleteGameRoom","toLocaleTimeString","opponentName","opponentRankDetails","iRequestedRematch","opponentRequestedRematch","card","index","selectedCard","newCount","setItem","toString","toLocaleString","logActivity","userName","ACTIVITY_TYPES","GAME_WIN","description","couponAmount","metadata","gameType","opponent","rewardType","rewardAmount","rollbackCount","handleRewardSelection","renderBoard","cells","starPointCoords","horizontalLines","top","verticalLines","j","left","isSelected","isLastMove","isStarPoint","includes","gridRow","gridColumn","_Fragment","textAlign","marginTop","fontWeight"],"ignoreList":[],"sourceRoot":""}