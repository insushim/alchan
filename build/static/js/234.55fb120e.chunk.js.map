{"version":3,"file":"static/js/234.55fb120e.chunk.js","mappings":"sNAgBA,MCPaA,EAAiB,SAACC,GAA0B,IAAlBC,EAAOC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EAChD,MAAM,IACJG,EAAM,EAAC,IACPC,EAAMC,OAAOC,iBAAgB,UAC7BC,GAAY,EAAK,UACjBC,EAAY,gBACVT,EAGEU,EAAYJ,OAAOP,GAGzB,GAAIY,MAAMD,GACR,MAAM,IAAIE,MAAM,GAADC,OAAIJ,EAAS,2EAI9B,IAAKK,SAASJ,GACZ,MAAM,IAAIE,MAAM,GAADC,OAAIJ,EAAS,2EAI9B,GAAIC,EAAY,EACd,MAAM,IAAIE,MAAM,GAADC,OAAIJ,EAAS,+DAI9B,IAAKD,GAA2B,IAAdE,EAChB,MAAM,IAAIE,MAAM,GAADC,OAAIJ,EAAS,0DAI9B,GAAIC,EAAYN,EACd,MAAM,IAAIQ,MAAM,GAADC,OAAIJ,EAAS,wBAAAI,OAAQT,EAAIW,iBAAgB,8DAG1D,GAAIL,EAAYL,EACd,MAAM,IAAIO,MAAM,GAADC,OAAIJ,EAAS,wBAAAI,OAAQR,EAAIU,iBAAgB,qEAI1D,OAAOC,KAAKC,MAAMP,EACpB,E,aC8RA,QAxUA,WAEE,MAAM,QACJQ,EAAO,gBACPC,EACAC,QAASC,EAAW,WACpBC,EAAU,mBACVC,IACEC,EAAAA,EAAAA,OAGGC,EAAeC,IAAoBC,EAAAA,EAAAA,UAAS,KAC5C5B,EAAQ6B,IAAaD,EAAAA,EAAAA,UAAS,KAC9BE,EAAYC,IAAiBH,EAAAA,EAAAA,UAAS,UACtCI,EAAQC,IAAaL,EAAAA,EAAAA,UAAS,SAC9BM,EAAUC,IAAeP,EAAAA,EAAAA,UAAS,SAClCQ,EAASC,IAAcT,EAAAA,EAAAA,UAAS,KAChCU,EAASC,IAAcX,EAAAA,EAAAA,UAAS,KAChCY,EAAOC,IAAYb,EAAAA,EAAAA,UAAS,KAC5Bc,EAAWC,IAAgBf,EAAAA,EAAAA,WAAS,IACpCgB,EAAcC,IAAmBjB,EAAAA,EAAAA,WAAS,GAG3CkB,EAAmB,OAAP3B,QAAO,IAAPA,OAAO,EAAPA,EAAS4B,KACrBC,EAAwB,OAAP7B,QAAO,IAAPA,OAAO,EAAPA,EAAS8B,UAG1BC,GAAQC,EAAAA,EAAAA,SAAQ,IACf/B,GAA8C,IAA3BA,EAAgBjB,OACjC,IAAIiB,GAAiBgC,KAAK,CAACC,EAAGC,KACnC,MAAMC,EAAQF,EAAEN,MAAQM,EAAEG,UAAY,GAChCC,EAAQH,EAAEP,MAAQO,EAAEE,UAAY,GACtC,OAAOD,EAAMG,cAAcD,EAAO,QAJyB,GAM5D,CAACrC,KAGJuC,EAAAA,EAAAA,WAAU,KACRhC,EAAiB,IACjBgB,GAAa,IACZ,CAACX,EAAQF,IAGZ,MAkBM8B,GAAyBC,EAAAA,EAAAA,aAAY,SAACC,EAAUC,GAAkC,IAClFC,EAD4DC,EAAQ/D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAQxE,GALE8D,EADiB,eAAflC,EACWb,KAAKC,MAAO4C,EAAWvD,OAAOwD,GAAe,KAE7CxD,OAAOwD,GAGlBE,GAAuB,SAAXjC,EAAmB,CAEjC,OAAOgC,EADW/C,KAAKC,MAAO8C,EAAa5B,EAAW,IAExD,CAEA,OAAO4B,CACT,EAAG,CAAClC,EAAYE,EAAQI,IA0FlB8B,GAAiBf,EAAAA,EAAAA,SAAQ,KAC7B,IAAKnD,GAAmC,IAAzB0B,EAAcvB,OAAc,MAAO,CAAC,EACnD,MAAMgE,EAAU,CAAC,EASjB,OARAzC,EAAc0C,QAAQC,IACpB,MAAMC,EAAOpB,EAAMqB,KAAKC,GAAKA,EAAEC,KAAOJ,GACtC,GAAIC,EAAM,CACR,MAAMR,EAAWvD,OAAO+D,EAAKI,MAAQ,GAC/BT,EAAsB,SAAXjC,EACjBmC,EAAQE,GAAUT,EAAuBE,EAAU9D,EAAQiE,EAC7D,IAEKE,GAEN,CAACzC,EAAe1B,EAAQgC,EAAQkB,EAAOU,IAE1C,OACEe,EAAAA,EAAAA,MAAA,OAAKC,UAAU,2BAA0BC,SAAA,EACvCC,EAAAA,EAAAA,KAAA,OAAKF,UAAU,SAAQC,UACrBF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,aAAYC,SAAA,EACzBC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,cAAaC,SAAC,wBAC9BC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,aAAYC,SAAE/B,GAAa,4BAC3C6B,EAAAA,EAAAA,MAAA,QAAMC,UAAU,aAAYC,SAAA,CAAC,mBAAa,OAAP1D,QAAO,IAAPA,OAAO,EAAPA,EAASuD,OAAQ,GAAG1D,iBAAiB,iBAI3EwB,IAASsC,EAAAA,EAAAA,KAAA,OAAKF,UAAU,oBAAmBC,SAAErC,IAC7CF,IAAWwC,EAAAA,EAAAA,KAAA,OAAKF,UAAU,sBAAqBC,SAAEvC,KAElDqC,EAAAA,EAAAA,MAAA,QAAMI,SAnHWC,UAEnB,GADAC,EAAEC,iBAC2B,IAAzBxD,EAAcvB,SAAiBH,GAAUY,MAAML,OAAOP,IAExD,YADAyC,EAAS,qHAIX,MAAMsB,EAAaxD,OAAOP,GAC1B,GAAI+D,GAAc,EAChBtB,EAAS,GAAD3B,OAAmB,eAAfgB,EAA8B,qBAAQ,eAAI,+DAGxD,GAAmB,eAAfA,IAAgCiC,EAAa,KAAOA,EAAa,GACnEtB,EAAS,4GADX,CAKAI,GAAgB,GAChBN,EAAW,IACXE,EAAS,IAET,IACE,MAAM0C,EAAkBjC,EAAMkC,OAAOd,GAAQ5C,EAAc2D,SAASf,EAAKG,MAGnE,MAAEa,EAAK,eAAEC,EAAc,aAAEC,QCMNR,WASxB,IAT+B,UACpClC,EAAS,eACTE,EAAc,YACdyC,EAAW,OACXzD,EAAM,SACNE,EAAQ,WACRJ,EAAU,OACV9B,EAAM,QACNoC,GACDsD,EACCC,EAAAA,GAAOC,IAAI,8CAAqC,CAC9C9C,YACAd,SACAE,WACAJ,aACA9B,SACAoC,UACAyD,iBAAkBJ,EAAYtF,SAIhC,IACE,GAAmB,eAAf2B,GACF,GAAI9B,EAAS,GAAKA,EAAS,IACzB,MAAM,IAAIa,MAAM,6GAGlBd,EAAeC,EAAQ,CAAEK,IAAK,EAAGK,UAAW,gBAEhD,CAAE,MAAO8B,GACP,MAAM,IAAI3B,MAAM,2CAADC,OAAc0B,EAAMF,SACrC,CAEA,MAAMkD,EAAe,GACrB,IAAID,EAAiB,EACjBO,EAAe,EAGnB,IAAK,MAAMxB,KAAQmB,EACjB,UACQM,EAAAA,EAAAA,IAAeC,EAAAA,GAAIhB,UACvB,MAAMiB,GAAUC,EAAAA,EAAAA,IAAIF,EAAAA,GAAI,QAAS1B,EAAKG,IAChCtD,QAAgBgF,EAAYC,IAAIH,GAEtC,IAAK9E,EAAQkF,SACX,MAAM,IAAIxF,MAAM,sBAADC,OAAQwD,EAAKvB,KAAI,yDAGlC,MAAMuD,EAAWnF,EAAQoF,OACnBC,EAAcjG,OAAO+F,EAAS5B,MAAQ,GAC5C,IAAIV,EAQJ,GALEA,EADiB,eAAflC,EACWb,KAAKC,MAAOsF,EAAcxG,EAAU,KAEpCD,EAAeC,EAAQ,CAAEK,IAAK,EAAGK,UAAW,iBAGvDsD,GAAc,EAEhB,YADA2B,EAAAA,GAAOC,IAAI,iBAAD9E,OAAkBwD,EAAKvB,KAAI,mFAIvC,IAQI0D,EARAC,EAAc1C,EACd2C,EAAY,EAQhB,GANe,SAAX3E,GAAqBI,EAAU,IACjCuE,EAAY1F,KAAKC,MAAO8C,EAAa5B,EAAW,KAChDsE,EAAc1C,EAAa2C,GAId,SAAX3E,EACFyE,EAAUD,EAAcE,MACnB,CAEL,GAAIF,EAAcxC,EAChB,MAAM,IAAInD,MAAM,GAADC,OAAIwD,EAAKvB,KAAI,mFAAAjC,OAAsB0F,EAAYxF,iBAAgB,0BAAAF,OAAUkD,EAAWhD,iBAAgB,YAErHyF,EAAUD,EAAcxC,CAC1B,CAGAmC,EAAYS,OAAOX,EAAS,CAC1BvB,KAAM+B,EACNI,WAAWC,EAAAA,EAAAA,QAIb,MAAMC,GAASb,EAAAA,EAAAA,KAAIc,EAAAA,EAAAA,IAAWhB,EAAAA,GAAI,kBAClC,IAAIiB,EAASC,EAEE,SAAXlF,GACFiF,EAAU,kBACS,eAAfnF,GACFoF,EAAc,sBAAApG,OAAUgC,EAAS,YAAAhC,OAAMwD,EAAKvB,KAAI,uBAAAjC,OAAOd,EAAM,OAAAc,OAAM4F,EAAY1F,iBAAgB,uDAC3F2F,EAAY,IACdO,GAAc,kBAAApG,OAAYkD,EAAWhD,iBAAgB,yBAAAF,OAAS6F,EAAU3F,iBAAgB,2BAG1FkG,EAAc,sBAAApG,OAAUgC,EAAS,YAAAhC,OAAMwD,EAAKvB,KAAI,uBAAAjC,OAAO4F,EAAY1F,iBAAgB,sDAC/E2F,EAAY,IACdO,GAAc,kBAAApG,OAAYkD,EAAWhD,iBAAgB,yBAAAF,OAAS6F,EAAU3F,iBAAgB,2BAGxE,SAAXgB,IACQ,WAAbE,GACF+E,EAAU,oBAERC,EADiB,eAAfpF,EACY,sBAAAhB,OAAUgC,EAAS,YAAAhC,OAAMwD,EAAKvB,KAAI,iBAAAjC,OAAMd,EAAM,OAAAc,OAAMkD,EAAWhD,iBAAgB,uDAE/E,sBAAAF,OAAUgC,EAAS,YAAAhC,OAAMwD,EAAKvB,KAAI,iBAAAjC,OAAMkD,EAAWhD,iBAAgB,wDAGnFiG,EAAU,kBAERC,EADiB,eAAfpF,EACY,sBAAAhB,OAAUgC,EAAS,YAAAhC,OAAMwD,EAAKvB,KAAI,mCAAAjC,OAASd,EAAM,OAAAc,OAAMkD,EAAWhD,iBAAgB,uDAElF,sBAAAF,OAAUgC,EAAS,YAAAhC,OAAMwD,EAAKvB,KAAI,mCAAAjC,OAASkD,EAAWhD,iBAAgB,wDAK1F,MAAMmG,EAAU,CACd9C,OAAQC,EAAKG,GACb2C,SAAU9C,EAAKvB,KACfsE,WAAWP,EAAAA,EAAAA,MACXQ,KAAML,EACNM,YAAaL,EACbjE,UAAWD,EACXwE,SAAU,CACR1E,YACAd,SACAF,aACAiC,WAAY/D,EACZoC,QAAoB,SAAXJ,EAAoBI,EAAU,EACvC4B,aACA2C,YACAD,cACAe,aAAcjB,EACdC,YAGJN,EAAYuB,IAAIX,EAAQI,GAGxB,MAAMQ,GAAiBzB,EAAAA,EAAAA,KAAIc,EAAAA,EAAAA,IAAWhB,EAAAA,GAAI,iBACpC4B,EAAkB,CACtBvD,OAAQC,EAAKG,GACbzE,OAAmB,SAAXgC,EAAoB0E,GAAe1C,EAC3CsD,KAAiB,SAAXtF,EAAoB,SAAW,UACrC6F,SAAU,QACVN,YAAwB,SAAXvF,EAAoB,kCAAW,kCAC5CqF,WAAWP,EAAAA,EAAAA,MACXU,SAAU,CACR1E,YACAhB,aACAM,QAAoB,SAAXJ,EAAoBI,EAAU,IAG3C+D,EAAYuB,IAAIC,EAAgBC,GAGhCpC,EAAasC,KAAK,CAAErD,GAAIH,EAAKG,GAAIgC,YACjClB,GAAkBvB,EAClB8B,IAEAH,EAAAA,GAAOC,IAAI,iBAAD9E,OAAkBwD,EAAKvB,KAAI,wDAAgB,CACnDgF,2BAAMvB,EACNwB,2BAAMhE,EACNiE,eAAItB,EACJuB,2BAAMxB,EACNyB,qBAAK1B,KAGX,CAAE,MAAO2B,GAEP,MADAzC,EAAAA,GAAOnD,MAAM,oCAAD1B,OAAsBwD,EAAKvB,KAAI,sCAAaqF,GAClD,IAAIvH,MAAM,GAADC,OAAIwD,EAAKvB,KAAI,sCAAAjC,OAAYsH,EAAU9F,SACpD,CAKF,OAFAqD,EAAAA,GAAOC,IAAI,+CAAD9E,OAAsCgF,EAAY,gCAAAhF,OAAWyE,EAAevE,iBAAgB,WAE/F,CACLsE,MAAOQ,EACPP,iBACAC,iBDhMwD6C,CAAgB,CACpEvF,YACAE,iBACAyC,YAAaN,EACbnD,SACAE,SAAqB,SAAXF,EAAoBE,OAAW9B,EACzC0B,aACA9B,OAAQ+D,EACR3B,YAIEoD,GAAgBA,EAAarF,OAAS,IAExCqB,EAAmB8G,GACjBA,EAAeC,IAAIC,IACjB,MAAMC,EAAcjD,EAAajB,KAAKC,GAAKA,EAAEC,KAAO+D,EAAO/D,IAC3D,OAAOgE,GAAWC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQF,GAAM,IAAE9D,KAAM+D,EAAYhC,UAAY+B,KAKpEjH,EAAWoH,IACT,MAAMC,EAAmBrI,OAAOoI,EAAgBjE,MAAQ,GACxD,IAAImE,EAWJ,OAREA,EAFa,SAAX7G,EAEa4G,EAAmBrD,EACd,SAAXvD,GAAkC,SAAbE,EAEf0G,EAAmBrD,EAGnBqD,GAEjBF,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYC,GAAe,IAAEjE,KAAMmE,OAKvC,MAAMC,EAAwB,SAAX9G,EAAoB,qBAAsB,SAAbE,EAAsB,2BAAS,qBAC/EK,EAAW,GAADzB,OACLwE,EAAK,uBAAAxE,OAAsB,eAAfgB,EAA2B,GAAAhB,OAAMiD,EAAU,QAAAjD,OAASiD,EAAW/C,iBAAgB,UAAG,KAAAF,OAAIgI,EAAU,2BAAAhI,OAAWyE,EAAevE,iBAAgB,uBAAAF,OAAkB,SAAXkB,GAAqBI,EAAU,EAAC,kBAAAtB,OAAWsB,EAAO,kBAAS,GAAE,MAG/NP,EAAU,IACVF,EAAiB,IACjBgB,GAAa,GAEboG,WAAW,IAAMxG,EAAW,IAAK,IAEnC,CAAE,MAAOyG,GACPrD,EAAAA,GAAOnD,MAAM,iDAAewG,GAC5BvG,EAAS,4DAAD3B,OAAgBkI,EAAI1G,UAG5ByG,WAAW,IAAMtG,EAAS,IAAK,IACjC,CAAC,QACCI,GAAgB,EAClB,CArEA,GAoGgC+B,UAAU,gBAAeC,SAAA,EACrDF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,kBAAiBC,SAAA,EAC9BF,EAAAA,EAAAA,MAAA,UAAQ2C,KAAK,SAAS1C,UAAS,cAAA9D,OAA2B,SAAXkB,EAAoB,cAAgB,IAAMiH,QAASA,IAAMhH,EAAU,QAAQ4C,SAAA,EACxHC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,OAAMC,SAAC,iBAAS,0BAElCF,EAAAA,EAAAA,MAAA,UAAQ2C,KAAK,SAAS1C,UAAS,cAAA9D,OAA2B,SAAXkB,EAAoB,cAAgB,IAAMiH,QAASA,IAAMhH,EAAU,QAAQ4C,SAAA,EACxHC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,OAAMC,SAAC,iBAAS,kCAIxB,SAAX7C,IACC2C,EAAAA,EAAAA,MAAA,OAAKC,UAAU,oBAAmBC,SAAA,EAChCC,EAAAA,EAAAA,KAAA,MAAAD,SAAI,2CACJF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,qBAAoBC,SAAA,EACjCF,EAAAA,EAAAA,MAAA,SAAOC,UAAS,eAAA9D,OAA8B,SAAboB,EAAsB,SAAW,IAAK2C,SAAA,EACrEC,EAAAA,EAAAA,KAAA,SACEwC,KAAK,QACLvE,KAAK,WACLmG,MAAM,OACNC,QAAsB,SAAbjH,EACTkH,SAAWnE,GAAM9C,EAAY8C,EAAEoE,OAAOH,UAExCpE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,kBAChBD,EAAAA,EAAAA,MAAA,QAAMC,UAAU,YAAWC,SAAA,EACzBC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,8DACRC,EAAAA,EAAAA,KAAA,SAAAD,SAAO,6HAGXF,EAAAA,EAAAA,MAAA,SAAOC,UAAS,eAAA9D,OAA8B,WAAboB,EAAwB,SAAW,IAAK2C,SAAA,EACvEC,EAAAA,EAAAA,KAAA,SACEwC,KAAK,QACLvE,KAAK,WACLmG,MAAM,SACNC,QAAsB,WAAbjH,EACTkH,SAAWnE,GAAM9C,EAAY8C,EAAEoE,OAAOH,UAExCpE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,kBAChBD,EAAAA,EAAAA,MAAA,QAAMC,UAAU,YAAWC,SAAA,EACzBC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,kDACRC,EAAAA,EAAAA,KAAA,SAAAD,SAAO,wIAOjBF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,iBAAgBC,SAAA,EAC7BF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,uBAAsBC,SAAA,EACnCF,EAAAA,EAAAA,MAAA,SAAOC,UAAS,eAAA9D,OAAgC,UAAfgB,EAAyB,SAAW,IAAK+C,SAAA,EACxEC,EAAAA,EAAAA,KAAA,SAAOwC,KAAK,QAAQvE,KAAK,aAAamG,MAAM,QAAQC,QAAwB,UAAfrH,EAAwBsH,SAAWnE,GAAMlD,EAAckD,EAAEoE,OAAOH,UAC7HpE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,iBAAsB,iCAExCD,EAAAA,EAAAA,MAAA,SAAOC,UAAS,eAAA9D,OAAgC,eAAfgB,EAA8B,SAAW,IAAK+C,SAAA,EAC7EC,EAAAA,EAAAA,KAAA,SAAOwC,KAAK,QAAQvE,KAAK,aAAamG,MAAM,aAAaC,QAAwB,eAAfrH,EAA6BsH,SAAWnE,GAAMlD,EAAckD,EAAEoE,OAAOH,UACvIpE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,iBAAsB,iCAG1CD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,qBAAoBC,SAAA,EACjCC,EAAAA,EAAAA,KAAA,SAAOwC,KAAK,SAAS4B,MAAOlJ,EAAQoJ,SAAWnE,GAAMpD,EAAUoD,EAAEoE,OAAOH,OAAQI,YAA4B,UAAfxH,EAAyB,4BAAU,kCAAUzB,IAAI,IAAIC,IAAoB,eAAfwB,EAA8B,WAAQ1B,EAAWmJ,UAAQ,EAAC3E,UAAU,kBAC3NE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,cAAaC,SAAiB,UAAf/C,EAAyB,SAAM,YAItD,SAAXE,IACC2C,EAAAA,EAAAA,MAAA,OAAKC,UAAU,cAAaC,SAAA,EAC1BF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,aAAYC,SAAA,EACzBC,EAAAA,EAAAA,KAAA,MAAAD,SAAI,4CACJC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,kBAAiBC,SAAC,gIAEpCF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,kBAAiBC,SAAA,EAC9BC,EAAAA,EAAAA,KAAA,SAAO0E,QAAQ,UAAS3E,SAAC,yBACzBC,EAAAA,EAAAA,KAAA,SAAOwC,KAAK,SAAS7C,GAAG,UAAUyE,MAAO9G,EAASgH,SAAWnE,GAAM5C,EAAWpB,KAAKX,IAAI,EAAGW,KAAKZ,IAAI,IAAKE,OAAO0E,EAAEoE,OAAOH,UAAW7I,IAAI,IAAIC,IAAI,MAAMsE,UAAU,eAC/JE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,WAAUC,SAAC,SAE5B7E,IACC8E,EAAAA,EAAAA,KAAA,OAAKF,UAAU,cAAaC,SACV,UAAf/C,GACC6C,EAAAA,EAAAA,MAAA8E,EAAAA,SAAA,CAAA5E,SAAA,CAAE,oCAASjB,EAAuB,EAAG5D,GAAQ,GAAMgB,iBAAiB,wBAAOC,KAAKC,MAAOX,OAAOP,GAAUoC,EAAW,KAAKpB,iBAAiB,0BAAQ,0CAAAF,OAErId,EAAM,+BAAAc,OAAUsB,EAAO,oEAO7CuC,EAAAA,EAAAA,MAAA,OAAKC,UAAU,yBAAwBC,SAAA,EACrCF,EAAAA,EAAAA,MAAA,OAAKC,UAAU,iBAAgBC,SAAA,EAC7BC,EAAAA,EAAAA,KAAA,MAAAD,SAAI,+BACJF,EAAAA,EAAAA,MAAA,SAAOC,UAAU,mBAAkBC,SAAA,EACjCC,EAAAA,EAAAA,KAAA,SAAOwC,KAAK,WAAW6B,QAASzG,EAAW0G,SAvO/BM,KACtB/G,EAAagH,IACX,MAAMC,GAAgBD,EAEtB,OADAhI,EAAiBiI,EAAe1G,EAAMqF,IAAKjE,GAASA,EAAKG,IAAM,IACxDmF,KAmOuEhF,UAAU,qBAChFE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,cAAmB,mCAItCtD,GAAgC,IAAjB4B,EAAM/C,QACpB2E,EAAAA,EAAAA,KAAA,OAAKF,UAAU,UAASC,SAAC,gGAEzBC,EAAAA,EAAAA,KAAA,OAAKF,UAAU,YAAWC,SACvB3B,EAAMqF,IAAKjE,IAAU,IAADuF,EACnB,MAAMC,EAAgB5F,EAAeI,EAAKG,IAC1C,OACEK,EAAAA,EAAAA,KAAA,OAAmBF,UAAU,YAAWC,UACtCF,EAAAA,EAAAA,MAAA,SAAOC,UAAU,aAAYC,SAAA,EAC3BC,EAAAA,EAAAA,KAAA,SAAOwC,KAAK,WAAW6B,QAASzH,EAAc2D,SAASf,EAAKG,IAAK2E,SAAUA,KAAMW,OA9PxE1F,EA8P4FC,EAAKG,QA7P5H9C,EAAkBqI,GAChBA,EAAa3E,SAAShB,GAClB2F,EAAa5E,OAAQX,GAAOA,IAAOJ,GACnC,IAAI2F,EAAc3F,IAJGA,OA8PsGO,UAAU,qBACzHE,EAAAA,EAAAA,KAAA,QAAMF,UAAU,eAChBD,EAAAA,EAAAA,MAAA,OAAKC,UAAU,YAAWC,SAAA,EACxBC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,YAAWC,SAAEP,EAAKvB,QAClC4B,EAAAA,EAAAA,MAAA,QAAMC,UAAU,eAAcC,SAAA,CAAC,kBAAc,QAATgF,EAAAvF,EAAKI,YAAI,IAAAmF,OAAA,EAATA,EAAW7I,mBAAoB,EAAE,iBAClDZ,IAAlB0J,IACCnF,EAAAA,EAAAA,MAAA,QAAMC,UAAS,kBAAA9D,OAAoBkB,GAAS6C,SAAA,CAC9B,SAAX7C,EAAoB,IAAM,SAAK8H,EAAc9I,iBAAiB,mBAT/DsD,EAAKG,YAqBzBK,EAAAA,EAAAA,KAAA,UAAQwC,KAAK,SAAS1C,UAAS,cAAA9D,OAAgBkB,GAAUiI,SAAU3I,GAAesB,EAAaiC,SAC5FjC,GACC+B,EAAAA,EAAAA,MAAA8E,EAAAA,SAAA,CAAA5E,SAAA,EAAEC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,YAAiB,8BAEnCD,EAAAA,EAAAA,MAAA8E,EAAAA,SAAA,CAAA5E,SAAA,EAAEC,EAAAA,EAAAA,KAAA,QAAMF,UAAU,OAAMC,SAAa,SAAX7C,EAAoB,eAAO,iBAAY,IAAa,SAAXA,EAAoB,qBAAQ,2BAAO,0BAMlH,C","sources":["utils/taxUtils.js","utils/validation.js","pages/banking/MoneyTransfer.js","services/database.js"],"sourcesContent":["// src/utils/taxUtils.js\r\nimport { db } from '../firebase';\r\nimport {\r\n  doc,\r\n  getDoc,\r\n  updateDoc,\r\n  increment,\r\n  serverTimestamp,\r\n  writeBatch,\r\n  collection\r\n} from 'firebase/firestore';\r\nimport { addActivityLog } from '../firebase';\r\nimport { getClassAdminUid } from '../firebase/db/core';\r\n\r\nimport { logger } from \"../utils/logger\";\r\n// ê¸°ë³¸ ì„¸ê¸ˆ ì„¤ì •\r\nconst DEFAULT_TAX_SETTINGS = {\r\n  stockTransactionTaxRate: 0.01, // ì£¼ì‹ ê±°ë˜ì„¸ìœ¨ (1%)\r\n  realEstateTransactionTaxRate: 0.03, // ë¶€ë™ì‚° ê±°ë˜ì„¸ìœ¨ (3%)\r\n  itemStoreVATRate: 0.1, // ì•„ì´í…œ ìƒì  ë¶€ê°€ê°€ì¹˜ì„¸ìœ¨ (10%)\r\n  auctionTransactionTaxRate: 0.03, // ê²½ë§¤ì¥ ê±°ë˜ì„¸ìœ¨ (3%)\r\n  propertyHoldingTaxRate: 0.002, // ë¶€ë™ì‚° ë³´ìœ ì„¸ìœ¨ (0.2%)\r\n  itemMarketTransactionTaxRate: 0.03, // ì•„ì´í…œ ì‹œì¥ ê±°ë˜ì„¸ìœ¨ (3%)\r\n  incomeTaxRate: 0.15, // ì†Œë“ì„¸ìœ¨ (15%)\r\n  transactionTaxRate: 0.005, // ì†¡ê¸ˆ/ì´ì²´ ê±°ë˜ì„¸ìœ¨ (0.5%)\r\n  salaryTaxRate: 0.1, // ê¸‰ì—¬ ì†Œë“ì„¸ìœ¨ (10%)\r\n  rewardTaxRate: 0.05, // ë³´ìƒ ì†Œë“ì„¸ìœ¨ (5%)\r\n};\r\n\r\n// ì„¸ê¸ˆ ì„¤ì • ê°€ì ¸ì˜¤ê¸°\r\nexport const getTaxSettings = async (classCode) => {\r\n  try {\r\n    const taxDoc = await getDoc(doc(db, 'taxSettings', classCode));\r\n    if (taxDoc.exists()) {\r\n      return { ...DEFAULT_TAX_SETTINGS, ...taxDoc.data() };\r\n    }\r\n    return DEFAULT_TAX_SETTINGS;\r\n  } catch (error) {\r\n    logger.error('ì„¸ê¸ˆ ì„¤ì • ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);\r\n    return DEFAULT_TAX_SETTINGS;\r\n  }\r\n};\r\n\r\n// êµ­ê³ ì— ì„¸ê¸ˆ ì¶”ê°€ (ê´€ë¦¬ì cashì—ë„ ì—°ë™)\r\nexport const addTaxToTreasury = async (classCode, taxType, amount, description) => {\r\n  try {\r\n    const treasuryRef = doc(db, 'nationalTreasuries', classCode);\r\n    const batch = writeBatch(db);\r\n\r\n    // ğŸ”¥ [ìˆ˜ì •] update ëŒ€ì‹  set with mergeë¥¼ ì‚¬ìš© (ë¬¸ì„œê°€ ì—†ì„ ë•Œ ìë™ ìƒì„±)\r\n    batch.set(treasuryRef, {\r\n      totalAmount: increment(amount),\r\n      [`${taxType}Revenue`]: increment(amount),\r\n      lastUpdated: serverTimestamp()\r\n    }, { merge: true });\r\n\r\n    // ì„¸ê¸ˆ ë‚©ë¶€ ê¸°ë¡ ì¶”ê°€\r\n    const taxRecordRef = doc(collection(db, 'taxRecords'));\r\n    batch.set(taxRecordRef, {\r\n      classCode,\r\n      type: taxType,\r\n      amount,\r\n      description,\r\n      timestamp: serverTimestamp()\r\n    });\r\n\r\n    // ğŸ”¥ [ì¶”ê°€] ê´€ë¦¬ì(ì„ ìƒë‹˜) cashì—ë„ ì„¸ê¸ˆ ì¶”ê°€\r\n    const adminUid = await getClassAdminUid(classCode);\r\n    if (adminUid) {\r\n      const adminRef = doc(db, 'users', adminUid);\r\n      batch.update(adminRef, {\r\n        cash: increment(amount),\r\n        updatedAt: serverTimestamp()\r\n      });\r\n      logger.log(`[Tax] ê´€ë¦¬ì(${adminUid}) cashì— ${amount}ì› ì¶”ê°€`);\r\n    } else {\r\n      logger.log(`[Tax] ê²½ê³ : í´ë˜ìŠ¤(${classCode})ì— ê´€ë¦¬ìê°€ ì—†ì–´ cash ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€`);\r\n    }\r\n\r\n    await batch.commit();\r\n    logger.log(`[Tax] ${taxType}: ${amount}ì›ì´ êµ­ê³ ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('êµ­ê³  ì„¸ê¸ˆ ì¶”ê°€ ì‹¤íŒ¨:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// ê±°ë˜ì„¸ ê³„ì‚° ë° ì ìš©\r\nexport const applyTransactionTax = async (classCode, userId, amount, transactionType) => {\r\n  try {\r\n    const taxSettings = await getTaxSettings(classCode);\r\n    const taxRate = taxSettings.transactionTaxRate || 0.005;\r\n    const taxAmount = Math.floor(amount * taxRate);\r\n\r\n    if (taxAmount > 0) {\r\n      await addTaxToTreasury(classCode, 'transaction', taxAmount,\r\n        `${transactionType} ê±°ë˜ì„¸: ${amount.toLocaleString()}ì› ê±°ë˜`);\r\n\r\n      // í™œë™ ë¡œê·¸ ì¶”ê°€\r\n      if (userId) {\r\n        await addActivityLog(userId, 'TAX_PAYMENT',\r\n          `ê±°ë˜ì„¸ ${taxAmount.toLocaleString()}ì›ì„ ë‚©ë¶€í–ˆìŠµë‹ˆë‹¤.`, {\r\n            taxType: 'transaction',\r\n            originalAmount: amount,\r\n            taxRate: taxRate,\r\n            taxAmount: taxAmount,\r\n            transactionType\r\n          });\r\n      }\r\n    }\r\n\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount,\r\n      netAmount: amount - taxAmount\r\n    };\r\n  } catch (error) {\r\n    logger.error('ê±°ë˜ì„¸ ì ìš© ì‹¤íŒ¨:', error);\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount: 0,\r\n      netAmount: amount\r\n    };\r\n  }\r\n};\r\n\r\n// ì†Œë“ì„¸ ê³„ì‚° ë° ì ìš©\r\nexport const applyIncomeTax = async (classCode, userId, income, incomeType) => {\r\n  try {\r\n    const taxSettings = await getTaxSettings(classCode);\r\n    let taxRate;\r\n\r\n    switch (incomeType) {\r\n      case 'salary':\r\n        taxRate = taxSettings.salaryTaxRate || 0.1;\r\n        break;\r\n      case 'reward':\r\n        taxRate = taxSettings.rewardTaxRate || 0.05;\r\n        break;\r\n      default:\r\n        taxRate = taxSettings.incomeTaxRate || 0.15;\r\n    }\r\n\r\n    const taxAmount = Math.floor(income * taxRate);\r\n\r\n    if (taxAmount > 0) {\r\n      await addTaxToTreasury(classCode, 'income', taxAmount,\r\n        `${incomeType} ì†Œë“ì„¸: ${income.toLocaleString()}ì› ì†Œë“`);\r\n\r\n      // í™œë™ ë¡œê·¸ ì¶”ê°€\r\n      if (userId) {\r\n        await addActivityLog(userId, 'TAX_PAYMENT',\r\n          `ì†Œë“ì„¸ ${taxAmount.toLocaleString()}ì›ì„ ë‚©ë¶€í–ˆìŠµë‹ˆë‹¤.`, {\r\n            taxType: 'income',\r\n            originalIncome: income,\r\n            taxRate: taxRate,\r\n            taxAmount: taxAmount,\r\n            incomeType\r\n          });\r\n      }\r\n    }\r\n\r\n    return {\r\n      grossIncome: income,\r\n      taxAmount,\r\n      netIncome: income - taxAmount\r\n    };\r\n  } catch (error) {\r\n    logger.error('ì†Œë“ì„¸ ì ìš© ì‹¤íŒ¨:', error);\r\n    return {\r\n      grossIncome: income,\r\n      taxAmount: 0,\r\n      netIncome: income\r\n    };\r\n  }\r\n};\r\n\r\n// ì•„ì´í…œ ê±°ë˜ì„¸ ê³„ì‚°ë§Œ (ë™ê¸° í•¨ìˆ˜)\r\nexport const calculateItemTax = (amount, isMarketPlace = false) => {\r\n  const taxRate = isMarketPlace ? 0.03 : 0.1; // ê¸°ë³¸ê°’ ì‚¬ìš©\r\n  const taxAmount = Math.floor(amount * taxRate);\r\n  return taxAmount;\r\n};\r\n\r\n// ì•„ì´í…œ ê±°ë˜ì„¸ ê³„ì‚° ë° ì ìš© (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)\r\nexport const applyItemTax = async (classCode, userId, amount, isMarketPlace = false) => {\r\n  try {\r\n    const taxSettings = await getTaxSettings(classCode);\r\n    const taxRate = isMarketPlace\r\n      ? (taxSettings.itemMarketTransactionTaxRate || 0.03)\r\n      : (taxSettings.itemStoreVATRate || 0.1);\r\n\r\n    const taxAmount = Math.floor(amount * taxRate);\r\n\r\n    if (taxAmount > 0) {\r\n      const taxType = isMarketPlace ? 'itemMarket' : 'itemStore';\r\n      await addTaxToTreasury(classCode, taxType, taxAmount,\r\n        `ì•„ì´í…œ ${isMarketPlace ? 'ë§ˆì¼“í”Œë ˆì´ìŠ¤' : 'ìƒì '} ê±°ë˜ì„¸: ${amount.toLocaleString()}ì›`);\r\n\r\n      // í™œë™ ë¡œê·¸ ì¶”ê°€\r\n      if (userId) {\r\n        await addActivityLog(userId, 'TAX_PAYMENT',\r\n          `ì•„ì´í…œ ê±°ë˜ì„¸ ${taxAmount.toLocaleString()}ì›ì„ ë‚©ë¶€í–ˆìŠµë‹ˆë‹¤.`, {\r\n            taxType: taxType,\r\n            originalAmount: amount,\r\n            taxRate: taxRate,\r\n            taxAmount: taxAmount,\r\n            isMarketPlace\r\n          });\r\n      }\r\n    }\r\n\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount,\r\n      netAmount: amount - taxAmount\r\n    };\r\n  } catch (error) {\r\n    logger.error('ì•„ì´í…œ ê±°ë˜ì„¸ ì ìš© ì‹¤íŒ¨:', error);\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount: 0,\r\n      netAmount: amount\r\n    };\r\n  }\r\n};\r\n\r\n// ì£¼ì‹ ê±°ë˜ì„¸ ê³„ì‚° ë° ì ìš©\r\nexport const applyStockTax = async (classCode, userId, amount, transactionType) => {\r\n  try {\r\n    const taxSettings = await getTaxSettings(classCode);\r\n    const taxRate = taxSettings.stockTransactionTaxRate || 0.01;\r\n    const taxAmount = Math.floor(amount * taxRate);\r\n\r\n    if (taxAmount > 0) {\r\n      await addTaxToTreasury(classCode, 'stock', taxAmount,\r\n        `ì£¼ì‹ ${transactionType} ê±°ë˜ì„¸: ${amount.toLocaleString()}ì›`);\r\n\r\n      // í™œë™ ë¡œê·¸ ì¶”ê°€\r\n      if (userId) {\r\n        await addActivityLog(userId, 'TAX_PAYMENT',\r\n          `ì£¼ì‹ ê±°ë˜ì„¸ ${taxAmount.toLocaleString()}ì›ì„ ë‚©ë¶€í–ˆìŠµë‹ˆë‹¤.`, {\r\n            taxType: 'stock',\r\n            originalAmount: amount,\r\n            taxRate: taxRate,\r\n            taxAmount: taxAmount,\r\n            transactionType\r\n          });\r\n      }\r\n    }\r\n\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount,\r\n      netAmount: amount - taxAmount\r\n    };\r\n  } catch (error) {\r\n    logger.error('ì£¼ì‹ ê±°ë˜ì„¸ ì ìš© ì‹¤íŒ¨:', error);\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount: 0,\r\n      netAmount: amount\r\n    };\r\n  }\r\n};\r\n\r\n// ë¶€ë™ì‚° ê±°ë˜ì„¸ ê³„ì‚° ë° ì ìš©\r\nexport const applyRealEstateTax = async (classCode, userId, amount, transactionType) => {\r\n  try {\r\n    const taxSettings = await getTaxSettings(classCode);\r\n    const taxRate = taxSettings.realEstateTransactionTaxRate || 0.03;\r\n    const taxAmount = Math.floor(amount * taxRate);\r\n\r\n    if (taxAmount > 0) {\r\n      await addTaxToTreasury(classCode, 'realEstateTransaction', taxAmount,\r\n        `ë¶€ë™ì‚° ${transactionType} ê±°ë˜ì„¸: ${amount.toLocaleString()}ì›`);\r\n\r\n      // í™œë™ ë¡œê·¸ ì¶”ê°€\r\n      if (userId) {\r\n        await addActivityLog(userId, 'TAX_PAYMENT',\r\n          `ë¶€ë™ì‚° ê±°ë˜ì„¸ ${taxAmount.toLocaleString()}ì›ì„ ë‚©ë¶€í–ˆìŠµë‹ˆë‹¤.`, {\r\n            taxType: 'realEstate',\r\n            originalAmount: amount,\r\n            taxRate: taxRate,\r\n            taxAmount: taxAmount,\r\n            transactionType\r\n          });\r\n      }\r\n    }\r\n\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount,\r\n      netAmount: amount - taxAmount\r\n    };\r\n  } catch (error) {\r\n    logger.error('ë¶€ë™ì‚° ê±°ë˜ì„¸ ì ìš© ì‹¤íŒ¨:', error);\r\n    return {\r\n      originalAmount: amount,\r\n      taxAmount: 0,\r\n      netAmount: amount\r\n    };\r\n  }\r\n};\r\n\r\n// ì‚¬ìš©ìì˜ í˜„ê¸ˆì—ì„œ ì„¸ê¸ˆ ì°¨ê°\r\nexport const deductTaxFromUser = async (userId, taxAmount, description) => {\r\n  try {\r\n    const userRef = doc(db, 'users', userId);\r\n    await updateDoc(userRef, {\r\n      cash: increment(-taxAmount),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n\r\n    logger.log(`[Tax] ì‚¬ìš©ì ${userId}ì—ê²Œì„œ ì„¸ê¸ˆ ${taxAmount}ì› ì°¨ê°ë¨`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('ì‚¬ìš©ì ì„¸ê¸ˆ ì°¨ê° ì‹¤íŒ¨:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\nexport default {\r\n  getTaxSettings,\r\n  addTaxToTreasury,\r\n  applyTransactionTax,\r\n  applyIncomeTax,\r\n  calculateItemTax,\r\n  applyItemTax,\r\n  applyStockTax,\r\n  applyRealEstateTax,\r\n  deductTaxFromUser\r\n};","// src/utils/validation.js - ì…ë ¥ ê²€ì¦ ìœ í‹¸ë¦¬í‹°\r\n\r\n/**\r\n * ê¸ˆì•¡ ê²€ì¦ ë° ì •ê·œí™”\r\n * @param {number|string} amount - ê²€ì¦í•  ê¸ˆì•¡\r\n * @param {object} options - ê²€ì¦ ì˜µì…˜\r\n * @returns {number} - ê²€ì¦ëœ ê¸ˆì•¡\r\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\r\n */\r\nexport const validateAmount = (amount, options = {}) => {\r\n  const {\r\n    min = 0,\r\n    max = Number.MAX_SAFE_INTEGER,\r\n    allowZero = false,\r\n    fieldName = 'ê¸ˆì•¡'\r\n  } = options;\r\n\r\n  // ìˆ«ìë¡œ ë³€í™˜\r\n  const numAmount = Number(amount);\r\n\r\n  // NaN ì²´í¬\r\n  if (isNaN(numAmount)) {\r\n    throw new Error(`${fieldName}ëŠ” ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  // ë¬´í•œëŒ€ ì²´í¬\r\n  if (!isFinite(numAmount)) {\r\n    throw new Error(`${fieldName}ëŠ” ìœ í•œí•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  // ìŒìˆ˜ ì²´í¬\r\n  if (numAmount < 0) {\r\n    throw new Error(`${fieldName}ëŠ” ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n  }\r\n\r\n  // 0 ì²´í¬\r\n  if (!allowZero && numAmount === 0) {\r\n    throw new Error(`${fieldName}ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  // ë²”ìœ„ ì²´í¬\r\n  if (numAmount < min) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${min.toLocaleString()}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (numAmount > max) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${max.toLocaleString()}ì›ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n  }\r\n\r\n  // ì •ìˆ˜ë¡œ ë³€í™˜ (ì†Œìˆ˜ì  ì œê±°)\r\n  return Math.floor(numAmount);\r\n};\r\n\r\n/**\r\n * ìˆ˜ëŸ‰ ê²€ì¦\r\n * @param {number|string} quantity - ê²€ì¦í•  ìˆ˜ëŸ‰\r\n * @param {object} options - ê²€ì¦ ì˜µì…˜\r\n * @returns {number} - ê²€ì¦ëœ ìˆ˜ëŸ‰\r\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\r\n */\r\nexport const validateQuantity = (quantity, options = {}) => {\r\n  const {\r\n    min = 1,\r\n    max = Number.MAX_SAFE_INTEGER,\r\n    fieldName = 'ìˆ˜ëŸ‰'\r\n  } = options;\r\n\r\n  const numQuantity = Number(quantity);\r\n\r\n  if (isNaN(numQuantity) || !isFinite(numQuantity)) {\r\n    throw new Error(`${fieldName}ëŠ” ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (numQuantity < min) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${min}ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (numQuantity > max) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${max}ê°œë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n  }\r\n\r\n  // ì •ìˆ˜ë¡œ ë³€í™˜\r\n  const intQuantity = Math.floor(numQuantity);\r\n\r\n  if (intQuantity !== numQuantity) {\r\n    throw new Error(`${fieldName}ëŠ” ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  return intQuantity;\r\n};\r\n\r\n/**\r\n * í¼ì„¼íŠ¸ ê²€ì¦\r\n * @param {number|string} percent - ê²€ì¦í•  í¼ì„¼íŠ¸\r\n * @param {object} options - ê²€ì¦ ì˜µì…˜\r\n * @returns {number} - ê²€ì¦ëœ í¼ì„¼íŠ¸\r\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\r\n */\r\nexport const validatePercent = (percent, options = {}) => {\r\n  const {\r\n    min = 0,\r\n    max = 100,\r\n    fieldName = 'í¼ì„¼íŠ¸'\r\n  } = options;\r\n\r\n  const numPercent = Number(percent);\r\n\r\n  if (isNaN(numPercent) || !isFinite(numPercent)) {\r\n    throw new Error(`${fieldName}ëŠ” ìœ íš¨í•œ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (numPercent < min || numPercent > max) {\r\n    throw new Error(`${fieldName}ëŠ” ${min}%ì—ì„œ ${max}% ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  return numPercent;\r\n};\r\n\r\n/**\r\n * ì”ì•¡ ì¶©ë¶„ ì—¬ë¶€ í™•ì¸\r\n * @param {number} currentBalance - í˜„ì¬ ì”ì•¡\r\n * @param {number} requiredAmount - í•„ìš”í•œ ê¸ˆì•¡\r\n * @param {string} fieldName - í•„ë“œ ì´ë¦„\r\n * @throws {Error} - ì”ì•¡ ë¶€ì¡± ì‹œ\r\n */\r\nexport const validateSufficientBalance = (currentBalance, requiredAmount, fieldName = 'ì”ì•¡') => {\r\n  const balance = Number(currentBalance);\r\n  const required = Number(requiredAmount);\r\n\r\n  if (isNaN(balance) || isNaN(required)) {\r\n    throw new Error('ì”ì•¡ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\r\n  }\r\n\r\n  if (balance < required) {\r\n    throw new Error(\r\n      `${fieldName}ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${balance.toLocaleString()}ì›, í•„ìš”: ${required.toLocaleString()}ì›)`\r\n    );\r\n  }\r\n};\r\n\r\n/**\r\n * ë¬¸ìì—´ ê²€ì¦\r\n * @param {string} value - ê²€ì¦í•  ë¬¸ìì—´\r\n * @param {object} options - ê²€ì¦ ì˜µì…˜\r\n * @returns {string} - ê²€ì¦ëœ ë¬¸ìì—´\r\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\r\n */\r\nexport const validateString = (value, options = {}) => {\r\n  const {\r\n    minLength = 0,\r\n    maxLength = 1000,\r\n    allowEmpty = false,\r\n    fieldName = 'ì…ë ¥ê°’'\r\n  } = options;\r\n\r\n  if (typeof value !== 'string') {\r\n    throw new Error(`${fieldName}ëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  const trimmed = value.trim();\r\n\r\n  if (!allowEmpty && trimmed.length === 0) {\r\n    throw new Error(`${fieldName}ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);\r\n  }\r\n\r\n  if (trimmed.length < minLength) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${minLength}ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (trimmed.length > maxLength) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${maxLength}ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n  }\r\n\r\n  return trimmed;\r\n};\r\n\r\n/**\r\n * ë°°ì—´ ê²€ì¦\r\n * @param {Array} value - ê²€ì¦í•  ë°°ì—´\r\n * @param {object} options - ê²€ì¦ ì˜µì…˜\r\n * @returns {Array} - ê²€ì¦ëœ ë°°ì—´\r\n * @throws {Error} - ê²€ì¦ ì‹¤íŒ¨ ì‹œ\r\n */\r\nexport const validateArray = (value, options = {}) => {\r\n  const {\r\n    minLength = 0,\r\n    maxLength = Number.MAX_SAFE_INTEGER,\r\n    allowEmpty = false,\r\n    fieldName = 'ë°°ì—´'\r\n  } = options;\r\n\r\n  if (!Array.isArray(value)) {\r\n    throw new Error(`${fieldName}ëŠ” ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (!allowEmpty && value.length === 0) {\r\n    throw new Error(`${fieldName}ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (value.length < minLength) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœì†Œ ${minLength}ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);\r\n  }\r\n\r\n  if (value.length > maxLength) {\r\n    throw new Error(`${fieldName}ëŠ” ìµœëŒ€ ${maxLength}ê°œë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n  }\r\n\r\n  return value;\r\n};\r\n","// src/MoneyTransfer.js - ì„œë²„ ì‘ë‹µ ê¸°ë°˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì • ë²„ì „\r\n\r\nimport React, { useState, useEffect, useMemo, useCallback } from \"react\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport { adminCashAction } from \"../../services/database\";\r\nimport \"./MoneyTransfer.css\";\r\nimport { formatKoreanCurrency } from '../../utils/numberFormatter';\r\nimport { logger } from '../../utils/logger';\r\n\r\nfunction MoneyTransfer() {\r\n  // AuthContextì—ì„œ í•„ìš”í•œ ë°ì´í„°ì™€ í•¨ìˆ˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.\r\n  const { \r\n    userDoc, \r\n    allClassMembers, \r\n    loading: authLoading,\r\n    setUserDoc,\r\n    setAllClassMembers\r\n  } = useAuth();\r\n\r\n  // ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ ìƒíƒœ ê´€ë¦¬\r\n  const [selectedUsers, setSelectedUsers] = useState([]);\r\n  const [amount, setAmount] = useState(\"\");\r\n  const [amountType, setAmountType] = useState(\"fixed\");\r\n  const [action, setAction] = useState(\"send\");\r\n  const [takeMode, setTakeMode] = useState(\"toMe\"); // \"toMe\" ë˜ëŠ” \"remove\"\r\n  const [taxRate, setTaxRate] = useState(10);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [selectAll, setSelectAll] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n  // ê´€ë¦¬ì ì •ë³´ ì¶”ì¶œ\r\n  const adminName = userDoc?.name;\r\n  const adminClassCode = userDoc?.classCode;\r\n\r\n  // ì „ì²´ ì‚¬ìš©ì ëª©ë¡ì„ ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬\r\n  const users = useMemo(() => {\r\n    if (!allClassMembers || allClassMembers.length === 0) return [];\r\n    return [...allClassMembers].sort((a, b) => {\r\n      const nameA = a.name || a.nickname || \"\";\r\n      const nameB = b.name || b.nickname || \"\";\r\n      return nameA.localeCompare(nameB, \"ko\");\r\n    });\r\n  }, [allClassMembers]);\r\n\r\n  // ì•¡ì…˜ íƒ€ì…ì´ ë³€ê²½ë˜ë©´ ì„ íƒ ì´ˆê¸°í™”\r\n  useEffect(() => {\r\n    setSelectedUsers([]);\r\n    setSelectAll(false);\r\n  }, [action, amountType]);\r\n\r\n  // ì‚¬ìš©ì ì„ íƒ í•¸ë“¤ëŸ¬\r\n  const handleUserSelection = (userId) => {\r\n    setSelectedUsers((prevSelected) =>\r\n      prevSelected.includes(userId)\r\n        ? prevSelected.filter((id) => id !== userId)\r\n        : [...prevSelected, userId]\r\n    );\r\n  };\r\n\r\n  // ì „ì²´ ì„ íƒ í•¸ë“¤ëŸ¬\r\n  const handleSelectAll = () => {\r\n    setSelectAll(prev => {\r\n      const newSelectAll = !prev;\r\n      setSelectedUsers(newSelectAll ? users.map((user) => user.id) : []);\r\n      return newSelectAll;\r\n    });\r\n  };\r\n  \r\n  // ë¯¸ë¦¬ë³´ê¸° ê¸ˆì•¡ ê³„ì‚° í•¨ìˆ˜\r\n  const calculatePreviewAmount = useCallback((userCash, inputValue, applyTax = false) => {\r\n    let baseAmount;\r\n    if (amountType === \"percentage\") {\r\n      baseAmount = Math.floor((userCash * Number(inputValue)) / 100);\r\n    } else {\r\n      baseAmount = Number(inputValue);\r\n    }\r\n\r\n    if (applyTax && action === \"send\") {\r\n      const taxAmount = Math.floor((baseAmount * taxRate) / 100);\r\n      return baseAmount - taxAmount;\r\n    }\r\n\r\n    return baseAmount;\r\n  }, [amountType, action, taxRate]);\r\n\r\n  // í¼ ì œì¶œ (ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ì‹¤í–‰) í•¸ë“¤ëŸ¬\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (selectedUsers.length === 0 || !amount || isNaN(Number(amount))) {\r\n      setError(\"ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ê³  ìœ íš¨í•œ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.\");\r\n      return;\r\n    }\r\n\r\n    const inputValue = Number(amount);\r\n    if (inputValue <= 0) {\r\n      setError(`${amountType === 'percentage' ? 'í¼ì„¼íŠ¸' : 'ê¸ˆì•¡'}ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.`);\r\n      return;\r\n    }\r\n    if (amountType === 'percentage' && (inputValue > 100 || inputValue < 0)) {\r\n      setError(\"í¼ì„¼íŠ¸ëŠ” 0ê³¼ 100 ì‚¬ì´ì˜ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.\");\r\n      return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    setMessage(\"\");\r\n    setError(\"\");\r\n\r\n    try {\r\n      const targetUsersData = users.filter(user => selectedUsers.includes(user.id));\r\n      \r\n      // âœ¨ DB ì‘ì—… ì‹¤í–‰í•˜ê³  ì„œë²„ë¡œë¶€í„° ì‹¤ì œ ê²°ê³¼ ë°›ê¸°\r\n      const { count, totalProcessed, updatedUsers } = await adminCashAction({\r\n        adminName,\r\n        adminClassCode,\r\n        targetUsers: targetUsersData,\r\n        action,\r\n        takeMode: action === \"take\" ? takeMode : undefined, // ê°€ì ¸ì˜¤ê¸° ëª¨ë“œ ì „ë‹¬\r\n        amountType,\r\n        amount: inputValue,\r\n        taxRate,\r\n      });\r\n\r\n      // âœ¨ ì„œë²„ì—ì„œ ë°›ì€ 'ì§„ì§œ' ë°ì´í„°ë¡œ ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸\r\n      if (updatedUsers && updatedUsers.length > 0) {\r\n        // 1. ëŒ€ìƒ ì‚¬ìš©ìë“¤ì˜ ì”ì•¡ ì—…ë°ì´íŠ¸\r\n        setAllClassMembers(currentMembers =>\r\n          currentMembers.map(member => {\r\n            const updatedInfo = updatedUsers.find(u => u.id === member.id);\r\n            return updatedInfo ? { ...member, cash: updatedInfo.newCash } : member;\r\n          })\r\n        );\r\n\r\n        // 2. ê´€ë¦¬ì ë³¸ì¸ì˜ ì”ì•¡ ì—…ë°ì´íŠ¸\r\n        setUserDoc(currentAdminDoc => {\r\n          const currentAdminCash = Number(currentAdminDoc.cash || 0);\r\n          let newAdminCash;\r\n          if (action === \"send\") {\r\n            // ë³´ëƒˆì„ ë•ŒëŠ” ì²˜ë¦¬ëœ ì´ì•¡ë§Œí¼ ì°¨ê° (ì„¸ê¸ˆ í¬í•¨ëœ ê¸ˆì•¡ì´ totalProcessed)\r\n            newAdminCash = currentAdminCash - totalProcessed;\r\n          } else if (action === \"take\" && takeMode === \"toMe\") {\r\n            // ë‚˜ì—ê²Œ ê°€ì ¸ì˜¬ ë•ŒëŠ” ì²˜ë¦¬ëœ ì´ì•¡ë§Œí¼ ì¦ê°€\r\n            newAdminCash = currentAdminCash + totalProcessed;\r\n          } else {\r\n            // ëˆ ì—†ì• ê¸° ëª¨ë“œëŠ” ê´€ë¦¬ì ì”ì•¡ ë³€í™” ì—†ìŒ\r\n            newAdminCash = currentAdminCash;\r\n          }\r\n          return { ...currentAdminDoc, cash: newAdminCash };\r\n        });\r\n      }\r\n\r\n      // ì„±ê³µ ë©”ì‹œì§€ ì„¤ì •\r\n      const actionText = action === \"send\" ? \"ë³´ë‚´ê¸°\" : (takeMode === \"toMe\" ? \"ê°€ì ¸ì˜¤ê¸°\" : \"ì—†ì• ê¸°\");\r\n      setMessage(\r\n        `${count}ëª…ì—ê²Œ ${amountType === 'percentage' ? `${inputValue}%` : `${inputValue.toLocaleString()}ì›`} ${actionText} ì™„ë£Œ! (ì´ ${totalProcessed.toLocaleString()}ì› ì²˜ë¦¬${action === 'send' && taxRate > 0 ? `, ì„¸ê¸ˆ ${taxRate}% ì ìš©` : ''})`\r\n      );\r\n      \r\n      setAmount(\"\");\r\n      setSelectedUsers([]);\r\n      setSelectAll(false);\r\n\r\n      setTimeout(() => setMessage(\"\"), 3000);\r\n\r\n    } catch (err) {\r\n      logger.error(\"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\", err);\r\n      setError(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message}`);\r\n      // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ëŠ” ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ ê°€ì¥ ì •í™•í•˜ì§€ë§Œ,\r\n      // Firestore ì‚¬ìš© ìµœì†Œí™”ë¥¼ ìœ„í•´ ì—¬ê¸°ì„œëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.\r\n      setTimeout(() => setError(\"\"), 5000);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n  \r\n  const previewAmounts = useMemo(() => {\r\n    if (!amount || selectedUsers.length === 0) return {};\r\n    const preview = {};\r\n    selectedUsers.forEach(userId => {\r\n      const user = users.find(u => u.id === userId);\r\n      if (user) {\r\n        const userCash = Number(user.cash || 0);\r\n        const applyTax = action === 'send';\r\n        preview[userId] = calculatePreviewAmount(userCash, amount, applyTax);\r\n      }\r\n    });\r\n    return preview;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [selectedUsers, amount, action, users, calculatePreviewAmount]); // amountTypeê³¼ taxRateëŠ” calculatePreviewAmount ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë¨\r\n\r\n  return (\r\n    <div className=\"money-transfer-container\">\r\n      <div className=\"header\">\r\n        <div className=\"admin-info\">\r\n          <span className=\"admin-label\">ê´€ë¦¬ì</span>\r\n          <span className=\"admin-name\">{adminName || \"ë¡œë”© ì¤‘...\"}</span>\r\n          <span className=\"admin-cash\">í˜„ê¸ˆ: {(userDoc?.cash || 0).toLocaleString()}ì›</span>\r\n        </div>\r\n      </div>\r\n\r\n      {error && <div className=\"alert alert-error\">{error}</div>}\r\n      {message && <div className=\"alert alert-success\">{message}</div>}\r\n\r\n      <form onSubmit={handleSubmit} className=\"transfer-form\">\r\n        <div className=\"action-selector\">\r\n          <button type=\"button\" className={`action-btn ${action === \"send\" ? \"active send\" : \"\"}`} onClick={() => setAction(\"send\")}>\r\n            <span className=\"icon\">ğŸ“¤</span> ë³´ë‚´ê¸°\r\n          </button>\r\n          <button type=\"button\" className={`action-btn ${action === \"take\" ? \"active take\" : \"\"}`} onClick={() => setAction(\"take\")}>\r\n            <span className=\"icon\">ğŸ“¥</span> ê°€ì ¸ì˜¤ê¸°\r\n          </button>\r\n        </div>\r\n\r\n        {action === \"take\" && (\r\n          <div className=\"take-mode-section\">\r\n            <h4>ê°€ì ¸ì˜¤ê¸° ì˜µì…˜</h4>\r\n            <div className=\"take-mode-selector\">\r\n              <label className={`mode-option ${takeMode === 'toMe' ? 'active' : ''}`}>\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"takeMode\"\r\n                  value=\"toMe\"\r\n                  checked={takeMode === 'toMe'}\r\n                  onChange={(e) => setTakeMode(e.target.value)}\r\n                />\r\n                <span className=\"radio-custom\"></span>\r\n                <span className=\"mode-text\">\r\n                  <strong>ğŸ’° ë‚˜ì—ê²Œ ê°€ì ¸ì˜¤ê¸°</strong>\r\n                  <small>ì„ íƒí•œ í•™ìƒë“¤ì˜ ëˆì„ ë‚´ ê³„ì¢Œë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤</small>\r\n                </span>\r\n              </label>\r\n              <label className={`mode-option ${takeMode === 'remove' ? 'active' : ''}`}>\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"takeMode\"\r\n                  value=\"remove\"\r\n                  checked={takeMode === 'remove'}\r\n                  onChange={(e) => setTakeMode(e.target.value)}\r\n                />\r\n                <span className=\"radio-custom\"></span>\r\n                <span className=\"mode-text\">\r\n                  <strong>ğŸ—‘ï¸ ëˆ ì—†ì• ê¸°</strong>\r\n                  <small>ì„ íƒí•œ í•™ìƒë“¤ì˜ ëˆì„ ì˜êµ¬ì ìœ¼ë¡œ ì œê±°í•©ë‹ˆë‹¤</small>\r\n                </span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"amount-section\">\r\n          <div className=\"amount-type-selector\">\r\n            <label className={`type-option ${amountType === 'fixed' ? 'active' : ''}`}>\r\n              <input type=\"radio\" name=\"amountType\" value=\"fixed\" checked={amountType === 'fixed'} onChange={(e) => setAmountType(e.target.value)} />\r\n              <span className=\"radio-custom\"></span> ê³ ì • ê¸ˆì•¡\r\n            </label>\r\n            <label className={`type-option ${amountType === 'percentage' ? 'active' : ''}`}>\r\n              <input type=\"radio\" name=\"amountType\" value=\"percentage\" checked={amountType === 'percentage'} onChange={(e) => setAmountType(e.target.value)} />\r\n              <span className=\"radio-custom\"></span> í¼ì„¼íŠ¸ (%)\r\n            </label>\r\n          </div>\r\n          <div className=\"amount-input-group\">\r\n            <input type=\"number\" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder={amountType === 'fixed' ? 'ê¸ˆì•¡ ì…ë ¥' : 'í¼ì„¼íŠ¸ ì…ë ¥'} min=\"1\" max={amountType === 'percentage' ? \"100\" : undefined} required className=\"amount-input\" />\r\n            <span className=\"amount-unit\">{amountType === 'fixed' ? 'ì›' : '%'}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {action === \"send\" && (\r\n          <div className=\"tax-section\">\r\n            <div className=\"tax-header\">\r\n              <h4>ğŸ’¸ ì„¸ê¸ˆ ì„¤ì •</h4>\r\n              <span className=\"tax-description\">ë³´ë‚´ëŠ” ê¸ˆì•¡ì—ì„œ ì„¸ê¸ˆì„ ì œì™¸í•˜ê³  ì§€ê¸‰ë©ë‹ˆë‹¤.</span>\r\n            </div>\r\n            <div className=\"tax-input-group\">\r\n              <label htmlFor=\"taxRate\">ì„¸ê¸ˆìœ¨:</label>\r\n              <input type=\"number\" id=\"taxRate\" value={taxRate} onChange={(e) => setTaxRate(Math.max(0, Math.min(100, Number(e.target.value))))} min=\"0\" max=\"100\" className=\"tax-input\" />\r\n              <span className=\"tax-unit\">%</span>\r\n            </div>\r\n            {amount && (\r\n              <div className=\"tax-preview\">\r\n                {amountType === 'fixed' ? (\r\n                  <>ì‹¤ì œ ì§€ê¸‰ì•¡: {calculatePreviewAmount(0, amount, true).toLocaleString()}ì› (ì„¸ê¸ˆ {Math.floor((Number(amount) * taxRate) / 100).toLocaleString()}ì› ì œì™¸)</>\r\n                ) : (\r\n                  `ê° í•™ìƒ ì”ì•¡ì˜ ${amount}%ì—ì„œ ì„¸ê¸ˆ ${taxRate}%ê°€ ì¶”ê°€ë¡œ ì°¨ê°ë©ë‹ˆë‹¤.`\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"user-selection-section\">\r\n          <div className=\"section-header\">\r\n            <h3>ëŒ€ìƒ ì„ íƒ</h3>\r\n            <label className=\"select-all-label\">\r\n              <input type=\"checkbox\" checked={selectAll} onChange={handleSelectAll} className=\"checkbox-custom\" />\r\n              <span className=\"checkmark\"></span> ì „ì²´ ì„ íƒ\r\n            </label>\r\n          </div>\r\n\r\n          {authLoading && users.length === 0 ? (\r\n            <div className=\"loading\">ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>\r\n          ) : (\r\n            <div className=\"user-list\">\r\n              {users.map((user) => {\r\n                const previewAmount = previewAmounts[user.id];\r\n                return (\r\n                  <div key={user.id} className=\"user-item\">\r\n                    <label className=\"user-label\">\r\n                      <input type=\"checkbox\" checked={selectedUsers.includes(user.id)} onChange={() => handleUserSelection(user.id)} className=\"checkbox-custom\" />\r\n                      <span className=\"checkmark\"></span>\r\n                      <div className=\"user-info\">\r\n                        <span className=\"user-name\">{user.name}</span>\r\n                        <span className=\"user-balance\">ì”ì•¡: {user.cash?.toLocaleString() || 0}ì›</span>\r\n                        {previewAmount !== undefined && (\r\n                          <span className={`preview-amount ${action}`}>\r\n                            {action === 'send' ? '+' : 'âˆ’'}{previewAmount.toLocaleString()}ì›\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </label>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <button type=\"submit\" className={`submit-btn ${action}`} disabled={authLoading || isProcessing}>\r\n          {isProcessing ? (\r\n            <><span className=\"spinner\"></span> ì²˜ë¦¬ ì¤‘...</>\r\n          ) : (\r\n            <><span className=\"icon\">{action === 'send' ? 'ğŸ“¤' : 'ğŸ“¥'}</span> {action === 'send' ? 'ë³´ë‚´ê¸°' : 'ê°€ì ¸ì˜¤ê¸°'} ì‹¤í–‰</>\r\n          )}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MoneyTransfer;","// src/database.js\r\nimport {\r\n  addActivityLog,\r\n  getUserDocument,\r\n  updateUserCashInFirestore,\r\n  updateUserCouponsInFirestore,\r\n  addTransaction as firebaseAddTransaction,\r\n  db,\r\n  writeBatch,\r\n  doc,\r\n  collection,\r\n  serverTimestamp,\r\n  updateUserDocument, // ì¶”ê°€ëœ import\r\n  runTransaction,\r\n  getDoc,\r\n  increment\r\n} from '../firebase';\r\nimport { applyTransactionTax, applyIncomeTax } from '../utils/taxUtils';\r\nimport { validateAmount } from '../utils/validation';\r\n\r\nimport { logger } from \"../utils/logger\";\r\n/**\r\n * í™œë™ ë¡œê·¸ íƒ€ì… ì •ì˜\r\n */\r\nconst LOG_TYPES = {\r\n  // í˜„ê¸ˆ ê´€ë ¨\r\n  CASH_INCOME: 'í˜„ê¸ˆ ì…ê¸ˆ',\r\n  CASH_EXPENSE: 'í˜„ê¸ˆ ì¶œê¸ˆ',\r\n  CASH_TRANSFER_SEND: 'ì†¡ê¸ˆ',\r\n  CASH_TRANSFER_RECEIVE: 'ì†¡ê¸ˆ ìˆ˜ì‹ ',\r\n  ADMIN_CASH_SEND: 'ê´€ë¦¬ì ì§€ê¸‰',\r\n  ADMIN_CASH_TAKE: 'ê´€ë¦¬ì íšŒìˆ˜',\r\n\r\n  // ì¿ í° ê´€ë ¨\r\n  COUPON_EARN: 'ì¿ í° íšë“',\r\n  COUPON_USE: 'ì¿ í° ì‚¬ìš©',\r\n  COUPON_GIVE: 'ì¿ í° ì§€ê¸‰',\r\n  COUPON_TAKE: 'ì¿ í° íšŒìˆ˜',\r\n  COUPON_TRANSFER_SEND: 'ì¿ í° ì†¡ê¸ˆ',\r\n  COUPON_TRANSFER_RECEIVE: 'ì¿ í° ìˆ˜ì‹ ',\r\n\r\n  // ì•„ì´í…œ ê´€ë ¨\r\n  ITEM_PURCHASE: 'ì•„ì´í…œ êµ¬ë§¤',\r\n  ITEM_USE: 'ì•„ì´í…œ ì‚¬ìš©', // ì•„ì´í…œ ì‚¬ìš© ë¡œê·¸ íƒ€ì…\r\n  ITEM_SELL: 'ì•„ì´í…œ íŒë§¤',\r\n  ITEM_MARKET_LIST: 'ì•„ì´í…œ ì‹œì¥ ë“±ë¡',\r\n  ITEM_MARKET_BUY: 'ì•„ì´í…œ ì‹œì¥ êµ¬ë§¤',\r\n  ITEM_OBTAIN: 'ì•„ì´í…œ íšë“',\r\n  ITEM_MOVE: 'ì•„ì´í…œ ì´ë™',\r\n\r\n  // ê³¼ì œ ê´€ë ¨\r\n  TASK_COMPLETE: 'ê³¼ì œ ì™„ë£Œ',\r\n  TASK_REWARD: 'ê³¼ì œ ë³´ìƒ',\r\n\r\n  // ê²Œì„ ê´€ë ¨\r\n  GAME_WIN: 'ê²Œì„ ìŠ¹ë¦¬',\r\n  GAME_LOSE: 'ê²Œì„ íŒ¨ë°°',\r\n  GAME_REWARD: 'ê²Œì„ ë³´ìƒ',\r\n  OMOK_GAME: 'ì˜¤ëª© ê²Œì„',\r\n  CHESS_GAME: 'ì²´ìŠ¤ ê²Œì„',\r\n\r\n  // ì£¼ì‹ ê´€ë ¨\r\n  STOCK_BUY: 'ì£¼ì‹ ë§¤ìˆ˜',\r\n  STOCK_SELL: 'ì£¼ì‹ ë§¤ë„',\r\n\r\n  // ì„¸ê¸ˆ ê´€ë ¨\r\n  TAX_PAYMENT: 'ì„¸ê¸ˆ ë‚©ë¶€',\r\n  TAX_REFUND: 'ì„¸ê¸ˆ í™˜ê¸‰',\r\n  FINE_PAYMENT: 'ë²Œê¸ˆ ë‚©ë¶€',\r\n\r\n  // ê¸‰ì—¬ ê´€ë ¨\r\n  SALARY_PAYMENT: 'ì›”ê¸‰ ì§€ê¸‰',\r\n  BONUS_PAYMENT: 'ë³´ë„ˆìŠ¤ ì§€ê¸‰',\r\n\r\n  // ì‹œìŠ¤í…œ ê´€ë ¨\r\n  SYSTEM: 'ì‹œìŠ¤í…œ',\r\n  ADMIN_ACTION: 'ê´€ë¦¬ì ì¡°ì¹˜',\r\n  TREASURY_DEPOSIT: 'ê¸ˆê³  ì…ê¸ˆ',\r\n  TREASURY_WITHDRAW: 'ê¸ˆê³  ì¶œê¸ˆ',\r\n};\r\n\r\n/**\r\n * ì²´ê³„ì ì¸ í™œë™ ë¡œê±°\r\n * @param {string} userId - ì‚¬ìš©ì ID\r\n * @param {string} type - í™œë™ ìœ í˜• (LOG_TYPES ì°¸ì¡°)\r\n * @param {string} description - í™œë™ ì„¤ëª…\r\n * @param {object} metadata - ì¶”ê°€ ë©”íƒ€ë°ì´í„°\r\n */\r\nconst logActivity = async (userId, type, description, metadata = {}) => {\r\n  if (!userId || userId === 'system') {\r\n    logger.log(`[System Log] ${type}: ${description}`);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Firebaseì— í™œë™ ë¡œê·¸ ê¸°ë¡ (ë©”íƒ€ë°ì´í„° í¬í•¨)\r\n    await addActivityLog(userId, type, description, metadata);\r\n\r\n    // ë©”íƒ€ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì½˜ì†”ì—ë„ ê¸°ë¡\r\n    if (Object.keys(metadata).length > 0) {\r\n      logger.log(`[Activity Log] User: ${userId}, Type: ${type}`, metadata);\r\n    }\r\n  } catch (error) {\r\n    logger.error('[Activity Log Error]', error);\r\n  }\r\n};\r\n\r\n/**\r\n * ê´€ë¦¬ì í˜„ê¸ˆ ì§€ê¸‰/íšŒìˆ˜ (MoneyTransfer.jsìš©) - Firestore íŠ¸ëœì­ì…˜ ì ìš©\r\n * @param {object} params - í•¨ìˆ˜ íŒŒë¼ë¯¸í„°\r\n * @param {string} params.adminName - ê´€ë¦¬ì ì´ë¦„\r\n * @param {string} params.adminClassCode - ê´€ë¦¬ì í•™ê¸‰ ì½”ë“œ\r\n * @param {Array<object>} params.targetUsers - ëŒ€ìƒ ì‚¬ìš©ì ì •ë³´ ë°°ì—´\r\n * @param {string} params.action - 'send' ë˜ëŠ” 'take'\r\n * @param {string} params.amountType - 'fixed' ë˜ëŠ” 'percentage'\r\n * @param {number} params.amount - ê¸ˆì•¡ ë˜ëŠ” í¼ì„¼íŠ¸\r\n * @param {number} params.taxRate - ì„¸ìœ¨\r\n */\r\nexport const adminCashAction = async ({\r\n  adminName,\r\n  adminClassCode,\r\n  targetUsers,\r\n  action,\r\n  takeMode, // \"toMe\" ë˜ëŠ” \"remove\"\r\n  amountType,\r\n  amount,\r\n  taxRate,\r\n}) => {\r\n  logger.log('[database.js] adminCashAction ì‹œì‘:', {\r\n    adminName,\r\n    action,\r\n    takeMode,\r\n    amountType,\r\n    amount,\r\n    taxRate,\r\n    targetUsersCount: targetUsers.length\r\n  });\r\n\r\n  // ì…ë ¥ ê²€ì¦\r\n  try {\r\n    if (amountType === 'percentage') {\r\n      if (amount < 0 || amount > 100) {\r\n        throw new Error('í¼ì„¼íŠ¸ëŠ” 0ê³¼ 100 ì‚¬ì´ì˜ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\r\n      }\r\n    } else {\r\n      validateAmount(amount, { min: 1, fieldName: 'ê¸ˆì•¡' });\r\n    }\r\n  } catch (error) {\r\n    throw new Error(`ì…ë ¥ ê²€ì¦ ì‹¤íŒ¨: ${error.message}`);\r\n  }\r\n\r\n  const updatedUsers = [];\r\n  let totalProcessed = 0;\r\n  let successCount = 0;\r\n\r\n  // ê° ì‚¬ìš©ìì— ëŒ€í•´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬\r\n  for (const user of targetUsers) {\r\n    try {\r\n      await runTransaction(db, async (transaction) => {\r\n        const userRef = doc(db, \"users\", user.id);\r\n        const userDoc = await transaction.get(userRef);\r\n\r\n        if (!userDoc.exists()) {\r\n          throw new Error(`ì‚¬ìš©ì ${user.name}ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);\r\n        }\r\n\r\n        const userData = userDoc.data();\r\n        const currentCash = Number(userData.cash || 0);\r\n        let baseAmount;\r\n\r\n        if (amountType === \"percentage\") {\r\n          baseAmount = Math.floor((currentCash * amount) / 100);\r\n        } else {\r\n          baseAmount = validateAmount(amount, { min: 1, fieldName: 'ê¸ˆì•¡' });\r\n        }\r\n\r\n        if (baseAmount <= 0) {\r\n          logger.log(`[database.js] ${user.name}: ì²˜ë¦¬í•  ê¸ˆì•¡ì´ 0ì›ì´ë¯€ë¡œ ìŠ¤í‚µ`);\r\n          return;\r\n        }\r\n\r\n        let finalAmount = baseAmount;\r\n        let taxAmount = 0;\r\n\r\n        if (action === \"send\" && taxRate > 0) {\r\n          taxAmount = Math.floor((baseAmount * taxRate) / 100);\r\n          finalAmount = baseAmount - taxAmount;\r\n        }\r\n\r\n        let newCash;\r\n        if (action === \"send\") {\r\n          newCash = currentCash + finalAmount;\r\n        } else { // take\r\n          // ì”ì•¡ í™•ì¸\r\n          if (currentCash < baseAmount) {\r\n            throw new Error(`${user.name}ë‹˜ì˜ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë³´ìœ : ${currentCash.toLocaleString()}ì›, í•„ìš”: ${baseAmount.toLocaleString()}ì›)`);\r\n          }\r\n          newCash = currentCash - baseAmount;\r\n        }\r\n\r\n        // ì‚¬ìš©ì ì”ì•¡ ì—…ë°ì´íŠ¸\r\n        transaction.update(userRef, {\r\n          cash: newCash,\r\n          updatedAt: serverTimestamp()\r\n        });\r\n\r\n        // ë¡œê·¸ ê¸°ë¡\r\n        const logRef = doc(collection(db, \"activity_logs\"));\r\n        let logType, logDescription;\r\n\r\n        if (action === \"send\") {\r\n          logType = \"ADMIN_CASH_SEND\";\r\n          if (amountType === \"percentage\") {\r\n            logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì—ê²Œ ${amount}% (${finalAmount.toLocaleString()}ì›)ì„ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤.`;\r\n            if (taxAmount > 0) {\r\n              logDescription += ` (ì›ê¸ˆ ${baseAmount.toLocaleString()}ì›, ì„¸ê¸ˆ ${taxAmount.toLocaleString()}ì› ì œì™¸)`;\r\n            }\r\n          } else {\r\n            logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì—ê²Œ ${finalAmount.toLocaleString()}ì›ì„ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤.`;\r\n            if (taxAmount > 0) {\r\n              logDescription += ` (ì›ê¸ˆ ${baseAmount.toLocaleString()}ì›, ì„¸ê¸ˆ ${taxAmount.toLocaleString()}ì› ì œì™¸)`;\r\n            }\r\n          }\r\n        } else if (action === \"take\") {\r\n          if (takeMode === \"remove\") {\r\n            logType = \"ADMIN_CASH_REMOVE\";\r\n            if (amountType === \"percentage\") {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì˜ ${amount}% (${baseAmount.toLocaleString()}ì›)ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.`;\r\n            } else {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ì˜ ${baseAmount.toLocaleString()}ì›ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.`;\r\n            }\r\n          } else {\r\n            logType = \"ADMIN_CASH_TAKE\";\r\n            if (amountType === \"percentage\") {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ìœ¼ë¡œë¶€í„° ${amount}% (${baseAmount.toLocaleString()}ì›)ì„ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`;\r\n            } else {\r\n              logDescription = `ê´€ë¦¬ì(${adminName})ê°€ ${user.name}ë‹˜ìœ¼ë¡œë¶€í„° ${baseAmount.toLocaleString()}ì›ì„ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`;\r\n            }\r\n          }\r\n        }\r\n\r\n        const logData = {\r\n          userId: user.id,\r\n          userName: user.name,\r\n          timestamp: serverTimestamp(),\r\n          type: logType,\r\n          description: logDescription,\r\n          classCode: adminClassCode,\r\n          metadata: {\r\n            adminName,\r\n            action,\r\n            amountType,\r\n            inputValue: amount,\r\n            taxRate: action === 'send' ? taxRate : 0,\r\n            baseAmount,\r\n            taxAmount,\r\n            finalAmount,\r\n            previousCash: currentCash,\r\n            newCash\r\n          }\r\n        };\r\n        transaction.set(logRef, logData);\r\n\r\n        // ê±°ë˜ ê¸°ë¡\r\n        const transactionRef = doc(collection(db, \"transactions\"));\r\n        const transactionData = {\r\n          userId: user.id,\r\n          amount: action === 'send' ? finalAmount : -baseAmount,\r\n          type: action === 'send' ? 'income' : 'expense',\r\n          category: 'admin',\r\n          description: action === 'send' ? 'ê´€ë¦¬ì ì§€ê¸‰' : 'ê´€ë¦¬ì íšŒìˆ˜',\r\n          timestamp: serverTimestamp(),\r\n          metadata: {\r\n            adminName,\r\n            amountType,\r\n            taxRate: action === 'send' ? taxRate : 0\r\n          }\r\n        };\r\n        transaction.set(transactionRef, transactionData);\r\n\r\n        // ì„±ê³µ ì •ë³´ ì €ì¥\r\n        updatedUsers.push({ id: user.id, newCash });\r\n        totalProcessed += baseAmount;\r\n        successCount++;\r\n\r\n        logger.log(`[database.js] ${user.name} íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ì™„ë£Œ:`, {\r\n          í˜„ì¬ì”ì•¡: currentCash,\r\n          ê¸°ë³¸ê¸ˆì•¡: baseAmount,\r\n          ì„¸ê¸ˆ: taxAmount,\r\n          ìµœì¢…ê¸ˆì•¡: finalAmount,\r\n          ìƒˆì”ì•¡: newCash\r\n        });\r\n      });\r\n    } catch (userError) {\r\n      logger.error(`[database.js] ì‚¬ìš©ì ${user.name} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, userError);\r\n      throw new Error(`${user.name}ë‹˜ ì²˜ë¦¬ ì‹¤íŒ¨: ${userError.message}`);\r\n    }\r\n  }\r\n\r\n  logger.log(`[database.js] adminCashAction ì™„ë£Œ: ${successCount}ëª… ì²˜ë¦¬, ì´ ${totalProcessed.toLocaleString()}ì›`);\r\n\r\n  return {\r\n    count: successCount,\r\n    totalProcessed,\r\n    updatedUsers,\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Initialize the database with default values\r\n */\r\nexport const initializeDatabase = async () => {\r\n  logger.log(\"Initializing database...\");\r\n\r\n  if (!localStorage.getItem(\"dbInitialized\")) {\r\n    logger.log(\"First time initialization...\");\r\n\r\n    // Initialize items\r\n    const defaultItems = [\r\n      {\r\n        id: 1,\r\n        name: \"ì—°í•„\",\r\n        description: \"ê³¼ì œ ì œì¶œ ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ ì•„ì´í…œ\",\r\n        icon: \"âœï¸\",\r\n        price: 100,\r\n        effect: \"ê³¼ì œ ì œì¶œ ì‹œ ì‚¬ìš©\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 2,\r\n        name: \"ì§€ìš°ê°œ\",\r\n        description: \"ì‹¤ìˆ˜ë¥¼ ì§€ìš¸ ìˆ˜ ìˆëŠ” í•„ìˆ˜ ì•„ì´í…œ\",\r\n        icon: \"ğŸ§½\",\r\n        price: 50,\r\n        effect: \"ì‹¤ìˆ˜ í•˜ë‚˜ ì§€ìš°ê¸°\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 3,\r\n        name: \"ë…¸íŠ¸\",\r\n        description: \"í•™ìŠµ ë‚´ìš©ì„ ê¸°ë¡í•  ìˆ˜ ìˆëŠ” ì•„ì´í…œ\",\r\n        icon: \"ğŸ““\",\r\n        price: 200,\r\n        effect: \"í•™ìŠµ ê¸°ë¡\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 4,\r\n        name: \"ê³„ì‚°ê¸°\",\r\n        description: \"ë³µì¡í•œ ê³„ì‚°ì„ ë„ì™€ì£¼ëŠ” ì•„ì´í…œ\",\r\n        icon: \"ğŸ§®\",\r\n        price: 500,\r\n        effect: \"ê³„ì‚° ë„ì›€\",\r\n        available: true,\r\n      },\r\n      {\r\n        id: 5,\r\n        name: \"ê³ ê¸‰ íœ\",\r\n        description: \"ê³¼ì œ ì œì¶œ ì‹œ ì¶”ê°€ ì ìˆ˜ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ì•„ì´í…œ\",\r\n        icon: \"ğŸ–‹ï¸\",\r\n        price: 1000,\r\n        effect: \"ê³¼ì œ ì œì¶œ ì‹œ ì¶”ê°€ ì ìˆ˜\",\r\n        available: true,\r\n      },\r\n    ];\r\n\r\n    localStorage.setItem(\"items\", JSON.stringify(defaultItems));\r\n\r\n    // Initialize tasks\r\n    const defaultTasks = [\r\n      {\r\n        id: 1,\r\n        title: \"ê¸°ë³¸ ê²½ì œ ê°œë… í•™ìŠµ\",\r\n        description: \"ê¸°ë³¸ì ì¸ ê²½ì œ ìš©ì–´ì™€ ê°œë…ì„ í•™ìŠµí•˜ì„¸ìš”.\",\r\n        reward: 100,\r\n        couponReward: 1,\r\n        completed: false,\r\n        deadline: addDays(new Date(), 3),\r\n      },\r\n      {\r\n        id: 2,\r\n        title: \"ì˜ˆì‚° ê³„íš ì„¸ìš°ê¸°\",\r\n        description: \"í•œ ë‹¬ ì˜ˆì‚° ê³„íšì„ ì„¸ì›Œë³´ì„¸ìš”.\",\r\n        reward: 200,\r\n        couponReward: 2,\r\n        completed: false,\r\n        deadline: addDays(new Date(), 5),\r\n      },\r\n      {\r\n        id: 3,\r\n        title: \"ì €ì¶• ëª©í‘œ ì„¤ì •\",\r\n        description: \"ì €ì¶• ëª©í‘œì™€ ì „ëµì„ ìˆ˜ë¦½í•˜ì„¸ìš”.\",\r\n        reward: 150,\r\n        couponReward: 1,\r\n        completed: false,\r\n        deadline: addDays(new Date(), 7),\r\n      },\r\n    ];\r\n\r\n    localStorage.setItem(\"tasks\", JSON.stringify(defaultTasks));\r\n\r\n    // Initialize transactions\r\n    const defaultTransactions = [\r\n      {\r\n        id: 1,\r\n        date: new Date().toISOString(),\r\n        type: \"income\",\r\n        amount: 1000,\r\n        description: \"ì´ˆê¸° ì§€ê¸‰ê¸ˆ\",\r\n        category: \"system\",\r\n      },\r\n    ];\r\n\r\n    localStorage.setItem(\"transactions\", JSON.stringify(defaultTransactions));\r\n    localStorage.setItem(\"activity_logs\", JSON.stringify([]));\r\n    localStorage.setItem(\"dbInitialized\", \"true\");\r\n\r\n    logger.log(\"Database initialization complete.\");\r\n  } else {\r\n    logger.log(\"Database already initialized.\");\r\n  }\r\n};\r\n\r\n/**\r\n * Helper function to add days to a date\r\n */\r\nfunction addDays(date, days) {\r\n  const result = new Date(date);\r\n  result.setDate(result.getDate() + days);\r\n  return result.toISOString();\r\n}\r\n\r\n/**\r\n * í˜„ê¸ˆ ì „ì†¡ (ì†¡ê¸ˆ) - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n * @param {string} senderId - ì†¡ê¸ˆì ID\r\n * @param {string} receiverId - ìˆ˜ì‹ ì ID\r\n * @param {number} amount - ì†¡ê¸ˆì•¡\r\n * @param {string} message - ì†¡ê¸ˆ ë©”ì‹œì§€\r\n */\r\nexport const transferCash = async (senderId, receiverId, amount, message = '') => {\r\n  if (!senderId || !receiverId || amount <= 0) {\r\n    throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì†¡ê¸ˆ ì •ë³´ì…ë‹ˆë‹¤.');\r\n  }\r\n\r\n  try {\r\n    // ì†¡ê¸ˆì ì”ì•¡ í™•ì¸\r\n    const senderDoc = await getUserDocument(senderId);\r\n    if (!senderDoc || (senderDoc.cash || 0) < amount) {\r\n      throw new Error('ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');\r\n    }\r\n\r\n    const receiverDoc = await getUserDocument(receiverId);\r\n    if (!receiverDoc) {\r\n      throw new Error('ìˆ˜ì‹ ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\r\n    }\r\n\r\n    // ê±°ë˜ì„¸ ê³„ì‚° ë° ì ìš©\r\n    const classCode = senderDoc.classCode || receiverDoc.classCode;\r\n    const taxResult = await applyTransactionTax(classCode, senderId, amount, 'ì†¡ê¸ˆ');\r\n    const { taxAmount, netAmount } = taxResult;\r\n\r\n    // ì†¡ê¸ˆìëŠ” ì›ë˜ ê¸ˆì•¡ + ì„¸ê¸ˆì„ ì§€ë¶ˆí•´ì•¼ í•¨\r\n    const totalDeduction = amount + taxAmount;\r\n    if ((senderDoc.cash || 0) < totalDeduction) {\r\n      throw new Error(`ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì†¡ê¸ˆì•¡: ${amount}ì› + ê±°ë˜ì„¸: ${taxAmount}ì› = ì´ ${totalDeduction}ì› í•„ìš”)`);\r\n    }\r\n\r\n    // ì†¡ê¸ˆ ì²˜ë¦¬\r\n    const transferMessage = message || `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì†¡ê¸ˆ`;\r\n\r\n    // ì†¡ê¸ˆì ì°¨ê° (ì›ë˜ ê¸ˆì•¡ + ê±°ë˜ì„¸)\r\n    await updateUserCashInFirestore(senderId, -totalDeduction,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ${amount}ì› ì†¡ê¸ˆ (ê±°ë˜ì„¸ ${taxAmount}ì› í¬í•¨) ${message ? `(${message})` : ''}`);\r\n\r\n    await logActivity(senderId, LOG_TYPES.CASH_TRANSFER_SEND,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ${amount}ì›ì„ ì†¡ê¸ˆí–ˆìŠµë‹ˆë‹¤.${taxAmount > 0 ? ` (ê±°ë˜ì„¸ ${taxAmount}ì› ë‚©ë¶€)` : ''}${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        receiverId,\r\n        receiverName: receiverDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        totalDeduction,\r\n        message,\r\n        transactionType: 'transfer_send'\r\n      }\r\n    );\r\n\r\n    // ìˆ˜ì‹ ì ì¦ê°€ (ì„¸ê¸ˆ ì œì™¸í•œ ì›ë˜ ê¸ˆì•¡)\r\n    await updateUserCashInFirestore(receiverId, amount,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ${amount}ì› ì†¡ê¸ˆ ë°›ìŒ ${message ? `(${message})` : ''}`);\r\n\r\n    await logActivity(receiverId, LOG_TYPES.CASH_TRANSFER_RECEIVE,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ${amount}ì›ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        senderId,\r\n        senderName: senderDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        message,\r\n        transactionType: 'transfer_receive'\r\n      }\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n      amount,\r\n      taxAmount,\r\n      totalDeduction,\r\n      message: taxAmount > 0 ? `ì†¡ê¸ˆ ì™„ë£Œ. ê±°ë˜ì„¸ ${taxAmount}ì›ì´ ë¶€ê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.` : 'ì†¡ê¸ˆ ì™„ë£Œ.'\r\n    };\r\n  } catch (error) {\r\n    logger.error('í˜„ê¸ˆ ì „ì†¡ ì‹¤íŒ¨:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * ì¿ í° ì „ì†¡ - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n * @param {string} senderId - ì†¡ê¸ˆì ID\r\n * @param {string} receiverId - ìˆ˜ì‹ ì ID\r\n * @param {number} amount - ì¿ í° ìˆ˜ëŸ‰\r\n * @param {string} message - ì „ì†¡ ë©”ì‹œì§€\r\n */\r\nexport const transferCoupons = async (senderId, receiverId, amount, message = '') => {\r\n  if (!senderId || !receiverId || amount <= 0) {\r\n    throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì¿ í° ì „ì†¡ ì •ë³´ì…ë‹ˆë‹¤.');\r\n  }\r\n\r\n  try {\r\n    // ì†¡ê¸ˆì ì¿ í° í™•ì¸\r\n    const senderDoc = await getUserDocument(senderId);\r\n    if (!senderDoc || (senderDoc.coupons || 0) < amount) {\r\n      throw new Error('ì¿ í°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');\r\n    }\r\n\r\n    const receiverDoc = await getUserDocument(receiverId);\r\n    if (!receiverDoc) {\r\n      throw new Error('ìˆ˜ì‹ ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\r\n    }\r\n\r\n    // ì¿ í° ì „ì†¡ì˜ ê²½ìš° í˜„ê¸ˆ ê¸°ì¤€ ê°€ê²©ìœ¼ë¡œ ê±°ë˜ì„¸ ê³„ì‚° (ì¿ í° 1ê°œ = 100ì›ìœ¼ë¡œ ê°€ì •)\r\n    const classCode = senderDoc.classCode || receiverDoc.classCode;\r\n    const couponValue = amount * 100; // ì¿ í° 1ê°œë‹¹ 100ì›ìœ¼ë¡œ ê³„ì‚°\r\n    const taxResult = await applyTransactionTax(classCode, senderId, couponValue, 'ì¿ í° ì „ì†¡');\r\n    const { taxAmount } = taxResult;\r\n\r\n    // ì†¡ê¸ˆìëŠ” ê±°ë˜ì„¸ë¥¼ í˜„ê¸ˆìœ¼ë¡œ ì§€ë¶ˆí•´ì•¼ í•¨\r\n    if (taxAmount > 0 && (senderDoc.cash || 0) < taxAmount) {\r\n      throw new Error(`ê±°ë˜ì„¸ ë‚©ë¶€ë¥¼ ìœ„í•œ í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ê±°ë˜ì„¸: ${taxAmount}ì› í•„ìš”)`);\r\n    }\r\n\r\n    // ì¿ í° ì „ì†¡ ì²˜ë¦¬\r\n    const transferMessage = message || `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ìˆ˜ì‹ `;\r\n\r\n    // ì†¡ê¸ˆì ì¿ í° ì°¨ê°\r\n    await updateUserCouponsInFirestore(senderId, -amount,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œ ì „ì†¡ ${message ? `(${message})` : ''}`\r\n    );\r\n\r\n    // ê±°ë˜ì„¸ ì°¨ê° (í˜„ê¸ˆìœ¼ë¡œ)\r\n    if (taxAmount > 0) {\r\n      await updateUserCashInFirestore(senderId, -taxAmount, `ì¿ í° ì „ì†¡ ê±°ë˜ì„¸ ${taxAmount}ì›`);\r\n    }\r\n\r\n    await logActivity(senderId, LOG_TYPES.COUPON_TRANSFER_SEND,\r\n      `${receiverDoc.name}ë‹˜ì—ê²Œ ì¿ í° ${amount}ê°œë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.${taxAmount > 0 ? ` (ê±°ë˜ì„¸ ${taxAmount}ì› ë‚©ë¶€)` : ''}${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        receiverId,\r\n        receiverName: receiverDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        couponValue,\r\n        message,\r\n        transactionType: 'coupon_transfer_send'\r\n      }\r\n    );\r\n\r\n    // ìˆ˜ì‹ ì ì¦ê°€\r\n    await updateUserCouponsInFirestore(receiverId, amount,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ${amount}ê°œ ë°›ìŒ ${message ? `(${message})` : ''}`);\r\n\r\n    await logActivity(receiverId, LOG_TYPES.COUPON_TRANSFER_RECEIVE,\r\n      `${senderDoc.name}ë‹˜ìœ¼ë¡œë¶€í„° ì¿ í° ${amount}ê°œë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.${message ? ` ë©”ì‹œì§€: \"${message}\"` : ''}`,\r\n      {\r\n        senderId,\r\n        senderName: senderDoc.name,\r\n        amount,\r\n        taxAmount,\r\n        message,\r\n        transactionType: 'coupon_transfer_receive'\r\n      }\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n      amount,\r\n      taxAmount,\r\n      message: taxAmount > 0 ? `ì¿ í° ì „ì†¡ ì™„ë£Œ. ê±°ë˜ì„¸ ${taxAmount}ì›ì´ ë¶€ê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.` : 'ì¿ í° ì „ì†¡ ì™„ë£Œ.'\r\n    };\r\n  } catch (error) {\r\n    logger.error('ì¿ í° ì „ì†¡ ì‹¤íŒ¨:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * ê±°ë˜ ì¶”ê°€ (ê°œì„ ëœ ë²„ì „) - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const addTransaction = async (transaction, updateFirebase = true) => {\r\n  try {\r\n    // localStorageì— ê±°ë˜ ê¸°ë¡\r\n    const transactionsJson = localStorage.getItem(\"transactions\");\r\n    const transactions = transactionsJson ? JSON.parse(transactionsJson) : [];\r\n\r\n    const newTransaction = {\r\n      ...transaction,\r\n      id: transactions.length > 0\r\n        ? Math.max(...transactions.map((t) => t.id)) + 1\r\n        : 1,\r\n      date: new Date().toISOString(),\r\n    };\r\n\r\n    transactions.push(newTransaction);\r\n    localStorage.setItem(\"transactions\", JSON.stringify(transactions));\r\n\r\n    // Firebase ì—…ë°ì´íŠ¸\r\n    if (updateFirebase && transaction.userId && typeof transaction.amount === 'number') {\r\n      try {\r\n        const logType = transaction.type === 'income' ? LOG_TYPES.CASH_INCOME : LOG_TYPES.CASH_EXPENSE;\r\n        const logMessage = `${transaction.description} (${Math.abs(transaction.amount)}ì›)`;\r\n\r\n        if (transaction.type === 'income') {\r\n          await updateUserCashInFirestore(transaction.userId, transaction.amount, logMessage);\r\n        } else if (transaction.type === 'expense') {\r\n          await updateUserCashInFirestore(transaction.userId, -Math.abs(transaction.amount), logMessage);\r\n        }\r\n\r\n        await logActivity(transaction.userId, logType, logMessage, {\r\n          amount: transaction.amount,\r\n          category: transaction.category,\r\n          transactionId: newTransaction.id,\r\n          transactionType: transaction.type\r\n        });\r\n\r\n        // Firebaseì—ë„ ê±°ë˜ ê¸°ë¡ ì €ì¥\r\n        if (firebaseAddTransaction) {\r\n          await firebaseAddTransaction(transaction.userId, transaction.amount, transaction.description);\r\n        }\r\n\r\n        logger.log('[DB] Firebase ë™ê¸°í™” ì™„ë£Œ:', newTransaction);\r\n      } catch (firebaseError) {\r\n        logger.error('[DB] Firebase ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜:', firebaseError);\r\n      }\r\n    }\r\n\r\n    return newTransaction;\r\n  } catch (error) {\r\n    logger.error(\"Error adding transaction:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * ì‚¬ìš©ì ê±°ë˜ ë‚´ì—­ ì¡°íšŒ\r\n */\r\nexport const getUserTransactions = (userId, limit = null) => {\r\n  try {\r\n    const transactionsJson = localStorage.getItem(\"transactions\");\r\n    const transactions = transactionsJson ? JSON.parse(transactionsJson) : [];\r\n\r\n    let filteredTransactions = transactions;\r\n    if (userId) {\r\n      filteredTransactions = transactions.filter(t => t.userId === userId);\r\n    }\r\n\r\n    const sortedTransactions = filteredTransactions.sort(\r\n      (a, b) => new Date(b.date) - new Date(a.date)\r\n    );\r\n\r\n    if (limit && limit > 0) {\r\n      return sortedTransactions.slice(0, limit);\r\n    }\r\n\r\n    return sortedTransactions;\r\n  } catch (error) {\r\n    logger.error(\"Error getting transactions:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * ì‚¬ìš©ì ê³¼ì œ ì¡°íšŒ\r\n */\r\nexport const getUserTasks = (userId, completed = null) => {\r\n  try {\r\n    const tasksJson = localStorage.getItem(\"tasks\");\r\n    const tasks = tasksJson ? JSON.parse(tasksJson) : [];\r\n\r\n    if (completed !== null) {\r\n      return tasks.filter((task) => task.completed === completed);\r\n    }\r\n\r\n    return tasks;\r\n  } catch (error) {\r\n    logger.error(\"Error getting tasks:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * ê³¼ì œ ì™„ë£Œ (ê°œì„ ëœ ë²„ì „) - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const completeTask = async (taskId, userId, updateFirebase = true) => {\r\n  try {\r\n    const tasksJson = localStorage.getItem(\"tasks\");\r\n    const tasks = tasksJson ? JSON.parse(tasksJson) : [];\r\n\r\n    const taskIndex = tasks.findIndex((task) => task.id === taskId);\r\n    if (taskIndex === -1) {\r\n      logger.warn(`Task with ID ${taskId} not found`);\r\n      return false;\r\n    }\r\n\r\n    const completedTask = tasks[taskIndex];\r\n    tasks[taskIndex].completed = true;\r\n    localStorage.setItem(\"tasks\", JSON.stringify(tasks));\r\n\r\n    const cashReward = completedTask.reward || 0;\r\n    const couponReward = completedTask.couponReward || 0;\r\n\r\n    if (updateFirebase && userId) {\r\n      try {\r\n        // í˜„ê¸ˆ ë³´ìƒ (ì†Œë“ì„¸ ì ìš©)\r\n        if (cashReward > 0) {\r\n          const userDoc = await getUserDocument(userId);\r\n          const classCode = userDoc?.classCode;\r\n\r\n          if (classCode) {\r\n            const taxResult = await applyIncomeTax(classCode, userId, cashReward, 'reward');\r\n            const { netIncome, taxAmount } = taxResult;\r\n\r\n            await updateUserCashInFirestore(userId, netIncome,\r\n              `'${completedTask.title}' ê³¼ì œ ì™„ë£Œ ë³´ìƒ (ì„¸í›„ ${netIncome}ì›, ì†Œë“ì„¸ ${taxAmount}ì› ë‚©ë¶€)`\r\n            );\r\n          } else {\r\n            await updateUserCashInFirestore(userId, cashReward,\r\n              `'${completedTask.title}' ê³¼ì œ ì™„ë£Œ ë³´ìƒ`\r\n            );\r\n          }\r\n        }\r\n\r\n        // ì¿ í° ë³´ìƒ\r\n        if (couponReward > 0) {\r\n          await updateUserCouponsInFirestore(userId, couponReward,\r\n            `'${completedTask.title}' ê³¼ì œ ì™„ë£Œ ì¿ í° ë³´ìƒ`\r\n          );\r\n\r\n          // ì¿ í° íšë“ì— ëŒ€í•œ ë³„ë„ ë¡œê·¸ (ìˆ˜ì •ëœ ë¶€ë¶„)\r\n          await logActivity(userId, LOG_TYPES.COUPON_EARN,\r\n            `'ê³¼ì œ ì™„ë£Œ: ${completedTask.title}' í™œë™ìœ¼ë¡œ ì¿ í° ${couponReward}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.`,\r\n            {\r\n              taskId,\r\n              taskTitle: completedTask.title,\r\n              couponAmount: couponReward,\r\n              reason: 'task_completion',\r\n              activity: `ê³¼ì œ ì™„ë£Œ: ${completedTask.title}`, // ì–´ë–¤ í™œë™ì¸ì§€ ëª…ì‹œ\r\n              taskDescription: completedTask.description\r\n            }\r\n          );\r\n        }\r\n\r\n        // ê³¼ì œ ì™„ë£Œ í™œë™ ë¡œê·¸\r\n        const rewardText = [];\r\n        if (cashReward > 0) rewardText.push(`í˜„ê¸ˆ ${cashReward}ì›`);\r\n        if (couponReward > 0) rewardText.push(`ì¿ í° ${couponReward}ê°œ`);\r\n\r\n        await logActivity(userId, LOG_TYPES.TASK_COMPLETE,\r\n          `'${completedTask.title}' ê³¼ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.${rewardText.length > 0 ? ` ë³´ìƒ: ${rewardText.join(', ')}` : ''}`,\r\n          {\r\n            taskId,\r\n            taskTitle: completedTask.title,\r\n            taskDescription: completedTask.description,\r\n            cashReward,\r\n            couponReward,\r\n            deadline: completedTask.deadline\r\n          }\r\n        );\r\n\r\n        logger.log(`[DB] ê³¼ì œ ì™„ë£Œ Firebase ë™ê¸°í™” ì™„ë£Œ: ${completedTask.title}`);\r\n      } catch (firebaseError) {\r\n        logger.error('[DB] Firebase ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜:', firebaseError);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    logger.error(\"Error completing task:\", error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ì•„ì´í…œ ì‚¬ìš© ê¸°ë¡ - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const useItem = async (userId, itemName, effect, quantity = 1, context = '') => {\r\n  if (!userId || !itemName) {\r\n    logger.warn('[DB] useItem: userIdì™€ itemNameì´ í•„ìš”í•©ë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const contextText = context ? ` (${context})` : '';\r\n    await logActivity(userId, LOG_TYPES.ITEM_USE,\r\n      `${itemName} ${quantity}ê°œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.${contextText} íš¨ê³¼: ${effect}`,\r\n      {\r\n        itemName,\r\n        effect,\r\n        quantity,\r\n        context,\r\n        usageTime: new Date().toISOString()\r\n      }\r\n    );\r\n    logger.log(`[DB] ì•„ì´í…œ ì‚¬ìš© ê¸°ë¡ ì™„ë£Œ: ${itemName}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ì•„ì´í…œ ì‚¬ìš© ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ì•„ì´í…œ íšë“ ê¸°ë¡ - ìƒˆë¡œìš´ í•¨ìˆ˜ ì¶”ê°€\r\n */\r\nexport const obtainItem = async (userId, itemName, quantity = 1, source = 'unknown') => {\r\n  if (!userId || !itemName) {\r\n    logger.warn('[DB] obtainItem: userIdì™€ itemNameì´ í•„ìš”í•©ë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const sourceText = source !== 'unknown' ? ` (${source})` : '';\r\n    await logActivity(userId, LOG_TYPES.ITEM_OBTAIN,\r\n      `${itemName} ${quantity}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.${sourceText}`,\r\n      {\r\n        itemName,\r\n        quantity,\r\n        source,\r\n        obtainTime: new Date().toISOString()\r\n      }\r\n    );\r\n    logger.log(`[DB] ì•„ì´í…œ íšë“ ê¸°ë¡ ì™„ë£Œ: ${itemName}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ì•„ì´í…œ íšë“ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ê²Œì„ ê²°ê³¼ ê¸°ë¡ - ìƒì„¸í•œ ë¡œê¹… í¬í•¨\r\n */\r\nexport const recordGameResult = async (userId, gameName, result, reward = null, gameDetails = {}) => {\r\n  if (!userId || !gameName || !result) {\r\n    logger.warn('[DB] recordGameResult: ëª¨ë“  ë§¤ê°œë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const logType = result === 'win' ? LOG_TYPES.GAME_WIN :\r\n                   result === 'lose' ? LOG_TYPES.GAME_LOSE :\r\n                   LOG_TYPES.GAME_REWARD;\r\n\r\n    let description = `${gameName}ì—ì„œ ${result === 'win' ? 'ìŠ¹ë¦¬' : result === 'lose' ? 'íŒ¨ë°°' : 'ê²Œì„ ì™„ë£Œ'}í–ˆìŠµë‹ˆë‹¤.`;\r\n    const rewardDetails = [];\r\n\r\n    if (reward) {\r\n      if (reward.cash > 0) {\r\n        await updateUserCashInFirestore(userId, reward.cash, `${gameName} ë³´ìƒ`);\r\n        rewardDetails.push(`í˜„ê¸ˆ ${reward.cash}ì›`);\r\n      }\r\n      if (reward.coupons > 0) {\r\n        await updateUserCouponsInFirestore(userId, reward.coupons, `${gameName} ë³´ìƒ`);\r\n        rewardDetails.push(`ì¿ í° ${reward.coupons}ê°œ`);\r\n\r\n        // ì¿ í° íšë“ì— ëŒ€í•œ ë³„ë„ ë¡œê·¸ (ìˆ˜ì •ëœ ë¶€ë¶„)\r\n        await logActivity(userId, LOG_TYPES.COUPON_EARN,\r\n          `'ê²Œì„ ë³´ìƒ: ${gameName}' í™œë™ìœ¼ë¡œ ì¿ í° ${reward.coupons}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.`,\r\n          {\r\n            gameName,\r\n            result,\r\n            couponAmount: reward.coupons,\r\n            reason: 'game_reward',\r\n            activity: `ê²Œì„ ë³´ìƒ: ${gameName}`, // ì–´ë–¤ í™œë™ì¸ì§€ ëª…ì‹œ\r\n            gameDetails\r\n          }\r\n        );\r\n      }\r\n\r\n      if (rewardDetails.length > 0) {\r\n        description += ` ë³´ìƒ: ${rewardDetails.join(', ')}`;\r\n      }\r\n    }\r\n\r\n    await logActivity(userId, logType, description, {\r\n      gameName,\r\n      result,\r\n      reward,\r\n      gameDetails,\r\n      duration: gameDetails.duration || null,\r\n      score: gameDetails.score || null\r\n    });\r\n\r\n    logger.log(`[DB] ê²Œì„ ê²°ê³¼ ê¸°ë¡ ì™„ë£Œ: ${gameName} - ${result}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê²Œì„ ê²°ê³¼ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * ê´€ë¦¬ì ì•¡ì…˜ ê¸°ë¡\r\n */\r\nexport const recordAdminAction = async (adminId, action, targetUserId, details) => {\r\n  if (!adminId || !action || !targetUserId) {\r\n    logger.warn('[DB] recordAdminAction: í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    await logActivity(adminId, LOG_TYPES.ADMIN_ACTION,\r\n      `ê´€ë¦¬ìê°€ ${action} ì‘ì—…ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ëŒ€ìƒ: ${targetUserId}`,\r\n      { action, targetUserId, details }\r\n    );\r\n    logger.log(`[DB] ê´€ë¦¬ì ì•¡ì…˜ ê¸°ë¡ ì™„ë£Œ: ${action}`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê´€ë¦¬ì ì•¡ì…˜ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡\r\n */\r\nexport const recordSalaryPayment = async (userId, amount, period, details = {}) => {\r\n  if (!userId || !amount || amount <= 0) {\r\n    logger.warn('[DB] recordSalaryPayment: í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const userDoc = await getUserDocument(userId);\r\n    const classCode = userDoc?.classCode;\r\n\r\n    if (classCode) {\r\n      // ê¸‰ì—¬ì— ì†Œë“ì„¸ ì ìš©\r\n      const taxResult = await applyIncomeTax(classCode, userId, amount, 'salary');\r\n      const { netIncome, taxAmount } = taxResult;\r\n\r\n      await updateUserCashInFirestore(userId, netIncome,\r\n        `${period} ê¸‰ì—¬ ì§€ê¸‰ (ì„¸í›„ ${netIncome}ì›, ì†Œë“ì„¸ ${taxAmount}ì› ë‚©ë¶€)`\r\n      );\r\n\r\n      await logActivity(userId, LOG_TYPES.SALARY_PAYMENT,\r\n        `${period} ê¸‰ì—¬ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ${amount}ì›, ì„¸í›„ ${netIncome}ì›, ì†Œë“ì„¸ ${taxAmount}ì›)`,\r\n        {\r\n          grossAmount: amount,\r\n          netAmount: netIncome,\r\n          taxAmount,\r\n          period,\r\n          details,\r\n          paymentDate: new Date().toISOString()\r\n        }\r\n      );\r\n\r\n      logger.log(`[DB] ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡ ì™„ë£Œ: ${userId} - ì´ ${amount}ì› (ì„¸í›„ ${netIncome}ì›)`);\r\n    } else {\r\n      // í´ë˜ìŠ¤ ì½”ë“œê°€ ì—†ëŠ” ê²½ìš° ê¸°ì¡´ ë°©ì‹\r\n      await updateUserCashInFirestore(userId, amount, `${period} ê¸‰ì—¬ ì§€ê¸‰`);\r\n      await logActivity(userId, LOG_TYPES.SALARY_PAYMENT,\r\n        `${period} ê¸‰ì—¬ ${amount}ì›ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`,\r\n        {\r\n          amount,\r\n          period,\r\n          details,\r\n          paymentDate: new Date().toISOString()\r\n        }\r\n      );\r\n      logger.log(`[DB] ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡ ì™„ë£Œ: ${userId} - ${amount}ì›`);\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê¸‰ì—¬ ì§€ê¸‰ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * ì¿ í° ê´€ë ¨ ê´€ë¦¬ì ì•¡ì…˜\r\n */\r\nexport const adminCouponAction = async (adminId, targetUserId, action, amount, reason) => {\r\n  if (!adminId || !targetUserId || !action || !amount) {\r\n    logger.warn('[DB] adminCouponAction: í•„ìˆ˜ ë§¤ê°œë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const isGive = action === 'give';\r\n    const logType = isGive ? LOG_TYPES.COUPON_GIVE : LOG_TYPES.COUPON_TAKE;\r\n    const actionAmount = isGive ? amount : -Math.abs(amount);\r\n\r\n    await updateUserCouponsInFirestore(targetUserId, actionAmount,\r\n      `ê´€ë¦¬ì ${isGive ? 'ì§€ê¸‰' : 'íšŒìˆ˜'}: ${reason || 'ê´€ë¦¬ì ì¡°ì¹˜'}`\r\n    );\r\n\r\n    const targetDoc = await getUserDocument(targetUserId);\r\n    const targetName = targetDoc?.name || 'ì‚¬ìš©ì';\r\n\r\n    await logActivity(targetUserId, logType,\r\n      `ê´€ë¦¬ìê°€ ì¿ í° ${Math.abs(amount)}ê°œë¥¼ ${isGive ? 'ì§€ê¸‰' : 'íšŒìˆ˜'}í–ˆìŠµë‹ˆë‹¤.${reason ? ` ì‚¬ìœ : ${reason}` : ''}`,\r\n      {\r\n        adminId,\r\n        action,\r\n        amount: Math.abs(amount),\r\n        reason,\r\n        targetUserId,\r\n        targetName\r\n      }\r\n    );\r\n\r\n    // ê´€ë¦¬ì ì•¡ì…˜ë„ ë³„ë„ ê¸°ë¡\r\n    await recordAdminAction(adminId, `ì¿ í° ${isGive ? 'ì§€ê¸‰' : 'íšŒìˆ˜'}`, targetUserId, {\r\n      amount: Math.abs(amount),\r\n      reason\r\n    });\r\n\r\n    logger.log(`[DB] ê´€ë¦¬ì ì¿ í° ì•¡ì…˜ ì™„ë£Œ: ${action} - ${amount}ê°œ`);\r\n    return true;\r\n  } catch (error) {\r\n    logger.error('[DB] ê´€ë¦¬ì ì¿ í° ì•¡ì…˜ ì¤‘ ì˜¤ë¥˜:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Export log types for external use\r\nexport { LOG_TYPES, logActivity };"],"names":["validateAmount","amount","options","arguments","length","undefined","min","max","Number","MAX_SAFE_INTEGER","allowZero","fieldName","numAmount","isNaN","Error","concat","isFinite","toLocaleString","Math","floor","userDoc","allClassMembers","loading","authLoading","setUserDoc","setAllClassMembers","useAuth","selectedUsers","setSelectedUsers","useState","setAmount","amountType","setAmountType","action","setAction","takeMode","setTakeMode","taxRate","setTaxRate","message","setMessage","error","setError","selectAll","setSelectAll","isProcessing","setIsProcessing","adminName","name","adminClassCode","classCode","users","useMemo","sort","a","b","nameA","nickname","nameB","localeCompare","useEffect","calculatePreviewAmount","useCallback","userCash","inputValue","baseAmount","applyTax","previewAmounts","preview","forEach","userId","user","find","u","id","cash","_jsxs","className","children","_jsx","onSubmit","async","e","preventDefault","targetUsersData","filter","includes","count","totalProcessed","updatedUsers","targetUsers","_ref","logger","log","targetUsersCount","successCount","runTransaction","db","userRef","doc","transaction","get","exists","userData","data","currentCash","newCash","finalAmount","taxAmount","update","updatedAt","serverTimestamp","logRef","collection","logType","logDescription","logData","userName","timestamp","type","description","metadata","previousCash","set","transactionRef","transactionData","category","push","í˜„ì¬ì”ì•¡","ê¸°ë³¸ê¸ˆì•¡","ì„¸ê¸ˆ","ìµœì¢…ê¸ˆì•¡","ìƒˆì”ì•¡","userError","adminCashAction","currentMembers","map","member","updatedInfo","_objectSpread","currentAdminDoc","currentAdminCash","newAdminCash","actionText","setTimeout","err","onClick","value","checked","onChange","target","placeholder","required","htmlFor","_Fragment","handleSelectAll","prev","newSelectAll","_user$cash","previewAmount","handleUserSelection","prevSelected","disabled"],"ignoreList":[],"sourceRoot":""}