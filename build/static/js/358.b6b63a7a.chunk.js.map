{"version":3,"file":"static/js/358.b6b63a7a.chunk.js","mappings":"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","sources":["pages/banking/CouponTransfer.js"],"sourcesContent":["// src/CouponTransfer.js - ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸ë¡œ Firestore ì‚¬ìš©ëŸ‰ ìµœì í™”\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { db } from \"../../firebase\";\r\nimport { collection, doc, writeBatch, serverTimestamp } from \"firebase/firestore\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport \"./CouponTransfer.css\";\r\nimport { logger } from '../../utils/logger';\n\r\nfunction CouponTransfer() {\r\n  // AuthContextì—ì„œ í•„ìš”í•œ ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.\r\n  const {\r\n    userDoc,\r\n    allClassMembers, // ì „ì²´ í•™ê¸‰ êµ¬ì„±ì›\r\n    loading: authLoading,\r\n    addCouponsToUserById,\r\n    deductCouponsFromUserById,\r\n    updateLocalUserState, // ë¡œì»¬ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜ (ìˆë‹¤ë©´)\r\n  } = useAuth();\r\n\r\n  const [message, setMessage] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n  // ëŒ€ëŸ‰ ì‘ì—… ê´€ë ¨ ìƒíƒœ ë³€ìˆ˜\r\n  const [selectedUsers, setSelectedUsers] = useState([]);\r\n  const [couponAmount, setCouponAmount] = useState(\"\");\r\n  const [amountType, setAmountType] = useState(\"fixed\");\r\n  const [action, setAction] = useState(\"send\");\r\n  const [takeAction, setTakeAction] = useState(\"delete\");\r\n  const [selectAll, setSelectAll] = useState(false);\r\n  \r\n  // ë¡œì»¬ ì‚¬ìš©ì ë°ì´í„° ìƒíƒœ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ìš©)\r\n  const [localUsers, setLocalUsers] = useState([]);\r\n  const [localUserDoc, setLocalUserDoc] = useState(null);\r\n\r\n  const isAdmin = userDoc?.isAdmin || false;\r\n  const adminName = userDoc?.name;\r\n  const adminId = userDoc?.uid;\r\n  const adminClassCode = userDoc?.classCode;\r\n\r\n  // ì´ˆê¸° ë°ì´í„° ì„¤ì • ë° ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬\r\n  useEffect(() => {\r\n    if (allClassMembers) {\r\n      const sortedUsers = [...allClassMembers].sort((a, b) => {\r\n        const nameA = a.name || '';\r\n        const nameB = b.name || '';\r\n        return nameA.localeCompare(nameB, 'ko-KR');\r\n      });\r\n      setLocalUsers(sortedUsers);\r\n    }\r\n  }, [allClassMembers]);\r\n\r\n  // userDoc ë³€ê²½ ì‹œ ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸\r\n  useEffect(() => {\r\n    if (userDoc) {\r\n      setLocalUserDoc(userDoc);\r\n    }\r\n  }, [userDoc]);\r\n\r\n  // í™”ë©´ì— í‘œì‹œí•  ì‚¬ìš©ì ëª©ë¡ (ë¡œì»¬ ìƒíƒœ ìš°ì„  ì‚¬ìš©)\r\n  const users = localUsers.length > 0 ? localUsers : (allClassMembers || []).sort((a, b) => {\r\n    const nameA = a.name || '';\r\n    const nameB = b.name || '';\r\n    return nameA.localeCompare(nameB, 'ko-KR');\r\n  });\r\n\r\n  // í™”ë©´ì— í‘œì‹œí•  í˜„ì¬ ì‚¬ìš©ì ì •ë³´ (ë¡œì»¬ ìƒíƒœ ìš°ì„  ì‚¬ìš©)\r\n  const displayUserDoc = localUserDoc || userDoc;\r\n\r\n  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì´ˆê¸°í™”\r\n  useEffect(() => {\r\n    setSelectedUsers([]);\r\n    setCouponAmount(\"\");\r\n    setMessage(\"\");\r\n    setError(\"\");\r\n    setSelectAll(false);\r\n  }, []);\r\n\r\n  // --- ëŒ€ëŸ‰ ì‘ì—… ê´€ë ¨ í•¨ìˆ˜ë“¤ ---\r\n  const handleUserSelection = (userId) => {\r\n    setSelectedUsers((prev) =>\r\n      prev.includes(userId)\r\n        ? prev.filter((id) => id !== userId)\r\n        : [...prev, userId]\r\n    );\r\n  };\r\n\r\n  const handleSelectAll = () => {\r\n    setSelectAll(!selectAll);\r\n    if (!selectAll) {\r\n      setSelectedUsers(users.map((user) => user.id));\r\n    } else {\r\n      setSelectedUsers([]);\r\n    }\r\n  };\r\n\r\n  const calculateAmount = (userCoupons, inputValue) => {\r\n    if (amountType === \"percentage\") {\r\n      return Math.floor((userCoupons * Number(inputValue)) / 100);\r\n    }\r\n    return Number(inputValue);\r\n  };\r\n\r\n  const getPreviewAmounts = () => {\r\n    if (!couponAmount || selectedUsers.length === 0) return {};\r\n    const preview = {};\r\n    selectedUsers.forEach((userId) => {\r\n      const user = users.find((u) => u.id === userId);\r\n      if (user) {\r\n        const calculatedAmount = calculateAmount(\r\n          Number(user.coupons || 0),\r\n          couponAmount\r\n        );\r\n        preview[userId] = calculatedAmount;\r\n      }\r\n    });\r\n    return preview;\r\n  };\r\n\r\n  // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜\r\n  const updateLocalState = (userId, couponChange) => {\r\n    // ì‚¬ìš©ì ëª©ë¡ ì—…ë°ì´íŠ¸\r\n    setLocalUsers(prevUsers => \r\n      prevUsers.map(user => \r\n        user.id === userId \r\n          ? { ...user, coupons: Math.max(0, (user.coupons || 0) + couponChange) }\r\n          : user\r\n      )\r\n    );\r\n    \r\n    // ê´€ë¦¬ì ì •ë³´ ì—…ë°ì´íŠ¸ (í•„ìš”í•œ ê²½ìš°)\r\n    if (userId === adminId) {\r\n      setLocalUserDoc(prev => ({\r\n        ...prev,\r\n        coupons: Math.max(0, (prev?.coupons || 0) + couponChange)\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleBulkSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!selectedUsers.length || !couponAmount || isNaN(Number(couponAmount))) {\r\n      setError(\"ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ê³  ìœ íš¨í•œ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.\");\r\n      return;\r\n    }\r\n    \r\n    setIsProcessing(true);\r\n    setMessage(\"\");\r\n    setError(\"\");\r\n\r\n    try {\r\n      const batch = writeBatch(db);\r\n      let successCount = 0;\r\n      let totalAmount = 0;\r\n      const updateQueue = []; // ë¡œì»¬ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ í\r\n\r\n      for (const userId of selectedUsers) {\r\n        const userToUpdate = users.find((user) => user.id === userId);\r\n        if (!userToUpdate) continue;\r\n\r\n        const currentCoupons = Number(userToUpdate.coupons || 0);\r\n        const transferAmount = calculateAmount(currentCoupons, couponAmount);\r\n        totalAmount += transferAmount;\r\n\r\n        try {\r\n          if (action === \"send\") {\r\n            // ì¿ í° ì§€ê¸‰\r\n            await addCouponsToUserById(userId, transferAmount);\r\n            updateQueue.push({ userId, change: transferAmount });\r\n          } else { // 'take'\r\n            if (takeAction === \"transfer\") {\r\n              // ì‚¬ìš©ìì—ê²Œì„œ ì°¨ê°í•˜ê³  ê´€ë¦¬ìì—ê²Œ ì¶”ê°€\r\n              await deductCouponsFromUserById(userId, transferAmount);\r\n              await addCouponsToUserById(adminId, transferAmount);\r\n              updateQueue.push({ userId, change: -transferAmount });\r\n              updateQueue.push({ userId: adminId, change: transferAmount });\r\n            } else { // 'delete'\r\n              // ì‚¬ìš©ìì—ê²Œì„œë§Œ ì°¨ê°\r\n              await deductCouponsFromUserById(userId, transferAmount);\r\n              updateQueue.push({ userId, change: -transferAmount });\r\n            }\r\n          }\r\n\r\n          // ë¡œê·¸ ê¸°ë¡\r\n          const logRef = doc(collection(db, \"activity_logs\"));\r\n          const logActionDetail = action === \"send\" \r\n            ? \"ëŒ€ëŸ‰ ì§€ê¸‰\" \r\n            : takeAction === \"transfer\" \r\n              ? \"ëŒ€ëŸ‰ íšŒìˆ˜(ê´€ë¦¬ì ì´ì „)\" \r\n              : \"ëŒ€ëŸ‰ ì‚­ì œ\";\r\n          \r\n          const logDetails = `ê´€ë¦¬ì(${adminName})ê°€ ${userToUpdate.name}ë‹˜ì—ê²Œ ì¿ í° ${transferAmount.toLocaleString()}ê°œë¥¼ ${logActionDetail}í–ˆìŠµë‹ˆë‹¤. (${amountType === 'percentage' ? `${couponAmount}% ì ìš©` : 'ê³ ì • ê°œìˆ˜'})`;\r\n          \r\n          batch.set(logRef, {\r\n            userId,\r\n            userName: userToUpdate.name,\r\n            timestamp: serverTimestamp(),\r\n            type: \"couponAdminAction\",\r\n            description: logDetails,\r\n            classCode: adminClassCode,\r\n            adminId,\r\n            adminName\r\n          });\r\n\r\n          successCount++;\r\n        } catch (userError) {\r\n          logger.error(`ì‚¬ìš©ì ${userId} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, userError);\r\n        }\r\n      }\r\n\r\n      await batch.commit();\r\n\r\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (Firestore ì½ê¸° ì—†ì´)\r\n      updateQueue.forEach(({ userId, change }) => {\r\n        updateLocalState(userId, change);\r\n      });\r\n\r\n      setMessage(`${successCount}ëª…ì—ê²Œ ì¿ í° ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ${totalAmount.toLocaleString()}ê°œ)`);\r\n      setCouponAmount(\"\");\r\n      setSelectedUsers([]);\r\n      setSelectAll(false);\r\n      \r\n      // ì„±ê³µ ë©”ì‹œì§€ë¥¼ 3ì´ˆ í›„ ìë™ ì œê±°\r\n      setTimeout(() => setMessage(\"\"), 3000);\r\n      \r\n    } catch (err) {\r\n      logger.error(\"ëŒ€ëŸ‰ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:\", err);\r\n      setError(`ì˜¤ë¥˜ ë°œìƒ: ${err.message}`);\r\n      \r\n      // ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ 5ì´ˆ í›„ ìë™ ì œê±°\r\n      setTimeout(() => setError(\"\"), 5000);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  // ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ì ‘ê·¼ ì œí•œ\r\n  if (!isAdmin) {\r\n    return (\r\n      <div className=\"coupon-transfer-container\">\r\n        <div className=\"alert alert-error\">\r\n          ê´€ë¦¬ìë§Œ ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (authLoading && users.length === 0) {\r\n    return (\r\n      <div className=\"coupon-transfer-container\">\r\n        <div className=\"loading\">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  const previewAmounts = getPreviewAmounts();\r\n  \r\n  return (\r\n    <div className=\"coupon-transfer-container\">\r\n      <div className=\"header\">\r\n        <h3>ì¿ í° ëŒ€ëŸ‰ ê´€ë¦¬</h3>\r\n        <div className=\"admin-info\">\r\n          <span className=\"admin-label\">{displayUserDoc?.name || \"ì‚¬ìš©ì\"}</span>\r\n          <span className=\"admin-coupons\">ë³´ìœ  ì¿ í°: {(displayUserDoc?.coupons || 0).toLocaleString()}ê°œ</span>\r\n          <span className=\"admin-cash\" style={{marginLeft: '10px'}}>í˜„ê¸ˆ: {(displayUserDoc?.cash || 0).toLocaleString()}ì›</span>\r\n        </div>\r\n      </div>\r\n      \r\n      {error && <div className=\"alert alert-error\">{error}</div>}\r\n      {message && <div className=\"alert alert-success\">{message}</div>}\r\n\r\n      <form onSubmit={handleBulkSubmit} className=\"transfer-form\">\r\n        <div className=\"action-selector\">\r\n          <button \r\n            type=\"button\" \r\n            className={`action-btn ${action === \"send\" ? \"active send\" : \"\"}`} \r\n            onClick={() => setAction(\"send\")}\r\n          >\r\n            ğŸ“¤ ë³´ë‚´ê¸°\r\n          </button>\r\n          <button \r\n            type=\"button\" \r\n            className={`action-btn ${action === \"take\" ? \"active take\" : \"\"}`} \r\n            onClick={() => setAction(\"take\")}\r\n          >\r\n            ğŸ“¥ ê°€ì ¸ì˜¤ê¸°\r\n          </button>\r\n        </div>\r\n        \r\n        {action === 'take' && (\r\n          <div className=\"amount-type-selector\" style={{ margin: \"10px 0\" }}>\r\n            <label className={`type-option ${takeAction === 'delete' ? 'active' : ''}`}>\r\n              <input \r\n                type=\"radio\" \r\n                value=\"delete\" \r\n                checked={takeAction === 'delete'} \r\n                onChange={(e) => setTakeAction(e.target.value)} \r\n              /> \r\n              ì‚­ì œí•˜ê¸°\r\n            </label>\r\n            <label className={`type-option ${takeAction === 'transfer' ? 'active' : ''}`}>\r\n              <input \r\n                type=\"radio\" \r\n                value=\"transfer\" \r\n                checked={takeAction === 'transfer'} \r\n                onChange={(e) => setTakeAction(e.target.value)} \r\n              /> \r\n              ë‚˜ì—ê²Œ ê°€ì ¸ì˜¤ê¸°\r\n            </label>\r\n          </div>\r\n        )}\r\n        \r\n        <div className=\"amount-section\">\r\n          <div className=\"amount-type-selector\">\r\n            <label className={`type-option ${amountType === 'fixed' ? 'active' : ''}`}>\r\n              <input \r\n                type=\"radio\" \r\n                value=\"fixed\" \r\n                checked={amountType === 'fixed'} \r\n                onChange={(e) => setAmountType(e.target.value)} \r\n              /> \r\n              ê³ ì • ê°œìˆ˜\r\n            </label>\r\n            <label className={`type-option ${amountType === 'percentage' ? 'active' : ''}`}>\r\n              <input \r\n                type=\"radio\" \r\n                value=\"percentage\" \r\n                checked={amountType === 'percentage'} \r\n                onChange={(e) => setAmountType(e.target.value)} \r\n              /> \r\n              í¼ì„¼íŠ¸ (%)\r\n            </label>\r\n          </div>\r\n          <div className=\"amount-input-group\">\r\n            <input \r\n              type=\"number\" \r\n              value={couponAmount} \r\n              onChange={(e) => setCouponAmount(e.target.value)} \r\n              placeholder={amountType === 'fixed' ? 'ì¿ í° ê°œìˆ˜' : 'í¼ì„¼íŠ¸'} \r\n              min=\"1\" \r\n              required \r\n              className=\"amount-input\"\r\n            />\r\n            <span className=\"amount-unit\">{amountType === 'fixed' ? 'ê°œ' : '%'}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"user-selection-section\">\r\n          <div className=\"section-header\">\r\n            <h3>ëŒ€ìƒ ì„ íƒ</h3>\r\n            <label className=\"select-all-label\">\r\n              <input \r\n                type=\"checkbox\" \r\n                checked={selectAll} \r\n                onChange={handleSelectAll} \r\n                className=\"checkbox-custom\"\r\n              /> \r\n              <span className=\"checkmark\"></span>\r\n              ì „ì²´ ì„ íƒ\r\n            </label>\r\n          </div>\r\n          <div className=\"user-list\">\r\n            {users.map(user => (\r\n              <div key={user.id} className=\"user-item\">\r\n                <label className=\"user-label\">\r\n                  <input \r\n                    type=\"checkbox\" \r\n                    className=\"checkbox-custom\"\r\n                    checked={selectedUsers.includes(user.id)} \r\n                    onChange={() => handleUserSelection(user.id)} \r\n                  />\r\n                  <span className=\"checkmark\"></span>\r\n                  <div className=\"user-info\">\r\n                    <span className=\"user-name\">{user.name}</span>\r\n                    <span className=\"user-balance\">ì¿ í°: {user.coupons?.toLocaleString() || 0}ê°œ</span>\r\n                    {previewAmounts[user.id] !== undefined && (\r\n                      <span className={`preview-amount ${action}`}>\r\n                        {action === 'send' ? '+' : '-'}{previewAmounts[user.id].toLocaleString()}ê°œ\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </label>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <button \r\n          type=\"submit\" \r\n          className={`submit-btn ${action}`} \r\n          disabled={isProcessing}\r\n        >\r\n          {isProcessing ? 'ì²˜ë¦¬ ì¤‘...' : 'ì‹¤í–‰'}\r\n        </button>\r\n      </form>\r\n\r\n      <div className=\"recent-users\">\r\n        <h4>í•™ê¸‰ ì‚¬ìš©ì ëª©ë¡</h4>\r\n        <div className=\"users-grid\">\r\n          {users.map(user => (\r\n            <div key={user.id} className=\"user-card\">\r\n              <div className=\"user-name\">{user.name}</div>\r\n              <div className=\"user-coupons\">ì¿ í°: {user.coupons?.toLocaleString() || 0}ê°œ</div>\r\n              <div className=\"user-cash\">í˜„ê¸ˆ: {user.cash?.toLocaleString() || 0}ì›</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CouponTransfer;"],"names":["userDoc","allClassMembers","loading","authLoading","addCouponsToUserById","deductCouponsFromUserById","updateLocalUserState","useAuth","message","setMessage","useState","error","setError","isProcessing","setIsProcessing","selectedUsers","setSelectedUsers","couponAmount","setCouponAmount","amountType","setAmountType","action","setAction","takeAction","setTakeAction","selectAll","setSelectAll","localUsers","setLocalUsers","localUserDoc","setLocalUserDoc","isAdmin","adminName","name","adminId","uid","adminClassCode","classCode","useEffect","sortedUsers","sort","a","b","nameA","nameB","localeCompare","users","length","displayUserDoc","calculateAmount","userCoupons","inputValue","Math","floor","Number","_jsx","className","children","previewAmounts","getPreviewAmounts","preview","forEach","userId","user","find","u","id","calculatedAmount","coupons","_jsxs","toLocaleString","style","marginLeft","cash","onSubmit","async","e","preventDefault","isNaN","batch","writeBatch","db","successCount","totalAmount","updateQueue","userToUpdate","currentCoupons","transferAmount","push","change","logRef","doc","collection","logActionDetail","logDetails","concat","set","userName","timestamp","serverTimestamp","type","description","userError","logger","commit","_ref","updateLocalState","couponChange","prevUsers","map","_objectSpread","max","prev","setTimeout","err","onClick","margin","value","checked","onChange","target","placeholder","min","required","handleSelectAll","_user$coupons","includes","handleUserSelection","filter","undefined","disabled","_user$coupons2","_user$cash"],"ignoreList":[],"sourceRoot":""}